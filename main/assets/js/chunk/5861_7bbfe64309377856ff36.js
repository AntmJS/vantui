/*! For license information please see 5861_7bbfe64309377856ff36.js.LICENSE.txt */
"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[5861],{"8840":function(R,_,I){I.d(_,{"a":function(){return createCommonjsModule},"b":function(){return C},"c":function(){return w},"g":function(){return getDefaultExportFromCjs}});var C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==I.g?I.g:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(R){return R&&R.__esModule&&Object.prototype.hasOwnProperty.call(R,"default")?R.default:R}function createCommonjsModule(R,_,I){return R(I={"path":_,"exports":{},"require":function require(R,_){return function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},I.exports),I.exports}var w=createCommonjsModule((function(R){!function(){var _={}.hasOwnProperty;function r(){for(var R=[],I=0;I<arguments.length;I++){var C=arguments[I];if(C){var w=typeof C;if("string"===w||"number"===w)R.push(C);else if(Array.isArray(C)){if(C.length){var O=r.apply(null,C);O&&R.push(O)}}else if("object"===w)if(C.toString===Object.prototype.toString)for(var x in C)_.call(C,x)&&C[x]&&R.push(x);else R.push(C.toString())}}return R.join(" ")}R.exports?(r.default=r,R.exports=r):window.classNames=r}()}))},"3160":function(R,_,I){function throttle(R,_,I){void 0===_&&(_=250);var C,w=0;return function(){for(var O=[],x=0;x<arguments.length;x++)O[x]=arguments[x];var P=I||this,F=Date.now();F-w>_?(R.apply(this,O),w=F):(clearTimeout(C),C=setTimeout((function(){w=F,R.apply(P,O)}),_))}}function debounce(R,_,I){var C;return void 0===_&&(_=250),function(){for(var w=[],O=0;O<arguments.length;O++)w[O]=arguments[O];var x=I||this;clearTimeout(C),C=setTimeout((function(){R.apply(x,w)}),_)}}I.d(_,{"d":function(){return debounce},"t":function(){return throttle}})},"5861":function(R,_,I){I.r(_),I.d(_,{"taro_video_control":function(){return N},"taro_video_core":function(){return G},"taro_video_danmu":function(){return j}});var C=I(7109),w=I(8840),O=I(3160),__generator=function(R,_){var I,C,w,O,x={"label":0,"sent":function sent(){if(1&w[0])throw w[1];return w[1]},"trys":[],"ops":[]};return O={"next":o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function o(R){return function(_){return l([R,_])}}function l(O){if(I)throw new TypeError("Generator is already executing.");for(;x;)try{if(I=1,C&&(w=2&O[0]?C.return:O[0]?C.throw||((w=C.return)&&w.call(C),0):C.next)&&!(w=w.call(C,O[1])).done)return w;switch(C=0,w&&(O=[2&O[0],w.value]),O[0]){case 0:case 1:w=O;break;case 4:return x.label++,{"value":O[1],"done":!1};case 5:x.label++,C=O[1],O=[0];continue;case 7:O=x.ops.pop(),x.trys.pop();continue;default:if(!(w=x.trys,(w=w.length>0&&w[w.length-1])||6!==O[0]&&2!==O[0])){x=0;continue}if(3===O[0]&&(!w||O[1]>w[0]&&O[1]<w[3])){x.label=O[1];break}if(6===O[0]&&x.label<w[1]){x.label=w[1],w=O;break}if(w&&x.label<w[2]){x.label=w[2],x.ops.push(O);break}w[2]&&x.ops.pop(),x.trys.pop();continue}O=_.call(R,x)}catch(R){O=[6,R],C=0}finally{I=w=0}if(5&O[0])throw O[1];return{"value":O[0]?O[1]:void 0,"done":!0}}},__spreadArray=function(R,_){for(var I=0,C=_.length,w=R.length;I<C;I++,w++)R[w]=_[I];return R},x=function formatTime(R){if(!R)return"";var _=Math.round(R%60),I=Math.round((R-_)/60);return(I<10?"0"+I:I)+":"+(_<10?"0"+_:_)},P=function normalizeNumber(R){return Math.max(-1,Math.min(R,1))},F="default",M=function(){for(var R,_=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],I=["webkitEnterFullscreen","webkitExitFullscreen","webkitCurrentFullScreenElement","webkitSupportsFullscreen","fullscreenchange","fullscreenerror"],C=0,w=_.length,O={};C<w;C++)if((R=_[C])&&R[1]in document){for(C=0;C<R.length;C++)O[_[0][C]]=R[C];return O}if(!O[_[0][0]])for(F="iOS",C=0;C<I.length;C++)O[_[0][C]]=I[C];return O}(),__awaiter$2=function(R,_,I,C){function a(R){return R instanceof I?R:new I((function(_){_(R)}))}return new(I||(I=Promise))((function(I,w){function s(R){try{l(C.next(R))}catch(R){w(R)}}function o(R){try{l(C.throw(R))}catch(R){w(R)}}function l(R){R.done?I(R.value):a(R.value).then(s,o)}l((C=C.apply(R,_||[])).next())}))},N=function(){function e(R){var _=this;(0,C.r)(this,R),this.visible=!1,this.isDraggingProgressBall=!1,this.percentage=0,this.progressDimensions={"left":0,"width":0},this.calcPercentage=function(R){var I=R-_.progressDimensions.left;return I=Math.max(I,0),(I=Math.min(I,_.progressDimensions.width))/_.progressDimensions.width},this.onDragProgressBallStart=function(){_.isDraggingProgressBall=!0,_.hideControlsTimer&&clearTimeout(_.hideControlsTimer)},this.onClickProgress=function(R){R.stopPropagation();var I=_.calcPercentage(R.pageX);_.seekFunc(I*_.duration),_.toggleVisibility(!0)}}return e.prototype.onDocumentTouchMove=function(R){if(this.isDraggingProgressBall){var _=R.touches[0].pageX;this.percentage=this.calcPercentage(_),this.setProgressBall(this.percentage),this.setCurrentTime(this.percentage*this.duration)}},e.prototype.onDocumentTouchEnd=function(){this.isDraggingProgressBall&&(this.isDraggingProgressBall=!1,this.seekFunc(this.percentage*this.duration),this.toggleVisibility(!0))},e.prototype.setProgressBall=function(R){return __awaiter$2(this,void 0,void 0,(function(){return __generator(this,(function(_){return this.progressBallRef&&(this.progressBallRef.style.left=100*R+"%"),[2]}))}))},e.prototype.toggleVisibility=function(R){return __awaiter$2(this,void 0,void 0,(function(){var _,I=this;return __generator(this,(function(C){return(_=void 0===R?!this.visible:R)?(this.hideControlsTimer&&clearTimeout(this.hideControlsTimer),this.isPlaying&&(this.hideControlsTimer=setTimeout((function(){I.toggleVisibility(!1)}),2e3)),this.el.style.visibility="visible"):this.el.style.visibility="hidden",this.visible=!!_,[2]}))}))},e.prototype.getIsDraggingProgressBall=function(){return __awaiter$2(this,void 0,void 0,(function(){return __generator(this,(function(R){return[2,this.isDraggingProgressBall]}))}))},e.prototype.setCurrentTime=function(R){return __awaiter$2(this,void 0,void 0,(function(){return __generator(this,(function(_){return this.currentTimeRef.innerHTML=x(R),[2]}))}))},e.prototype.render=function(){var R,_=this,I=this,w=I.controls,O=I.currentTime,P=I.duration,F=I.isPlaying,M=I.pauseFunc,N=I.playFunc,B=I.showPlayBtn,U=I.showProgress,G=x(P);return R=B?F?(0,C.h)("div",{"class":"taro-video-control-button taro-video-control-button-pause","onClick":M}):(0,C.h)("div",{"class":"taro-video-control-button taro-video-control-button-play","onClick":N}):null,(0,C.h)(C.H,{"class":"taro-video-bar taro-video-bar-full"},w&&(0,C.h)("div",{"class":"taro-video-controls"},R,U&&(0,C.h)("div",{"class":"taro-video-current-time","ref":function ref(R){return _.currentTimeRef=R}},x(O)),U&&(0,C.h)("div",{"class":"taro-video-progress-container","onClick":this.onClickProgress},(0,C.h)("div",{"class":"taro-video-progress","ref":function ref(R){if(R){var I=R.getBoundingClientRect();_.progressDimensions.left=I.left,_.progressDimensions.width=I.width}}},(0,C.h)("div",{"class":"taro-video-progress-buffered","style":{"width":"100%"}}),(0,C.h)("div",{"class":"taro-video-ball","ref":function ref(R){return _.progressBallRef=R},"onTouchStart":this.onDragProgressBallStart,"style":{"left":(G?this.currentTime/P*100:0)+"%"}},(0,C.h)("div",{"class":"taro-video-inner"})))),U&&(0,C.h)("div",{"class":"taro-video-duration"},G)),(0,C.h)("slot",null))},Object.defineProperty(e.prototype,"el",{"get":function get(){return(0,C.g)(this)},"enumerable":!1,"configurable":!0}),e}(),B=(0,w.a)((function(R,_){"undefined"!=typeof window&&function t(_,I){R.exports=I()}(w.b,(function(){return function(R){var _={};function r(I){if(_[I])return _[I].exports;var C=_[I]={"i":I,"l":!1,"exports":{}};return R[I].call(C.exports,C,C.exports,r),C.l=!0,C.exports}return r.m=R,r.c=_,r.d=function(R,_,I){r.o(R,_)||Object.defineProperty(R,_,{"enumerable":!0,"get":I})},r.r=function(R){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(R,Symbol.toStringTag,{"value":"Module"}),Object.defineProperty(R,"__esModule",{"value":!0})},r.t=function(R,_){if(1&_&&(R=r(R)),8&_)return R;if(4&_&&"object"==typeof R&&R&&R.__esModule)return R;var I=Object.create(null);if(r.r(I),Object.defineProperty(I,"default",{"enumerable":!0,"value":R}),2&_&&"string"!=typeof R)for(var C in R)r.d(I,C,function(_){return R[_]}.bind(null,C));return I},r.n=function(R){var _=R&&R.__esModule?function t(){return R.default}:function t(){return R};return r.d(_,"a",_),_},r.o=function(R,_){return Object.prototype.hasOwnProperty.call(R,_)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function _node_modules_eventemitter3_indexJs(R,_,I){var C=Object.prototype.hasOwnProperty,w="~";function n(){}function s(R,_,I){this.fn=R,this.context=_,this.once=I||!1}function o(R,_,I,C,O){if("function"!=typeof I)throw new TypeError("The listener must be a function");var x=new s(I,C||R,O),P=w?w+_:_;return R._events[P]?R._events[P].fn?R._events[P]=[R._events[P],x]:R._events[P].push(x):(R._events[P]=x,R._eventsCount++),R}function l(R,_){0===--R._eventsCount?R._events=new n:delete R._events[_]}function u(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(w=!1)),u.prototype.eventNames=function e(){var R,_,I=[];if(0===this._eventsCount)return I;for(_ in R=this._events)C.call(R,_)&&I.push(w?_.slice(1):_);return Object.getOwnPropertySymbols?I.concat(Object.getOwnPropertySymbols(R)):I},u.prototype.listeners=function e(R){var _=w?w+R:R,I=this._events[_];if(!I)return[];if(I.fn)return[I.fn];for(var C=0,O=I.length,x=new Array(O);C<O;C++)x[C]=I[C].fn;return x},u.prototype.listenerCount=function e(R){var _=w?w+R:R,I=this._events[_];return I?I.fn?1:I.length:0},u.prototype.emit=function e(R,_,I,C,O,x){var P=w?w+R:R;if(!this._events[P])return!1;var F,M,N=this._events[P],B=arguments.length;if(N.fn){switch(N.once&&this.removeListener(R,N.fn,void 0,!0),B){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,_),!0;case 3:return N.fn.call(N.context,_,I),!0;case 4:return N.fn.call(N.context,_,I,C),!0;case 5:return N.fn.call(N.context,_,I,C,O),!0;case 6:return N.fn.call(N.context,_,I,C,O,x),!0}for(M=1,F=new Array(B-1);M<B;M++)F[M-1]=arguments[M];N.fn.apply(N.context,F)}else{var U,G=N.length;for(M=0;M<G;M++)switch(N[M].once&&this.removeListener(R,N[M].fn,void 0,!0),B){case 1:N[M].fn.call(N[M].context);break;case 2:N[M].fn.call(N[M].context,_);break;case 3:N[M].fn.call(N[M].context,_,I);break;case 4:N[M].fn.call(N[M].context,_,I,C);break;default:if(!F)for(U=1,F=new Array(B-1);U<B;U++)F[U-1]=arguments[U];N[M].fn.apply(N[M].context,F)}}return!0},u.prototype.on=function e(R,_,I){return o(this,R,_,I,!1)},u.prototype.once=function e(R,_,I){return o(this,R,_,I,!0)},u.prototype.removeListener=function e(R,_,I,C){var O=w?w+R:R;if(!this._events[O])return this;if(!_)return l(this,O),this;var x=this._events[O];if(x.fn)x.fn!==_||C&&!x.once||I&&x.context!==I||l(this,O);else{for(var P=0,F=[],M=x.length;P<M;P++)(x[P].fn!==_||C&&!x[P].once||I&&x[P].context!==I)&&F.push(x[P]);F.length?this._events[O]=1===F.length?F[0]:F:l(this,O)}return this},u.prototype.removeAllListeners=function e(R){var _;return R?(_=w?w+R:R,this._events[_]&&l(this,_)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=w,u.EventEmitter=u,R.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":function _node_modules_urlToolkit_src_urlToolkitJs(R,_,I){!function(){var _=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,I=/^([^\/?#]*)([^]*)$/,C=/(?:\/|^)\.(?=\/)/g,w=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,O={"buildAbsoluteURL":function buildAbsoluteURL(R,_,C){if(C=C||{},R=R.trim(),!(_=_.trim())){if(!C.alwaysNormalize)return R;var w=O.parseURL(R);if(!w)throw new Error("Error trying to parse base URL.");return w.path=O.normalizePath(w.path),O.buildURLFromParts(w)}var x=O.parseURL(_);if(!x)throw new Error("Error trying to parse relative URL.");if(x.scheme)return C.alwaysNormalize?(x.path=O.normalizePath(x.path),O.buildURLFromParts(x)):_;var P=O.parseURL(R);if(!P)throw new Error("Error trying to parse base URL.");if(!P.netLoc&&P.path&&"/"!==P.path[0]){var F=I.exec(P.path);P.netLoc=F[1],P.path=F[2]}P.netLoc&&!P.path&&(P.path="/");var M={"scheme":P.scheme,"netLoc":x.netLoc,"path":null,"params":x.params,"query":x.query,"fragment":x.fragment};if(!x.netLoc&&(M.netLoc=P.netLoc,"/"!==x.path[0]))if(x.path){var N=P.path,B=N.substring(0,N.lastIndexOf("/")+1)+x.path;M.path=O.normalizePath(B)}else M.path=P.path,x.params||(M.params=P.params,x.query||(M.query=P.query));return null===M.path&&(M.path=C.alwaysNormalize?O.normalizePath(x.path):x.path),O.buildURLFromParts(M)},"parseURL":function parseURL(R){var I=_.exec(R);return I?{"scheme":I[1]||"","netLoc":I[2]||"","path":I[3]||"","params":I[4]||"","query":I[5]||"","fragment":I[6]||""}:null},"normalizePath":function normalizePath(R){for(R=R.split("").reverse().join("").replace(C,"");R.length!==(R=R.replace(w,"")).length;);return R.split("").reverse().join("")},"buildURLFromParts":function buildURLFromParts(R){return R.scheme+R.netLoc+R.path+R.params+R.query+R.fragment}};R.exports=O}()},"./node_modules/webworkify-webpack/index.js":function _node_modules_webworkifyWebpack_indexJs(R,_,I){function i(R){var _={};function r(I){if(_[I])return _[I].exports;var C=_[I]={"i":I,"l":!1,"exports":{}};return R[I].call(C.exports,C,C.exports,r),C.l=!0,C.exports}r.m=R,r.c=_,r.i=function(R){return R},r.d=function(R,_,I){r.o(R,_)||Object.defineProperty(R,_,{"configurable":!1,"enumerable":!0,"get":I})},r.r=function(R){Object.defineProperty(R,"__esModule",{"value":!0})},r.n=function(R){var _=R&&R.__esModule?function t(){return R.default}:function t(){return R};return r.d(_,"a",_),_},r.o=function(R,_){return Object.prototype.hasOwnProperty.call(R,_)},r.p="/",r.oe=function(R){throw console.error(R),R};var I=r(r.s=ENTRY_MODULE);return I.default||I}var C="[\\.|\\-|\\+|\\w|/|@]+",w="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+C+").*?\\)";function s(R){return(R+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(R){return!isNaN(1*R)}function l(R,_,O){var x={};x[O]=[];var P=_.toString(),F=P.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!F)return x;for(var M,N=F[1],B=new RegExp("(\\\\n|\\W)"+s(N)+w,"g");M=B.exec(P);)"dll-reference"!==M[3]&&x[O].push(M[3]);for(B=new RegExp("\\("+s(N)+'\\("(dll-reference\\s('+C+'))"\\)\\)'+w,"g");M=B.exec(P);)R[M[2]]||(x[O].push(M[1]),R[M[2]]=I(M[1]).m),x[M[2]]=x[M[2]]||[],x[M[2]].push(M[4]);for(var U=Object.keys(x),G=0;G<U.length;G++)for(var j=0;j<x[U[G]].length;j++)o(x[U[G]][j])&&(x[U[G]][j]=1*x[U[G]][j]);return x}function u(R){return Object.keys(R).reduce((function(_,I){return _||R[I].length>0}),!1)}function f(R,_){for(var I={"main":[_]},C={"main":[]},w={"main":{}};u(I);)for(var O=Object.keys(I),x=0;x<O.length;x++){var P=O[x],F=I[P].pop();if(w[P]=w[P]||{},!w[P][F]&&R[P][F]){w[P][F]=!0,C[P]=C[P]||[],C[P].push(F);for(var M=l(R,R[P][F],P),N=Object.keys(M),B=0;B<N.length;B++)I[N[B]]=I[N[B]]||[],I[N[B]]=I[N[B]].concat(M[N[B]])}}return C}R.exports=function(R,_){_=_||{};var C={"main":I.m},w=_.all?{"main":Object.keys(C.main)}:f(C,R),O="";Object.keys(w).filter((function(R){return"main"!==R})).forEach((function(R){for(var _=0;w[R][_];)_++;w[R].push(_),C[R][_]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",O=O+"var "+R+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(_))+")({"+w[R].map((function(_){return JSON.stringify(_)+": "+C[R][_].toString()})).join(",")+"});\n"})),O=O+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(R))+")({"+w.main.map((function(R){return JSON.stringify(R)+": "+C.main[R].toString()})).join(",")+"}))(self);";var x=new window.Blob([O],{"type":"text/javascript"});if(_.bare)return x;var P=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(x),F=new window.Worker(P);return F.objectURL=P,F}},"./src/config.ts":function _src_configTs(R,_,I){I.r(_),I.d(_,"hlsDefaultConfig",(function(){return Y})),I.d(_,"mergeConfig",(function(){return D})),I.d(_,"enableStreamingMode",(function(){return k}));var C=I("./src/controller/abr-controller.ts"),w=I("./src/controller/audio-stream-controller.ts"),O=I("./src/controller/audio-track-controller.ts"),x=I("./src/controller/subtitle-stream-controller.ts"),P=I("./src/controller/subtitle-track-controller.ts"),F=I("./src/controller/buffer-controller.ts"),M=I("./src/controller/timeline-controller.ts"),N=I("./src/controller/cap-level-controller.ts"),B=I("./src/controller/fps-controller.ts"),U=I("./src/controller/eme-controller.ts"),G=I("./src/controller/cmcd-controller.ts"),j=I("./src/utils/xhr-loader.ts"),K=I("./src/utils/fetch-loader.ts"),H=I("./src/utils/cues.ts"),V=I("./src/utils/mediakeys-helper.ts"),W=I("./src/utils/logger.ts");function E(){return E=Object.assign||function(R){for(var _=1;_<arguments.length;_++){var I=arguments[_];for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(R[C]=I[C])}return R},E.apply(this,arguments)}function T(R,_){var I=Object.keys(R);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(R);_&&(C=C.filter((function(_){return Object.getOwnPropertyDescriptor(R,_).enumerable}))),I.push.apply(I,C)}return I}function b(R){for(var _=1;_<arguments.length;_++){var I=null!=arguments[_]?arguments[_]:{};_%2?T(Object(I),!0).forEach((function(_){S(R,_,I[_])})):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(I)):T(Object(I)).forEach((function(_){Object.defineProperty(R,_,Object.getOwnPropertyDescriptor(I,_))}))}return R}function S(R,_,I){return _ in R?Object.defineProperty(R,_,{"value":I,"enumerable":!0,"configurable":!0,"writable":!0}):R[_]=I,R}var Y=b(b({"autoStartLoad":!0,"startPosition":-1,"defaultAudioCodec":void 0,"debug":!1,"capLevelOnFPSDrop":!1,"capLevelToPlayerSize":!1,"initialLiveManifestSize":1,"maxBufferLength":30,"backBufferLength":1/0,"maxBufferSize":6e7,"maxBufferHole":.1,"highBufferWatchdogPeriod":2,"nudgeOffset":.1,"nudgeMaxRetry":3,"maxFragLookUpTolerance":.25,"liveSyncDurationCount":3,"liveMaxLatencyDurationCount":1/0,"liveSyncDuration":void 0,"liveMaxLatencyDuration":void 0,"maxLiveSyncPlaybackRate":1,"liveDurationInfinity":!1,"liveBackBufferLength":null,"maxMaxBufferLength":600,"enableWorker":!0,"enableSoftwareAES":!0,"manifestLoadingTimeOut":1e4,"manifestLoadingMaxRetry":1,"manifestLoadingRetryDelay":1e3,"manifestLoadingMaxRetryTimeout":64e3,"startLevel":void 0,"levelLoadingTimeOut":1e4,"levelLoadingMaxRetry":4,"levelLoadingRetryDelay":1e3,"levelLoadingMaxRetryTimeout":64e3,"fragLoadingTimeOut":2e4,"fragLoadingMaxRetry":6,"fragLoadingRetryDelay":1e3,"fragLoadingMaxRetryTimeout":64e3,"startFragPrefetch":!1,"fpsDroppedMonitoringPeriod":5e3,"fpsDroppedMonitoringThreshold":.2,"appendErrorMaxRetry":3,"loader":j.default,"fLoader":void 0,"pLoader":void 0,"xhrSetup":void 0,"licenseXhrSetup":void 0,"licenseResponseCallback":void 0,"abrController":C.default,"bufferController":F.default,"capLevelController":N.default,"fpsController":B.default,"stretchShortVideoTrack":!1,"maxAudioFramesDrift":1,"forceKeyFrameOnDiscontinuity":!0,"abrEwmaFastLive":3,"abrEwmaSlowLive":9,"abrEwmaFastVoD":3,"abrEwmaSlowVoD":9,"abrEwmaDefaultEstimate":5e5,"abrBandWidthFactor":.95,"abrBandWidthUpFactor":.7,"abrMaxWithRealBitrate":!1,"maxStarvationDelay":4,"maxLoadingDelay":4,"minAutoBitrate":0,"emeEnabled":!1,"widevineLicenseUrl":void 0,"drmSystemOptions":{},"requestMediaKeySystemAccessFunc":V.requestMediaKeySystemAccess,"testBandwidth":!0,"progressive":!1,"lowLatencyMode":!0,"cmcd":void 0},function L(){return{"cueHandler":H.default,"enableCEA708Captions":!0,"enableWebVTT":!0,"enableIMSC1":!0,"captionsTextTrack1Label":"English","captionsTextTrack1LanguageCode":"en","captionsTextTrack2Label":"Spanish","captionsTextTrack2LanguageCode":"es","captionsTextTrack3Label":"Unknown CC","captionsTextTrack3LanguageCode":"","captionsTextTrack4Label":"Unknown CC","captionsTextTrack4LanguageCode":"","renderTextTracksNatively":!0}}()),{},{"subtitleStreamController":x.SubtitleStreamController,"subtitleTrackController":P.default,"timelineController":M.TimelineController,"audioStreamController":w.default,"audioTrackController":O.default,"emeController":U.default,"cmcdController":G.default});function D(R,_){if((_.liveSyncDurationCount||_.liveMaxLatencyDurationCount)&&(_.liveSyncDuration||_.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==_.liveMaxLatencyDurationCount&&(void 0===_.liveSyncDurationCount||_.liveMaxLatencyDurationCount<=_.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==_.liveMaxLatencyDuration&&(void 0===_.liveSyncDuration||_.liveMaxLatencyDuration<=_.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return E({},R,_)}function k(R){var _=R.loader;_!==K.default&&_!==j.default?(W.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),R.progressive=!1):Object(K.fetchSupported)()&&(R.loader=K.default,R.progressive=!0,R.enableSoftwareAES=!0,W.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function _src_controller_abrControllerTs(R,_,I){I.r(_);var C=I("./src/polyfills/number.ts"),w=I("./src/utils/ewma-bandwidth-estimator.ts"),O=I("./src/events.ts"),x=I("./src/utils/buffer-helper.ts"),P=I("./src/errors.ts"),F=I("./src/types/loader.ts"),M=I("./src/utils/logger.ts");function f(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}var N=function(){function e(R){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=R;var _=R.config;this.bwEstimator=new w.default(_.abrEwmaSlowVoD,_.abrEwmaFastVoD,_.abrEwmaDefaultEstimate),this.registerListeners()}var R=e.prototype;return R.registerListeners=function e(){var R=this.hls;R.on(O.Events.FRAG_LOADING,this.onFragLoading,this),R.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),R.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(O.Events.ERROR,this.onError,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(O.Events.FRAG_LOADING,this.onFragLoading,this),R.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(O.Events.ERROR,this.onError,this)},R.destroy=function e(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},R.onFragLoading=function e(R,_){var I,C=_.frag;C.type===F.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=C,this.partCurrent=null!=(I=_.part)?I:null,this.timer=self.setInterval(this.onCheck,100)))},R.onLevelLoaded=function e(R,_){var I=this.hls.config;_.details.live?this.bwEstimator.update(I.abrEwmaSlowLive,I.abrEwmaFastLive):this.bwEstimator.update(I.abrEwmaSlowVoD,I.abrEwmaFastVoD)},R._abandonRulesCheck=function e(){var R=this.fragCurrent,_=this.partCurrent,I=this.hls,w=I.autoLevelEnabled,P=I.config,F=I.media;if(R&&F){var N=_?_.stats:R.stats,B=_?_.duration:R.duration;if(N.aborted)return M.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(w&&!F.paused&&F.playbackRate&&F.readyState){var U=performance.now()-N.loading.start,G=Math.abs(F.playbackRate);if(!(U<=500*B/G)){var j=I.levels,K=I.minAutoLevel,H=j[R.level],V=N.total||Math.max(N.loaded,Math.round(B*H.maxBitrate/8)),W=Math.max(1,N.bwEstimate?N.bwEstimate/8:1e3*N.loaded/U),Y=(V-N.loaded)/W,z=F.currentTime,X=(x.BufferHelper.bufferInfo(F,z,P.maxBufferHole).end-z)/G;if(!(X>=2*B/G||Y<=X)){var q,Z=Number.POSITIVE_INFINITY;for(q=R.level-1;q>K;q--){if((Z=B*j[q].maxBitrate/(6.4*W))<X)break}if(!(Z>=Y)){var Q=this.bwEstimator.getEstimate();M.logger.warn("Fragment "+R.sn+(_?" part "+_.index:"")+" of level "+R.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+q+"\n      Current BW estimate: "+(Object(C.isFiniteNumber)(Q)?(Q/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+Y.toFixed(3)+" s\n      Estimated load time for the next fragment: "+Z.toFixed(3)+" s\n      Time to underbuffer: "+X.toFixed(3)+" s"),I.nextLoadLevel=q,this.bwEstimator.sample(U,N.loaded),this.clearTimer(),R.loader&&(this.fragCurrent=this.partCurrent=null,R.loader.abort()),I.trigger(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,{"frag":R,"part":_,"stats":N})}}}}}},R.onFragLoaded=function e(R,_){var I=_.frag,w=_.part;if(I.type===F.PlaylistLevelType.MAIN&&Object(C.isFiniteNumber)(I.sn)){var x=w?w.stats:I.stats,P=w?w.duration:I.duration;if(this.clearTimer(),this.lastLoadedFragLevel=I.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var M=this.hls.levels[I.level],N=(M.loaded?M.loaded.bytes:0)+x.loaded,B=(M.loaded?M.loaded.duration:0)+P;M.loaded={"bytes":N,"duration":B},M.realBitrate=Math.round(8*N/B)}if(I.bitrateTest){var U={"stats":x,"frag":I,"part":w,"id":I.type};this.onFragBuffered(O.Events.FRAG_BUFFERED,U),I.bitrateTest=!1}}},R.onFragBuffered=function e(R,_){var I=_.frag,C=_.part,w=C?C.stats:I.stats;if(!w.aborted&&I.type===F.PlaylistLevelType.MAIN&&"initSegment"!==I.sn){var O=w.parsing.end-w.loading.start;this.bwEstimator.sample(O,w.loaded),w.bwEstimate=this.bwEstimator.getEstimate(),I.bitrateTest?this.bitrateTestDelay=O/1e3:this.bitrateTestDelay=0}},R.onError=function e(R,_){switch(_.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},R.clearTimer=function e(){self.clearInterval(this.timer),this.timer=void 0},R.getNextABRAutoLevel=function e(){var R=this.fragCurrent,_=this.partCurrent,I=this.hls,C=I.maxAutoLevel,w=I.config,O=I.minAutoLevel,P=I.media,F=_?_.duration:R?R.duration:0,N=P?P.currentTime:0,B=P&&0!==P.playbackRate?Math.abs(P.playbackRate):1,U=this.bwEstimator?this.bwEstimator.getEstimate():w.abrEwmaDefaultEstimate,G=(x.BufferHelper.bufferInfo(P,N,w.maxBufferHole).end-N)/B,j=this.findBestLevel(U,O,C,G,w.abrBandWidthFactor,w.abrBandWidthUpFactor);if(j>=0)return j;M.logger.trace((G?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var K=F?Math.min(F,w.maxStarvationDelay):w.maxStarvationDelay,H=w.abrBandWidthFactor,V=w.abrBandWidthUpFactor;if(!G){var W=this.bitrateTestDelay;if(W)K=(F?Math.min(F,w.maxLoadingDelay):w.maxLoadingDelay)-W,M.logger.trace("bitrate test took "+Math.round(1e3*W)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*K)+" ms"),H=V=1}return j=this.findBestLevel(U,O,C,G+K,H,V),Math.max(j,0)},R.findBestLevel=function e(R,_,I,C,w,O){for(var x,P=this.fragCurrent,F=this.partCurrent,N=this.lastLoadedFragLevel,B=this.hls.levels,U=B[N],G=!(null==U||null===(x=U.details)||void 0===x||!x.live),j=null==U?void 0:U.codecSet,K=F?F.duration:P?P.duration:0,H=I;H>=_;H--){var V=B[H];if(V&&(!j||V.codecSet===j)){var W=V.details,Y=(F?null==W?void 0:W.partTarget:null==W?void 0:W.averagetargetduration)||K,z=void 0;z=H<=N?w*R:O*R;var X=B[H].maxBitrate,q=X*Y/z;if(M.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+H+"/"+Math.round(z)+"/"+X+"/"+Y+"/"+C+"/"+q),z>X&&(!q||G&&!this.bitrateTestDelay||q<C))return H}}return-1},function c(R,_,I){return _&&f(R.prototype,_),I&&f(R,I),R}(e,[{"key":"nextAutoLevel","get":function e(){var R=this._nextAutoLevel,_=this.bwEstimator;if(!(-1===R||_&&_.canEstimate()))return R;var I=this.getNextABRAutoLevel();return-1!==R&&(I=Math.min(R,I)),I},"set":function e(R){this._nextAutoLevel=R}}]),e}();_.default=N},"./src/controller/audio-stream-controller.ts":function _src_controller_audioStreamControllerTs(R,_,I){I.r(_);var C=I("./src/polyfills/number.ts"),w=I("./src/controller/base-stream-controller.ts"),O=I("./src/events.ts"),x=I("./src/utils/buffer-helper.ts"),P=I("./src/controller/fragment-tracker.ts"),F=I("./src/types/level.ts"),M=I("./src/types/loader.ts"),N=I("./src/loader/fragment.ts"),B=I("./src/demux/chunk-cache.ts"),U=I("./src/demux/transmuxer-interface.ts"),G=I("./src/types/transmuxer.ts"),j=I("./src/controller/fragment-finders.ts"),K=I("./src/utils/discontinuities.ts"),H=I("./src/errors.ts"),V=I("./src/utils/logger.ts");function y(){return y=Object.assign||function(R){for(var _=1;_<arguments.length;_++){var I=arguments[_];for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(R[C]=I[C])}return R},y.apply(this,arguments)}function T(R,_){return T=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},T(R,_)}var W=function(R){function t(_,I){var C;return(C=R.call(this,_,I,"[audio-stream-controller]")||this).videoBuffer=null,C.videoTrackCC=-1,C.waitingVideoCC=-1,C.audioSwitch=!1,C.trackId=-1,C.waitingData=null,C.mainDetails=null,C.bufferFlushed=!1,C._registerListeners(),C}!function E(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,T(R,_)}(t,R);var _=t.prototype;return _.onHandlerDestroying=function e(){this._unregisterListeners(),this.mainDetails=null},_._registerListeners=function e(){var R=this.hls;R.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),R.on(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.on(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.on(O.Events.ERROR,this.onError,this),R.on(O.Events.BUFFER_RESET,this.onBufferReset,this),R.on(O.Events.BUFFER_CREATED,this.onBufferCreated,this),R.on(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_._unregisterListeners=function e(){var R=this.hls;R.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),R.off(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.off(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.off(O.Events.ERROR,this.onError,this),R.off(O.Events.BUFFER_RESET,this.onBufferReset,this),R.off(O.Events.BUFFER_CREATED,this.onBufferCreated,this),R.off(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_.onInitPtsFound=function e(R,_){var I=_.frag,C=_.id,O=_.initPTS;if("main"===C){var x=I.cc;this.initPTS[I.cc]=O,this.log("InitPTS for cc: "+x+" found from main: "+O),this.videoTrackCC=x,this.state===w.State.WAITING_INIT_PTS&&this.tick()}},_.startLoad=function e(R){if(!this.levels)return this.startPosition=R,void(this.state=w.State.STOPPED);var _=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,_>0&&-1===R?(this.log("Override startPosition with lastCurrentTime @"+_.toFixed(3)),this.state=w.State.IDLE):(this.loadedmetadata=!1,this.state=w.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=R,this.tick()},_.doTick=function t(){switch(this.state){case w.State.IDLE:this.doTickIdle();break;case w.State.WAITING_TRACK:var _,I=this.levels,C=this.trackId,O=null==I||null===(_=I[C])||void 0===_?void 0:_.details;if(O){if(this.waitForCdnTuneIn(O))break;this.state=w.State.WAITING_INIT_PTS}break;case w.State.FRAG_LOADING_WAITING_RETRY:var P,F=performance.now(),M=this.retryDate;(!M||F>=M||null!==(P=this.media)&&void 0!==P&&P.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=w.State.IDLE);break;case w.State.WAITING_INIT_PTS:var N=this.waitingData;if(N){var B=N.frag,U=N.part,G=N.cache,K=N.complete;if(void 0!==this.initPTS[B.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=w.State.FRAG_LOADING;var H={"frag":B,"part":U,"payload":G.flush(),"networkDetails":null};this._handleFragmentLoadProgress(H),K&&R.prototype._handleFragmentLoadComplete.call(this,H)}else if(this.videoTrackCC!==this.waitingVideoCC)V.logger.log("Waiting fragment cc ("+B.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var W=this.getLoadPosition(),Y=x.BufferHelper.bufferInfo(this.mediaBuffer,W,this.config.maxBufferHole);Object(j.fragmentWithinToleranceTest)(Y.end,this.config.maxFragLookUpTolerance,B)<0&&(V.logger.log("Waiting fragment cc ("+B.cc+") @ "+B.start+" cancelled because another fragment at "+Y.end+" is needed"),this.clearWaitingFragment())}}else this.state=w.State.IDLE}this.onTickEnd()},_.clearWaitingFragment=function e(){var R=this.waitingData;R&&(this.fragmentTracker.removeFragment(R.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=w.State.IDLE)},_.onTickEnd=function e(){var R=this.media;if(R&&R.readyState){var _=(this.mediaBuffer?this.mediaBuffer:R).buffered;!this.loadedmetadata&&_.length&&(this.loadedmetadata=!0),this.lastCurrentTime=R.currentTime}},_.doTickIdle=function e(){var R,_,I=this.hls,C=this.levels,x=this.media,P=this.trackId,F=I.config;if(C&&C[P]&&(x||!this.startFragRequested&&F.startFragPrefetch)){var B=C[P].details;if(!B||B.live&&this.levelLastLoaded!==P||this.waitForCdnTuneIn(B))this.state=w.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,N.ElementaryStreamTypes.AUDIO,M.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,M.PlaylistLevelType.AUDIO);if(null!==U){var G=U.len,j=this.getMaxBufferLength(),K=this.audioSwitch;if(!(G>=j)||K){if(!K&&this._streamEnded(U,B))return I.trigger(O.Events.BUFFER_EOS,{"type":"audio"}),void(this.state=w.State.ENDED);var H=B.fragments[0].start,V=U.end;if(K){var W=this.getLoadPosition();V=W,B.PTSKnown&&W<H&&(U.end>H||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),x.currentTime=H+.05)}var Y=this.getNextFragment(V,B);Y?"identity"!==(null===(R=Y.decryptdata)||void 0===R?void 0:R.keyFormat)||null!==(_=Y.decryptdata)&&void 0!==_&&_.key?this.loadFragment(Y,B,V):this.loadKey(Y,B):this.bufferFlushed=!0}}}}},_.getMaxBufferLength=function t(){var _=R.prototype.getMaxBufferLength.call(this),I=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,M.PlaylistLevelType.MAIN);return null===I?_:Math.max(_,I.len)},_.onMediaDetaching=function t(){this.videoBuffer=null,R.prototype.onMediaDetaching.call(this)},_.onAudioTracksUpdated=function e(R,_){var I=_.audioTracks;this.resetTransmuxer(),this.levels=I.map((function(R){return new F.Level(R)}))},_.onAudioTrackSwitching=function e(R,_){var I=!!_.url;this.trackId=_.id;var C=this.fragCurrent;null!=C&&C.loader&&C.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),I?this.setInterval(100):this.resetTransmuxer(),I?(this.audioSwitch=!0,this.state=w.State.IDLE):this.state=w.State.STOPPED,this.tick()},_.onManifestLoading=function e(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},_.onLevelLoaded=function e(R,_){this.mainDetails=_.details},_.onAudioTrackLoaded=function e(R,_){var I,C=this.levels,O=_.details,x=_.id;if(C){this.log("Track "+x+" loaded ["+O.startSN+","+O.endSN+"],duration:"+O.totalduration);var P=C[x],F=0;if(O.live||null!==(I=P.details)&&void 0!==I&&I.live){var M=this.mainDetails;if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed||!M)return;!P.details&&O.hasProgramDateTime&&M.hasProgramDateTime?(Object(K.alignMediaPlaylistByPDT)(O,M),F=O.fragments[0].start):F=this.alignPlaylists(O,P.details)}P.details=O,this.levelLastLoaded=x,this.startFragRequested||!this.mainDetails&&O.live||this.setStartPosition(P.details,F),this.state!==w.State.WAITING_TRACK||this.waitForCdnTuneIn(O)||(this.state=w.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+x)},_._handleFragmentLoadProgress=function e(R){var _,I=R.frag,C=R.part,O=R.payload,x=this.config,P=this.trackId,F=this.levels;if(F){var N=F[P];console.assert(N,"Audio track is defined on fragment load progress");var j=N.details;console.assert(j,"Audio track details are defined on fragment load progress");var K=x.defaultAudioCodec||N.audioCodec||"mp4a.40.2",H=this.transmuxer;H||(H=this.transmuxer=new U.default(this.hls,M.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var W=this.initPTS[I.cc],Y=null===(_=I.initSegment)||void 0===_?void 0:_.data;if(void 0!==W){var z=C?C.index:-1,X=-1!==z,q=new G.ChunkMetadata(I.level,I.sn,I.stats.chunkCount,O.byteLength,z,X);H.push(O,Y,K,"",I,C,j.totalduration,!1,q,W)}else{V.logger.log("Unknown video PTS for cc "+I.cc+", waiting for video PTS before demuxing audio frag "+I.sn+" of ["+j.startSN+" ,"+j.endSN+"],track "+P),(this.waitingData=this.waitingData||{"frag":I,"part":C,"cache":new B.default,"complete":!1}).cache.push(new Uint8Array(O)),this.waitingVideoCC=this.videoTrackCC,this.state=w.State.WAITING_INIT_PTS}}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+I.sn+" of level "+I.level+" will not be buffered")},_._handleFragmentLoadComplete=function t(_){this.waitingData?this.waitingData.complete=!0:R.prototype._handleFragmentLoadComplete.call(this,_)},_.onBufferReset=function e(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},_.onBufferCreated=function e(R,_){var I=_.tracks.audio;I&&(this.mediaBuffer=I.buffer),_.tracks.video&&(this.videoBuffer=_.tracks.video.buffer)},_.onFragBuffered=function e(R,_){var I=_.frag,C=_.part;I.type===M.PlaylistLevelType.AUDIO&&(this.fragContextChanged(I)?this.warn("Fragment "+I.sn+(C?" p: "+C.index:"")+" of level "+I.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==I.sn&&(this.fragPrevious=I,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(O.Events.AUDIO_TRACK_SWITCHED,{"id":this.trackId}))),this.fragBufferedComplete(I,C)))},_.onError=function t(_,I){switch(I.details){case H.ErrorDetails.FRAG_LOAD_ERROR:case H.ErrorDetails.FRAG_LOAD_TIMEOUT:case H.ErrorDetails.KEY_LOAD_ERROR:case H.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(M.PlaylistLevelType.AUDIO,I);break;case H.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case H.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==w.State.ERROR&&this.state!==w.State.STOPPED&&(this.state=I.fatal?w.State.ERROR:w.State.IDLE,this.warn(I.details+" while loading frag, switching to "+this.state+" state"));break;case H.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===I.parent&&(this.state===w.State.PARSING||this.state===w.State.PARSED)){var C=!0,O=this.getFwdBufferInfo(this.mediaBuffer,M.PlaylistLevelType.AUDIO);O&&O.len>.5&&(C=!this.reduceMaxBufferLength(O.len)),C&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,R.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},_.onBufferFlushed=function e(R,_){_.type===N.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},_._handleTransmuxComplete=function e(R){var _,I="audio",C=this.hls,x=R.remuxResult,P=R.chunkMeta,F=this.getCurrentContext(P);if(!F)return this.warn("The loading context changed while buffering fragment "+P.sn+" of level "+P.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(P.level);var M=F.frag,B=F.part,U=x.audio,G=x.text,j=x.id3,K=x.initSegment;if(!this.fragContextChanged(M)){if(this.state=w.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),null!=K&&K.tracks&&(this._bufferInitSegment(K.tracks,M,P),C.trigger(O.Events.FRAG_PARSING_INIT_SEGMENT,{"frag":M,"id":I,"tracks":K.tracks})),U){var H=U.startPTS,V=U.endPTS,W=U.startDTS,Y=U.endDTS;B&&(B.elementaryStreams[N.ElementaryStreamTypes.AUDIO]={"startPTS":H,"endPTS":V,"startDTS":W,"endDTS":Y}),M.setElementaryStreamInfo(N.ElementaryStreamTypes.AUDIO,H,V,W,Y),this.bufferFragmentData(U,M,B,P)}if(null!=j&&null!==(_=j.samples)&&void 0!==_&&_.length){var z=y({"frag":M,"id":I},j);C.trigger(O.Events.FRAG_PARSING_METADATA,z)}if(G){var X=y({"frag":M,"id":I},G);C.trigger(O.Events.FRAG_PARSING_USERDATA,X)}}},_._bufferInitSegment=function e(R,_,I){if(this.state===w.State.PARSING){R.video&&delete R.video;var C=R.audio;if(C){C.levelCodec=C.codec,C.id="audio",this.log("Init audio buffer, container:"+C.container+", codecs[parsed]=["+C.codec+"]"),this.hls.trigger(O.Events.BUFFER_CODECS,R);var x=C.initSegment;if(null!=x&&x.byteLength){var P={"type":"audio","frag":_,"part":null,"chunkMeta":I,"parent":_.type,"data":x};this.hls.trigger(O.Events.BUFFER_APPENDING,P)}this.tick()}}},_.loadFragment=function t(_,I,O){var x=this.fragmentTracker.getState(_);this.fragCurrent=_,(this.audioSwitch||x===P.FragmentState.NOT_LOADED||x===P.FragmentState.PARTIAL)&&("initSegment"===_.sn?this._loadInitSegment(_):I.live&&!Object(C.isFiniteNumber)(this.initPTS[_.cc])?(this.log("Waiting for video PTS in continuity counter "+_.cc+" of live stream before loading audio fragment "+_.sn+" of level "+this.trackId),this.state=w.State.WAITING_INIT_PTS):(this.startFragRequested=!0,R.prototype.loadFragment.call(this,_,I,O)))},_.completeAudioSwitch=function t(){var _=this.hls,I=this.media,C=this.trackId;I&&(this.log("Switching audio track : flushing all audio"),R.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,_.trigger(O.Events.AUDIO_TRACK_SWITCHED,{"id":C})},t}(w.default);_.default=W},"./src/controller/audio-track-controller.ts":function _src_controller_audioTrackControllerTs(R,_,I){I.r(_);var C=I("./src/events.ts"),w=I("./src/errors.ts"),O=I("./src/controller/base-playlist-controller.ts"),x=I("./src/types/loader.ts");function o(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}function f(R,_){return f=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},f(R,_)}var P=function(R){function t(_){var I;return(I=R.call(this,_,"[audio-track-controller]")||this).tracks=[],I.groupId=null,I.tracksInGroup=[],I.trackId=-1,I.trackName="",I.selectDefaultTrack=!0,I.registerListeners(),I}!function u(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,f(R,_)}(t,R);var _=t.prototype;return _.registerListeners=function e(){var R=this.hls;R.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.on(C.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.on(C.Events.ERROR,this.onError,this)},_.unregisterListeners=function e(){var R=this.hls;R.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(C.Events.LEVEL_LOADING,this.onLevelLoading,this),R.off(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.off(C.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.off(C.Events.ERROR,this.onError,this)},_.destroy=function t(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,R.prototype.destroy.call(this)},_.onManifestLoading=function e(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},_.onManifestParsed=function e(R,_){this.tracks=_.audioTracks||[]},_.onAudioTrackLoaded=function e(R,_){var I=_.id,C=_.details,w=this.tracksInGroup[I];if(w){var O=w.details;w.details=_.details,this.log("audioTrack "+I+" loaded ["+C.startSN+"-"+C.endSN+"]"),I===this.trackId&&(this.retryCount=0,this.playlistLoaded(I,_,O))}else this.warn("Invalid audio track id "+I)},_.onLevelLoading=function e(R,_){this.switchLevel(_.level)},_.onLevelSwitching=function e(R,_){this.switchLevel(_.level)},_.switchLevel=function e(R){var _=this.hls.levels[R];if(null!=_&&_.audioGroupIds){var I=_.audioGroupIds[_.urlId];if(this.groupId!==I){this.groupId=I;var w=this.tracks.filter((function(R){return!I||R.groupId===I}));this.selectDefaultTrack&&!w.some((function(R){return R.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=w;var O={"audioTracks":w};this.log("Updating audio tracks, "+w.length+' track(s) found in "'+I+'" group-id'),this.hls.trigger(C.Events.AUDIO_TRACKS_UPDATED,O),this.selectInitialTrack()}}},_.onError=function t(_,I){R.prototype.onError.call(this,_,I),!I.fatal&&I.context&&I.context.type===x.PlaylistContextType.AUDIO_TRACK&&I.context.id===this.trackId&&I.context.groupId===this.groupId&&this.retryLoadingOrFail(I)},_.setAudioTrack=function e(R){var _=this.tracksInGroup;if(R<0||R>=_.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var I=_[this.trackId];this.log("Now switching to audio-track index "+R);var w=_[R],O=w.id,x=w.groupId,P=void 0===x?"":x,F=w.name,M=w.type,N=w.url;if(this.trackId=R,this.trackName=F,this.selectDefaultTrack=!1,this.hls.trigger(C.Events.AUDIO_TRACK_SWITCHING,{"id":O,"groupId":P,"name":F,"type":M,"url":N}),!w.details||w.details.live){var B=this.switchParams(w.url,null==I?void 0:I.details);this.loadPlaylist(B)}}},_.selectInitialTrack=function e(){var R=this.tracksInGroup;console.assert(R.length,"Initial audio track should be selected when tracks are known");var _=this.trackName,I=this.findTrackId(_)||this.findTrackId();-1!==I?this.setAudioTrack(I):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.MEDIA_ERROR,"details":w.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,"fatal":!0}))},_.findTrackId=function e(R){for(var _=this.tracksInGroup,I=0;I<_.length;I++){var C=_[I];if((!this.selectDefaultTrack||C.default)&&(!R||R===C.name))return C.id}return-1},_.loadPlaylist=function e(R){var _=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(_)){var I=_.id,w=_.groupId,O=_.url;if(R)try{O=R.addDirectives(O)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("loading audio-track playlist for id: "+I),this.clearTimer(),this.hls.trigger(C.Events.AUDIO_TRACK_LOADING,{"url":O,"id":I,"groupId":w,"deliveryDirectives":R||null})}},function l(R,_,I){return _&&o(R.prototype,_),I&&o(R,I),R}(t,[{"key":"audioTracks","get":function e(){return this.tracksInGroup}},{"key":"audioTrack","get":function e(){return this.trackId},"set":function e(R){this.selectDefaultTrack=!1,this.setAudioTrack(R)}}]),t}(O.default);_.default=P},"./src/controller/base-playlist-controller.ts":function _src_controller_basePlaylistControllerTs(R,_,I){I.r(_),I.d(_,"default",(function(){return F}));var C=I("./src/polyfills/number.ts"),w=I("./src/types/level.ts"),O=I("./src/controller/level-helper.ts"),x=I("./src/utils/logger.ts"),P=I("./src/errors.ts"),F=function(){function e(R,_){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=x.logger.log.bind(x.logger,_+":"),this.warn=x.logger.warn.bind(x.logger,_+":"),this.hls=R}var R=e.prototype;return R.destroy=function e(){this.clearTimer(),this.hls=this.log=this.warn=null},R.onError=function e(R,_){_.fatal&&_.type===P.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},R.clearTimer=function e(){clearTimeout(this.timer),this.timer=-1},R.startLoad=function e(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},R.stopLoad=function e(){this.canLoad=!1,this.clearTimer()},R.switchParams=function e(R,_){var I=null==_?void 0:_.renditionReports;if(I)for(var O=0;O<I.length;O++){var x=I[O],P=""+x.URI;if(P===R.substr(-P.length)){var F=parseInt(x["LAST-MSN"]),M=parseInt(x["LAST-PART"]);if(_&&this.hls.config.lowLatencyMode){var N=Math.min(_.age-_.partTarget,_.targetduration);void 0!==M&&N>_.partTarget&&(M+=1)}if(Object(C.isFiniteNumber)(F))return new w.HlsUrlParameters(F,Object(C.isFiniteNumber)(M)?M:void 0,w.HlsSkip.No)}}},R.loadPlaylist=function e(R){},R.shouldLoadTrack=function e(R){return this.canLoad&&R&&!!R.url&&(!R.details||R.details.live)},R.playlistLoaded=function e(R,_,I){var C=this,w=_.details,x=_.stats,P=x.loading.end?Math.max(0,self.performance.now()-x.loading.end):0;if(w.advancedDateTime=Date.now()-P,w.live||null!=I&&I.live){if(w.reloaded(I),I&&this.log("live playlist "+R+" "+(w.advanced?"REFRESHED "+w.lastPartSn+"-"+w.lastPartIndex:"MISSED")),I&&w.fragments.length>0&&Object(O.mergeDetails)(I,w),!this.canLoad||!w.live)return;var F,M=void 0,N=void 0;if(w.canBlockReload&&w.endSN&&w.advanced){var B=this.hls.config.lowLatencyMode,U=w.lastPartSn,G=w.endSN,j=w.lastPartIndex,K=U===G;-1!==j?(M=K?G+1:U,N=K?B?0:j:j+1):M=G+1;var H=w.age,V=H+w.ageHeader,W=Math.min(V-w.partTarget,1.5*w.targetduration);if(W>0){if(I&&W>I.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+I.tuneInGoal+" to: "+W+" with playlist age: "+w.age),W=0;else{var Y=Math.floor(W/w.targetduration);if(M+=Y,void 0!==N)N+=Math.round(W%w.targetduration/w.partTarget);this.log("CDN Tune-in age: "+w.ageHeader+"s last advanced "+H.toFixed(2)+"s goal: "+W+" skip sn "+Y+" to part "+N)}w.tuneInGoal=W}if(F=this.getDeliveryDirectives(w,_.deliveryDirectives,M,N),B||!K)return void this.loadPlaylist(F)}else F=this.getDeliveryDirectives(w,_.deliveryDirectives,M,N);var z=Object(O.computeReloadInterval)(w,x);void 0!==M&&w.canBlockReload&&(z-=w.partTarget||1),this.log("reload live playlist "+R+" in "+Math.round(z)+" ms"),this.timer=self.setTimeout((function(){return C.loadPlaylist(F)}),z)}else this.clearTimer()},R.getDeliveryDirectives=function e(R,_,I,C){var O=Object(w.getSkipValue)(R,I);return null!=_&&_.skip&&R.deltaUpdateFailed&&(I=_.msn,C=_.part,O=w.HlsSkip.No),new w.HlsUrlParameters(I,C,O)},R.retryLoadingOrFail=function e(R){var _,I=this,C=this.hls.config,w=this.retryCount<C.levelLoadingMaxRetry;if(w)if(this.retryCount++,R.details.indexOf("LoadTimeOut")>-1&&null!==(_=R.context)&&void 0!==_&&_.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+R.details+'"'),this.loadPlaylist();else{var O=Math.min(Math.pow(2,this.retryCount)*C.levelLoadingRetryDelay,C.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return I.loadPlaylist()}),O),this.warn("retry playlist loading #"+this.retryCount+" in "+O+' ms after "'+R.details+'"')}else this.warn('cannot recover from error "'+R.details+'"'),this.clearTimer(),R.fatal=!0;return w},e}()},"./src/controller/base-stream-controller.ts":function _src_controller_baseStreamControllerTs(R,_,I){I.r(_),I.d(_,"State",(function(){return Y})),I.d(_,"default",(function(){return z}));var C=I("./src/polyfills/number.ts"),w=I("./src/task-loop.ts"),O=I("./src/controller/fragment-tracker.ts"),x=I("./src/utils/buffer-helper.ts"),P=I("./src/utils/logger.ts"),F=I("./src/events.ts"),M=I("./src/errors.ts"),N=I("./src/types/transmuxer.ts"),B=I("./src/utils/mp4-tools.ts"),U=I("./src/utils/discontinuities.ts"),G=I("./src/controller/fragment-finders.ts"),j=I("./src/controller/level-helper.ts"),K=I("./src/loader/fragment-loader.ts"),H=I("./src/crypt/decrypter.ts"),V=I("./src/utils/time-ranges.ts"),W=I("./src/types/loader.ts");function E(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}function A(R,_){return A=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},A(R,_)}var Y={"STOPPED":"STOPPED","IDLE":"IDLE","KEY_LOADING":"KEY_LOADING","FRAG_LOADING":"FRAG_LOADING","FRAG_LOADING_WAITING_RETRY":"FRAG_LOADING_WAITING_RETRY","WAITING_TRACK":"WAITING_TRACK","PARSING":"PARSING","PARSED":"PARSED","BACKTRACKING":"BACKTRACKING","ENDED":"ENDED","ERROR":"ERROR","WAITING_INIT_PTS":"WAITING_INIT_PTS","WAITING_LEVEL":"WAITING_LEVEL"},z=function(R){function t(_,I,C){var w;return(w=R.call(this)||this).hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=Y.STOPPED,w.media=void 0,w.mediaBuffer=void 0,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=C,w.log=P.logger.log.bind(P.logger,C+":"),w.warn=P.logger.warn.bind(P.logger,C+":"),w.hls=_,w.fragmentLoader=new K.default(_.config),w.fragmentTracker=I,w.config=_.config,w.decrypter=new H.default(_,_.config),_.on(F.Events.KEY_LOADED,w.onKeyLoaded,function b(R){if(void 0===R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}(w)),w}!function S(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,A(R,_)}(t,R);var _=t.prototype;return _.doTick=function e(){this.onTickEnd()},_.onTickEnd=function e(){},_.startLoad=function e(R){},_.stopLoad=function e(){this.fragmentLoader.abort();var R=this.fragCurrent;R&&this.fragmentTracker.removeFragment(R),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Y.STOPPED},_._streamEnded=function e(R,_){var I=this.fragCurrent,C=this.fragmentTracker;if(!_.live&&I&&I.sn>=_.endSN&&!R.nextStart){var w=_.partList;if(null!=w&&w.length){var P=w[w.length-1];return x.BufferHelper.isBuffered(this.media,P.start+P.duration/2)}var F=C.getState(I);return F===O.FragmentState.PARTIAL||F===O.FragmentState.OK}return!1},_.onMediaAttached=function e(R,_){var I=this.media=this.mediaBuffer=_.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var C=this.config;this.levels&&C.autoStartLoad&&this.state===Y.STOPPED&&this.startLoad(C.startPosition)},_.onMediaDetaching=function e(){var R=this.media;null!=R&&R.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),R&&(R.removeEventListener("seeking",this.onvseeking),R.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},_.onMediaSeeking=function e(){var R=this.config,_=this.fragCurrent,I=this.media,w=this.mediaBuffer,O=this.state,P=I?I.currentTime:0,F=x.BufferHelper.bufferInfo(w||I,P,R.maxBufferHole);if(this.log("media seeking to "+(Object(C.isFiniteNumber)(P)?P.toFixed(3):P)+", state: "+O),O===Y.ENDED)this.resetLoadingState();else if(_&&!F.len){var M=R.maxFragLookUpTolerance,N=_.start-M,B=P>_.start+_.duration+M;(P<N||B)&&(B&&_.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),_.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=P),this.loadedmetadata||F.len||(this.nextLoadPosition=this.startPosition=P),this.tickImmediate()},_.onMediaEnded=function e(){this.startPosition=this.lastCurrentTime=0},_.onKeyLoaded=function e(R,_){if(this.state===Y.KEY_LOADING&&_.frag===this.fragCurrent&&this.levels){this.state=Y.IDLE;var I=this.levels[_.frag.level].details;I&&this.loadFragment(_.frag,I,_.frag.start)}},_.onHandlerDestroying=function t(){this.stopLoad(),R.prototype.onHandlerDestroying.call(this)},_.onHandlerDestroyed=function t(){this.state=Y.STOPPED,this.hls.off(F.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,R.prototype.onHandlerDestroyed.call(this)},_.loadKey=function e(R,_){this.log("Loading key for "+R.sn+" of ["+_.startSN+"-"+_.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+R.level),this.state=Y.KEY_LOADING,this.fragCurrent=R,this.hls.trigger(F.Events.KEY_LOADING,{"frag":R})},_.loadFragment=function e(R,_,I){this._loadFragForPlayback(R,_,I)},_._loadFragForPlayback=function e(R,_,I){var C=this;this._doFragLoad(R,_,I,(function e(_){if(C.fragContextChanged(R))return C.warn("Fragment "+R.sn+(_.part?" p: "+_.part.index:"")+" of level "+R.level+" was dropped during download."),void C.fragmentTracker.removeFragment(R);R.stats.chunkCount++,C._handleFragmentLoadProgress(_)})).then((function(_){if(_){C.fragLoadError=0;var I=C.state;if(!C.fragContextChanged(R))return"payload"in _&&(C.log("Loaded fragment "+R.sn+" of level "+R.level),C.hls.trigger(F.Events.FRAG_LOADED,_),C.state===Y.BACKTRACKING)?(C.fragmentTracker.backtrack(R,_),void C.resetFragmentLoading(R)):void C._handleFragmentLoadComplete(_);(I===Y.FRAG_LOADING||I===Y.BACKTRACKING||!C.fragCurrent&&I===Y.PARSING)&&(C.fragmentTracker.removeFragment(R),C.state=Y.IDLE)}})).catch((function(_){C.warn(_),C.resetFragmentLoading(R)}))},_.flushMainBuffer=function e(R,_,I){if(void 0===I&&(I=null),R-_){var C={"startOffset":R,"endOffset":_,"type":I};this.fragLoadError=0,this.hls.trigger(F.Events.BUFFER_FLUSHING,C)}},_._loadInitSegment=function e(R){var _=this;this._doFragLoad(R).then((function(I){if(!I||_.fragContextChanged(R)||!_.levels)throw new Error("init load aborted");return I})).then((function(I){var C=_.hls,w=I.payload,O=R.decryptdata;if(w&&w.byteLength>0&&O&&O.key&&O.iv&&"AES-128"===O.method){var x=self.performance.now();return _.decrypter.webCryptoDecrypt(new Uint8Array(w),O.key.buffer,O.iv.buffer).then((function(_){var w=self.performance.now();return C.trigger(F.Events.FRAG_DECRYPTED,{"frag":R,"payload":_,"stats":{"tstart":x,"tdecrypt":w}}),I.payload=_,I}))}return I})).then((function(I){var C=_.fragCurrent,w=_.hls,O=_.levels;if(!O)throw new Error("init load aborted, missing levels");var x=O[R.level].details;console.assert(x,"Level details are defined when init segment is loaded");var P=R.stats;_.state=Y.IDLE,_.fragLoadError=0,R.data=new Uint8Array(I.payload),P.parsing.start=P.buffering.start=self.performance.now(),P.parsing.end=P.buffering.end=self.performance.now(),I.frag===C&&w.trigger(F.Events.FRAG_BUFFERED,{"stats":P,"frag":C,"part":null,"id":R.type}),_.tick()})).catch((function(I){_.warn(I),_.resetFragmentLoading(R)}))},_.fragContextChanged=function e(R){var _=this.fragCurrent;return!R||!_||R.level!==_.level||R.sn!==_.sn||R.urlId!==_.urlId},_.fragBufferedComplete=function e(R,_){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+R.type+" sn: "+R.sn+(_?" part: "+_.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+R.level+" "+V.default.toString(x.BufferHelper.getBuffered(I))),this.state=Y.IDLE,this.tick()},_._handleFragmentLoadComplete=function e(R){var _=this.transmuxer;if(_){var I=R.frag,C=R.part,w=R.partsLoaded,O=!w||0===w.length||w.some((function(R){return!R})),x=new N.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,C?C.index:-1,!O);_.flush(x)}},_._handleFragmentLoadProgress=function e(R){},_._doFragLoad=function e(R,_,I,w){var O=this;if(void 0===I&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(R.start,I||0),this.config.lowLatencyMode&&_){var x=_.partList;if(x&&w){I>R.end&&_.fragmentHint&&(R=_.fragmentHint);var P=this.getNextPart(x,R,I);if(P>-1){var M=x[P];return this.log("Loading part sn: "+R.sn+" p: "+M.index+" cc: "+R.cc+" of playlist ["+_.startSN+"-"+_.endSN+"] parts [0-"+P+"-"+(x.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+R.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=M.start+M.duration,this.state=Y.FRAG_LOADING,this.hls.trigger(F.Events.FRAG_LOADING,{"frag":R,"part":x[P],"targetBufferTime":I}),this.doFragPartsLoad(R,x,P,w).catch((function(R){return O.handleFragLoadError(R)}))}if(!R.url||this.loadedEndOfParts(x,I))return Promise.resolve(null)}}return this.log("Loading fragment "+R.sn+" cc: "+R.cc+" "+(_?"of ["+_.startSN+"-"+_.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+R.level+", target: "+parseFloat(I.toFixed(3))),Object(C.isFiniteNumber)(R.sn)&&!this.bitrateTest&&(this.nextLoadPosition=R.start+R.duration),this.state=Y.FRAG_LOADING,this.hls.trigger(F.Events.FRAG_LOADING,{"frag":R,"targetBufferTime":I}),this.fragmentLoader.load(R,w).catch((function(R){return O.handleFragLoadError(R)}))},_.doFragPartsLoad=function e(R,_,I,C){var w=this;return new Promise((function(O,x){var P=[];!function i(I){var M=_[I];w.fragmentLoader.loadPart(R,M,C).then((function(C){P[M.index]=C;var x=C.part;w.hls.trigger(F.Events.FRAG_LOADED,C);var N=_[I+1];if(!N||N.fragment!==R)return O({"frag":R,"part":x,"partsLoaded":P});i(I+1)})).catch(x)}(I)}))},_.handleFragLoadError=function e(R){var _=R.data;return _&&_.details===M.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(_.frag,_.part):this.hls.trigger(F.Events.ERROR,_),null},_._handleTransmuxerFlush=function e(R){var _=this.getCurrentContext(R);if(_&&this.state===Y.PARSING){var I=_.frag,C=_.part,w=_.level,O=self.performance.now();I.stats.parsing.end=O,C&&(C.stats.parsing.end=O),this.updateLevelTiming(I,C,w,R.partial)}else this.fragCurrent||(this.state=Y.IDLE)},_.getCurrentContext=function e(R){var _=this.levels,I=R.level,C=R.sn,w=R.part;if(!_||!_[I])return this.warn("Levels object was unset while buffering fragment "+C+" of level "+I+". The current chunk will not be buffered."),null;var O=_[I],x=w>-1?Object(j.getPartWith)(O,C,w):null,P=x?x.fragment:Object(j.getFragmentWithSN)(O,C,this.fragCurrent);return P?{"frag":P,"part":x,"level":O}:null},_.bufferFragmentData=function e(R,_,I,C){if(R&&this.state===Y.PARSING){var w=R.data1,O=R.data2,x=w;if(w&&O&&(x=Object(B.appendUint8Array)(w,O)),x&&x.length){var P={"type":R.type,"frag":_,"part":I,"chunkMeta":C,"parent":_.type,"data":x};this.hls.trigger(F.Events.BUFFER_APPENDING,P),R.dropped&&R.independent&&!I&&this.flushBufferGap(_)}}},_.flushBufferGap=function e(R){var _=this.media;if(_)if(x.BufferHelper.isBuffered(_,_.currentTime)){var I=_.currentTime,C=x.BufferHelper.bufferInfo(_,I,0),w=R.duration,O=Math.min(2*this.config.maxFragLookUpTolerance,.25*w),P=Math.max(Math.min(R.start-O,C.end-O),I+O);R.start-P>O&&this.flushMainBuffer(P,R.start)}else this.flushMainBuffer(0,R.start)},_.getFwdBufferInfo=function e(R,_){var I=this.config,w=this.getLoadPosition();if(!Object(C.isFiniteNumber)(w))return null;var O=x.BufferHelper.bufferInfo(R,w,I.maxBufferHole);if(0===O.len&&void 0!==O.nextStart){var P=this.fragmentTracker.getBufferedFrag(w,_);if(P&&O.nextStart<P.end)return x.BufferHelper.bufferInfo(R,w,Math.max(O.nextStart,I.maxBufferHole))}return O},_.getMaxBufferLength=function e(R){var _,I=this.config;return _=R?Math.max(8*I.maxBufferSize/R,I.maxBufferLength):I.maxBufferLength,Math.min(_,I.maxMaxBufferLength)},_.reduceMaxBufferLength=function e(R){var _=this.config,I=R||_.maxBufferLength;return _.maxMaxBufferLength>=I&&(_.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+_.maxMaxBufferLength+"s"),!0)},_.getNextFragment=function e(R,_){var I,C,w=_.fragments,O=w.length;if(!O)return null;var x,P=this.config,F=w[0].start;if(_.live){var M=P.initialLiveManifestSize;if(O<M)return this.warn("Not enough fragments to start playback (have: "+O+", need: "+M+")"),null;_.PTSKnown||this.startFragRequested||-1!==this.startPosition||(x=this.getInitialLiveFragment(_,w),this.startPosition=x?this.hls.liveSyncPosition||x.start:R)}else R<=F&&(x=w[0]);if(!x){var N=P.lowLatencyMode?_.partEnd:_.fragmentEnd;x=this.getFragmentAtPosition(R,N,_)}return null===(I=x)||void 0===I||!I.initSegment||null!==(C=x)&&void 0!==C&&C.initSegment.data||this.bitrateTest||(x=x.initSegment),x},_.getNextPart=function e(R,_,I){for(var C=-1,w=!1,O=!0,x=0,P=R.length;x<P;x++){var F=R[x];if(O=O&&!F.independent,C>-1&&I<F.start)break;var M=F.loaded;!M&&(w||F.independent||O)&&F.fragment===_&&(C=x),w=M}return C},_.loadedEndOfParts=function e(R,_){var I=R[R.length-1];return I&&_>I.start&&I.loaded},_.getInitialLiveFragment=function e(R,_){var I=this.fragPrevious,C=null;if(I){if(R.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),C=Object(G.findFragmentByPDT)(_,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!C){var w=I.sn+1;if(w>=R.startSN&&w<=R.endSN){var O=_[w-R.startSN];I.cc===O.cc&&(C=O,this.log("Live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=Object(G.findFragWithCC)(_,I.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+C.sn)}}else{var x=this.hls.liveSyncPosition;null!==x&&(C=this.getFragmentAtPosition(x,this.bitrateTest?R.fragmentEnd:R.edge,R))}return C},_.getFragmentAtPosition=function e(R,_,I){var C,w=this.config,x=this.fragPrevious,P=I.fragments,F=I.endSN,M=I.fragmentHint,N=w.maxFragLookUpTolerance,B=!!(w.lowLatencyMode&&I.partList&&M);if(B&&M&&!this.bitrateTest&&(P=P.concat(M),F=M.sn),R<_){var U=R>_-N?0:N;C=Object(G.findFragmentByPTS)(x,P,R,U)}else C=P[P.length-1];if(C){var j=C.sn-I.startSN,K=x&&C.level===x.level,H=P[j+1];if(this.fragmentTracker.getState(C)===O.FragmentState.BACKTRACKED){C=null;for(var V=j;P[V]&&this.fragmentTracker.getState(P[V])===O.FragmentState.BACKTRACKED;)C=x?P[V--]:P[--V];C||(C=H)}else x&&C.sn===x.sn&&!B&&K&&(C.sn<F&&this.fragmentTracker.getState(H)!==O.FragmentState.OK?(this.log("SN "+C.sn+" just loaded, load next one: "+H.sn),C=H):C=null)}return C},_.synchronizeToLiveEdge=function e(R){var _=this.config,I=this.media;if(I){var C=this.hls.liveSyncPosition,w=I.currentTime,O=R.fragments[0].start,x=R.edge,P=w>=O-_.maxFragLookUpTolerance&&w<=x;if(null!==C&&I.duration>C&&(w<C||!P)){var F=void 0!==_.liveMaxLatencyDuration?_.liveMaxLatencyDuration:_.liveMaxLatencyDurationCount*R.targetduration;(!P&&I.readyState<4||w<x-F)&&(this.loadedmetadata||(this.nextLoadPosition=C),I.readyState&&(this.warn("Playback: "+w.toFixed(3)+" is located too far from the end of live sliding playlist: "+x+", reset currentTime to : "+C.toFixed(3)),I.currentTime=C))}}},_.alignPlaylists=function e(R,_){var I=this.levels,w=this.levelLastLoaded,O=this.fragPrevious,x=null!==w?I[w]:null,P=R.fragments.length;if(!P)return this.warn("No fragments in live playlist"),0;var F=R.fragments[0].start,M=!_,N=R.alignedSliding&&Object(C.isFiniteNumber)(F);if(M||!N&&!F){Object(U.alignStream)(O,x,R);var B=R.fragments[0].start;return this.log("Live playlist sliding: "+B.toFixed(2)+" start-sn: "+(_?_.startSN:"na")+"->"+R.startSN+" prev-sn: "+(O?O.sn:"na")+" fragments: "+P),B}return F},_.waitForCdnTuneIn=function e(R){return R.live&&R.canBlockReload&&R.tuneInGoal>Math.max(R.partHoldBack,3*R.partTarget)},_.setStartPosition=function e(R,_){var I=this.startPosition;if(I<_&&(I=-1),-1===I||-1===this.lastCurrentTime){var w=R.startTimeOffset;Object(C.isFiniteNumber)(w)?(I=_+w,w<0&&(I+=R.totalduration),I=Math.min(Math.max(_,I),_+R.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+I),this.startPosition=I):R.live?I=this.hls.liveSyncPosition||_:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},_.getLoadPosition=function e(){var R=this.media,_=0;return this.loadedmetadata&&R?_=R.currentTime:this.nextLoadPosition&&(_=this.nextLoadPosition),_},_.handleFragLoadAborted=function e(R,_){this.transmuxer&&"initSegment"!==R.sn&&R.stats.aborted&&(this.warn("Fragment "+R.sn+(_?" part"+_.index:"")+" of level "+R.level+" was aborted"),this.resetFragmentLoading(R))},_.resetFragmentLoading=function e(R){this.fragCurrent&&this.fragContextChanged(R)||(this.state=Y.IDLE)},_.onFragmentOrKeyLoadError=function e(R,_){if(!_.fatal){var I=_.frag;if(I&&I.type===R){var C=this.fragCurrent;console.assert(C&&I.sn===C.sn&&I.level===C.level&&I.urlId===C.urlId,"Frag load error must match current frag to retry");var w=this.config;if(this.fragLoadError+1<=w.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(I.level))return;var O=Math.min(Math.pow(2,this.fragLoadError)*w.fragLoadingRetryDelay,w.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+R+" "+I.level+" failed to load, retrying in "+O+"ms"),this.retryDate=self.performance.now()+O,this.fragLoadError++,this.state=Y.FRAG_LOADING_WAITING_RETRY}else _.levelRetry?(R===W.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=Y.IDLE):(P.logger.error(_.details+" reaches max retry, redispatch as fatal ..."),_.fatal=!0,this.hls.stopLoad(),this.state=Y.ERROR)}}},_.afterBufferFlushed=function e(R,_,I){if(R){var C=x.BufferHelper.getBuffered(R);this.fragmentTracker.detectEvictedFragments(_,C,I),this.state===Y.ENDED&&this.resetLoadingState()}},_.resetLoadingState=function e(){this.fragCurrent=null,this.fragPrevious=null,this.state=Y.IDLE},_.resetLiveStartWhenNotLoaded=function e(R){if(!this.loadedmetadata){this.startFragRequested=!1;var _=this.levels?this.levels[R].details:null;if(null!=_&&_.live)return this.startPosition=-1,this.setStartPosition(_,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},_.updateLevelTiming=function e(R,_,I,C){var w=this,O=I.details;console.assert(!!O,"level.details must be defined");var x=Object.keys(R.elementaryStreams).reduce((function(_,x){var P=R.elementaryStreams[x];if(P){var M=P.endPTS-P.startPTS;if(M<=0)return w.warn("Could not parse fragment "+R.sn+" "+x+" duration reliably ("+M+") resetting transmuxer to fallback to playlist timing"),w.resetTransmuxer(),_||!1;var N=C?0:Object(j.updateFragPTSDTS)(O,R,P.startPTS,P.endPTS,P.startDTS,P.endDTS);return w.hls.trigger(F.Events.LEVEL_PTS_UPDATED,{"details":O,"level":I,"drift":N,"type":x,"frag":R,"start":P.startPTS,"end":P.endPTS}),!0}return _}),!1);x?(this.state=Y.PARSED,this.hls.trigger(F.Events.FRAG_PARSED,{"frag":R,"part":_})):this.resetLoadingState()},_.resetTransmuxer=function e(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},function T(R,_,I){return _&&E(R.prototype,_),I&&E(R,I),R}(t,[{"key":"state","get":function e(){return this._state},"set":function e(R){var _=this._state;_!==R&&(this._state=R,this.log(_+"->"+R))}}]),t}(w.default)},"./src/controller/buffer-controller.ts":function _src_controller_bufferControllerTs(R,_,I){I.r(_),I.d(_,"default",(function(){return G}));var C=I("./src/polyfills/number.ts"),w=I("./src/events.ts"),O=I("./src/utils/logger.ts"),x=I("./src/errors.ts"),P=I("./src/utils/buffer-helper.ts"),F=I("./src/utils/mediasource-helper.ts"),M=I("./src/loader/fragment.ts"),N=I("./src/controller/buffer-operation-queue.ts"),B=Object(F.getMediaSource)(),U=/([ha]vc.)(?:\.[^.,]+)+/,G=function(){function e(R){var _=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var R=_.hls,I=_.media,C=_.mediaSource;O.logger.log("[buffer-controller]: Media source opened"),I&&(_.updateMediaElementDuration(),R.trigger(w.Events.MEDIA_ATTACHED,{"media":I})),C&&C.removeEventListener("sourceopen",_._onMediaSourceOpen),_.checkPendingTracks()},this._onMediaSourceClose=function(){O.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){O.logger.log("[buffer-controller]: Media source ended")},this.hls=R,this._initSourceBuffer(),this.registerListeners()}var R=e.prototype;return R.hasSourceTypes=function e(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},R.destroy=function e(){this.unregisterListeners(),this.details=null},R.registerListeners=function e(){var R=this.hls;R.on(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(w.Events.BUFFER_RESET,this.onBufferReset,this),R.on(w.Events.BUFFER_APPENDING,this.onBufferAppending,this),R.on(w.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.on(w.Events.BUFFER_EOS,this.onBufferEos,this),R.on(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),R.on(w.Events.LEVEL_UPDATED,this.onLevelUpdated,this),R.on(w.Events.FRAG_PARSED,this.onFragParsed,this),R.on(w.Events.FRAG_CHANGED,this.onFragChanged,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(w.Events.BUFFER_RESET,this.onBufferReset,this),R.off(w.Events.BUFFER_APPENDING,this.onBufferAppending,this),R.off(w.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.off(w.Events.BUFFER_EOS,this.onBufferEos,this),R.off(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),R.off(w.Events.LEVEL_UPDATED,this.onLevelUpdated,this),R.off(w.Events.FRAG_PARSED,this.onFragParsed,this),R.off(w.Events.FRAG_CHANGED,this.onFragChanged,this)},R._initSourceBuffer=function e(){this.sourceBuffer={},this.operationQueue=new N.default(this.sourceBuffer),this.listeners={"audio":[],"video":[],"audiovideo":[]}},R.onManifestParsed=function e(R,_){var I=2;(_.audio&&!_.video||!_.altAudio)&&(I=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=I,this.details=null,O.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},R.onMediaAttaching=function e(R,_){var I=this.media=_.media;if(I&&B){var C=this.mediaSource=new B;C.addEventListener("sourceopen",this._onMediaSourceOpen),C.addEventListener("sourceended",this._onMediaSourceEnded),C.addEventListener("sourceclose",this._onMediaSourceClose),I.src=self.URL.createObjectURL(C),this._objectUrl=I.src}},R.onMediaDetaching=function e(){var R=this.media,_=this.mediaSource,I=this._objectUrl;if(_){if(O.logger.log("[buffer-controller]: media source detaching"),"open"===_.readyState)try{_.endOfStream()}catch(e){O.logger.warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}this.onBufferReset(),_.removeEventListener("sourceopen",this._onMediaSourceOpen),_.removeEventListener("sourceended",this._onMediaSourceEnded),_.removeEventListener("sourceclose",this._onMediaSourceClose),R&&(I&&self.URL.revokeObjectURL(I),R.src===I?(R.removeAttribute("src"),R.load()):O.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(w.Events.MEDIA_DETACHED,void 0)},R.onBufferReset=function e(){var R=this;this.getSourceBufferTypes().forEach((function(_){var I=R.sourceBuffer[_];try{I&&(R.removeBufferListeners(_),R.mediaSource&&R.mediaSource.removeSourceBuffer(I),R.sourceBuffer[_]=void 0)}catch(R){O.logger.warn("[buffer-controller]: Failed to reset the "+_+" buffer",R)}})),this._initSourceBuffer()},R.onBufferCodecs=function e(R,_){var I=this,C=this.getSourceBufferTypes().length;Object.keys(_).forEach((function(R){if(C){var w=I.tracks[R];if(w&&"function"==typeof w.buffer.changeType){var O=_[R],x=O.codec,P=O.levelCodec,F=O.container;if((w.levelCodec||w.codec).replace(U,"$1")!==(P||x).replace(U,"$1")){var M=F+";codecs="+(P||x);I.appendChangeType(R,M)}}}else I.pendingTracks[R]=_[R]})),C||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},R.appendChangeType=function e(R,_){var I=this,C=this.operationQueue,w={"execute":function e(){var w=I.sourceBuffer[R];w&&(O.logger.log("[buffer-controller]: changing "+R+" sourceBuffer type to "+_),w.changeType(_)),C.shiftAndExecuteNext(R)},"onStart":function e(){},"onComplete":function e(){},"onError":function e(_){O.logger.warn("[buffer-controller]: Failed to change "+R+" SourceBuffer type",_)}};C.append(w,R)},R.onBufferAppending=function e(R,_){var I=this,C=this.hls,F=this.operationQueue,M=this.tracks,N=_.data,B=_.type,U=_.frag,G=_.part,j=_.chunkMeta,K=j.buffering[B],H=self.performance.now();K.start=H;var V=U.stats.buffering,W=G?G.stats.buffering:null;0===V.start&&(V.start=H),W&&0===W.start&&(W.start=H);var Y=M.audio,z="audio"===B&&1===j.id&&"audio/mpeg"===(null==Y?void 0:Y.container),X={"execute":function e(){if(K.executeStart=self.performance.now(),z){var R=I.sourceBuffer[B];if(R){var _=U.start-R.timestampOffset;Math.abs(_)>=.1&&(O.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+U.start+" (delta: "+_+") sn: "+U.sn+")"),R.timestampOffset=U.start)}}I.appendExecutor(N,B)},"onStart":function e(){},"onComplete":function e(){var R=self.performance.now();K.executeEnd=K.end=R,0===V.first&&(V.first=R),W&&0===W.first&&(W.first=R);var _=I.sourceBuffer,C={};for(var O in _)C[O]=P.BufferHelper.getBuffered(_[O]);I.appendError=0,I.hls.trigger(w.Events.BUFFER_APPENDED,{"type":B,"frag":U,"part":G,"chunkMeta":j,"parent":U.type,"timeRanges":C})},"onError":function e(R){O.logger.error("[buffer-controller]: Error encountered while trying to append to the "+B+" SourceBuffer",R);var _={"type":x.ErrorTypes.MEDIA_ERROR,"parent":U.type,"details":x.ErrorDetails.BUFFER_APPEND_ERROR,"err":R,"fatal":!1};R.code===DOMException.QUOTA_EXCEEDED_ERR?_.details=x.ErrorDetails.BUFFER_FULL_ERROR:(I.appendError++,_.details=x.ErrorDetails.BUFFER_APPEND_ERROR,I.appendError>C.config.appendErrorMaxRetry&&(O.logger.error("[buffer-controller]: Failed "+C.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),_.fatal=!0)),C.trigger(w.Events.ERROR,_)}};F.append(X,B)},R.onBufferFlushing=function e(R,_){var I=this,C=this.operationQueue,x=function e(R){return{"execute":I.removeExecutor.bind(I,R,_.startOffset,_.endOffset),"onStart":function e(){},"onComplete":function e(){I.hls.trigger(w.Events.BUFFER_FLUSHED,{"type":R})},"onError":function e(_){O.logger.warn("[buffer-controller]: Failed to remove from "+R+" SourceBuffer",_)}}};_.type?C.append(x(_.type),_.type):this.getSourceBufferTypes().forEach((function(R){C.append(x(R),R)}))},R.onFragParsed=function e(R,_){var I=this,C=_.frag,x=_.part,P=[],F=x?x.elementaryStreams:C.elementaryStreams;F[M.ElementaryStreamTypes.AUDIOVIDEO]?P.push("audiovideo"):(F[M.ElementaryStreamTypes.AUDIO]&&P.push("audio"),F[M.ElementaryStreamTypes.VIDEO]&&P.push("video"));0===P.length&&O.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+C.type+" level: "+C.level+" sn: "+C.sn),this.blockBuffers((function e(){var R=self.performance.now();C.stats.buffering.end=R,x&&(x.stats.buffering.end=R);var _=x?x.stats:C.stats;I.hls.trigger(w.Events.FRAG_BUFFERED,{"frag":C,"part":x,"stats":_,"id":C.type})}),P)},R.onFragChanged=function e(R,_){this.flushBackBuffer()},R.onBufferEos=function e(R,_){var I=this,C=this.getSourceBufferTypes().reduce((function(R,C){var w=I.sourceBuffer[C];return _.type&&_.type!==C||w&&!w.ended&&(w.ended=!0,O.logger.log("[buffer-controller]: "+C+" sourceBuffer now EOS")),R&&!(w&&!w.ended)}),!0);C&&this.blockBuffers((function(){var R=I.mediaSource;R&&"open"===R.readyState&&R.endOfStream()}))},R.onLevelUpdated=function e(R,_){var I=_.details;I.fragments.length&&(this.details=I,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},R.flushBackBuffer=function e(){var R=this.hls,_=this.details,I=this.media,O=this.sourceBuffer;if(I&&null!==_){var x=this.getSourceBufferTypes();if(x.length){var F=_.live&&null!==R.config.liveBackBufferLength?R.config.liveBackBufferLength:R.config.backBufferLength;if(Object(C.isFiniteNumber)(F)&&!(F<0)){var M=I.currentTime,N=_.levelTargetDuration,B=Math.max(F,N),U=Math.floor(M/N)*N-B;x.forEach((function(I){var C=O[I];if(C){var x=P.BufferHelper.getBuffered(C);x.length>0&&U>x.start(0)&&(R.trigger(w.Events.BACK_BUFFER_REACHED,{"bufferEnd":U}),_.live&&R.trigger(w.Events.LIVE_BACK_BUFFER_REACHED,{"bufferEnd":U}),R.trigger(w.Events.BUFFER_FLUSHING,{"startOffset":0,"endOffset":U,"type":I}))}}))}}}},R.updateMediaElementDuration=function e(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var R=this.details,_=this.hls,I=this.media,w=this.mediaSource,x=R.fragments[0].start+R.totalduration,P=I.duration,F=Object(C.isFiniteNumber)(w.duration)?w.duration:0;R.live&&_.config.liveDurationInfinity?(O.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),w.duration=1/0,this.updateSeekableRange(R)):(x>F&&x>P||!Object(C.isFiniteNumber)(P))&&(O.logger.log("[buffer-controller]: Updating Media Source duration to "+x.toFixed(3)),w.duration=x)}},R.updateSeekableRange=function e(R){var _=this.mediaSource,I=R.fragments;if(I.length&&R.live&&null!=_&&_.setLiveSeekableRange){var C=Math.max(0,I[0].start),w=Math.max(C,C+R.totalduration);_.setLiveSeekableRange(C,w)}},R.checkPendingTracks=function e(){var R=this.bufferCodecEventsExpected,_=this.operationQueue,I=this.pendingTracks,C=Object.keys(I).length;if(C&&!R||2===C){this.createSourceBuffers(I),this.pendingTracks={};var O=this.getSourceBufferTypes();if(0===O.length)return void this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,"fatal":!0,"reason":"could not create source buffer for media codec(s)"});O.forEach((function(R){_.executeNext(R)}))}},R.createSourceBuffers=function e(R){var _=this.sourceBuffer,I=this.mediaSource;if(!I)throw Error("createSourceBuffers called when mediaSource was null");var C=0;for(var P in R)if(!_[P]){var F=R[P];if(!F)throw Error("source buffer exists for track "+P+", however track does not");var M=F.levelCodec||F.codec,N=F.container+";codecs="+M;O.logger.log("[buffer-controller]: creating sourceBuffer("+N+")");try{var B=_[P]=I.addSourceBuffer(N),U=P;this.addBufferListener(U,"updatestart",this._onSBUpdateStart),this.addBufferListener(U,"updateend",this._onSBUpdateEnd),this.addBufferListener(U,"error",this._onSBUpdateError),this.tracks[P]={"buffer":B,"codec":M,"container":F.container,"levelCodec":F.levelCodec,"id":F.id},C++}catch(e){O.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.BUFFER_ADD_CODEC_ERROR,"fatal":!1,"error":e,"mimeType":N})}}C&&this.hls.trigger(w.Events.BUFFER_CREATED,{"tracks":this.tracks})},R._onSBUpdateStart=function e(R){this.operationQueue.current(R).onStart()},R._onSBUpdateEnd=function e(R){var _=this.operationQueue;_.current(R).onComplete(),_.shiftAndExecuteNext(R)},R._onSBUpdateError=function e(R,_){O.logger.error("[buffer-controller]: "+R+" SourceBuffer error",_),this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.BUFFER_APPENDING_ERROR,"fatal":!1});var I=this.operationQueue.current(R);I&&I.onError(_)},R.removeExecutor=function e(R,_,I){var w=this.media,x=this.mediaSource,P=this.operationQueue,F=this.sourceBuffer[R];if(!w||!x||!F)return O.logger.warn("[buffer-controller]: Attempting to remove from the "+R+" SourceBuffer, but it does not exist"),void P.shiftAndExecuteNext(R);var M=Object(C.isFiniteNumber)(w.duration)?w.duration:1/0,N=Object(C.isFiniteNumber)(x.duration)?x.duration:1/0,B=Math.max(0,_),U=Math.min(I,M,N);U>B?(O.logger.log("[buffer-controller]: Removing ["+B+","+U+"] from the "+R+" SourceBuffer"),console.assert(!F.updating,R+" sourceBuffer must not be updating"),F.remove(B,U)):P.shiftAndExecuteNext(R)},R.appendExecutor=function e(R,_){var I=this.operationQueue,C=this.sourceBuffer[_];if(!C)return O.logger.warn("[buffer-controller]: Attempting to append to the "+_+" SourceBuffer, but it does not exist"),void I.shiftAndExecuteNext(_);C.ended=!1,console.assert(!C.updating,_+" sourceBuffer must not be updating"),C.appendBuffer(R)},R.blockBuffers=function e(R,_){var I=this;if(void 0===_&&(_=this.getSourceBufferTypes()),_.length){var C=this.operationQueue,w=_.map((function(R){return C.appendBlocker(R)}));Promise.all(w).then((function(){R(),_.forEach((function(R){var _=I.sourceBuffer[R];_&&_.updating||C.shiftAndExecuteNext(R)}))}))}else O.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist")},R.getSourceBufferTypes=function e(){return Object.keys(this.sourceBuffer)},R.addBufferListener=function e(R,_,I){var C=this.sourceBuffer[R];if(C){var w=I.bind(this,R);this.listeners[R].push({"event":_,"listener":w}),C.addEventListener(_,w)}},R.removeBufferListeners=function e(R){var _=this.sourceBuffer[R];_&&this.listeners[R].forEach((function(R){_.removeEventListener(R.event,R.listener)}))},e}()},"./src/controller/buffer-operation-queue.ts":function _src_controller_bufferOperationQueueTs(R,_,I){I.r(_),I.d(_,"default",(function(){return w}));var C=I("./src/utils/logger.ts"),w=function(){function e(R){this.buffers=void 0,this.queues={"video":[],"audio":[],"audiovideo":[]},this.buffers=R}var R=e.prototype;return R.append=function e(R,_){var I=this.queues[_];I.push(R),1===I.length&&this.buffers[_]&&this.executeNext(_)},R.insertAbort=function e(R,_){this.queues[_].unshift(R),this.executeNext(_)},R.appendBlocker=function e(R){var _,I=new Promise((function(R){_=R})),C={"execute":_,"onStart":function e(){},"onComplete":function e(){},"onError":function e(){}};return this.append(C,R),I},R.executeNext=function e(R){var _=this.buffers,I=this.queues,w=_[R],O=I[R];if(O.length){var x=O[0];try{x.execute()}catch(e){C.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),x.onError(e),w&&w.updating||(O.shift(),this.executeNext(R))}}},R.shiftAndExecuteNext=function e(R){this.queues[R].shift(),this.executeNext(R)},R.current=function e(R){return this.queues[R][0]},e}()},"./src/controller/cap-level-controller.ts":function _src_controller_capLevelControllerTs(R,_,I){I.r(_);var C=I("./src/events.ts");function a(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}var w=function(){function e(R){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=R,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var R=e.prototype;return R.setStreamController=function e(R){this.streamController=R},R.destroy=function e(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},R.registerListeners=function e(){var R=this.hls;R.on(C.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),R.on(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(C.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.unregisterListener=function e(){var R=this.hls;R.off(C.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),R.off(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(C.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.onFpsDropLevelCapping=function t(R,_){e.isLevelAllowed(_.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(_.droppedLevel)},R.onMediaAttaching=function e(R,_){this.media=_.media instanceof HTMLVideoElement?_.media:null},R.onManifestParsed=function e(R,_){var I=this.hls;this.restrictedLevels=[],this.firstLevel=_.firstLevel,I.config.capLevelToPlayerSize&&_.video&&this.startCapping()},R.onBufferCodecs=function e(R,_){this.hls.config.capLevelToPlayerSize&&_.video&&this.startCapping()},R.onMediaDetaching=function e(){this.stopCapping()},R.detectPlayerSize=function e(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var R=this.hls.levels;if(R.length){var _=this.hls;_.autoLevelCapping=this.getMaxLevel(R.length-1),_.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=_.autoLevelCapping}}},R.getMaxLevel=function t(R){var _=this,I=this.hls.levels;if(!I.length)return-1;var C=I.filter((function(I,C){return e.isLevelAllowed(C,_.restrictedLevels)&&C<=R}));return this.clientRect=null,e.getMaxLevelByMediaSize(C,this.mediaWidth,this.mediaHeight)},R.startCapping=function e(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},R.stopCapping=function e(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},R.getDimensions=function e(){if(this.clientRect)return this.clientRect;var R=this.media,_={"width":0,"height":0};if(R){var I=R.getBoundingClientRect();_.width=I.width,_.height=I.height,_.width||_.height||(_.width=I.right-I.left||R.width||0,_.height=I.bottom-I.top||R.height||0)}return this.clientRect=_,_},e.isLevelAllowed=function e(R,_){return void 0===_&&(_=[]),-1===_.indexOf(R)},e.getMaxLevelByMediaSize=function e(R,_,I){if(!R||!R.length)return-1;for(var C=function e(R,_){return!_||(R.width!==_.width||R.height!==_.height)},w=R.length-1,O=0;O<R.length;O+=1){var x=R[O];if((x.width>=_||x.height>=I)&&C(x,R[O+1])){w=O;break}}return w},function n(R,_,I){return _&&a(R.prototype,_),I&&a(R,I),R}(e,[{"key":"mediaWidth","get":function t(){return this.getDimensions().width*e.contentScaleFactor}},{"key":"mediaHeight","get":function t(){return this.getDimensions().height*e.contentScaleFactor}}],[{"key":"contentScaleFactor","get":function e(){var R=1;try{R=self.devicePixelRatio}catch(e){}return R}}]),e}();_.default=w},"./src/controller/cmcd-controller.ts":function _src_controller_cmcdControllerTs(R,_,I){I.r(_),I.d(_,"default",(function(){return P}));var C=I("./src/events.ts"),w=I("./src/types/cmcd.ts"),O=I("./src/utils/buffer-helper.ts"),x=I("./src/utils/logger.ts");function o(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}function l(R,_,I){return _&&o(R.prototype,_),I&&o(R,I),R}function u(R,_){var I="undefined"!=typeof Symbol&&R[Symbol.iterator]||R["@@iterator"];if(I)return(I=I.call(R)).next.bind(I);if(Array.isArray(R)||(I=function f(R,_){if(!R)return;if("string"==typeof R)return c(R,_);var I=Object.prototype.toString.call(R).slice(8,-1);"Object"===I&&R.constructor&&(I=R.constructor.name);if("Map"===I||"Set"===I)return Array.from(R);if("Arguments"===I||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(I))return c(R,_)}(R))||_&&R&&"number"==typeof R.length){I&&(R=I);var C=0;return function(){return C>=R.length?{"done":!0}:{"done":!1,"value":R[C++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(R,_){(null==_||_>R.length)&&(_=R.length);for(var I=0,C=new Array(_);I<_;I++)C[I]=R[I];return C}function d(){return d=Object.assign||function(R){for(var _=1;_<arguments.length;_++){var I=arguments[_];for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(R[C]=I[C])}return R},d.apply(this,arguments)}var P=function(){function e(R){var _=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){_.initialized&&(_.starved=!0),_.buffering=!0},this.onPlaying=function(){_.initialized||(_.initialized=!0),_.buffering=!1},this.applyPlaylistData=function(R){try{_.apply(R,{"ot":w.CMCDObjectType.MANIFEST,"su":!_.initialized})}catch(R){x.logger.warn("Could not generate manifest CMCD data.",R)}},this.applyFragmentData=function(R){try{var I=R.frag,C=_.hls.levels[I.level],O=_.getObjectType(I),P={"d":1e3*I.duration,"ot":O};O!==w.CMCDObjectType.VIDEO&&O!==w.CMCDObjectType.AUDIO&&O!=w.CMCDObjectType.MUXED||(P.br=C.bitrate/1e3,P.tb=_.getTopBandwidth(O)/1e3,P.bl=_.getBufferLength(O)),_.apply(R,P)}catch(R){x.logger.warn("Could not generate segment CMCD data.",R)}},this.hls=R;var I=this.config=R.config,C=I.cmcd;null!=C&&(I.pLoader=this.createPlaylistLoader(),I.fLoader=this.createFragmentLoader(),this.sid=C.sessionId||e.uuid(),this.cid=C.contentId,this.useHeaders=!0===C.useHeaders,this.registerListeners())}var R=e.prototype;return R.registerListeners=function e(){var R=this.hls;R.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),R.on(C.Events.BUFFER_CREATED,this.onBufferCreated,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),R.off(C.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},R.destroy=function e(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},R.onMediaAttached=function e(R,_){this.media=_.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},R.onMediaDetached=function e(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},R.onBufferCreated=function e(R,_){var I,C;this.audioBuffer=null===(I=_.tracks.audio)||void 0===I?void 0:I.buffer,this.videoBuffer=null===(C=_.tracks.video)||void 0===C?void 0:C.buffer},R.createData=function e(){var R;return{"v":w.CMCDVersion,"sf":w.CMCDStreamingFormat.HLS,"sid":this.sid,"cid":this.cid,"pr":null===(R=this.media)||void 0===R?void 0:R.playbackRate,"mtp":this.hls.bandwidthEstimate/1e3}},R.apply=function t(R,_){void 0===_&&(_={}),d(_,this.createData());var I=_.ot===w.CMCDObjectType.INIT||_.ot===w.CMCDObjectType.VIDEO||_.ot===w.CMCDObjectType.MUXED;if(this.starved&&I&&(_.bs=!0,_.su=!0,this.starved=!1),null==_.su&&(_.su=this.buffering),this.useHeaders){var C=e.toHeaders(_);if(!Object.keys(C).length)return;R.headers||(R.headers={}),d(R.headers,C)}else{var O=e.toQuery(_);if(!O)return;R.url=e.appendQueryToUri(R.url,O)}},R.getObjectType=function e(R){var _=R.type;return"subtitle"===_?w.CMCDObjectType.TIMED_TEXT:"initSegment"===R.sn?w.CMCDObjectType.INIT:"audio"===_?w.CMCDObjectType.AUDIO:"main"===_?this.hls.audioTracks.length?w.CMCDObjectType.VIDEO:w.CMCDObjectType.MUXED:void 0},R.getTopBandwidth=function e(R){var _,I=0,C=this.hls;if(R===w.CMCDObjectType.AUDIO)_=C.audioTracks;else{var O=C.maxAutoLevel,x=O>-1?O+1:C.levels.length;_=C.levels.slice(0,x)}for(var P,F=u(_);!(P=F()).done;){var M=P.value;M.bitrate>I&&(I=M.bitrate)}return I>0?I:NaN},R.getBufferLength=function e(R){var _=this.hls.media,I=R===w.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return I&&_?1e3*O.BufferHelper.bufferInfo(I,_.currentTime,this.config.maxBufferHole).len:NaN},R.createPlaylistLoader=function e(){var R=this.config.pLoader,_=this.applyPlaylistData,I=R||this.config.loader;return function(){function e(R){this.loader=void 0,this.loader=new I(R)}var R=e.prototype;return R.destroy=function e(){this.loader.destroy()},R.abort=function e(){this.loader.abort()},R.load=function e(R,I,C){_(R),this.loader.load(R,I,C)},l(e,[{"key":"stats","get":function e(){return this.loader.stats}},{"key":"context","get":function e(){return this.loader.context}}]),e}()},R.createFragmentLoader=function e(){var R=this.config.fLoader,_=this.applyFragmentData,I=R||this.config.loader;return function(){function e(R){this.loader=void 0,this.loader=new I(R)}var R=e.prototype;return R.destroy=function e(){this.loader.destroy()},R.abort=function e(){this.loader.abort()},R.load=function e(R,I,C){_(R),this.loader.load(R,I,C)},l(e,[{"key":"stats","get":function e(){return this.loader.stats}},{"key":"context","get":function e(){return this.loader.context}}]),e}()},e.uuid=function e(){var R=URL.createObjectURL(new Blob),e=R.toString();return URL.revokeObjectURL(R),e.substr(e.lastIndexOf("/")+1)},e.serialize=function e(R){for(var _,I=[],C=function e(R){return!Number.isNaN(R)&&null!=R&&""!==R&&!1!==R},w=function e(R){return Math.round(R)},O=function e(R){return 100*w(R/100)},x={"br":w,"d":w,"bl":O,"dl":O,"mtp":O,"nor":function e(R){return encodeURIComponent(R)},"rtp":O,"tb":w},P=u(Object.keys(R||{}).sort());!(_=P()).done;){var F=_.value,M=R[F];if(C(M)&&!("v"===F&&1===M||"pr"==F&&1===M)){var N=x[F];N&&(M=N(M));var B=typeof M,U=void 0;U="ot"===F||"sf"===F||"st"===F?F+"="+M:"boolean"===B?F:"number"===B?F+"="+M:F+"="+JSON.stringify(M),I.push(U)}}return I.join(",")},e.toHeaders=function t(R){for(var _={},I=["Object","Request","Session","Status"],C=[{},{},{},{}],w={"br":0,"d":0,"ot":0,"tb":0,"bl":1,"dl":1,"mtp":1,"nor":1,"nrr":1,"su":1,"cid":2,"pr":2,"sf":2,"sid":2,"st":2,"v":2,"bs":3,"rtp":3},O=0,x=Object.keys(R);O<x.length;O++){var P=x[O];C[null!=w[P]?w[P]:1][P]=R[P]}for(var F=0;F<C.length;F++){var M=e.serialize(C[F]);M&&(_["CMCD-"+I[F]]=M)}return _},e.toQuery=function t(R){return"CMCD="+encodeURIComponent(e.serialize(R))},e.appendQueryToUri=function e(R,_){if(!_)return R;var I=R.includes("?")?"&":"?";return""+R+I+_},e}()},"./src/controller/eme-controller.ts":function _src_controller_emeControllerTs(R,_,I){I.r(_);var C=I("./src/events.ts"),w=I("./src/errors.ts"),O=I("./src/utils/logger.ts"),x=I("./src/utils/mediakeys-helper.ts");function o(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}var P=function e(R,_,I,C){if(R===x.KeySystems.WIDEVINE)return function e(R,_,I){var C={"audioCapabilities":[],"videoCapabilities":[]};return R.forEach((function(R){C.audioCapabilities.push({"contentType":'audio/mp4; codecs="'+R+'"',"robustness":I.audioRobustness||""})})),_.forEach((function(R){C.videoCapabilities.push({"contentType":'video/mp4; codecs="'+R+'"',"robustness":I.videoRobustness||""})})),[C]}(_,I,C);throw new Error("Unknown key-system: "+R)},F=function(){function e(R){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=R,this._config=R.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var R=e.prototype;return R.destroy=function e(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},R._registerListeners=function e(){this.hls.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this)},R._unregisterListeners=function e(){this.hls.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this)},R.getLicenseServerUrl=function e(R){switch(R){case x.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+R+'"')},R._attemptKeySystemAccess=function e(R,_,I){var C=this,w=P(R,_,I,this._drmSystemOptions);O.logger.log("Requesting encrypted media key-system access");var x=this.requestMediaKeySystemAccess(R,w);this.mediaKeysPromise=x.then((function(_){return C._onMediaKeySystemAccessObtained(R,_)})),x.catch((function(_){O.logger.error('Failed to obtain key-system "'+R+'" access:',_)}))},R._onMediaKeySystemAccessObtained=function e(R,_){var I=this;O.logger.log('Access for key-system "'+R+'" obtained');var C={"mediaKeysSessionInitialized":!1,"mediaKeySystemAccess":_,"mediaKeySystemDomain":R};this._mediaKeysList.push(C);var w=Promise.resolve().then((function(){return _.createMediaKeys()})).then((function(_){return C.mediaKeys=_,O.logger.log('Media-keys created for key-system "'+R+'"'),I._onMediaKeysCreated(),_}));return w.catch((function(R){O.logger.error("Failed to create media-keys:",R)})),w},R._onMediaKeysCreated=function e(){var R=this;this._mediaKeysList.forEach((function(_){_.mediaKeysSession||(_.mediaKeysSession=_.mediaKeys.createSession(),R._onNewMediaKeySession(_.mediaKeysSession))}))},R._onNewMediaKeySession=function e(R){var _=this;O.logger.log("New key-system session "+R.sessionId),R.addEventListener("message",(function(I){_._onKeySessionMessage(R,I.message)}),!1)},R._onKeySessionMessage=function e(R,_){O.logger.log("Got EME message event, creating license request"),this._requestLicense(_,(function(_){O.logger.log("Received license data (length: "+(_?_.byteLength:_)+"), updating key-session"),R.update(_)}))},R.onMediaEncrypted=function e(R){var _=this;if(O.logger.log('Media is encrypted using "'+R.initDataType+'" init data type'),!this.mediaKeysPromise)return O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.KEY_SYSTEM_ERROR,"details":w.ErrorDetails.KEY_SYSTEM_NO_KEYS,"fatal":!0});var I=function e(I){_._media&&(_._attemptSetMediaKeys(I),_._generateRequestWithPreferredKeySession(R.initDataType,R.initData))};this.mediaKeysPromise.then(I).catch(I)},R._attemptSetMediaKeys=function e(R){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var _=this._mediaKeysList[0];if(!_||!_.mediaKeys)return O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.KEY_SYSTEM_ERROR,"details":w.ErrorDetails.KEY_SYSTEM_NO_KEYS,"fatal":!0});O.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(_.mediaKeys),this._hasSetMediaKeys=!0}},R._generateRequestWithPreferredKeySession=function e(R,_){var I=this,x=this._mediaKeysList[0];if(!x)return O.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.KEY_SYSTEM_ERROR,"details":w.ErrorDetails.KEY_SYSTEM_NO_ACCESS,"fatal":!0});if(x.mediaKeysSessionInitialized)O.logger.warn("Key-Session already initialized but requested again");else{var P=x.mediaKeysSession;if(!P)return O.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.KEY_SYSTEM_ERROR,"details":w.ErrorDetails.KEY_SYSTEM_NO_SESSION,"fatal":!0});if(!_)return O.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.KEY_SYSTEM_ERROR,"details":w.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,"fatal":!0});O.logger.log('Generating key-session request for "'+R+'" init data type'),x.mediaKeysSessionInitialized=!0,P.generateRequest(R,_).then((function(){O.logger.debug("Key-session generation succeeded")})).catch((function(R){O.logger.error("Error generating key-session request:",R),I.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.KEY_SYSTEM_ERROR,"details":w.ErrorDetails.KEY_SYSTEM_NO_SESSION,"fatal":!1})}))}},R._createLicenseXhr=function e(R,_,I){var C=new XMLHttpRequest;C.responseType="arraybuffer",C.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,C,R,_,I);var w=this._licenseXhrSetup;if(w)try{w.call(this.hls,C,R),w=void 0}catch(e){O.logger.error(e)}try{C.readyState||C.open("POST",R,!0),w&&w.call(this.hls,C,R)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return C},R._onLicenseRequestReadyStageChange=function e(R,_,I,x){if(4===R.readyState)if(200===R.status){this._requestLicenseFailureCount=0,O.logger.log("License request succeeded");var P=R.response,F=this._licenseResponseCallback;if(F)try{P=F.call(this.hls,R,_)}catch(e){O.logger.error(e)}x(P)}else{if(O.logger.error("License Request XHR failed ("+_+"). Status: "+R.status+" ("+R.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.KEY_SYSTEM_ERROR,"details":w.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,"fatal":!0});var M=3-this._requestLicenseFailureCount+1;O.logger.warn("Retrying license request, "+M+" attempts left"),this._requestLicense(I,x)}},R._generateLicenseRequestChallenge=function e(R,_){if(R.mediaKeySystemDomain===x.KeySystems.WIDEVINE)return _;throw new Error("unsupported key-system: "+R.mediaKeySystemDomain)},R._requestLicense=function e(R,_){O.logger.log("Requesting content license for key-system");var I=this._mediaKeysList[0];if(!I)return O.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.KEY_SYSTEM_ERROR,"details":w.ErrorDetails.KEY_SYSTEM_NO_ACCESS,"fatal":!0});try{var x=this.getLicenseServerUrl(I.mediaKeySystemDomain),P=this._createLicenseXhr(x,R,_);O.logger.log("Sending license request to URL: "+x);var F=this._generateLicenseRequestChallenge(I,R);P.send(F)}catch(e){O.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.KEY_SYSTEM_ERROR,"details":w.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,"fatal":!0})}},R.onMediaAttached=function e(R,_){if(this._emeEnabled){var I=_.media;this._media=I,I.addEventListener("encrypted",this._onMediaEncrypted)}},R.onMediaDetached=function e(){var R=this._media,_=this._mediaKeysList;R&&(R.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(_.map((function(R){if(R.mediaKeysSession)return R.mediaKeysSession.close().catch((function(){}))}))).then((function(){return R.setMediaKeys(null)})).catch((function(){})))},R.onManifestParsed=function e(R,_){if(this._emeEnabled){var I=_.levels.map((function(R){return R.audioCodec})).filter((function(R){return!!R})),C=_.levels.map((function(R){return R.videoCodec})).filter((function(R){return!!R}));this._attemptKeySystemAccess(x.KeySystems.WIDEVINE,I,C)}},function l(R,_,I){return _&&o(R.prototype,_),I&&o(R,I),R}(e,[{"key":"requestMediaKeySystemAccess","get":function e(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),e}();_.default=F},"./src/controller/fps-controller.ts":function _src_controller_fpsControllerTs(R,_,I){I.r(_);var C=I("./src/events.ts"),w=I("./src/utils/logger.ts"),O=function(){function e(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var R=e.prototype;return R.setStreamController=function e(R){this.streamController=R},R.registerListeners=function e(){this.hls.on(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function e(){this.hls.off(C.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function e(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function e(R,_){var I=this.hls.config;if(I.capLevelOnFPSDrop){var C=_.media instanceof self.HTMLVideoElement?_.media:null;this.media=C,C&&"function"==typeof C.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),I.fpsDroppedMonitoringPeriod)}},R.checkFPS=function e(R,_,I){var O=performance.now();if(_){if(this.lastTime){var x=O-this.lastTime,P=I-this.lastDroppedFrames,F=_-this.lastDecodedFrames,M=1e3*P/x,N=this.hls;if(N.trigger(C.Events.FPS_DROP,{"currentDropped":P,"currentDecoded":F,"totalDroppedFrames":I}),M>0&&P>N.config.fpsDroppedMonitoringThreshold*F){var B=N.currentLevel;w.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+B),B>0&&(-1===N.autoLevelCapping||N.autoLevelCapping>=B)&&(B-=1,N.trigger(C.Events.FPS_DROP_LEVEL_CAPPING,{"level":B,"droppedLevel":N.currentLevel}),N.autoLevelCapping=B,this.streamController.nextLevelSwitch())}}this.lastTime=O,this.lastDroppedFrames=I,this.lastDecodedFrames=_}},R.checkFPSInterval=function e(){var R=this.media;if(R)if(this.isVideoPlaybackQualityAvailable){var _=R.getVideoPlaybackQuality();this.checkFPS(R,_.totalVideoFrames,_.droppedVideoFrames)}else this.checkFPS(R,R.webkitDecodedFrameCount,R.webkitDroppedFrameCount)},e}();_.default=O},"./src/controller/fragment-finders.ts":function _src_controller_fragmentFindersTs(R,_,I){I.r(_),I.d(_,"findFragmentByPDT",(function(){return n})),I.d(_,"findFragmentByPTS",(function(){return s})),I.d(_,"fragmentWithinToleranceTest",(function(){return o})),I.d(_,"pdtWithinToleranceTest",(function(){return l})),I.d(_,"findFragWithCC",(function(){return u}));var C=I("./src/polyfills/number.ts"),w=I("./src/utils/binary-search.ts");function n(R,_,I){if(null===_||!Array.isArray(R)||!R.length||!Object(C.isFiniteNumber)(_))return null;if(_<(R[0].programDateTime||0))return null;if(_>=(R[R.length-1].endProgramDateTime||0))return null;I=I||0;for(var w=0;w<R.length;++w){var O=R[w];if(l(_,I,O))return O}return null}function s(R,_,I,C){void 0===I&&(I=0),void 0===C&&(C=0);var O=null;if(R?O=_[R.sn-_[0].sn+1]||null:0===I&&0===_[0].start&&(O=_[0]),O&&0===o(I,C,O))return O;var x=w.default.search(_,o.bind(null,I,C));return x||O}function o(R,_,I){void 0===R&&(R=0),void 0===_&&(_=0);var C=Math.min(_,I.duration+(I.deltaPTS?I.deltaPTS:0));return I.start+I.duration-C<=R?1:I.start-C>R&&I.start?-1:0}function l(R,_,I){var C=1e3*Math.min(_,I.duration+(I.deltaPTS?I.deltaPTS:0));return(I.endProgramDateTime||0)-C>R}function u(R,_){return w.default.search(R,(function(R){return R.cc<_?1:R.cc>_?-1:0}))}},"./src/controller/fragment-tracker.ts":function _src_controller_fragmentTrackerTs(R,_,I){I.r(_),I.d(_,"FragmentState",(function(){return C})),I.d(_,"FragmentTracker",(function(){return x}));var C,w=I("./src/events.ts"),O=I("./src/types/loader.ts");!function(R){R.NOT_LOADED="NOT_LOADED",R.BACKTRACKED="BACKTRACKED",R.APPENDING="APPENDING",R.PARTIAL="PARTIAL",R.OK="OK"}(C||(C={}));var x=function(){function e(R){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=R,this._registerListeners()}var R=e.prototype;return R._registerListeners=function e(){var R=this.hls;R.on(w.Events.BUFFER_APPENDED,this.onBufferAppended,this),R.on(w.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.on(w.Events.FRAG_LOADED,this.onFragLoaded,this)},R._unregisterListeners=function e(){var R=this.hls;R.off(w.Events.BUFFER_APPENDED,this.onBufferAppended,this),R.off(w.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.off(w.Events.FRAG_LOADED,this.onFragLoaded,this)},R.destroy=function e(){this._unregisterListeners(),this.fragments=this.timeRanges=null},R.getAppendedFrag=function e(R,_){if(_===O.PlaylistLevelType.MAIN){var I=this.activeFragment,C=this.activeParts;if(!I)return null;if(C)for(var w=C.length;w--;){var x=C[w],P=x?x.end:I.appendedPTS;if(x.start<=R&&void 0!==P&&R<=P)return w>9&&(this.activeParts=C.slice(w-9)),x}else if(I.start<=R&&void 0!==I.appendedPTS&&R<=I.appendedPTS)return I}return this.getBufferedFrag(R,_)},R.getBufferedFrag=function e(R,_){for(var I=this.fragments,C=Object.keys(I),w=C.length;w--;){var O=I[C[w]];if((null==O?void 0:O.body.type)===_&&O.buffered){var x=O.body;if(x.start<=R&&R<=x.end)return x}}return null},R.detectEvictedFragments=function e(R,_,I){var C=this;Object.keys(this.fragments).forEach((function(w){var O=C.fragments[w];if(O)if(O.buffered){var x=O.range[R];x&&x.time.some((function(R){var I=!C.isTimeBuffered(R.startPTS,R.endPTS,_);return I&&C.removeFragment(O.body),I}))}else O.body.type===I&&C.removeFragment(O.body)}))},R.detectPartialFragments=function e(R){var _=this,I=this.timeRanges,C=R.frag,w=R.part;if(I&&"initSegment"!==C.sn){var O=l(C),x=this.fragments[O];x&&(Object.keys(I).forEach((function(R){var O=C.elementaryStreams[R];if(O){var P=I[R],F=null!==w||!0===O.partial;x.range[R]=_.getBufferedTimes(C,w,F,P)}})),x.backtrack=x.loaded=null,Object.keys(x.range).length?x.buffered=!0:this.removeFragment(x.body))}},R.fragBuffered=function e(R){var _=l(R),I=this.fragments[_];I&&(I.backtrack=I.loaded=null,I.buffered=!0)},R.getBufferedTimes=function e(R,_,I,C){for(var w={"time":[],"partial":I},O=_?_.start:R.start,x=_?_.end:R.end,P=R.minEndPTS||x,F=R.maxStartPTS||O,M=0;M<C.length;M++){var N=C.start(M)-this.bufferPadding,B=C.end(M)+this.bufferPadding;if(F>=N&&P<=B){w.time.push({"startPTS":Math.max(O,C.start(M)),"endPTS":Math.min(x,C.end(M))});break}if(O<B&&x>N)w.partial=!0,w.time.push({"startPTS":Math.max(O,C.start(M)),"endPTS":Math.min(x,C.end(M))});else if(x<=N)break}return w},R.getPartialFragment=function e(R){var _,I,C,w=null,O=0,x=this.bufferPadding,P=this.fragments;return Object.keys(P).forEach((function(F){var M=P[F];M&&o(M)&&(I=M.body.start-x,C=M.body.end+x,R>=I&&R<=C&&(_=Math.min(R-I,C-R),O<=_&&(w=M.body,O=_)))})),w},R.getState=function e(R){var _=l(R),I=this.fragments[_];return I?I.buffered?o(I)?C.PARTIAL:C.OK:I.backtrack?C.BACKTRACKED:C.APPENDING:C.NOT_LOADED},R.backtrack=function e(R,_){var I=l(R),C=this.fragments[I];if(!C||C.backtrack)return null;var e=C.backtrack=_||C.loaded;return C.loaded=null,e},R.getBacktrackData=function e(R){var _=l(R),I=this.fragments[_];if(I){var C,w=I.backtrack;if(null!=w&&null!==(C=w.payload)&&void 0!==C&&C.byteLength)return w;this.removeFragment(R)}return null},R.isTimeBuffered=function e(R,_,I){for(var C,w,O=0;O<I.length;O++){if(C=I.start(O)-this.bufferPadding,w=I.end(O)+this.bufferPadding,R>=C&&_<=w)return!0;if(_<=C)return!1}return!1},R.onFragLoaded=function e(R,_){var I=_.frag,C=_.part;if("initSegment"!==I.sn&&!I.bitrateTest&&!C){var w=l(I);this.fragments[w]={"body":I,"loaded":_,"backtrack":null,"buffered":!1,"range":Object.create(null)}}},R.onBufferAppended=function e(R,_){var I=this,C=_.frag,w=_.part,x=_.timeRanges;if(C.type===O.PlaylistLevelType.MAIN)if(this.activeFragment=C,w){var P=this.activeParts;P||(this.activeParts=P=[]),P.push(w)}else this.activeParts=null;this.timeRanges=x,Object.keys(x).forEach((function(R){var _=x[R];if(I.detectEvictedFragments(R,_),!w)for(var O=0;O<_.length;O++)C.appendedPTS=Math.max(_.end(O),C.appendedPTS||0)}))},R.onFragBuffered=function e(R,_){this.detectPartialFragments(_)},R.hasFragment=function e(R){var _=l(R);return!!this.fragments[_]},R.removeFragmentsInRange=function e(R,_,I){var C=this;Object.keys(this.fragments).forEach((function(w){var O=C.fragments[w];if(O&&O.buffered){var x=O.body;x.type===I&&x.start<_&&x.end>R&&C.removeFragment(x)}}))},R.removeFragment=function e(R){var _=l(R);R.stats.loaded=0,R.clearElementaryStreamInfo(),delete this.fragments[_]},R.removeAllFragments=function e(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},e}();function o(R){var _,I;return R.buffered&&((null===(_=R.range.video)||void 0===_?void 0:_.partial)||(null===(I=R.range.audio)||void 0===I?void 0:I.partial))}function l(R){return R.type+"_"+R.level+"_"+R.urlId+"_"+R.sn}},"./src/controller/gap-controller.ts":function _src_controller_gapControllerTs(R,_,I){I.r(_),I.d(_,"STALL_MINIMUM_DURATION_MS",(function(){return P})),I.d(_,"MAX_START_GAP_JUMP",(function(){return F})),I.d(_,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return M})),I.d(_,"SKIP_BUFFER_RANGE_START",(function(){return N})),I.d(_,"default",(function(){return B}));var C=I("./src/utils/buffer-helper.ts"),w=I("./src/errors.ts"),O=I("./src/events.ts"),x=I("./src/utils/logger.ts"),P=250,F=2,M=.1,N=.05,B=function(){function e(R,_,I,C){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=R,this.media=_,this.fragmentTracker=I,this.hls=C}var R=e.prototype;return R.destroy=function e(){this.hls=this.fragmentTracker=this.media=null},R.poll=function e(R){var _=this.config,I=this.media,w=this.stalled,O=I.currentTime,M=I.seeking,N=this.seeking&&!M,B=!this.seeking&&M;if(this.seeking=M,O===R){if((B||N)&&(this.stalled=null),!I.paused&&!I.ended&&0!==I.playbackRate&&C.BufferHelper.getBuffered(I).length){var U=C.BufferHelper.bufferInfo(I,O,0),G=U.len>0,j=U.nextStart||0;if(G||j){if(M){var K=U.len>F,H=!j||j-O>F&&!this.fragmentTracker.getPartialFragment(O);if(K||H)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var V,W=Math.max(j,U.start||0)-O,Y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,z=(null==Y||null===(V=Y.details)||void 0===V?void 0:V.live)?2*Y.details.targetduration:F;if(W>0&&W<=z)return void this._trySkipBufferHole(null)}var X=self.performance.now();if(null!==w){var q=X-w;!M&&q>=P&&this._reportStall(U.len);var Z=C.BufferHelper.bufferInfo(I,O,_.maxBufferHole);this._tryFixBufferStall(Z,q)}else this.stalled=X}}}else if(this.moved=!0,null!==w){if(this.stallReported){var Q=self.performance.now()-w;x.logger.warn("playback not stuck anymore @"+O+", after "+Math.round(Q)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},R._tryFixBufferStall=function e(R,_){var I=this.config,C=this.fragmentTracker,w=this.media.currentTime,O=C.getPartialFragment(w);if(O&&this._trySkipBufferHole(O))return;R.len>I.maxBufferHole&&_>1e3*I.highBufferWatchdogPeriod&&(x.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},R._reportStall=function e(R){var _=this.hls,I=this.media;this.stallReported||(this.stallReported=!0,x.logger.warn("Playback stalling at @"+I.currentTime+" due to low buffer (buffer="+R+")"),_.trigger(O.Events.ERROR,{"type":w.ErrorTypes.MEDIA_ERROR,"details":w.ErrorDetails.BUFFER_STALLED_ERROR,"fatal":!1,"buffer":R}))},R._trySkipBufferHole=function e(R){for(var _=this.config,I=this.hls,P=this.media,F=P.currentTime,B=0,U=C.BufferHelper.getBuffered(P),G=0;G<U.length;G++){var j=U.start(G);if(F+_.maxBufferHole>=B&&F<j){var K=Math.max(j+N,P.currentTime+M);return x.logger.warn("skipping hole, adjusting currentTime from "+F+" to "+K),this.moved=!0,this.stalled=null,P.currentTime=K,R&&I.trigger(O.Events.ERROR,{"type":w.ErrorTypes.MEDIA_ERROR,"details":w.ErrorDetails.BUFFER_SEEK_OVER_HOLE,"fatal":!1,"reason":"fragment loaded with buffer holes, seeking from "+F+" to "+K,"frag":R}),K}B=U.end(G)}return 0},R._tryNudgeBuffer=function e(){var R=this.config,_=this.hls,I=this.media,C=I.currentTime,P=(this.nudgeRetry||0)+1;if(this.nudgeRetry=P,P<R.nudgeMaxRetry){var F=C+P*R.nudgeOffset;x.logger.warn("Nudging 'currentTime' from "+C+" to "+F),I.currentTime=F,_.trigger(O.Events.ERROR,{"type":w.ErrorTypes.MEDIA_ERROR,"details":w.ErrorDetails.BUFFER_NUDGE_ON_STALL,"fatal":!1})}else x.logger.error("Playhead still not moving while enough data buffered @"+C+" after "+R.nudgeMaxRetry+" nudges"),_.trigger(O.Events.ERROR,{"type":w.ErrorTypes.MEDIA_ERROR,"details":w.ErrorDetails.BUFFER_STALLED_ERROR,"fatal":!0})},e}()},"./src/controller/id3-track-controller.ts":function _src_controller_id3TrackControllerTs(R,_,I){I.r(_);var C=I("./src/events.ts"),w=I("./src/utils/texttrack-utils.ts"),O=I("./src/demux/id3.ts"),x=function(){function e(R){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=R,this._registerListeners()}var R=e.prototype;return R.destroy=function e(){this._unregisterListeners()},R._registerListeners=function e(){var R=this.hls;R.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(C.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),R.on(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R._unregisterListeners=function e(){var R=this.hls;R.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(C.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),R.off(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R.onMediaAttached=function e(R,_){this.media=_.media},R.onMediaDetaching=function e(){this.id3Track&&(Object(w.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},R.getID3Track=function e(R){if(this.media){for(var _=0;_<R.length;_++){var I=R[_];if("metadata"===I.kind&&"id3"===I.label)return Object(w.sendAddTrackEvent)(I,this.media),I}return this.media.addTextTrack("metadata","id3")}},R.onFragParsingMetadata=function e(R,_){if(this.media){var I=_.frag,C=_.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var w=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,x=0;x<C.length;x++){var P=O.getID3Frames(C[x].data);if(P){var F=C[x].pts,M=x<C.length-1?C[x+1].pts:I.end;M-F<=0&&(M=F+.25);for(var N=0;N<P.length;N++){var B=P[N];if(!O.isTimeStampFrame(B)){var U=new w(F,M,"");U.value=B,this.id3Track.addCue(U)}}}}}},R.onBufferFlushing=function e(R,_){var I=_.startOffset,C=_.endOffset,O=_.type;if(!O||"audio"===O){var x=this.id3Track;x&&Object(w.removeCuesInRange)(x,I,C)}},e}();_.default=x},"./src/controller/latency-controller.ts":function _src_controller_latencyControllerTs(R,_,I){I.r(_),I.d(_,"default",(function(){return x}));var C=I("./src/errors.ts"),w=I("./src/events.ts"),O=I("./src/utils/logger.ts");function s(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}var x=function(){function e(R){var _=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return _.timeupdate()},this.hls=R,this.config=R.config,this.registerListeners()}var R=e.prototype;return R.destroy=function e(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},R.registerListeners=function e(){this.hls.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(w.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(w.Events.ERROR,this.onError,this)},R.unregisterListeners=function e(){this.hls.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(w.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(w.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(w.Events.ERROR,this.onError)},R.onMediaAttached=function e(R,_){this.media=_.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},R.onMediaDetaching=function e(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},R.onManifestLoading=function e(){this.levelDetails=null,this._latency=null,this.stallCount=0},R.onLevelUpdated=function e(R,_){var I=_.details;this.levelDetails=I,I.advanced&&this.timeupdate(),!I.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},R.onError=function e(R,_){_.details===C.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,O.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},R.timeupdate=function e(){var R=this.media,_=this.levelDetails;if(R&&_){this.currentTime=R.currentTime;var I=this.computeLatency();if(null!==I){this._latency=I;var C=this.config,w=C.lowLatencyMode,O=C.maxLiveSyncPlaybackRate;if(w&&1!==O){var x=this.targetLatency;if(null!==x){var P=I-x,F=P<Math.min(this.maxLatency,x+_.targetduration);if(_.live&&F&&P>.05&&this.forwardBufferLength>1){var M=Math.min(2,Math.max(1,O)),N=Math.round(2/(1+Math.exp(-.75*P-this.edgeStalled))*20)/20;R.playbackRate=Math.min(M,Math.max(1,N))}else 1!==R.playbackRate&&0!==R.playbackRate&&(R.playbackRate=1)}}}}},R.estimateLiveEdge=function e(){var R=this.levelDetails;return null===R?null:R.edge+R.age},R.computeLatency=function e(){var R=this.estimateLiveEdge();return null===R?null:R-this.currentTime},function o(R,_,I){return _&&s(R.prototype,_),I&&s(R,I),R}(e,[{"key":"latency","get":function e(){return this._latency||0}},{"key":"maxLatency","get":function e(){var R=this.config,_=this.levelDetails;return void 0!==R.liveMaxLatencyDuration?R.liveMaxLatencyDuration:_?R.liveMaxLatencyDurationCount*_.targetduration:0}},{"key":"targetLatency","get":function e(){var R=this.levelDetails;if(null===R)return null;var _=R.holdBack,I=R.partHoldBack,C=R.targetduration,w=this.config,O=w.liveSyncDuration,x=w.liveSyncDurationCount,P=w.lowLatencyMode,F=this.hls.userConfig,M=P&&I||_;(F.liveSyncDuration||F.liveSyncDurationCount||0===M)&&(M=void 0!==O?O:x*C);var N=C;return M+Math.min(1*this.stallCount,N)}},{"key":"liveSyncPosition","get":function e(){var R=this.estimateLiveEdge(),_=this.targetLatency,I=this.levelDetails;if(null===R||null===_||null===I)return null;var C=I.edge,w=R-_-this.edgeStalled,O=C-I.totalduration,x=C-(this.config.lowLatencyMode&&I.partTarget||I.targetduration);return Math.min(Math.max(O,w),x)}},{"key":"drift","get":function e(){var R=this.levelDetails;return null===R?1:R.drift}},{"key":"edgeStalled","get":function e(){var R=this.levelDetails;if(null===R)return 0;var _=3*(this.config.lowLatencyMode&&R.partTarget||R.targetduration);return Math.max(R.age-_,0)}},{"key":"forwardBufferLength","get":function e(){var R=this.media,_=this.levelDetails;if(!R||!_)return 0;var I=R.buffered.length;return I?R.buffered.end(I-1):_.edge-this.currentTime}}]),e}()},"./src/controller/level-controller.ts":function _src_controller_levelControllerTs(R,_,I){I.r(_),I.d(_,"default",(function(){return B}));var C=I("./src/types/level.ts"),w=I("./src/events.ts"),O=I("./src/errors.ts"),x=I("./src/utils/codecs.ts"),P=I("./src/controller/level-helper.ts"),F=I("./src/controller/base-playlist-controller.ts"),M=I("./src/types/loader.ts");function f(){return f=Object.assign||function(R){for(var _=1;_<arguments.length;_++){var I=arguments[_];for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(R[C]=I[C])}return R},f.apply(this,arguments)}function c(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}function v(R,_){return v=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},v(R,_)}var N=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),B=function(R){function t(_){var I;return(I=R.call(this,_,"[level-controller]")||this)._levels=[],I._firstLevel=-1,I._startLevel=void 0,I.currentLevelIndex=-1,I.manualLevelIndex=-1,I.onParsedComplete=void 0,I._registerListeners(),I}!function h(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,v(R,_)}(t,R);var _=t.prototype;return _._registerListeners=function e(){var R=this.hls;R.on(w.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(w.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.on(w.Events.FRAG_LOADED,this.onFragLoaded,this),R.on(w.Events.ERROR,this.onError,this)},_._unregisterListeners=function e(){var R=this.hls;R.off(w.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(w.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.off(w.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(w.Events.ERROR,this.onError,this)},_.destroy=function t(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,R.prototype.destroy.call(this)},_.startLoad=function t(){this._levels.forEach((function(R){R.loadError=0})),R.prototype.startLoad.call(this)},_.onManifestLoaded=function e(R,_){var I,F,M=[],B=[],U=[],G={},j=!1,K=!1,H=!1;if(_.levels.forEach((function(R){var _=R.attrs;j=j||!(!R.width||!R.height),K=K||!!R.videoCodec,H=H||!!R.audioCodec,N&&R.audioCodec&&-1!==R.audioCodec.indexOf("mp4a.40.34")&&(R.audioCodec=void 0);var I=R.bitrate+"-"+R.attrs.RESOLUTION+"-"+R.attrs.CODECS;(F=G[I])?F.url.push(R.url):(F=new C.Level(R),G[I]=F,M.push(F)),_&&(_.AUDIO&&Object(P.addGroupId)(F,"audio",_.AUDIO),_.SUBTITLES&&Object(P.addGroupId)(F,"text",_.SUBTITLES))})),(j||K)&&H&&(M=M.filter((function(R){var _=R.videoCodec,I=R.width,C=R.height;return!!_||!(!I||!C)}))),M=M.filter((function(R){var _=R.audioCodec,I=R.videoCodec;return(!_||Object(x.isCodecSupportedInMp4)(_,"audio"))&&(!I||Object(x.isCodecSupportedInMp4)(I,"video"))})),_.audioTracks&&(B=_.audioTracks.filter((function(R){return!R.audioCodec||Object(x.isCodecSupportedInMp4)(R.audioCodec,"audio")})),Object(P.assignTrackIdsByGroup)(B)),_.subtitles&&(U=_.subtitles,Object(P.assignTrackIdsByGroup)(U)),M.length>0){I=M[0].bitrate,M.sort((function(R,_){return R.bitrate-_.bitrate})),this._levels=M;for(var V=0;V<M.length;V++)if(M[V].bitrate===I){this._firstLevel=V,this.log("manifest loaded, "+M.length+" level(s) found, first bitrate: "+I);break}var W=H&&!K,Y={"levels":M,"audioTracks":B,"subtitleTracks":U,"firstLevel":this._firstLevel,"stats":_.stats,"audio":H,"video":K,"altAudio":!W&&B.some((function(R){return!!R.url}))};this.hls.trigger(w.Events.MANIFEST_PARSED,Y),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(w.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,"fatal":!0,"url":_.url,"reason":"no level with compatible codecs found in manifest"})},_.onError=function t(_,I){if(R.prototype.onError.call(this,_,I),!I.fatal){var C=I.context,w=this._levels[this.currentLevelIndex];if(C&&(C.type===M.PlaylistContextType.AUDIO_TRACK&&w.audioGroupIds&&C.groupId===w.audioGroupIds[w.urlId]||C.type===M.PlaylistContextType.SUBTITLE_TRACK&&w.textGroupIds&&C.groupId===w.textGroupIds[w.urlId]))this.redundantFailover(this.currentLevelIndex);else{var x,P=!1,F=!0;switch(I.details){case O.ErrorDetails.FRAG_LOAD_ERROR:case O.ErrorDetails.FRAG_LOAD_TIMEOUT:case O.ErrorDetails.KEY_LOAD_ERROR:case O.ErrorDetails.KEY_LOAD_TIMEOUT:if(I.frag){var N=this._levels[I.frag.level];N?(N.fragmentError++,N.fragmentError>this.hls.config.fragLoadingMaxRetry&&(x=I.frag.level)):x=I.frag.level}break;case O.ErrorDetails.LEVEL_LOAD_ERROR:case O.ErrorDetails.LEVEL_LOAD_TIMEOUT:C&&(C.deliveryDirectives&&(F=!1),x=C.level),P=!0;break;case O.ErrorDetails.REMUX_ALLOC_ERROR:x=I.level,P=!0}void 0!==x&&this.recoverLevel(I,x,P,F)}}},_.recoverLevel=function e(R,_,I,C){var w=R.details,O=this._levels[_];if(O.loadError++,I){if(!this.retryLoadingOrFail(R))return void(this.currentLevelIndex=-1);R.levelRetry=!0}if(C){var x=O.url.length;if(x>1&&O.loadError<x)R.levelRetry=!0,this.redundantFailover(_);else if(-1===this.manualLevelIndex){var P=0===_?this._levels.length-1:_-1;this.currentLevelIndex!==P&&0===this._levels[P].loadError&&(this.warn(w+": switch to "+P),R.levelRetry=!0,this.hls.nextAutoLevel=P)}}},_.redundantFailover=function e(R){var _=this._levels[R],I=_.url.length;if(I>1){var C=(_.urlId+1)%I;this.warn("Switching to redundant URL-id "+C),this._levels.forEach((function(R){R.urlId=C})),this.level=R}},_.onFragLoaded=function e(R,_){var I=_.frag;if(void 0!==I&&I.type===M.PlaylistLevelType.MAIN){var C=this._levels[I.level];void 0!==C&&(C.fragmentError=0,C.loadError=0)}},_.onLevelLoaded=function e(R,_){var I,C,w=_.level,O=_.details,x=this._levels[w];if(!x)return this.warn("Invalid level index "+w),void(null!==(C=_.deliveryDirectives)&&void 0!==C&&C.skip&&(O.deltaUpdateFailed=!0));w===this.currentLevelIndex?(0===x.fragmentError&&(x.loadError=0,this.retryCount=0),this.playlistLoaded(w,_,x.details)):null!==(I=_.deliveryDirectives)&&void 0!==I&&I.skip&&(O.deltaUpdateFailed=!0)},_.onAudioTrackSwitched=function e(R,_){var I=this.hls.levels[this.currentLevelIndex];if(I&&I.audioGroupIds){for(var C=-1,w=this.hls.audioTracks[_.id].groupId,O=0;O<I.audioGroupIds.length;O++)if(I.audioGroupIds[O]===w){C=O;break}C!==I.urlId&&(I.urlId=C,this.startLoad())}},_.loadPlaylist=function e(R){var _=this.currentLevelIndex,I=this._levels[_];if(this.canLoad&&I&&I.url.length>0){var C=I.urlId,O=I.url[C];if(R)try{O=R.addDirectives(O)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Attempt loading level index "+_+(R?" at sn "+R.msn+" part "+R.part:"")+" with URL-id "+C+" "+O),this.clearTimer(),this.hls.trigger(w.Events.LEVEL_LOADING,{"url":O,"level":_,"id":C,"deliveryDirectives":R||null})}},_.removeLevel=function e(R,_){var I=function e(R,I){return I!==_},C=this._levels.filter((function(C,w){return w!==R||C.url.length>1&&void 0!==_&&(C.url=C.url.filter(I),C.audioGroupIds&&(C.audioGroupIds=C.audioGroupIds.filter(I)),C.textGroupIds&&(C.textGroupIds=C.textGroupIds.filter(I)),C.urlId=0,!0)})).map((function(R,_){var I=R.details;return null!=I&&I.fragments&&I.fragments.forEach((function(R){R.level=_})),R}));this._levels=C,this.hls.trigger(w.Events.LEVELS_UPDATED,{"levels":C})},function d(R,_,I){return _&&c(R.prototype,_),I&&c(R,I),R}(t,[{"key":"levels","get":function e(){return 0===this._levels.length?null:this._levels}},{"key":"level","get":function e(){return this.currentLevelIndex},"set":function e(R){var _,I=this._levels;if(0!==I.length&&(this.currentLevelIndex!==R||null===(_=I[R])||void 0===_||!_.details)){if(R<0||R>=I.length){var C=R<0;if(this.hls.trigger(w.Events.ERROR,{"type":O.ErrorTypes.OTHER_ERROR,"details":O.ErrorDetails.LEVEL_SWITCH_ERROR,"level":R,"fatal":C,"reason":"invalid level idx"}),C)return;R=Math.min(R,I.length-1)}this.clearTimer();var x=this.currentLevelIndex,P=I[x],F=I[R];this.log("switching to level "+R+" from "+x),this.currentLevelIndex=R;var M=f({},F,{"level":R,"maxBitrate":F.maxBitrate,"uri":F.uri,"urlId":F.urlId});delete M._urlId,this.hls.trigger(w.Events.LEVEL_SWITCHING,M);var N=F.details;if(!N||N.live){var B=this.switchParams(F.uri,null==P?void 0:P.details);this.loadPlaylist(B)}}}},{"key":"manualLevel","get":function e(){return this.manualLevelIndex},"set":function e(R){this.manualLevelIndex=R,void 0===this._startLevel&&(this._startLevel=R),-1!==R&&(this.level=R)}},{"key":"firstLevel","get":function e(){return this._firstLevel},"set":function e(R){this._firstLevel=R}},{"key":"startLevel","get":function e(){if(void 0===this._startLevel){var R=this.hls.config.startLevel;return void 0!==R?R:this._firstLevel}return this._startLevel},"set":function e(R){this._startLevel=R}},{"key":"nextLoadLevel","get":function e(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},"set":function e(R){this.level=R,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=R)}}]),t}(F.default)},"./src/controller/level-helper.ts":function _src_controller_levelHelperTs(R,_,I){I.r(_),I.d(_,"addGroupId",(function(){return n})),I.d(_,"assignTrackIdsByGroup",(function(){return s})),I.d(_,"updatePTS",(function(){return o})),I.d(_,"updateFragPTSDTS",(function(){return u})),I.d(_,"mergeDetails",(function(){return f})),I.d(_,"mapPartIntersection",(function(){return c})),I.d(_,"mapFragmentIntersection",(function(){return d})),I.d(_,"adjustSliding",(function(){return h})),I.d(_,"addSliding",(function(){return v})),I.d(_,"computeReloadInterval",(function(){return g})),I.d(_,"getFragmentWithSN",(function(){return p})),I.d(_,"getPartWith",(function(){return m}));var C=I("./src/polyfills/number.ts"),w=I("./src/utils/logger.ts");function n(R,_,I){switch(_){case"audio":R.audioGroupIds||(R.audioGroupIds=[]),R.audioGroupIds.push(I);break;case"text":R.textGroupIds||(R.textGroupIds=[]),R.textGroupIds.push(I)}}function s(R){var _={};R.forEach((function(R){var I=R.groupId||"";R.id=_[I]=_[I]||0,_[I]++}))}function o(R,_,I){l(R[_],R[I])}function l(R,_){var I=_.startPTS;if(Object(C.isFiniteNumber)(I)){var w,O=0;_.sn>R.sn?(O=I-R.start,w=R):(O=R.start-I,w=_),w.duration!==O&&(w.duration=O)}else if(_.sn>R.sn){R.cc===_.cc&&R.minEndPTS?_.start=R.start+(R.minEndPTS-R.start):_.start=R.start+R.duration}else _.start=Math.max(R.start-_.duration,0)}function u(R,_,I,O,x,P){O-I<=0&&(w.logger.warn("Fragment should have a positive duration",_),O=I+_.duration,P=x+_.duration);var F=I,M=O,N=_.startPTS,B=_.endPTS;if(Object(C.isFiniteNumber)(N)){var U=Math.abs(N-I);Object(C.isFiniteNumber)(_.deltaPTS)?_.deltaPTS=Math.max(U,_.deltaPTS):_.deltaPTS=U,F=Math.max(I,N),I=Math.min(I,N),x=Math.min(x,_.startDTS),M=Math.min(O,B),O=Math.max(O,B),P=Math.max(P,_.endDTS)}_.duration=O-I;var G=I-_.start;_.appendedPTS=O,_.start=_.startPTS=I,_.maxStartPTS=F,_.startDTS=x,_.endPTS=O,_.minEndPTS=M,_.endDTS=P;var j,K=_.sn;if(!R||K<R.startSN||K>R.endSN)return 0;var H=K-R.startSN,V=R.fragments;for(V[H]=_,j=H;j>0;j--)l(V[j],V[j-1]);for(j=H;j<V.length-1;j++)l(V[j],V[j+1]);return R.fragmentHint&&l(V[V.length-1],R.fragmentHint),R.PTSKnown=R.alignedSliding=!0,G}function f(R,_){for(var I=null,O=R.fragments,x=O.length-1;x>=0;x--){var P=O[x].initSegment;if(P){I=P;break}}R.fragmentHint&&delete R.fragmentHint.endPTS;var F,M=0;(d(R,_,(function(R,w){R.relurl&&(M=R.cc-w.cc),Object(C.isFiniteNumber)(R.startPTS)&&Object(C.isFiniteNumber)(R.endPTS)&&(w.start=w.startPTS=R.startPTS,w.startDTS=R.startDTS,w.appendedPTS=R.appendedPTS,w.maxStartPTS=R.maxStartPTS,w.endPTS=R.endPTS,w.endDTS=R.endDTS,w.minEndPTS=R.minEndPTS,w.duration=R.endPTS-R.startPTS,w.duration&&(F=w),_.PTSKnown=_.alignedSliding=!0),w.elementaryStreams=R.elementaryStreams,w.loader=R.loader,w.stats=R.stats,w.urlId=R.urlId,R.initSegment&&(w.initSegment=R.initSegment,I=R.initSegment)})),I)&&(_.fragmentHint?_.fragments.concat(_.fragmentHint):_.fragments).forEach((function(R){var _;R.initSegment&&R.initSegment.relurl!==(null===(_=I)||void 0===_?void 0:_.relurl)||(R.initSegment=I)}));if(_.skippedSegments&&(_.deltaUpdateFailed=_.fragments.some((function(R){return!R})),_.deltaUpdateFailed)){w.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var N=_.skippedSegments;N--;)_.fragments.shift();_.startSN=_.fragments[0].sn,_.startCC=_.fragments[0].cc}var B=_.fragments;if(M){w.logger.warn("discontinuity sliding from playlist, take drift into account");for(var U=0;U<B.length;U++)B[U].cc+=M}_.skippedSegments&&(_.startCC=_.fragments[0].cc),c(R.partList,_.partList,(function(R,_){_.elementaryStreams=R.elementaryStreams,_.stats=R.stats})),F?u(_,F,F.startPTS,F.endPTS,F.startDTS,F.endDTS):h(R,_),B.length&&(_.totalduration=_.edge-B[0].start),_.driftStartTime=R.driftStartTime,_.driftStart=R.driftStart;var G=_.advancedDateTime;if(_.advanced&&G){var j=_.edge;_.driftStart||(_.driftStartTime=G,_.driftStart=j),_.driftEndTime=G,_.driftEnd=j}else _.driftEndTime=R.driftEndTime,_.driftEnd=R.driftEnd,_.advancedDateTime=R.advancedDateTime}function c(R,_,I){if(R&&_)for(var C=0,w=0,O=R.length;w<=O;w++){var x=R[w],P=_[w+C];x&&P&&x.index===P.index&&x.fragment.sn===P.fragment.sn?I(x,P):C--}}function d(R,_,I){for(var C=_.skippedSegments,w=Math.max(R.startSN,_.startSN)-_.startSN,O=(R.fragmentHint?1:0)+(C?_.endSN:Math.min(R.endSN,_.endSN))-_.startSN,x=_.startSN-R.startSN,P=_.fragmentHint?_.fragments.concat(_.fragmentHint):_.fragments,F=R.fragmentHint?R.fragments.concat(R.fragmentHint):R.fragments,M=w;M<=O;M++){var N=F[x+M],B=P[M];C&&!B&&M<C&&(B=_.fragments[M]=N),N&&B&&I(N,B)}}function h(R,_){var I=_.startSN+_.skippedSegments-R.startSN,C=R.fragments;I<0||I>=C.length||v(_,C[I].start)}function v(R,_){if(_){for(var I=R.fragments,C=R.skippedSegments;C<I.length;C++)I[C].start+=_;R.fragmentHint&&(R.fragmentHint.start+=_)}}function g(R,_){var I,C=1e3*R.levelTargetDuration,w=C/2,O=R.age,x=O>0&&O<3*C,P=_.loading.end-_.loading.start,F=R.availabilityDelay;if(!1===R.updated)if(x){var M=333*R.misses;I=Math.max(Math.min(w,2*P),M),R.availabilityDelay=(R.availabilityDelay||0)+I}else I=w;else x?(F=Math.min(F||C/2,O),R.availabilityDelay=F,I=F+C-O):I=C-P;return Math.round(I)}function p(R,_,I){if(!R||!R.details)return null;var C=R.details,w=C.fragments[_-C.startSN];return w||((w=C.fragmentHint)&&w.sn===_?w:_<C.startSN&&I&&I.sn===_?I:null)}function m(R,_,I){if(!R||!R.details)return null;var C=R.details.partList;if(C)for(var w=C.length;w--;){var O=C[w];if(O.index===I&&O.fragment.sn===_)return O}return null}},"./src/controller/stream-controller.ts":function _src_controller_streamControllerTs(R,_,I){I.r(_),I.d(_,"default",(function(){return H}));var C=I("./src/polyfills/number.ts"),w=I("./src/controller/base-stream-controller.ts"),O=I("./src/is-supported.ts"),x=I("./src/events.ts"),P=I("./src/utils/buffer-helper.ts"),F=I("./src/controller/fragment-tracker.ts"),M=I("./src/types/loader.ts"),N=I("./src/loader/fragment.ts"),B=I("./src/demux/transmuxer-interface.ts"),U=I("./src/types/transmuxer.ts"),G=I("./src/controller/gap-controller.ts"),j=I("./src/errors.ts"),K=I("./src/utils/logger.ts");function p(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}function E(R,_){return E=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},E(R,_)}var H=function(R){function t(_,I){var C;return(C=R.call(this,_,I,"[stream-controller]")||this).audioCodecSwap=!1,C.gapController=null,C.level=-1,C._forceStartLoad=!1,C.altAudio=!1,C.audioOnly=!1,C.fragPlaying=null,C.onvplaying=null,C.onvseeked=null,C.fragLastKbps=0,C.stalled=!1,C.couldBacktrack=!1,C.audioCodecSwitch=!1,C.videoBuffer=null,C._registerListeners(),C}!function y(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,E(R,_)}(t,R);var _=t.prototype;return _._registerListeners=function e(){var R=this.hls;R.on(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(x.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(x.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),R.on(x.Events.ERROR,this.onError,this),R.on(x.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.on(x.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.on(x.Events.BUFFER_CREATED,this.onBufferCreated,this),R.on(x.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.on(x.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),R.on(x.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_._unregisterListeners=function e(){var R=this.hls;R.off(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(x.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),R.off(x.Events.ERROR,this.onError,this),R.off(x.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.off(x.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.off(x.Events.BUFFER_CREATED,this.onBufferCreated,this),R.off(x.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.off(x.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),R.off(x.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_.onHandlerDestroying=function e(){this._unregisterListeners(),this.onMediaDetaching()},_.startLoad=function e(R){if(this.levels){var _=this.lastCurrentTime,I=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var C=I.startLevel;-1===C&&(I.config.testBandwidth?(C=0,this.bitrateTest=!0):C=I.nextAutoLevel),this.level=I.nextLoadLevel=C,this.loadedmetadata=!1}_>0&&-1===R&&(this.log("Override startPosition with lastCurrentTime @"+_.toFixed(3)),R=_),this.state=w.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=R,this.tick()}else this._forceStartLoad=!0,this.state=w.State.STOPPED},_.stopLoad=function t(){this._forceStartLoad=!1,R.prototype.stopLoad.call(this)},_.doTick=function e(){switch(this.state){case w.State.IDLE:this.doTickIdle();break;case w.State.WAITING_LEVEL:var R,_=this.levels,I=this.level,C=null==_||null===(R=_[I])||void 0===R?void 0:R.details;if(C&&(!C.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(C))break;this.state=w.State.IDLE;break}break;case w.State.FRAG_LOADING_WAITING_RETRY:var O,x=self.performance.now(),P=this.retryDate;(!P||x>=P||null!==(O=this.media)&&void 0!==O&&O.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=w.State.IDLE)}this.onTickEnd()},_.onTickEnd=function t(){R.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},_.doTickIdle=function e(){var R,_,I=this.hls,C=this.levelLastLoaded,O=this.levels,P=this.media,B=I.config,U=I.nextLoadLevel;if(null!==C&&(P||!this.startFragRequested&&B.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&O&&O[U]){var G=O[U];this.level=I.nextLoadLevel=U;var j=G.details;if(!j||this.state===w.State.WAITING_LEVEL||j.live&&this.levelLastLoaded!==U)this.state=w.State.WAITING_LEVEL;else{var K=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:P,M.PlaylistLevelType.MAIN);if(null!==K)if(!(K.len>=this.getMaxBufferLength(G.maxBitrate))){if(this._streamEnded(K,j)){var H={};return this.altAudio&&(H.type="video"),this.hls.trigger(x.Events.BUFFER_EOS,H),void(this.state=w.State.ENDED)}var V=K.end,W=this.getNextFragment(V,j);if(this.couldBacktrack&&!this.fragPrevious&&W&&"initSegment"!==W.sn){var Y=W.sn-j.startSN;Y>1&&(W=j.fragments[Y-1],this.fragmentTracker.removeFragment(W))}if(W&&this.fragmentTracker.getState(W)===F.FragmentState.OK&&this.nextLoadPosition>V){var z=this.audioOnly&&!this.altAudio?N.ElementaryStreamTypes.AUDIO:N.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(P,z,M.PlaylistLevelType.MAIN),W=this.getNextFragment(this.nextLoadPosition,j)}W&&(!W.initSegment||W.initSegment.data||this.bitrateTest||(W=W.initSegment),"identity"!==(null===(R=W.decryptdata)||void 0===R?void 0:R.keyFormat)||null!==(_=W.decryptdata)&&void 0!==_&&_.key?this.loadFragment(W,j,V):this.loadKey(W,j))}}}},_.loadFragment=function t(_,I,C){var w,O=this.fragmentTracker.getState(_);if(this.fragCurrent=_,O===F.FragmentState.BACKTRACKED){var x=this.fragmentTracker.getBacktrackData(_);if(x)return this._handleFragmentLoadProgress(x),void this._handleFragmentLoadComplete(x);O=F.FragmentState.NOT_LOADED}O===F.FragmentState.NOT_LOADED||O===F.FragmentState.PARTIAL?"initSegment"===_.sn?this._loadInitSegment(_):this.bitrateTest?(_.bitrateTest=!0,this.log("Fragment "+_.sn+" of level "+_.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(_)):(this.startFragRequested=!0,R.prototype.loadFragment.call(this,_,I,C)):O===F.FragmentState.APPENDING?this.reduceMaxBufferLength(_.duration)&&this.fragmentTracker.removeFragment(_):0===(null===(w=this.media)||void 0===w?void 0:w.buffered.length)&&this.fragmentTracker.removeAllFragments()},_.getAppendedFrag=function e(R){var _=this.fragmentTracker.getAppendedFrag(R,M.PlaylistLevelType.MAIN);return _&&"fragment"in _?_.fragment:_},_.getBufferedFrag=function e(R){return this.fragmentTracker.getBufferedFrag(R,M.PlaylistLevelType.MAIN)},_.followingBufferedFrag=function e(R){return R?this.getBufferedFrag(R.end+.5):null},_.immediateLevelSwitch=function e(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},_.nextLevelSwitch=function e(){var R=this.levels,_=this.media;if(null!=_&&_.readyState){var I,C=this.getAppendedFrag(_.currentTime);if(C&&C.start>1&&this.flushMainBuffer(0,C.start-1),!_.paused&&R){var w=R[this.hls.nextLoadLevel],O=this.fragLastKbps;I=O&&this.fragCurrent?this.fragCurrent.duration*w.maxBitrate/(1e3*O)+1:0}else I=0;var x=this.getBufferedFrag(_.currentTime+I);if(x){var P=this.followingBufferedFrag(x);if(P){this.abortCurrentFrag();var F=P.maxStartPTS?P.maxStartPTS:P.start,M=P.duration,N=Math.max(x.end,F+Math.min(Math.max(M-this.config.maxFragLookUpTolerance,.5*M),.75*M));this.flushMainBuffer(N,Number.POSITIVE_INFINITY)}}}},_.abortCurrentFrag=function e(){var R=this.fragCurrent;this.fragCurrent=null,null!=R&&R.loader&&R.loader.abort(),this.state===w.State.KEY_LOADING&&(this.state=w.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},_.flushMainBuffer=function t(_,I){R.prototype.flushMainBuffer.call(this,_,I,this.altAudio?"video":null)},_.onMediaAttached=function t(_,I){R.prototype.onMediaAttached.call(this,_,I);var C=I.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),C.addEventListener("playing",this.onvplaying),C.addEventListener("seeked",this.onvseeked),this.gapController=new G.default(this.config,C,this.fragmentTracker,this.hls)},_.onMediaDetaching=function t(){var _=this.media;_&&(_.removeEventListener("playing",this.onvplaying),_.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),R.prototype.onMediaDetaching.call(this)},_.onMediaPlaying=function e(){this.tick()},_.onMediaSeeked=function e(){var R=this.media,_=R?R.currentTime:null;Object(C.isFiniteNumber)(_)&&this.log("Media seeked to "+_.toFixed(3)),this.tick()},_.onManifestLoading=function e(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},_.onManifestParsed=function e(R,_){var I,C=!1,w=!1;_.levels.forEach((function(R){(I=R.audioCodec)&&(-1!==I.indexOf("mp4a.40.2")&&(C=!0),-1!==I.indexOf("mp4a.40.5")&&(w=!0))})),this.audioCodecSwitch=C&&w&&!Object(O.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=_.levels,this.startFragRequested=!1},_.onLevelLoading=function e(R,_){var I=this.levels;if(I&&this.state===w.State.IDLE){var C=I[_.level];(!C.details||C.details.live&&this.levelLastLoaded!==_.level||this.waitForCdnTuneIn(C.details))&&(this.state=w.State.WAITING_LEVEL)}},_.onLevelLoaded=function e(R,_){var I,C=this.levels,O=_.level,P=_.details,F=P.totalduration;if(C){this.log("Level "+O+" loaded ["+P.startSN+","+P.endSN+"], cc ["+P.startCC+", "+P.endCC+"] duration:"+F);var M=this.fragCurrent;!M||this.state!==w.State.FRAG_LOADING&&this.state!==w.State.FRAG_LOADING_WAITING_RETRY||M.level!==_.level&&M.loader&&(this.state=w.State.IDLE,M.loader.abort());var N=C[O],B=0;if(P.live||null!==(I=N.details)&&void 0!==I&&I.live){if(P.fragments[0]||(P.deltaUpdateFailed=!0),P.deltaUpdateFailed)return;B=this.alignPlaylists(P,N.details)}if(N.details=P,this.levelLastLoaded=O,this.hls.trigger(x.Events.LEVEL_UPDATED,{"details":P,"level":O}),this.state===w.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(P))return;this.state=w.State.IDLE}this.startFragRequested?P.live&&this.synchronizeToLiveEdge(P):this.setStartPosition(P,B),this.tick()}else this.warn("Levels were reset while loading level "+O)},_._handleFragmentLoadProgress=function e(R){var _,I=R.frag,C=R.part,w=R.payload,O=this.levels;if(O){var x=O[I.level],P=x.details;if(P){var F=x.videoCodec,N=P.PTSKnown||!P.live,G=null===(_=I.initSegment)||void 0===_?void 0:_.data,j=this._getAudioCodec(x),K=this.transmuxer=this.transmuxer||new B.default(this.hls,M.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),H=C?C.index:-1,V=-1!==H,W=new U.ChunkMetadata(I.level,I.sn,I.stats.chunkCount,w.byteLength,H,V),Y=this.initPTS[I.cc];K.push(w,G,j,F,I,C,P.totalduration,N,W,Y)}else this.warn("Dropping fragment "+I.sn+" of level "+I.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+I.sn+" of level "+I.level+" will not be buffered")},_.onAudioTrackSwitching=function e(R,_){var I=this.altAudio,C=!!_.url,w=_.id;if(!C){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var O=this.fragCurrent;null!=O&&O.loader&&(this.log("Switching to main audio track, cancel main fragment load"),O.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var P=this.hls;I&&P.trigger(x.Events.BUFFER_FLUSHING,{"startOffset":0,"endOffset":Number.POSITIVE_INFINITY,"type":"audio"}),P.trigger(x.Events.AUDIO_TRACK_SWITCHED,{"id":w})}},_.onAudioTrackSwitched=function e(R,_){var I=_.id,C=!!this.hls.audioTracks[I].url;if(C){var w=this.videoBuffer;w&&this.mediaBuffer!==w&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=w)}this.altAudio=C,this.tick()},_.onBufferCreated=function e(R,_){var I,C,w=_.tracks,O=!1;for(var x in w){var P=w[x];if("main"===P.id){if(C=x,I=P,"video"===x){var F=w[x];F&&(this.videoBuffer=F.buffer)}}else O=!0}O&&I?(this.log("Alternate track found, use "+C+".buffered to schedule main fragment loading"),this.mediaBuffer=I.buffer):this.mediaBuffer=this.media},_.onFragBuffered=function e(R,_){var I=_.frag,C=_.part;if(!I||I.type===M.PlaylistLevelType.MAIN){if(this.fragContextChanged(I))return this.warn("Fragment "+I.sn+(C?" p: "+C.index:"")+" of level "+I.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===w.State.PARSED&&(this.state=w.State.IDLE));var O=C?C.stats:I.stats;this.fragLastKbps=Math.round(8*O.total/(O.buffering.end-O.loading.first)),"initSegment"!==I.sn&&(this.fragPrevious=I),this.fragBufferedComplete(I,C)}},_.onError=function e(R,_){switch(_.details){case j.ErrorDetails.FRAG_LOAD_ERROR:case j.ErrorDetails.FRAG_LOAD_TIMEOUT:case j.ErrorDetails.KEY_LOAD_ERROR:case j.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(M.PlaylistLevelType.MAIN,_);break;case j.ErrorDetails.LEVEL_LOAD_ERROR:case j.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==w.State.ERROR&&(_.fatal?(this.warn(""+_.details),this.state=w.State.ERROR):_.levelRetry||this.state!==w.State.WAITING_LEVEL||(this.state=w.State.IDLE));break;case j.ErrorDetails.BUFFER_FULL_ERROR:if("main"===_.parent&&(this.state===w.State.PARSING||this.state===w.State.PARSED)){var I=!0,C=this.getFwdBufferInfo(this.media,M.PlaylistLevelType.MAIN);C&&C.len>.5&&(I=!this.reduceMaxBufferLength(C.len)),I&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},_.checkBuffer=function e(){var R=this.media,_=this.gapController;if(R&&_&&R.readyState){var I=P.BufferHelper.getBuffered(R);!this.loadedmetadata&&I.length?(this.loadedmetadata=!0,this.seekToStartPos()):_.poll(this.lastCurrentTime),this.lastCurrentTime=R.currentTime}},_.onFragLoadEmergencyAborted=function e(){this.state=w.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},_.onBufferFlushed=function e(R,_){var I=_.type;if(I!==N.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var C=(I===N.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(C,I,M.PlaylistLevelType.MAIN)}},_.onLevelsUpdated=function e(R,_){this.levels=_.levels},_.swapAudioCodec=function e(){this.audioCodecSwap=!this.audioCodecSwap},_.seekToStartPos=function e(){var R=this.media,_=R.currentTime,I=this.startPosition;if(I>=0&&_<I){if(R.seeking)return void K.logger.log("could not seek to "+I+", already seeking at "+_);var C=P.BufferHelper.getBuffered(R),w=(C.length?C.start(0):0)-I;w>0&&(w<this.config.maxBufferHole||w<this.config.maxFragLookUpTolerance)&&(K.logger.log("adjusting start position by "+w+" to match buffer start"),I+=w,this.startPosition=I),this.log("seek to target start position "+I+" from current time "+_),R.currentTime=I}},_._getAudioCodec=function e(R){var _=this.config.defaultAudioCodec||R.audioCodec;return this.audioCodecSwap&&_&&(this.log("Swapping audio codec"),_=-1!==_.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),_},_._loadBitrateTestFrag=function e(R){var _=this;this._doFragLoad(R).then((function(I){var C=_.hls;if(I&&!C.nextLoadLevel&&!_.fragContextChanged(R)){_.fragLoadError=0,_.state=w.State.IDLE,_.startFragRequested=!1,_.bitrateTest=!1;var O=R.stats;O.parsing.start=O.parsing.end=O.buffering.start=O.buffering.end=self.performance.now(),C.trigger(x.Events.FRAG_LOADED,I)}}))},_._handleTransmuxComplete=function e(R){var _,I="main",O=this.hls,P=R.remuxResult,F=R.chunkMeta,M=this.getCurrentContext(F);if(!M)return this.warn("The loading context changed while buffering fragment "+F.sn+" of level "+F.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(F.level);var B=M.frag,U=M.part,G=M.level,j=P.video,K=P.text,H=P.id3,V=P.initSegment,W=this.altAudio?void 0:P.audio;if(!this.fragContextChanged(B)){if(this.state=w.State.PARSING,V){V.tracks&&(this._bufferInitSegment(G,V.tracks,B,F),O.trigger(x.Events.FRAG_PARSING_INIT_SEGMENT,{"frag":B,"id":I,"tracks":V.tracks}));var Y=V.initPTS,z=V.timescale;Object(C.isFiniteNumber)(Y)&&(this.initPTS[B.cc]=Y,O.trigger(x.Events.INIT_PTS_FOUND,{"frag":B,"id":I,"initPTS":Y,"timescale":z}))}if(j&&!1!==P.independent){if(G.details){var X=j.startPTS,q=j.endPTS,Z=j.startDTS,Q=j.endDTS;if(U)U.elementaryStreams[j.type]={"startPTS":X,"endPTS":q,"startDTS":Z,"endDTS":Q};else if(j.firstKeyFrame&&j.independent&&(this.couldBacktrack=!0),j.dropped&&j.independent){if(this.getLoadPosition()+this.config.maxBufferHole<X)return void this.backtrack(B);B.setElementaryStreamInfo(j.type,B.start,q,B.start,Q,!0)}B.setElementaryStreamInfo(j.type,X,q,Z,Q),this.bufferFragmentData(j,B,U,F)}}else if(!1===P.independent)return void this.backtrack(B);if(W){var J=W.startPTS,$=W.endPTS,ee=W.startDTS,te=W.endDTS;U&&(U.elementaryStreams[N.ElementaryStreamTypes.AUDIO]={"startPTS":J,"endPTS":$,"startDTS":ee,"endDTS":te}),B.setElementaryStreamInfo(N.ElementaryStreamTypes.AUDIO,J,$,ee,te),this.bufferFragmentData(W,B,U,F)}if(null!=H&&null!==(_=H.samples)&&void 0!==_&&_.length){var re={"frag":B,"id":I,"samples":H.samples};O.trigger(x.Events.FRAG_PARSING_METADATA,re)}if(K){var ie={"frag":B,"id":I,"samples":K.samples};O.trigger(x.Events.FRAG_PARSING_USERDATA,ie)}}},_._bufferInitSegment=function e(R,_,I,C){var O=this;if(this.state===w.State.PARSING){this.audioOnly=!!_.audio&&!_.video,this.altAudio&&!this.audioOnly&&delete _.audio;var P=_.audio,F=_.video,M=_.audiovideo;if(P){var N=R.audioCodec,B=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(N&&(N=-1!==N.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==P.metadata.channelCount&&-1===B.indexOf("firefox")&&(N="mp4a.40.5")),-1!==B.indexOf("android")&&"audio/mpeg"!==P.container&&(N="mp4a.40.2",this.log("Android: force audio codec to "+N)),R.audioCodec&&R.audioCodec!==N&&this.log('Swapping manifest audio codec "'+R.audioCodec+'" for "'+N+'"'),P.levelCodec=N,P.id="main",this.log("Init audio buffer, container:"+P.container+", codecs[selected/level/parsed]=["+(N||"")+"/"+(R.audioCodec||"")+"/"+P.codec+"]")}F&&(F.levelCodec=R.videoCodec,F.id="main",this.log("Init video buffer, container:"+F.container+", codecs[level/parsed]=["+(R.videoCodec||"")+"/"+F.codec+"]")),M&&this.log("Init audiovideo buffer, container:"+M.container+", codecs[level/parsed]=["+(R.attrs.CODECS||"")+"/"+M.codec+"]"),this.hls.trigger(x.Events.BUFFER_CODECS,_),Object.keys(_).forEach((function(R){var w=_[R].initSegment;null!=w&&w.byteLength&&O.hls.trigger(x.Events.BUFFER_APPENDING,{"type":R,"data":w,"frag":I,"part":null,"chunkMeta":C,"parent":I.type})})),this.tick()}},_.backtrack=function e(R){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(R);var _=this.fragmentTracker.backtrack(R);this.fragPrevious=null,this.nextLoadPosition=R.start,_?this.resetFragmentLoading(R):this.state=w.State.BACKTRACKING},_.checkFragmentChanged=function e(){var R=this.media,_=null;if(R&&R.readyState>1&&!1===R.seeking){var I=R.currentTime;if(P.BufferHelper.isBuffered(R,I)?_=this.getAppendedFrag(I):P.BufferHelper.isBuffered(R,I+.1)&&(_=this.getAppendedFrag(I+.1)),_){var C=this.fragPlaying,w=_.level;C&&_.sn===C.sn&&C.level===w&&_.urlId===C.urlId||(this.hls.trigger(x.Events.FRAG_CHANGED,{"frag":_}),C&&C.level===w||this.hls.trigger(x.Events.LEVEL_SWITCHED,{"level":w}),this.fragPlaying=_)}}},function m(R,_,I){return _&&p(R.prototype,_),I&&p(R,I),R}(t,[{"key":"nextLevel","get":function e(){var R=this.nextBufferedFrag;return R?R.level:-1}},{"key":"currentLevel","get":function e(){var R=this.media;if(R){var _=this.getAppendedFrag(R.currentTime);if(_)return _.level}return-1}},{"key":"nextBufferedFrag","get":function e(){var R=this.media;if(R){var _=this.getAppendedFrag(R.currentTime);return this.followingBufferedFrag(_)}return null}},{"key":"forceStartLoad","get":function e(){return this._forceStartLoad}}]),t}(w.default)},"./src/controller/subtitle-stream-controller.ts":function _src_controller_subtitleStreamControllerTs(R,_,I){I.r(_),I.d(_,"SubtitleStreamController",(function(){return U}));var C=I("./src/events.ts"),w=I("./src/utils/buffer-helper.ts"),O=I("./src/controller/fragment-finders.ts"),x=I("./src/utils/discontinuities.ts"),P=I("./src/controller/level-helper.ts"),F=I("./src/controller/fragment-tracker.ts"),M=I("./src/controller/base-stream-controller.ts"),N=I("./src/types/loader.ts"),B=I("./src/types/level.ts");function d(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}function g(R,_){return g=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},g(R,_)}var U=function(R){function t(_,I){var C;return(C=R.call(this,_,I,"[subtitle-stream-controller]")||this).levels=[],C.currentTrackId=-1,C.tracksBuffered=[],C.mainDetails=null,C._registerListeners(),C}!function v(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,g(R,_)}(t,R);var _=t.prototype;return _.onHandlerDestroying=function e(){this._unregisterListeners(),this.mainDetails=null},_._registerListeners=function e(){var R=this.hls;R.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(C.Events.ERROR,this.onError,this),R.on(C.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.on(C.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),R.on(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.on(C.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),R.on(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},_._unregisterListeners=function e(){var R=this.hls;R.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(C.Events.ERROR,this.onError,this),R.off(C.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.off(C.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),R.off(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.off(C.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),R.off(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},_.startLoad=function e(){this.stopLoad(),this.state=M.State.IDLE,this.setInterval(500),this.tick()},_.onManifestLoading=function e(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},_.onLevelLoaded=function e(R,_){this.mainDetails=_.details},_.onSubtitleFragProcessed=function e(R,_){var I=_.frag,C=_.success;if(this.fragPrevious=I,this.state=M.State.IDLE,C){var w=this.tracksBuffered[this.currentTrackId];if(w){for(var O,x=I.start,P=0;P<w.length;P++)if(x>=w[P].start&&x<=w[P].end){O=w[P];break}var F=I.start+I.duration;O?O.end=F:(O={"start":x,"end":F},w.push(O)),this.fragmentTracker.fragBuffered(I)}}},_.onBufferFlushing=function e(R,_){var I=_.startOffset,C=_.endOffset;if(0===I&&C!==Number.POSITIVE_INFINITY){var w=this.currentTrackId,O=this.levels;if(!O.length||!O[w]||!O[w].details)return;var x=C-O[w].details.targetduration;if(x<=0)return;_.endOffsetSubtitles=Math.max(0,x),this.tracksBuffered.forEach((function(R){for(var _=0;_<R.length;)if(R[_].end<=x)R.shift();else{if(!(R[_].start<x))break;R[_].start=x,_++}})),this.fragmentTracker.removeFragmentsInRange(I,x,N.PlaylistLevelType.SUBTITLE)}},_.onError=function e(R,_){var I,C=_.frag;C&&C.type===N.PlaylistLevelType.SUBTITLE&&(null!==(I=this.fragCurrent)&&void 0!==I&&I.loader&&this.fragCurrent.loader.abort(),this.state=M.State.IDLE)},_.onSubtitleTracksUpdated=function e(R,_){var I=this,C=_.subtitleTracks;this.tracksBuffered=[],this.levels=C.map((function(R){return new B.Level(R)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(R){I.tracksBuffered[R.id]=[]})),this.mediaBuffer=null},_.onSubtitleTrackSwitch=function e(R,_){if(this.currentTrackId=_.id,this.levels.length&&-1!==this.currentTrackId){var I=this.levels[this.currentTrackId];null!=I&&I.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,I&&this.setInterval(500)}else this.clearInterval()},_.onSubtitleTrackLoaded=function e(R,_){var I,C=_.details,w=_.id,F=this.currentTrackId,N=this.levels;if(N.length){var B=N[F];if(!(w>=N.length||w!==F)&&B){if(this.mediaBuffer=this.mediaBufferTimeRanges,C.live||null!==(I=B.details)&&void 0!==I&&I.live){var U=this.mainDetails;if(C.deltaUpdateFailed||!U)return;var G=U.fragments[0];if(B.details)0===this.alignPlaylists(C,B.details)&&G&&Object(P.addSliding)(C,G.start);else C.hasProgramDateTime&&U.hasProgramDateTime?Object(x.alignMediaPlaylistByPDT)(C,U):G&&Object(P.addSliding)(C,G.start)}if(B.details=C,this.levelLastLoaded=w,this.tick(),C.live&&!this.fragCurrent&&this.media&&this.state===M.State.IDLE)Object(O.findFragmentByPTS)(null,C.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),B.details=void 0)}}},_._handleFragmentLoadComplete=function e(R){var _=R.frag,I=R.payload,w=_.decryptdata,O=this.hls;if(!this.fragContextChanged(_)&&I&&I.byteLength>0&&w&&w.key&&w.iv&&"AES-128"===w.method){var x=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(I),w.key.buffer,w.iv.buffer).then((function(R){var I=performance.now();O.trigger(C.Events.FRAG_DECRYPTED,{"frag":_,"payload":R,"stats":{"tstart":x,"tdecrypt":I}})}))}},_.doTick=function e(){if(this.media){if(this.state===M.State.IDLE){var R,_=this.currentTrackId,I=this.levels;if(!I.length||!I[_]||!I[_].details)return;var C=I[_].details,x=C.targetduration,P=this.config,N=this.media,B=w.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,N.currentTime-x,P.maxBufferHole),U=B.end;if(B.len>this.getMaxBufferLength()+x)return;console.assert(C,"Subtitle track details are defined on idle subtitle stream controller tick");var G,j=C.fragments,K=j.length,H=C.edge,V=this.fragPrevious;if(U<H){var W=P.maxFragLookUpTolerance;!(G=Object(O.findFragmentByPTS)(V,j,U,W))&&V&&V.start<j[0].start&&(G=j[0])}else G=j[K-1];null!==(R=G)&&void 0!==R&&R.encrypted?this.loadKey(G,C):G&&this.fragmentTracker.getState(G)===F.FragmentState.NOT_LOADED&&this.loadFragment(G,C,U)}}else this.state=M.State.IDLE},_.loadFragment=function t(_,I,C){this.fragCurrent=_,R.prototype.loadFragment.call(this,_,I,C)},function h(R,_,I){return _&&d(R.prototype,_),I&&d(R,I),R}(t,[{"key":"mediaBufferTimeRanges","get":function e(){return this.tracksBuffered[this.currentTrackId]||[]}}]),t}(M.default)},"./src/controller/subtitle-track-controller.ts":function _src_controller_subtitleTrackControllerTs(R,_,I){I.r(_);var C=I("./src/events.ts"),w=I("./src/utils/texttrack-utils.ts"),O=I("./src/controller/base-playlist-controller.ts"),x=I("./src/types/loader.ts");function o(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}function f(R,_){return f=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},f(R,_)}var P=function(R){function t(_){var I;return(I=R.call(this,_,"[subtitle-track-controller]")||this).media=null,I.tracks=[],I.groupId=null,I.tracksInGroup=[],I.trackId=-1,I.selectDefaultTrack=!0,I.queuedDefaultTrack=-1,I.trackChangeListener=function(){return I.onTextTracksChanged()},I.asyncPollTrackChange=function(){return I.pollTrackChange(0)},I.useTextTrackPolling=!1,I.subtitlePollingInterval=-1,I.subtitleDisplay=!0,I.registerListeners(),I}!function u(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,f(R,_)}(t,R);var _=t.prototype;return _.destroy=function t(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,R.prototype.destroy.call(this)},_.registerListeners=function e(){var R=this.hls;R.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.on(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.on(C.Events.ERROR,this.onError,this)},_.unregisterListeners=function e(){var R=this.hls;R.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(C.Events.LEVEL_LOADING,this.onLevelLoading,this),R.off(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.off(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.off(C.Events.ERROR,this.onError,this)},_.onMediaAttached=function e(R,_){this.media=_.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},_.pollTrackChange=function e(R){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,R)},_.onMediaDetaching=function e(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),d(this.media.textTracks).forEach((function(R){Object(w.clearCurrentCues)(R)})),this.subtitleTrack=-1,this.media=null)},_.onManifestLoading=function e(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},_.onManifestParsed=function e(R,_){this.tracks=_.subtitleTracks},_.onSubtitleTrackLoaded=function e(R,_){var I=_.id,C=_.details,w=this.trackId,O=this.tracksInGroup[w];if(O){var x=O.details;O.details=_.details,this.log("subtitle track "+I+" loaded ["+C.startSN+"-"+C.endSN+"]"),I===this.trackId&&(this.retryCount=0,this.playlistLoaded(I,_,x))}else this.warn("Invalid subtitle track id "+I)},_.onLevelLoading=function e(R,_){this.switchLevel(_.level)},_.onLevelSwitching=function e(R,_){this.switchLevel(_.level)},_.switchLevel=function e(R){var _=this.hls.levels[R];if(null!=_&&_.textGroupIds){var I=_.textGroupIds[_.urlId];if(this.groupId!==I){var w=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,O=this.tracks.filter((function(R){return!I||R.groupId===I}));this.tracksInGroup=O;var x=this.findTrackId(null==w?void 0:w.name)||this.findTrackId();this.groupId=I;var P={"subtitleTracks":O};this.log("Updating subtitle tracks, "+O.length+' track(s) found in "'+I+'" group-id'),this.hls.trigger(C.Events.SUBTITLE_TRACKS_UPDATED,P),-1!==x&&this.setSubtitleTrack(x,w)}}},_.findTrackId=function e(R){for(var _=this.tracksInGroup,I=0;I<_.length;I++){var C=_[I];if((!this.selectDefaultTrack||C.default)&&(!R||R===C.name))return C.id}return-1},_.onError=function t(_,I){R.prototype.onError.call(this,_,I),!I.fatal&&I.context&&I.context.type===x.PlaylistContextType.SUBTITLE_TRACK&&I.context.id===this.trackId&&I.context.groupId===this.groupId&&this.retryLoadingOrFail(I)},_.loadPlaylist=function e(R){var _=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(_)){var I=_.id,w=_.groupId,O=_.url;if(R)try{O=R.addDirectives(O)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Loading subtitle playlist for id "+I),this.hls.trigger(C.Events.SUBTITLE_TRACK_LOADING,{"url":O,"id":I,"groupId":w,"deliveryDirectives":R||null})}},_.toggleTrackModes=function e(R){var _=this,I=this.media,C=this.subtitleDisplay,w=this.trackId;if(I){var O=d(I.textTracks),x=O.filter((function(R){return R.groupId===_.groupId}));if(-1===R)[].slice.call(O).forEach((function(R){R.mode="disabled"}));else{var P=x[w];P&&(P.mode="disabled")}var F=x[R];F&&(F.mode=C?"showing":"hidden")}},_.setSubtitleTrack=function e(R,_){var I,w=this.tracksInGroup;if(this.media){if(this.trackId!==R&&this.toggleTrackModes(R),!(this.trackId===R&&(-1===R||null!==(I=w[R])&&void 0!==I&&I.details)||R<-1||R>=w.length)){this.clearTimer();var O=w[R];if(this.log("Switching to subtitle track "+R),this.trackId=R,O){var x=O.id,P=O.groupId,F=void 0===P?"":P,M=O.name,N=O.type,B=O.url;this.hls.trigger(C.Events.SUBTITLE_TRACK_SWITCH,{"id":x,"groupId":F,"name":M,"type":N,"url":B});var U=this.switchParams(O.url,null==_?void 0:_.details);this.loadPlaylist(U)}else this.hls.trigger(C.Events.SUBTITLE_TRACK_SWITCH,{"id":R})}}else this.queuedDefaultTrack=R},_.onTextTracksChanged=function e(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var R=-1,_=d(this.media.textTracks),I=0;I<_.length;I++)if("hidden"===_[I].mode)R=I;else if("showing"===_[I].mode){R=I;break}this.subtitleTrack!==R&&(this.subtitleTrack=R)}},function l(R,_,I){return _&&o(R.prototype,_),I&&o(R,I),R}(t,[{"key":"subtitleTracks","get":function e(){return this.tracksInGroup}},{"key":"subtitleTrack","get":function e(){return this.trackId},"set":function e(R){this.selectDefaultTrack=!1;var _=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(R,_)}}]),t}(O.default);function d(R){for(var _=[],I=0;I<R.length;I++){var C=R[I];"subtitles"===C.kind&&C.label&&_.push(R[I])}return _}_.default=P},"./src/controller/timeline-controller.ts":function _src_controller_timelineControllerTs(R,_,I){I.r(_),I.d(_,"TimelineController",(function(){return U}));var C=I("./src/polyfills/number.ts"),w=I("./src/events.ts"),O=I("./src/utils/cea-608-parser.ts"),x=I("./src/utils/output-filter.ts"),P=I("./src/utils/webvtt-parser.ts"),F=I("./src/utils/texttrack-utils.ts"),M=I("./src/utils/imsc1-ttml-parser.ts"),N=I("./src/types/loader.ts"),B=I("./src/utils/logger.ts"),U=function(){function e(R){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={"ccOffset":0,"presentationOffset":0,"0":{"start":0,"prevCC":-1,"new":!1}},this.captionsProperties=void 0,this.hls=R,this.config=R.config,this.Cues=R.config.cueHandler,this.captionsProperties={"textTrack1":{"label":this.config.captionsTextTrack1Label,"languageCode":this.config.captionsTextTrack1LanguageCode},"textTrack2":{"label":this.config.captionsTextTrack2Label,"languageCode":this.config.captionsTextTrack2LanguageCode},"textTrack3":{"label":this.config.captionsTextTrack3Label,"languageCode":this.config.captionsTextTrack3LanguageCode},"textTrack4":{"label":this.config.captionsTextTrack4Label,"languageCode":this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var _=new x.default(this,"textTrack1"),I=new x.default(this,"textTrack2"),C=new x.default(this,"textTrack3"),P=new x.default(this,"textTrack4");this.cea608Parser1=new O.default(1,_,I),this.cea608Parser2=new O.default(3,C,P)}R.on(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(w.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.on(w.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.on(w.Events.FRAG_LOADING,this.onFragLoading,this),R.on(w.Events.FRAG_LOADED,this.onFragLoaded,this),R.on(w.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),R.on(w.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),R.on(w.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.on(w.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),R.on(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var R=e.prototype;return R.destroy=function e(){var R=this.hls;R.off(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(w.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.off(w.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.off(w.Events.FRAG_LOADING,this.onFragLoading,this),R.off(w.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(w.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),R.off(w.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),R.off(w.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.off(w.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),R.off(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},R.addCues=function e(R,_,I,C,O){for(var x=!1,P=O.length;P--;){var F=O[P],M=v(F[0],F[1],_,I);if(M>=0&&(F[0]=Math.min(F[0],_),F[1]=Math.max(F[1],I),x=!0,M/(I-_)>.5))return}if(x||O.push([_,I]),this.config.renderTextTracksNatively){var N=this.captionsTracks[R];this.Cues.newCue(N,_,I,C)}else{var B=this.Cues.newCue(null,_,I,C);this.hls.trigger(w.Events.CUES_PARSED,{"type":"captions","cues":B,"track":R})}},R.onInitPtsFound=function e(R,_){var I=this,C=_.frag,O=_.id,x=_.initPTS,P=_.timescale,F=this.unparsedVttFrags;"main"===O&&(this.initPTS[C.cc]=x,this.timescale[C.cc]=P),F.length&&(this.unparsedVttFrags=[],F.forEach((function(R){I.onFragLoaded(w.Events.FRAG_LOADED,R)})))},R.getExistingTrack=function e(R){var _=this.media;if(_)for(var I=0;I<_.textTracks.length;I++){var C=_.textTracks[I];if(C[R])return C}return null},R.createCaptionsTrack=function e(R){this.config.renderTextTracksNatively?this.createNativeTrack(R):this.createNonNativeTrack(R)},R.createNativeTrack=function e(R){if(!this.captionsTracks[R]){var _=this.captionsProperties,I=this.captionsTracks,C=this.media,w=_[R],O=w.label,x=w.languageCode,P=this.getExistingTrack(R);if(P)I[R]=P,Object(F.clearCurrentCues)(I[R]),Object(F.sendAddTrackEvent)(I[R],C);else{var M=this.createTextTrack("captions",O,x);M&&(M[R]=!0,I[R]=M)}}},R.createNonNativeTrack=function e(R){if(!this.nonNativeCaptionsTracks[R]){var _=this.captionsProperties[R];if(_){var I={"_id":R,"label":_.label,"kind":"captions","default":!!_.media&&!!_.media.default,"closedCaptions":_.media};this.nonNativeCaptionsTracks[R]=I,this.hls.trigger(w.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{"tracks":[I]})}}},R.createTextTrack=function e(R,_,I){var C=this.media;if(C)return C.addTextTrack(R,_,I)},R.onMediaAttaching=function e(R,_){this.media=_.media,this._cleanTracks()},R.onMediaDetaching=function e(){var R=this.captionsTracks;Object.keys(R).forEach((function(_){Object(F.clearCurrentCues)(R[_]),delete R[_]})),this.nonNativeCaptionsTracks={}},R.onManifestLoading=function e(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={"ccOffset":0,"presentationOffset":0,"0":{"start":0,"prevCC":-1,"new":!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},R._cleanTracks=function e(){var R=this.media;if(R){var _=R.textTracks;if(_)for(var I=0;I<_.length;I++)Object(F.clearCurrentCues)(_[I])}},R.onSubtitleTracksUpdated=function e(R,_){var I=this;this.textTracks=[];var C=_.subtitleTracks||[],O=C.some((function(R){return R.textCodec===M.IMSC1_CODEC}));if(this.config.enableWebVTT||O&&this.config.enableIMSC1){var x=this.tracks&&C&&this.tracks.length===C.length;if(this.tracks=C||[],this.config.renderTextTracksNatively){var P=this.media?this.media.textTracks:[];this.tracks.forEach((function(R,_){var C;if(_<P.length){for(var w=null,O=0;O<P.length;O++)if(h(P[O],R)){w=P[O];break}w&&(C=w)}C?Object(F.clearCurrentCues)(C):(C=I.createTextTrack("subtitles",R.name,R.lang))&&(C.mode="disabled"),C&&(C.groupId=R.groupId,I.textTracks.push(C))}))}else if(!x&&this.tracks&&this.tracks.length){var N=this.tracks.map((function(R){return{"label":R.name,"kind":R.type.toLowerCase(),"default":R.default,"subtitleTrack":R}}));this.hls.trigger(w.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{"tracks":N})}}},R.onManifestLoaded=function e(R,_){var I=this;this.config.enableCEA708Captions&&_.captions&&_.captions.forEach((function(R){var _=/(?:CC|SERVICE)([1-4])/.exec(R.instreamId);if(_){var C="textTrack"+_[1],w=I.captionsProperties[C];w&&(w.label=R.name,R.lang&&(w.languageCode=R.lang),w.media=R)}}))},R.onFragLoading=function e(R,_){var I=this.cea608Parser1,C=this.cea608Parser2,w=this.lastSn,O=this.lastPartIndex;if(this.enabled&&I&&C&&_.frag.type===N.PlaylistLevelType.MAIN){var x,P,F=_.frag.sn,M=null!=(x=null==_||null===(P=_.part)||void 0===P?void 0:P.index)?x:-1;F===w+1||F===w&&M===O+1||(I.reset(),C.reset()),this.lastSn=F,this.lastPartIndex=M}},R.onFragLoaded=function e(R,_){var I=_.frag,O=_.payload,x=this.initPTS,P=this.unparsedVttFrags;if(I.type===N.PlaylistLevelType.SUBTITLE)if(O.byteLength){if(!Object(C.isFiniteNumber)(x[I.cc]))return P.push(_),void(x.length&&this.hls.trigger(w.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":I,"error":new Error("Missing initial subtitle PTS")}));var F=I.decryptdata,B="stats"in _;if(null==F||null==F.key||"AES-128"!==F.method||B){var U=this.tracks[I.level],G=this.vttCCs;G[I.cc]||(G[I.cc]={"start":I.start,"prevCC":this.prevCC,"new":!0},this.prevCC=I.cc),U&&U.textCodec===M.IMSC1_CODEC?this._parseIMSC1(I,O):this._parseVTTs(I,O,G)}}else this.hls.trigger(w.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":I,"error":new Error("Empty subtitle payload")})},R._parseIMSC1=function e(R,_){var I=this,C=this.hls;Object(M.parseIMSC1)(_,this.initPTS[R.cc],this.timescale[R.cc],(function(_){I._appendCues(_,R.level),C.trigger(w.Events.SUBTITLE_FRAG_PROCESSED,{"success":!0,"frag":R})}),(function(_){B.logger.log("Failed to parse IMSC1: "+_),C.trigger(w.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":R,"error":_})}))},R._parseVTTs=function e(R,_,I){var C=this,O=this.hls;Object(P.parseWebVTT)(_,this.initPTS[R.cc],this.timescale[R.cc],I,R.cc,R.start,(function(_){C._appendCues(_,R.level),O.trigger(w.Events.SUBTITLE_FRAG_PROCESSED,{"success":!0,"frag":R})}),(function(I){C._fallbackToIMSC1(R,_),B.logger.log("Failed to parse VTT cue: "+I),O.trigger(w.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":R,"error":I})}))},R._fallbackToIMSC1=function e(R,_){var I=this,C=this.tracks[R.level];C.textCodec||Object(M.parseIMSC1)(_,this.initPTS[R.cc],this.timescale[R.cc],(function(){C.textCodec=M.IMSC1_CODEC,I._parseIMSC1(R,_)}),(function(){C.textCodec="wvtt"}))},R._appendCues=function e(R,_){var I=this.hls;if(this.config.renderTextTracksNatively){var C=this.textTracks[_];if("disabled"===C.mode)return;R.forEach((function(R){return Object(F.addCueToTrack)(C,R)}))}else{var O=this.tracks[_].default?"default":"subtitles"+_;I.trigger(w.Events.CUES_PARSED,{"type":"subtitles","cues":R,"track":O})}},R.onFragDecrypted=function e(R,_){var I=_.frag;if(I.type===N.PlaylistLevelType.SUBTITLE){if(!Object(C.isFiniteNumber)(this.initPTS[I.cc]))return void this.unparsedVttFrags.push(_);this.onFragLoaded(w.Events.FRAG_LOADED,_)}},R.onSubtitleTracksCleared=function e(){this.tracks=[],this.captionsTracks={}},R.onFragParsingUserdata=function e(R,_){var I=this.cea608Parser1,C=this.cea608Parser2;if(this.enabled&&I&&C)for(var w=0;w<_.samples.length;w++){var O=_.samples[w].bytes;if(O){var x=this.extractCea608Data(O);I.addData(_.samples[w].pts,x[0]),C.addData(_.samples[w].pts,x[1])}}},R.onBufferFlushing=function e(R,_){var I=_.startOffset,C=_.endOffset,w=_.endOffsetSubtitles,O=_.type,x=this.media;if(x&&!(x.currentTime<C)){if(!O||"video"===O){var P=this.captionsTracks;Object.keys(P).forEach((function(R){return Object(F.removeCuesInRange)(P[R],I,C)}))}if(this.config.renderTextTracksNatively&&0===I&&void 0!==w){var M=this.textTracks;Object.keys(M).forEach((function(R){return Object(F.removeCuesInRange)(M[R],I,w)}))}}},R.extractCea608Data=function e(R){for(var _=31&R[0],I=2,C=[[],[]],w=0;w<_;w++){var O=R[I++],x=127&R[I++],P=127&R[I++],F=3&O;0===x&&0===P||!!(4&O)&&(0!==F&&1!==F||(C[F].push(x),C[F].push(P)))}return C},e}();function h(R,_){return R&&R.label===_.name&&!(R.textTrack1||R.textTrack2)}function v(R,_,I,C){return Math.min(_,C)-Math.max(R,I)}},"./src/crypt/aes-crypto.ts":function _src_crypt_aesCryptoTs(R,_,I){I.r(_),I.d(_,"default",(function(){return C}));var C=function(){function e(R,_){this.subtle=void 0,this.aesIV=void 0,this.subtle=R,this.aesIV=_}return e.prototype.decrypt=function e(R,_){return this.subtle.decrypt({"name":"AES-CBC","iv":this.aesIV},_,R)},e}()},"./src/crypt/aes-decryptor.ts":function _src_crypt_aesDecryptorTs(R,_,I){I.r(_),I.d(_,"removePadding",(function(){return a})),I.d(_,"default",(function(){return w}));var C=I("./src/utils/typed-array.ts");function a(R){var _=R.byteLength,I=_&&new DataView(R.buffer).getUint8(_-1);return I?Object(C.sliceUint8)(R,0,_-I):R}var w=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=e.prototype;return R.uint8ArrayToUint32Array_=function e(R){for(var _=new DataView(R),I=new Uint32Array(4),C=0;C<4;C++)I[C]=_.getUint32(4*C);return I},R.initTable=function e(){var R=this.sBox,_=this.invSBox,I=this.subMix,C=I[0],w=I[1],O=I[2],x=I[3],P=this.invSubMix,F=P[0],M=P[1],N=P[2],B=P[3],U=new Uint32Array(256),G=0,j=0,K=0;for(K=0;K<256;K++)U[K]=K<128?K<<1:K<<1^283;for(K=0;K<256;K++){var H=j^j<<1^j<<2^j<<3^j<<4;H=H>>>8^255&H^99,R[G]=H,_[H]=G;var V=U[G],W=U[V],Y=U[W],z=257*U[H]^16843008*H;C[G]=z<<24|z>>>8,w[G]=z<<16|z>>>16,O[G]=z<<8|z>>>24,x[G]=z,z=16843009*Y^65537*W^257*V^16843008*G,F[H]=z<<24|z>>>8,M[H]=z<<16|z>>>16,N[H]=z<<8|z>>>24,B[H]=z,G?(G=V^U[U[U[Y^V]]],j^=U[U[j]]):G=j=1}},R.expandKey=function e(R){for(var _=this.uint8ArrayToUint32Array_(R),I=!0,C=0;C<_.length&&I;)I=_[C]===this.key[C],C++;if(!I){this.key=_;var w=this.keySize=_.length;if(4!==w&&6!==w&&8!==w)throw new Error("Invalid aes key size="+w);var O,x,P,F,M=this.ksRows=4*(w+6+1),N=this.keySchedule=new Uint32Array(M),B=this.invKeySchedule=new Uint32Array(M),U=this.sBox,G=this.rcon,j=this.invSubMix,K=j[0],H=j[1],V=j[2],W=j[3];for(O=0;O<M;O++)O<w?P=N[O]=_[O]:(F=P,O%w===0?(F=U[(F=F<<8|F>>>24)>>>24]<<24|U[F>>>16&255]<<16|U[F>>>8&255]<<8|U[255&F],F^=G[O/w|0]<<24):w>6&&O%w===4&&(F=U[F>>>24]<<24|U[F>>>16&255]<<16|U[F>>>8&255]<<8|U[255&F]),N[O]=P=(N[O-w]^F)>>>0);for(x=0;x<M;x++)O=M-x,F=3&x?N[O]:N[O-4],B[x]=x<4||O<=4?F:K[U[F>>>24]]^H[U[F>>>16&255]]^V[U[F>>>8&255]]^W[U[255&F]],B[x]=B[x]>>>0}},R.networkToHostOrderSwap=function e(R){return R<<24|(65280&R)<<8|(16711680&R)>>8|R>>>24},R.decrypt=function e(R,_,I){for(var C,w,O,x,P,F,M,N,B,U,G,j,K,H,V=this.keySize+6,W=this.invKeySchedule,Y=this.invSBox,z=this.invSubMix,X=z[0],q=z[1],Z=z[2],Q=z[3],J=this.uint8ArrayToUint32Array_(I),$=J[0],ee=J[1],te=J[2],re=J[3],ie=new Int32Array(R),ne=new Int32Array(ie.length),se=this.networkToHostOrderSwap;_<ie.length;){for(B=se(ie[_]),U=se(ie[_+1]),G=se(ie[_+2]),j=se(ie[_+3]),P=B^W[0],F=j^W[1],M=G^W[2],N=U^W[3],K=4,H=1;H<V;H++)C=X[P>>>24]^q[F>>16&255]^Z[M>>8&255]^Q[255&N]^W[K],w=X[F>>>24]^q[M>>16&255]^Z[N>>8&255]^Q[255&P]^W[K+1],O=X[M>>>24]^q[N>>16&255]^Z[P>>8&255]^Q[255&F]^W[K+2],x=X[N>>>24]^q[P>>16&255]^Z[F>>8&255]^Q[255&M]^W[K+3],P=C,F=w,M=O,N=x,K+=4;C=Y[P>>>24]<<24^Y[F>>16&255]<<16^Y[M>>8&255]<<8^Y[255&N]^W[K],w=Y[F>>>24]<<24^Y[M>>16&255]<<16^Y[N>>8&255]<<8^Y[255&P]^W[K+1],O=Y[M>>>24]<<24^Y[N>>16&255]<<16^Y[P>>8&255]<<8^Y[255&F]^W[K+2],x=Y[N>>>24]<<24^Y[P>>16&255]<<16^Y[F>>8&255]<<8^Y[255&M]^W[K+3],ne[_]=se(C^$),ne[_+1]=se(x^ee),ne[_+2]=se(O^te),ne[_+3]=se(w^re),$=B,ee=U,te=G,re=j,_+=4}return ne.buffer},e}()},"./src/crypt/decrypter.ts":function _src_crypt_decrypterTs(R,_,I){I.r(_),I.d(_,"default",(function(){return M}));var C=I("./src/crypt/aes-crypto.ts"),w=I("./src/crypt/fast-aes-key.ts"),O=I("./src/crypt/aes-decryptor.ts"),x=I("./src/utils/logger.ts"),P=I("./src/utils/mp4-tools.ts"),F=I("./src/utils/typed-array.ts"),M=function(){function e(R,_,I){var C=(void 0===I?{}:I).removePKCS7Padding,w=void 0===C||C;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=R,this.config=_,this.removePKCS7Padding=w,w)try{var O=self.crypto;O&&(this.subtle=O.subtle||O.webkitSubtle)}catch(R){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var R=e.prototype;return R.destroy=function e(){this.observer=null},R.isSync=function e(){return this.config.enableSoftwareAES},R.flush=function e(){var R=this.currentResult;if(R){var _=new Uint8Array(R);return this.reset(),this.removePKCS7Padding?Object(O.removePadding)(_):_}this.reset()},R.reset=function e(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},R.decrypt=function e(R,_,I,C){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(R),_,I);var w=this.flush();w&&C(w.buffer)}else this.webCryptoDecrypt(new Uint8Array(R),_,I).then(C)},R.softwareDecrypt=function e(R,_,I){var C=this.currentIV,w=this.currentResult,x=this.remainderData;this.logOnce("JS AES decrypt"),x&&(R=Object(P.appendUint8Array)(x,R),this.remainderData=null);var M=this.getValidChunk(R);if(!M.length)return null;C&&(I=C);var N=this.softwareDecrypter;N||(N=this.softwareDecrypter=new O.default),N.expandKey(_);var B=w;return this.currentResult=N.decrypt(M.buffer,0,I),this.currentIV=Object(F.sliceUint8)(M,-16).buffer,B||null},R.webCryptoDecrypt=function e(R,_,I){var O=this,x=this.subtle;return this.key===_&&this.fastAesKey||(this.key=_,this.fastAesKey=new w.default(x,_)),this.fastAesKey.expandKey().then((function(_){return x?new C.default(x,I).decrypt(R.buffer,_):Promise.reject(new Error("web crypto not initialized"))})).catch((function(C){return O.onWebCryptoError(C,R,_,I)}))},R.onWebCryptoError=function e(R,_,I,C){return x.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",R),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(_,I,C)},R.getValidChunk=function e(R){var _=R,I=R.length-R.length%16;return I!==R.length&&(_=Object(F.sliceUint8)(R,0,I),this.remainderData=Object(F.sliceUint8)(R,I)),_},R.logOnce=function e(R){this.logEnabled&&(x.logger.log("[decrypter.ts]: "+R),this.logEnabled=!1)},e}()},"./src/crypt/fast-aes-key.ts":function _src_crypt_fastAesKeyTs(R,_,I){I.r(_),I.d(_,"default",(function(){return C}));var C=function(){function e(R,_){this.subtle=void 0,this.key=void 0,this.subtle=R,this.key=_}return e.prototype.expandKey=function e(){return this.subtle.importKey("raw",this.key,{"name":"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":function _src_demux_aacdemuxerTs(R,_,I){I.r(_);var C=I("./src/demux/base-audio-demuxer.ts"),w=I("./src/demux/adts.ts"),O=I("./src/utils/logger.ts"),x=I("./src/demux/id3.ts");function l(R,_){return l=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},l(R,_)}var P=function(R){function t(_,I){var C;return(C=R.call(this)||this).observer=void 0,C.config=void 0,C.observer=_,C.config=I,C}!function o(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,l(R,_)}(t,R);var _=t.prototype;return _.resetInitSegment=function t(_,I,C){R.prototype.resetInitSegment.call(this,_,I,C),this._audioTrack={"container":"audio/adts","type":"audio","id":2,"pid":-1,"sequenceNumber":0,"isAAC":!0,"samples":[],"manifestCodec":_,"duration":C,"inputTimeScale":9e4,"dropped":0}},t.probe=function e(R){if(!R)return!1;for(var _=(x.getID3Data(R,0)||[]).length,I=R.length;_<I;_++)if(w.probe(R,_))return O.logger.log("ADTS sync word found !"),!0;return!1},_.canParse=function e(R,_){return w.canParse(R,_)},_.appendFrame=function e(R,_,I){w.initTrackConfig(R,this.observer,_,I,R.manifestCodec);var C=w.appendFrame(R,_,I,this.initPTS,this.frameIndex);if(C&&0===C.missing)return C},t}(C.default);P.minProbeByteLength=9,_.default=P},"./src/demux/adts.ts":function _src_demux_adtsTs(R,_,I){I.r(_),I.d(_,"getAudioConfig",(function(){return s})),I.d(_,"isHeaderPattern",(function(){return o})),I.d(_,"getHeaderLength",(function(){return l})),I.d(_,"getFullFrameLength",(function(){return u})),I.d(_,"canGetFrameLength",(function(){return f})),I.d(_,"isHeader",(function(){return c})),I.d(_,"canParse",(function(){return d})),I.d(_,"probe",(function(){return h})),I.d(_,"initTrackConfig",(function(){return v})),I.d(_,"getFrameDuration",(function(){return g})),I.d(_,"parseFrameHeader",(function(){return p})),I.d(_,"appendFrame",(function(){return m}));var C=I("./src/utils/logger.ts"),w=I("./src/errors.ts"),O=I("./src/events.ts");function s(R,_,I,x){var P,F,M,N,B=navigator.userAgent.toLowerCase(),U=x,G=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];P=((192&_[I+2])>>>6)+1;var j=(60&_[I+2])>>>2;if(!(j>G.length-1))return M=(1&_[I+2])<<2,M|=(192&_[I+3])>>>6,C.logger.log("manifest codec:"+x+", ADTS type:"+P+", samplingIndex:"+j),/firefox/i.test(B)?j>=6?(P=5,N=new Array(4),F=j-3):(P=2,N=new Array(2),F=j):-1!==B.indexOf("android")?(P=2,N=new Array(2),F=j):(P=5,N=new Array(4),x&&(-1!==x.indexOf("mp4a.40.29")||-1!==x.indexOf("mp4a.40.5"))||!x&&j>=6?F=j-3:((x&&-1!==x.indexOf("mp4a.40.2")&&(j>=6&&1===M||/vivaldi/i.test(B))||!x&&1===M)&&(P=2,N=new Array(2)),F=j)),N[0]=P<<3,N[0]|=(14&j)>>1,N[1]|=(1&j)<<7,N[1]|=M<<3,5===P&&(N[1]|=(14&F)>>1,N[2]=(1&F)<<7,N[2]|=8,N[3]=0),{"config":N,"samplerate":G[j],"channelCount":M,"codec":"mp4a.40."+P,"manifestCodec":U};R.trigger(O.Events.ERROR,{"type":w.ErrorTypes.MEDIA_ERROR,"details":w.ErrorDetails.FRAG_PARSING_ERROR,"fatal":!0,"reason":"invalid ADTS sampling index:"+j})}function o(R,_){return 255===R[_]&&240==(246&R[_+1])}function l(R,_){return 1&R[_+1]?7:9}function u(R,_){return(3&R[_+3])<<11|R[_+4]<<3|(224&R[_+5])>>>5}function f(R,_){return _+5<R.length}function c(R,_){return _+1<R.length&&o(R,_)}function d(R,_){return f(R,_)&&o(R,_)&&u(R,_)<=R.length-_}function h(R,_){if(c(R,_)){var I=l(R,_);if(_+I>=R.length)return!1;var C=u(R,_);if(C<=I)return!1;var w=_+C;return w===R.length||c(R,w)}return!1}function v(R,_,I,w,O){if(!R.samplerate){var x=s(_,I,w,O);if(!x)return;R.config=x.config,R.samplerate=x.samplerate,R.channelCount=x.channelCount,R.codec=x.codec,R.manifestCodec=x.manifestCodec,C.logger.log("parsed codec:"+R.codec+", rate:"+x.samplerate+", channels:"+x.channelCount)}}function g(R){return 9216e4/R}function p(R,_,I,C,w){var O=l(R,_),x=u(R,_);if((x-=O)>0)return{"headerLength":O,"frameLength":x,"stamp":I+C*w}}function m(R,_,I,C,w){var O=p(_,I,C,w,g(R.samplerate));if(O){var x,P=O.frameLength,F=O.headerLength,M=O.stamp,N=F+P,B=Math.max(0,I+N-_.length);B?(x=new Uint8Array(N-F)).set(_.subarray(I+F,_.length),0):x=_.subarray(I+F,I+N);var U={"unit":x,"pts":M};return B||R.samples.push(U),{"sample":U,"length":N,"missing":B}}}},"./src/demux/base-audio-demuxer.ts":function _src_demux_baseAudioDemuxerTs(R,_,I){I.r(_),I.d(_,"initPTSFn",(function(){return M}));var C=I("./src/polyfills/number.ts"),w=I("./src/demux/id3.ts"),O=I("./src/demux/dummy-demuxed-track.ts"),x=I("./src/utils/mp4-tools.ts"),P=I("./src/utils/typed-array.ts"),F=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var R=e.prototype;return R.resetInitSegment=function e(R,_,I){this._id3Track={"type":"id3","id":3,"pid":-1,"inputTimeScale":9e4,"sequenceNumber":0,"samples":[],"dropped":0}},R.resetTimeStamp=function e(){},R.resetContiguity=function e(){},R.canParse=function e(R,_){return!1},R.appendFrame=function e(R,_,I){},R.demux=function e(R,_){this.cachedData&&(R=Object(x.appendUint8Array)(this.cachedData,R),this.cachedData=null);var I,C,F=w.getID3Data(R,0),N=F?F.length:0,B=this._audioTrack,U=this._id3Track,G=F?w.getTimeStamp(F):void 0,j=R.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=M(G,_)),F&&F.length>0&&U.samples.push({"pts":this.initPTS,"dts":this.initPTS,"data":F}),C=this.initPTS;N<j;){if(this.canParse(R,N)){var K=this.appendFrame(B,R,N);K?(this.frameIndex++,C=K.sample.pts,I=N+=K.length):N=j}else w.canParse(R,N)?(F=w.getID3Data(R,N),U.samples.push({"pts":C,"dts":C,"data":F}),I=N+=F.length):N++;if(N===j&&I!==j){var H=Object(P.sliceUint8)(R,I);this.cachedData?this.cachedData=Object(x.appendUint8Array)(this.cachedData,H):this.cachedData=H}}return{"audioTrack":B,"avcTrack":Object(O.dummyTrack)(),"id3Track":U,"textTrack":Object(O.dummyTrack)()}},R.demuxSampleAes=function e(R,_,I){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},R.flush=function e(R){var _=this.cachedData;return _&&(this.cachedData=null,this.demux(_,0)),this.frameIndex=0,{"audioTrack":this._audioTrack,"avcTrack":Object(O.dummyTrack)(),"id3Track":this._id3Track,"textTrack":Object(O.dummyTrack)()}},R.destroy=function e(){},e}(),M=function e(R,_){return Object(C.isFiniteNumber)(R)?90*R:9e4*_};_.default=F},"./src/demux/chunk-cache.ts":function _src_demux_chunkCacheTs(R,_,I){I.r(_),I.d(_,"default",(function(){return C}));var C=function(){function e(){this.chunks=[],this.dataLength=0}var R=e.prototype;return R.push=function e(R){this.chunks.push(R),this.dataLength+=R.length},R.flush=function e(){var R,_=this.chunks,I=this.dataLength;return _.length?(R=1===_.length?_[0]:function a(R,_){for(var I=new Uint8Array(_),C=0,w=0;w<R.length;w++){var O=R[w];I.set(O,C),C+=O.length}return I}(_,I),this.reset(),R):new Uint8Array(0)},R.reset=function e(){this.chunks.length=0,this.dataLength=0},e}()},"./src/demux/dummy-demuxed-track.ts":function _src_demux_dummyDemuxedTrackTs(R,_,I){function i(){return{"type":"","id":-1,"pid":-1,"inputTimeScale":9e4,"sequenceNumber":-1,"samples":[],"dropped":0}}I.r(_),I.d(_,"dummyTrack",(function(){return i}))},"./src/demux/exp-golomb.ts":function _src_demux_expGolombTs(R,_,I){I.r(_);var C=I("./src/utils/logger.ts"),w=function(){function e(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var R=e.prototype;return R.loadWord=function e(){var R=this.data,_=this.bytesAvailable,I=R.byteLength-_,C=new Uint8Array(4),w=Math.min(4,_);if(0===w)throw new Error("no bytes available");C.set(R.subarray(I,I+w)),this.word=new DataView(C.buffer).getUint32(0),this.bitsAvailable=8*w,this.bytesAvailable-=w},R.skipBits=function e(R){var _;this.bitsAvailable>R?(this.word<<=R,this.bitsAvailable-=R):(R-=this.bitsAvailable,R-=(_=R>>3)>>3,this.bytesAvailable-=_,this.loadWord(),this.word<<=R,this.bitsAvailable-=R)},R.readBits=function e(R){var _=Math.min(this.bitsAvailable,R),I=this.word>>>32-_;return R>32&&C.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=_,this.bitsAvailable>0?this.word<<=_:this.bytesAvailable>0&&this.loadWord(),(_=R-_)>0&&this.bitsAvailable?I<<_|this.readBits(_):I},R.skipLZ=function e(){var R;for(R=0;R<this.bitsAvailable;++R)if(this.word&2147483648>>>R)return this.word<<=R,this.bitsAvailable-=R,R;return this.loadWord(),R+this.skipLZ()},R.skipUEG=function e(){this.skipBits(1+this.skipLZ())},R.skipEG=function e(){this.skipBits(1+this.skipLZ())},R.readUEG=function e(){var R=this.skipLZ();return this.readBits(R+1)-1},R.readEG=function e(){var R=this.readUEG();return 1&R?1+R>>>1:-1*(R>>>1)},R.readBoolean=function e(){return 1===this.readBits(1)},R.readUByte=function e(){return this.readBits(8)},R.readUShort=function e(){return this.readBits(16)},R.readUInt=function e(){return this.readBits(32)},R.skipScalingList=function e(R){for(var _=8,I=8,C=0;C<R;C++)0!==I&&(I=(_+this.readEG()+256)%256),_=0===I?_:I},R.readSPS=function e(){var R,_,I,C=0,w=0,O=0,x=0,P=this.readUByte.bind(this),F=this.readBits.bind(this),M=this.readUEG.bind(this),N=this.readBoolean.bind(this),B=this.skipBits.bind(this),U=this.skipEG.bind(this),G=this.skipUEG.bind(this),j=this.skipScalingList.bind(this);P();var K=P();if(F(5),B(3),P(),G(),100===K||110===K||122===K||244===K||44===K||83===K||86===K||118===K||128===K){var H=M();if(3===H&&B(1),G(),G(),B(1),N())for(_=3!==H?8:12,I=0;I<_;I++)N()&&j(I<6?16:64)}G();var V=M();if(0===V)M();else if(1===V)for(B(1),U(),U(),R=M(),I=0;I<R;I++)U();G(),B(1);var W=M(),Y=M(),z=F(1);0===z&&B(1),B(1),N()&&(C=M(),w=M(),O=M(),x=M());var X=[1,1];if(N()&&N())switch(P()){case 1:X=[1,1];break;case 2:X=[12,11];break;case 3:X=[10,11];break;case 4:X=[16,11];break;case 5:X=[40,33];break;case 6:X=[24,11];break;case 7:X=[20,11];break;case 8:X=[32,11];break;case 9:X=[80,33];break;case 10:X=[18,11];break;case 11:X=[15,11];break;case 12:X=[64,33];break;case 13:X=[160,99];break;case 14:X=[4,3];break;case 15:X=[3,2];break;case 16:X=[2,1];break;case 255:X=[P()<<8|P(),P()<<8|P()]}return{"width":Math.ceil(16*(W+1)-2*C-2*w),"height":(2-z)*(Y+1)*16-(z?2:4)*(O+x),"pixelRatio":X}},R.readSliceType=function e(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();_.default=w},"./src/demux/id3.ts":function _src_demux_id3Ts(R,_,I){I.r(_),I.d(_,"isHeader",(function(){return w})),I.d(_,"isFooter",(function(){return O})),I.d(_,"getID3Data",(function(){return x})),I.d(_,"canParse",(function(){return F})),I.d(_,"getTimeStamp",(function(){return M})),I.d(_,"isTimeStampFrame",(function(){return N})),I.d(_,"getID3Frames",(function(){return U})),I.d(_,"decodeFrame",(function(){return G})),I.d(_,"utf8ArrayToStr",(function(){return W})),I.d(_,"testables",(function(){return Y}));var C,w=function e(R,_){return _+10<=R.length&&73===R[_]&&68===R[_+1]&&51===R[_+2]&&R[_+3]<255&&R[_+4]<255&&R[_+6]<128&&R[_+7]<128&&R[_+8]<128&&R[_+9]<128},O=function e(R,_){return _+10<=R.length&&51===R[_]&&68===R[_+1]&&73===R[_+2]&&R[_+3]<255&&R[_+4]<255&&R[_+6]<128&&R[_+7]<128&&R[_+8]<128&&R[_+9]<128},x=function e(R,_){for(var I=_,C=0;w(R,_);){C+=10,C+=P(R,_+6),O(R,_+10)&&(C+=10),_+=C}if(C>0)return R.subarray(I,I+C)},P=function e(R,_){var I=0;return I=(127&R[_])<<21,I|=(127&R[_+1])<<14,I|=(127&R[_+2])<<7,I|=127&R[_+3]},F=function e(R,_){return w(R,_)&&P(R,_+6)+10<=R.length-_},M=function e(R){for(var _=U(R),I=0;I<_.length;I++){var C=_[I];if(N(C))return V(C)}},N=function e(R){return R&&"PRIV"===R.key&&"com.apple.streaming.transportStreamTimestamp"===R.info},B=function e(R){var _=String.fromCharCode(R[0],R[1],R[2],R[3]),I=P(R,4);return{"type":_,"size":I,"data":R.subarray(10,10+I)}},U=function e(R){for(var _=0,I=[];w(R,_);){for(var C=P(R,_+6),x=(_+=10)+C;_+8<x;){var F=B(R.subarray(_)),M=G(F);M&&I.push(M),_+=F.size+10}O(R,_)&&(_+=10)}return I},G=function e(R){return"PRIV"===R.type?j(R):"W"===R.type[0]?H(R):K(R)},j=function e(R){if(!(R.size<2)){var _=W(R.data,!0),I=new Uint8Array(R.data.subarray(_.length+1));return{"key":R.type,"info":_,"data":I.buffer}}},K=function e(R){if(!(R.size<2)){if("TXXX"===R.type){var _=1,I=W(R.data.subarray(_),!0);_+=I.length+1;var C=W(R.data.subarray(_));return{"key":R.type,"info":I,"data":C}}var w=W(R.data.subarray(1));return{"key":R.type,"data":w}}},H=function e(R){if("WXXX"===R.type){if(R.size<2)return;var _=1,I=W(R.data.subarray(_),!0);_+=I.length+1;var C=W(R.data.subarray(_));return{"key":R.type,"info":I,"data":C}}var w=W(R.data);return{"key":R.type,"data":w}},V=function e(R){if(8===R.data.byteLength){var _=new Uint8Array(R.data),I=1&_[3],C=(_[4]<<23)+(_[5]<<15)+(_[6]<<7)+_[7];return C/=45,I&&(C+=47721858.84),Math.round(C)}},W=function e(R,_){void 0===_&&(_=!1);var I=function T(){C||void 0===self.TextDecoder||(C=new self.TextDecoder("utf-8"));return C}();if(I){var w=I.decode(R);if(_){var O=w.indexOf("\0");return-1!==O?w.substring(0,O):w}return w.replace(/\0/g,"")}for(var x,P,F,M=R.length,N="",B=0;B<M;){if(0===(x=R[B++])&&_)return N;if(0!==x&&3!==x)switch(x>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:N+=String.fromCharCode(x);break;case 12:case 13:P=R[B++],N+=String.fromCharCode((31&x)<<6|63&P);break;case 14:P=R[B++],F=R[B++],N+=String.fromCharCode((15&x)<<12|(63&P)<<6|63&F)}}return N},Y={"decodeTextFrame":K}},"./src/demux/mp3demuxer.ts":function _src_demux_mp3demuxerTs(R,_,I){I.r(_);var C=I("./src/demux/base-audio-demuxer.ts"),w=I("./src/demux/id3.ts"),O=I("./src/utils/logger.ts"),x=I("./src/demux/mpegaudio.ts");function l(R,_){return l=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},l(R,_)}var P=function(R){function t(){return R.apply(this,arguments)||this}!function o(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,l(R,_)}(t,R);var _=t.prototype;return _.resetInitSegment=function t(_,I,C){R.prototype.resetInitSegment.call(this,_,I,C),this._audioTrack={"container":"audio/mpeg","type":"audio","id":2,"pid":-1,"sequenceNumber":0,"isAAC":!1,"samples":[],"manifestCodec":_,"duration":C,"inputTimeScale":9e4,"dropped":0}},t.probe=function e(R){if(!R)return!1;for(var _=(w.getID3Data(R,0)||[]).length,I=R.length;_<I;_++)if(x.probe(R,_))return O.logger.log("MPEG Audio sync word found !"),!0;return!1},_.canParse=function e(R,_){return x.canParse(R,_)},_.appendFrame=function e(R,_,I){if(null!==this.initPTS)return x.appendFrame(R,_,I,this.initPTS,this.frameIndex)},t}(C.default);P.minProbeByteLength=4,_.default=P},"./src/demux/mp4demuxer.ts":function _src_demux_mp4demuxerTs(R,_,I){I.r(_);var C=I("./src/utils/mp4-tools.ts"),w=I("./src/demux/dummy-demuxed-track.ts"),O=function(){function e(R,_){this.remainderData=null,this.config=void 0,this.config=_}var R=e.prototype;return R.resetTimeStamp=function e(){},R.resetInitSegment=function e(){},R.resetContiguity=function e(){},e.probe=function e(R){return Object(C.findBox)({"data":R,"start":0,"end":Math.min(R.length,16384)},["moof"]).length>0},R.demux=function e(R){var _=R,I=Object(w.dummyTrack)();if(this.config.progressive){this.remainderData&&(_=Object(C.appendUint8Array)(this.remainderData,R));var O=Object(C.segmentValidRange)(_);this.remainderData=O.remainder,I.samples=O.valid||new Uint8Array}else I.samples=_;return{"audioTrack":Object(w.dummyTrack)(),"avcTrack":I,"id3Track":Object(w.dummyTrack)(),"textTrack":Object(w.dummyTrack)()}},R.flush=function e(){var R=Object(w.dummyTrack)();return R.samples=this.remainderData||new Uint8Array,this.remainderData=null,{"audioTrack":Object(w.dummyTrack)(),"avcTrack":R,"id3Track":Object(w.dummyTrack)(),"textTrack":Object(w.dummyTrack)()}},R.demuxSampleAes=function e(R,_,I){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},R.destroy=function e(){},e}();O.minProbeByteLength=1024,_.default=O},"./src/demux/mpegaudio.ts":function _src_demux_mpegaudioTs(R,_,I){I.r(_),I.d(_,"appendFrame",(function(){return l})),I.d(_,"parseHeader",(function(){return u})),I.d(_,"isHeaderPattern",(function(){return f})),I.d(_,"isHeader",(function(){return c})),I.d(_,"canParse",(function(){return d})),I.d(_,"probe",(function(){return h}));var C=null,w=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],O=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],x=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],P=[0,1,1,4];function l(R,_,I,C,w){if(!(I+24>_.length)){var O=u(_,I);if(O&&I+O.frameLength<=_.length){var x=C+w*(9e4*O.samplesPerFrame/O.sampleRate),P={"unit":_.subarray(I,I+O.frameLength),"pts":x,"dts":x};return R.config=[],R.channelCount=O.channelCount,R.samplerate=O.sampleRate,R.samples.push(P),{"sample":P,"length":O.frameLength,"missing":0}}}}function u(R,_){var I=R[_+1]>>3&3,F=R[_+1]>>1&3,M=R[_+2]>>4&15,N=R[_+2]>>2&3;if(1!==I&&0!==M&&15!==M&&3!==N){var B=R[_+2]>>1&1,U=R[_+3]>>6,G=1e3*w[14*(3===I?3-F:3===F?3:4)+M-1],j=O[3*(3===I?0:2===I?1:2)+N],K=3===U?1:2,H=x[I][F],V=P[F],W=8*H*V,Y=Math.floor(H*G/j+B)*V;if(null===C){var z=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);C=z?parseInt(z[1]):0}return!!C&&C<=87&&2===F&&G>=224e3&&0===U&&(R[_+3]=128|R[_+3]),{"sampleRate":j,"channelCount":K,"frameLength":Y,"samplesPerFrame":W}}}function f(R,_){return!(255!==R[_]||224&~R[_+1]||!(6&R[_+1]))}function c(R,_){return _+1<R.length&&f(R,_)}function d(R,_){return f(R,_)&&4<=R.length-_}function h(R,_){if(_+1<R.length&&f(R,_)){var I=u(R,_),C=4;null!=I&&I.frameLength&&(C=I.frameLength);var w=_+C;return w===R.length||c(R,w)}return!1}},"./src/demux/sample-aes.ts":function _src_demux_sampleAesTs(R,_,I){I.r(_);var C=I("./src/crypt/decrypter.ts"),w=I("./src/demux/tsdemuxer.ts"),O=function(){function e(R,_,I){this.keyData=void 0,this.decrypter=void 0,this.keyData=I,this.decrypter=new C.default(R,_,{"removePKCS7Padding":!1})}var R=e.prototype;return R.decryptBuffer=function e(R,_){this.decrypter.decrypt(R,this.keyData.key.buffer,this.keyData.iv.buffer,_)},R.decryptAacSample=function e(R,_,I,C){var w=R[_].unit,O=w.subarray(16,w.length-w.length%16),x=O.buffer.slice(O.byteOffset,O.byteOffset+O.length),P=this;this.decryptBuffer(x,(function(O){var x=new Uint8Array(O);w.set(x,16),C||P.decryptAacSamples(R,_+1,I)}))},R.decryptAacSamples=function e(R,_,I){for(;;_++){if(_>=R.length)return void I();if(!(R[_].unit.length<32)){var C=this.decrypter.isSync();if(this.decryptAacSample(R,_,I,C),!C)return}}},R.getAvcEncryptedData=function e(R){for(var _=16*Math.floor((R.length-48)/160)+16,I=new Int8Array(_),C=0,w=32;w<R.length-16;w+=160,C+=16)I.set(R.subarray(w,w+16),C);return I},R.getAvcDecryptedUnit=function e(R,_){for(var I=new Uint8Array(_),C=0,w=32;w<R.length-16;w+=160,C+=16)R.set(I.subarray(C,C+16),w);return R},R.decryptAvcSample=function e(R,_,I,C,O,x){var P=Object(w.discardEPB)(O.data),F=this.getAvcEncryptedData(P),M=this;this.decryptBuffer(F.buffer,(function(w){O.data=M.getAvcDecryptedUnit(P,w),x||M.decryptAvcSamples(R,_,I+1,C)}))},R.decryptAvcSamples=function e(R,_,I,C){if(R instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;_++,I=0){if(_>=R.length)return void C();for(var w=R[_].units;!(I>=w.length);I++){var O=w[I];if(!(O.data.length<=48||1!==O.type&&5!==O.type)){var x=this.decrypter.isSync();if(this.decryptAvcSample(R,_,I,C,O,x),!x)return}}}},e}();_.default=O},"./src/demux/transmuxer-interface.ts":function _src_demux_transmuxerInterfaceTs(R,_,I){I.r(_),I.d(_,"default",(function(){return B}));var C=I("./node_modules/webworkify-webpack/index.js"),w=I("./src/events.ts"),O=I("./src/demux/transmuxer.ts"),x=I("./src/utils/logger.ts"),P=I("./src/errors.ts"),F=I("./src/utils/mediasource-helper.ts"),M=I("./node_modules/eventemitter3/index.js"),N=Object(F.getMediaSource)()||{"isTypeSupported":function e(){return!1}},B=function(){function e(R,_,I,F){var B=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=R,this.id=_,this.onTransmuxComplete=I,this.onFlush=F;var U=R.config,G=function t(_,I){(I=I||{}).frag=B.frag,I.id=B.id,R.trigger(_,I)};this.observer=new M.EventEmitter,this.observer.on(w.Events.FRAG_DECRYPTED,G),this.observer.on(w.Events.ERROR,G);var j={"mp4":N.isTypeSupported("video/mp4"),"mpeg":N.isTypeSupported("audio/mpeg"),"mp3":N.isTypeSupported('audio/mp4; codecs="mp3"')},K=navigator.vendor;if(U.enableWorker&&"undefined"!=typeof Worker){var H;x.logger.log("demuxing in webworker");try{H=this.worker=C("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),H.addEventListener("message",this.onwmsg),H.onerror=function(_){R.trigger(w.Events.ERROR,{"type":P.ErrorTypes.OTHER_ERROR,"details":P.ErrorDetails.INTERNAL_EXCEPTION,"fatal":!0,"event":"demuxerWorker","error":new Error(_.message+"  ("+_.filename+":"+_.lineno+")")})},H.postMessage({"cmd":"init","typeSupported":j,"vendor":K,"id":_,"config":JSON.stringify(U)})}catch(R){x.logger.warn("Error in worker:",R),x.logger.error("Error while initializing DemuxerWorker, fallback to inline"),H&&self.URL.revokeObjectURL(H.objectURL),this.transmuxer=new O.default(this.observer,j,U,K,_),this.worker=null}}else this.transmuxer=new O.default(this.observer,j,U,K,_)}var R=e.prototype;return R.destroy=function e(){var R=this.worker;if(R)R.removeEventListener("message",this.onwmsg),R.terminate(),this.worker=null;else{var _=this.transmuxer;_&&(_.destroy(),this.transmuxer=null)}var I=this.observer;I&&I.removeAllListeners(),this.observer=null},R.push=function e(R,_,I,C,w,P,F,M,N,B){var U,G,j=this;N.transmuxing.start=self.performance.now();var K=this.transmuxer,H=this.worker,V=P?P.start:w.start,W=w.decryptdata,Y=this.frag,z=!(Y&&w.cc===Y.cc),X=!(Y&&N.level===Y.level),q=Y?N.sn-Y.sn:-1,Z=this.part?N.part-this.part.index:1,Q=!X&&(1===q||0===q&&1===Z),J=self.performance.now();(X||q||0===w.stats.parsing.start)&&(w.stats.parsing.start=J),!P||!Z&&Q||(P.stats.parsing.start=J);var $=!(Y&&(null===(U=w.initSegment)||void 0===U?void 0:U.url)===(null===(G=Y.initSegment)||void 0===G?void 0:G.url)),ee=new O.TransmuxState(z,Q,M,X,V,$);if(!Q||z||$){x.logger.log("[transmuxer-interface, "+w.type+"]: Starting new transmux session for sn: "+N.sn+" p: "+N.part+" level: "+N.level+" id: "+N.id+"\n        discontinuity: "+z+"\n        trackSwitch: "+X+"\n        contiguous: "+Q+"\n        accurateTimeOffset: "+M+"\n        timeOffset: "+V+"\n        initSegmentChange: "+$);var te=new O.TransmuxConfig(I,C,_,F,B);this.configureTransmuxer(te)}if(this.frag=w,this.part=P,H)H.postMessage({"cmd":"demux","data":R,"decryptdata":W,"chunkMeta":N,"state":ee},R instanceof ArrayBuffer?[R]:[]);else if(K){var re=K.push(R,W,N,ee);Object(O.isPromise)(re)?re.then((function(R){j.handleTransmuxComplete(R)})):this.handleTransmuxComplete(re)}},R.flush=function e(R){var _=this;R.transmuxing.start=self.performance.now();var I=this.transmuxer,C=this.worker;if(C)C.postMessage({"cmd":"flush","chunkMeta":R});else if(I){var w=I.flush(R);Object(O.isPromise)(w)?w.then((function(I){_.handleFlushResult(I,R)})):this.handleFlushResult(w,R)}},R.handleFlushResult=function e(R,_){var I=this;R.forEach((function(R){I.handleTransmuxComplete(R)})),this.onFlush(_)},R.onWorkerMessage=function e(R){var _=R.data,I=this.hls;switch(_.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(_.data);break;case"flush":this.onFlush(_.data);break;default:_.data=_.data||{},_.data.frag=this.frag,_.data.id=this.id,I.trigger(_.event,_.data)}},R.configureTransmuxer=function e(R){var _=this.worker,I=this.transmuxer;_?_.postMessage({"cmd":"configure","config":R}):I&&I.configure(R)},R.handleTransmuxComplete=function e(R){R.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(R)},e}()},"./src/demux/transmuxer-worker.ts":function _src_demux_transmuxerWorkerTs(R,_,I){I.r(_),I.d(_,"default",(function(){return o}));var C=I("./src/demux/transmuxer.ts"),w=I("./src/events.ts"),O=I("./src/utils/logger.ts"),x=I("./node_modules/eventemitter3/index.js");function o(R){var _=new x.EventEmitter,I=function t(_,I){R.postMessage({"event":_,"data":I})};_.on(w.Events.FRAG_DECRYPTED,I),_.on(w.Events.ERROR,I),R.addEventListener("message",(function(w){var x=w.data;switch(x.cmd){case"init":var P=JSON.parse(x.config);R.transmuxer=new C.default(_,x.typeSupported,P,x.vendor,x.id),Object(O.enableLogs)(P.debug),I("init",null);break;case"configure":R.transmuxer.configure(x.config);break;case"demux":var F=R.transmuxer.push(x.data,x.decryptdata,x.chunkMeta,x.state);Object(C.isPromise)(F)?F.then((function(_){l(R,_)})):l(R,F);break;case"flush":var M=x.chunkMeta,N=R.transmuxer.flush(M);Object(C.isPromise)(N)?N.then((function(_){f(R,_,M)})):f(R,N,M)}}))}function l(R,_){if(!function c(R){return!(R.audio||R.video||R.text||R.id3||R.initSegment)}(_.remuxResult)){var I=[],C=_.remuxResult,w=C.audio,O=C.video;w&&u(I,w),O&&u(I,O),R.postMessage({"event":"transmuxComplete","data":_},I)}}function u(R,_){_.data1&&R.push(_.data1.buffer),_.data2&&R.push(_.data2.buffer)}function f(R,_,I){_.forEach((function(_){l(R,_)})),R.postMessage({"event":"flush","data":I})}},"./src/demux/transmuxer.ts":function _src_demux_transmuxerTs(R,_,I){I.r(_),I.d(_,"default",(function(){return W})),I.d(_,"isPromise",(function(){return b})),I.d(_,"TransmuxConfig",(function(){return z})),I.d(_,"TransmuxState",(function(){return X}));var C,w=I("./src/events.ts"),O=I("./src/errors.ts"),x=I("./src/crypt/decrypter.ts"),P=I("./src/demux/aacdemuxer.ts"),F=I("./src/demux/mp4demuxer.ts"),M=I("./src/demux/tsdemuxer.ts"),N=I("./src/demux/mp3demuxer.ts"),B=I("./src/remux/mp4-remuxer.ts"),U=I("./src/remux/passthrough-remuxer.ts"),G=I("./src/demux/chunk-cache.ts"),j=I("./src/utils/mp4-tools.ts"),K=I("./src/utils/logger.ts");try{C=self.performance.now.bind(self.performance)}catch(R){K.logger.debug("Unable to use Performance API on this environment"),C=self.Date.now}var H=[{"demux":M.default,"remux":B.default},{"demux":F.default,"remux":U.default},{"demux":P.default,"remux":B.default},{"demux":N.default,"remux":B.default}],V=1024;H.forEach((function(R){var _=R.demux;V=Math.max(V,_.minProbeByteLength)}));var W=function(){function e(R,_,I,C,w){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new G.default,this.observer=R,this.typeSupported=_,this.config=I,this.vendor=C,this.id=w}var R=e.prototype;return R.configure=function e(R){this.transmuxConfig=R,this.decrypter&&this.decrypter.reset()},R.push=function e(R,_,I,w){var O=this,x=I.transmuxing;x.executeStart=C();var P=new Uint8Array(R),F=this.cache,M=this.config,N=this.currentTransmuxState,B=this.transmuxConfig;w&&(this.currentTransmuxState=w);var U=function E(R,_){var I=null;R.byteLength>0&&null!=_&&null!=_.key&&null!==_.iv&&null!=_.method&&(I=_);return I}(P,_);if(U&&"AES-128"===U.method){var G=this.getDecrypter();if(!M.enableSoftwareAES)return this.decryptionPromise=G.webCryptoDecrypt(P,U.key.buffer,U.iv.buffer).then((function(R){var _=O.push(R,null,I);return O.decryptionPromise=null,_})),this.decryptionPromise;var K=G.softwareDecrypt(P,U.key.buffer,U.iv.buffer);if(!K)return x.executeEnd=C(),Y(I);P=new Uint8Array(K)}var H=w||N,V=H.contiguous,W=H.discontinuity,z=H.trackSwitch,X=H.accurateTimeOffset,q=H.timeOffset,Z=H.initSegmentChange,Q=B.audioCodec,J=B.videoCodec,$=B.defaultInitPts,ee=B.duration,te=B.initSegmentData;if((W||z||Z)&&this.resetInitSegment(te,Q,J,ee),(W||Z)&&this.resetInitialTimestamp($),V||this.resetContiguity(),this.needsProbing(P,W,z)){if(F.dataLength){var re=F.flush();P=Object(j.appendUint8Array)(re,P)}this.configureTransmuxer(P,B)}var ie=this.transmux(P,U,q,X,I),ne=this.currentTransmuxState;return ne.contiguous=!0,ne.discontinuity=!1,ne.trackSwitch=!1,x.executeEnd=C(),ie},R.flush=function e(R){var _=this,I=R.transmuxing;I.executeStart=C();var x=this.decrypter,P=this.cache,F=this.currentTransmuxState,M=this.decryptionPromise;if(M)return M.then((function(){return _.flush(R)}));var N=[],B=F.timeOffset;if(x){var U=x.flush();U&&N.push(this.push(U,null,R))}var G=P.dataLength;P.reset();var j=this.demuxer,K=this.remuxer;if(!j||!K)return G>=V&&this.observer.emit(w.Events.ERROR,w.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.FRAG_PARSING_ERROR,"fatal":!0,"reason":"no demux matching with content found"}),I.executeEnd=C(),[Y(R)];var H=j.flush(B);return b(H)?H.then((function(I){return _.flushRemux(N,I,R),N})):(this.flushRemux(N,H,R),N)},R.flushRemux=function e(R,_,I){var w=_.audioTrack,O=_.avcTrack,x=_.id3Track,P=_.textTrack,F=this.currentTransmuxState,M=F.accurateTimeOffset,N=F.timeOffset;K.logger.log("[transmuxer.ts]: Flushed fragment "+I.sn+(I.part>-1?" p: "+I.part:"")+" of level "+I.level);var B=this.remuxer.remux(w,O,x,P,N,M,!0,this.id);R.push({"remuxResult":B,"chunkMeta":I}),I.transmuxing.executeEnd=C()},R.resetInitialTimestamp=function e(R){var _=this.demuxer,I=this.remuxer;_&&I&&(_.resetTimeStamp(R),I.resetTimeStamp(R))},R.resetContiguity=function e(){var R=this.demuxer,_=this.remuxer;R&&_&&(R.resetContiguity(),_.resetNextTimestamp())},R.resetInitSegment=function e(R,_,I,C){var w=this.demuxer,O=this.remuxer;w&&O&&(w.resetInitSegment(_,I,C),O.resetInitSegment(R,_,I))},R.destroy=function e(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},R.transmux=function e(R,_,I,C,w){return _&&"SAMPLE-AES"===_.method?this.transmuxSampleAes(R,_,I,C,w):this.transmuxUnencrypted(R,I,C,w)},R.transmuxUnencrypted=function e(R,_,I,C){var w=this.demuxer.demux(R,_,!1,!this.config.progressive),O=w.audioTrack,x=w.avcTrack,P=w.id3Track,F=w.textTrack;return{"remuxResult":this.remuxer.remux(O,x,P,F,_,I,!1,this.id),"chunkMeta":C}},R.transmuxSampleAes=function e(R,_,I,C,w){var O=this;return this.demuxer.demuxSampleAes(R,_,I).then((function(R){return{"remuxResult":O.remuxer.remux(R.audioTrack,R.avcTrack,R.id3Track,R.textTrack,I,C,!1,O.id),"chunkMeta":w}}))},R.configureTransmuxer=function e(R,_){for(var I,C=this.config,w=this.observer,O=this.typeSupported,x=this.vendor,P=_.audioCodec,M=_.defaultInitPts,N=_.duration,B=_.initSegmentData,G=_.videoCodec,j=0,V=H.length;j<V;j++)if(H[j].demux.probe(R)){I=H[j];break}I||(K.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),I={"demux":F.default,"remux":U.default});var W=this.demuxer,Y=this.remuxer,z=I.remux,X=I.demux;Y&&Y instanceof z||(this.remuxer=new z(w,C,O,x)),W&&W instanceof X||(this.demuxer=new X(w,C,O),this.probe=X.probe),this.resetInitSegment(B,P,G,N),this.resetInitialTimestamp(M)},R.needsProbing=function e(R,_,I){return!this.demuxer||!this.remuxer||_||I},R.getDecrypter=function e(){var R=this.decrypter;return R||(R=this.decrypter=new x.default(this.observer,this.config)),R},e}();var Y=function e(R){return{"remuxResult":{},"chunkMeta":R}};function b(R){return"then"in R&&R.then instanceof Function}var z=function e(R,_,I,C,w){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=R,this.videoCodec=_,this.initSegmentData=I,this.duration=C,this.defaultInitPts=w},X=function e(R,_,I,C,w,O){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=R,this.contiguous=_,this.accurateTimeOffset=I,this.trackSwitch=C,this.timeOffset=w,this.initSegmentChange=O}},"./src/demux/tsdemuxer.ts":function _src_demux_tsdemuxerTs(R,_,I){I.r(_),I.d(_,"discardEPB",(function(){return T}));var C=I("./src/demux/adts.ts"),w=I("./src/demux/mpegaudio.ts"),O=I("./src/demux/exp-golomb.ts"),x=I("./src/demux/id3.ts"),P=I("./src/demux/sample-aes.ts"),F=I("./src/events.ts"),M=I("./src/utils/mp4-tools.ts"),N=I("./src/utils/logger.ts"),B=I("./src/errors.ts"),U={"video":1,"audio":2,"id3":3,"text":4},G=function(){function e(R,_,I){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=R,this.config=_,this.typeSupported=I}e.probe=function t(R){var _=e.syncOffset(R);return!(_<0)&&(_&&N.logger.warn("MPEG2-TS detected but first sync word found @ offset "+_+", junk ahead ?"),!0)},e.syncOffset=function e(R){for(var _=Math.min(1e3,R.length-564),I=0;I<_;){if(71===R[I]&&71===R[I+188]&&71===R[I+376])return I;I++}return-1},e.createTrack=function e(R,_){return{"container":"video"===R||"audio"===R?"video/mp2t":void 0,"type":R,"id":U[R],"pid":-1,"inputTimeScale":9e4,"sequenceNumber":0,"samples":[],"dropped":0,"duration":"audio"===R?_:void 0}};var R=e.prototype;return R.resetInitSegment=function t(R,_,I){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",I),this._audioTrack=e.createTrack("audio",I),this._id3Track=e.createTrack("id3",I),this._txtTrack=e.createTrack("text",I),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=R,this.videoCodec=_,this._duration=I},R.resetTimeStamp=function e(){},R.resetContiguity=function e(){var R=this._audioTrack,_=this._avcTrack,I=this._id3Track;R&&(R.pesData=null),_&&(_.pesData=null),I&&(I.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},R.demux=function t(R,_,I,C){var w;void 0===I&&(I=!1),void 0===C&&(C=!1),I||(this.sampleAes=null);var O=this._avcTrack,x=this._audioTrack,P=this._id3Track,U=O.pid,G=O.pesData,j=x.pid,K=P.pid,H=x.pesData,V=P.pesData,W=!1,Y=this.pmtParsed,z=this._pmtId,X=R.length;if(this.remainderData&&(X=(R=Object(M.appendUint8Array)(this.remainderData,R)).length,this.remainderData=null),X<188&&!C)return this.remainderData=R,{"audioTrack":x,"avcTrack":O,"id3Track":P,"textTrack":this._txtTrack};var q=Math.max(0,e.syncOffset(R));(X-=(X+q)%188)<R.byteLength&&!C&&(this.remainderData=new Uint8Array(R.buffer,X,R.buffer.byteLength-X));for(var Z=0,Q=q;Q<X;Q+=188)if(71===R[Q]){var J=!!(64&R[Q+1]),$=((31&R[Q+1])<<8)+R[Q+2],ee=void 0;if((48&R[Q+3])>>4>1){if((ee=Q+5+R[Q+4])===Q+188)continue}else ee=Q+4;switch($){case U:J&&(G&&(w=m(G))&&this.parseAVCPES(w,!1),G={"data":[],"size":0}),G&&(G.data.push(R.subarray(ee,Q+188)),G.size+=Q+188-ee);break;case j:J&&(H&&(w=m(H))&&(x.isAAC?this.parseAACPES(w):this.parseMPEGPES(w)),H={"data":[],"size":0}),H&&(H.data.push(R.subarray(ee,Q+188)),H.size+=Q+188-ee);break;case K:J&&(V&&(w=m(V))&&this.parseID3PES(w),V={"data":[],"size":0}),V&&(V.data.push(R.subarray(ee,Q+188)),V.size+=Q+188-ee);break;case 0:J&&(ee+=R[ee]+1),z=this._pmtId=g(R,ee);break;case z:J&&(ee+=R[ee]+1);var te=p(R,ee,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,I);(U=te.avc)>0&&(O.pid=U),(j=te.audio)>0&&(x.pid=j,x.isAAC=te.isAAC),(K=te.id3)>0&&(P.pid=K),W&&!Y&&(N.logger.log("reparse from beginning"),W=!1,Q=q-188),Y=this.pmtParsed=!0;break;case 17:case 8191:break;default:W=!0}}else Z++;Z>0&&this.observer.emit(F.Events.ERROR,F.Events.ERROR,{"type":B.ErrorTypes.MEDIA_ERROR,"details":B.ErrorDetails.FRAG_PARSING_ERROR,"fatal":!1,"reason":"Found "+Z+" TS packet/s that do not start with 0x47"}),O.pesData=G,x.pesData=H,P.pesData=V;var re={"audioTrack":x,"avcTrack":O,"id3Track":P,"textTrack":this._txtTrack};return C&&this.extractRemainingSamples(re),re},R.flush=function e(){var R,_=this.remainderData;return this.remainderData=null,R=_?this.demux(_,-1,!1,!0):{"audioTrack":this._audioTrack,"avcTrack":this._avcTrack,"textTrack":this._txtTrack,"id3Track":this._id3Track},this.extractRemainingSamples(R),this.sampleAes?this.decrypt(R,this.sampleAes):R},R.extractRemainingSamples=function e(R){var _,I=R.audioTrack,C=R.avcTrack,w=R.id3Track,O=C.pesData,x=I.pesData,P=w.pesData;O&&(_=m(O))?(this.parseAVCPES(_,!0),C.pesData=null):C.pesData=O,x&&(_=m(x))?(I.isAAC?this.parseAACPES(_):this.parseMPEGPES(_),I.pesData=null):(null!=x&&x.size&&N.logger.log("last AAC PES packet truncated,might overlap between fragments"),I.pesData=x),P&&(_=m(P))?(this.parseID3PES(_),w.pesData=null):w.pesData=P},R.demuxSampleAes=function e(R,_,I){var C=this.demux(R,I,!0,!this.config.progressive),w=this.sampleAes=new P.default(this.observer,this.config,_);return this.decrypt(C,w)},R.decrypt=function e(R,_){return new Promise((function(I){var C=R.audioTrack,w=R.avcTrack;C.samples&&C.isAAC?_.decryptAacSamples(C.samples,0,(function(){w.samples?_.decryptAvcSamples(w.samples,0,0,(function(){I(R)})):I(R)})):w.samples&&_.decryptAvcSamples(w.samples,0,0,(function(){I(R)}))}))},R.destroy=function e(){this._initPTS=this._initDTS=null,this._duration=0},R.parseAVCPES=function e(R,_){var I,C=this,w=this._avcTrack,P=this.parseAVCNALu(R.data),F=this.avcSample,M=!1;R.data=null,F&&P.length&&!w.audFound&&(y(F,w),F=this.avcSample=v(!1,R.pts,R.dts,"")),P.forEach((function(_){switch(_.type){case 1:I=!0,F||(F=C.avcSample=v(!0,R.pts,R.dts,"")),F.frame=!0;var P=_.data;if(M&&P.length>4){var N=new O.default(P).readSliceType();2!==N&&4!==N&&7!==N&&9!==N||(F.key=!0)}break;case 5:I=!0,F||(F=C.avcSample=v(!0,R.pts,R.dts,"")),F.key=!0,F.frame=!0;break;case 6:I=!0;var B=new O.default(T(_.data));B.readUByte();for(var U=0,G=0,j=!1,K=0;!j&&B.bytesAvailable>1;){U=0;do{U+=K=B.readUByte()}while(255===K);G=0;do{G+=K=B.readUByte()}while(255===K);if(4===U&&0!==B.bytesAvailable){if(j=!0,181===B.readUByte())if(49===B.readUShort())if(1195456820===B.readUInt())if(3===B.readUByte()){for(var H=B.readUByte(),V=31&H,W=[H,B.readUByte()],Y=0;Y<V;Y++)W.push(B.readUByte()),W.push(B.readUByte()),W.push(B.readUByte());E(C._txtTrack.samples,{"type":3,"pts":R.pts,"bytes":W})}}else if(5===U&&0!==B.bytesAvailable){if(j=!0,G>16){for(var z=[],X=0;X<16;X++)z.push(B.readUByte().toString(16)),3!==X&&5!==X&&7!==X&&9!==X||z.push("-");for(var q=G-16,Z=new Uint8Array(q),Q=0;Q<q;Q++)Z[Q]=B.readUByte();E(C._txtTrack.samples,{"pts":R.pts,"payloadType":U,"uuid":z.join(""),"userData":Object(x.utf8ArrayToStr)(Z),"userDataBytes":Z})}}else if(G<B.bytesAvailable)for(var J=0;J<G;J++)B.readUByte()}break;case 7:if(I=!0,M=!0,!w.sps){var $=new O.default(_.data).readSPS();w.width=$.width,w.height=$.height,w.pixelRatio=$.pixelRatio,w.sps=[_.data],w.duration=C._duration;for(var ee=_.data.subarray(1,4),te="avc1.",re=0;re<3;re++){var ie=ee[re].toString(16);ie.length<2&&(ie="0"+ie),te+=ie}w.codec=te}break;case 8:I=!0,w.pps||(w.pps=[_.data]);break;case 9:I=!1,w.audFound=!0,F&&y(F,w),F=C.avcSample=v(!1,R.pts,R.dts,"");break;case 12:I=!1;break;default:I=!1,F&&(F.debug+="unknown NAL "+_.type+" ")}F&&I&&F.units.push(_)})),_&&F&&(y(F,w),this.avcSample=null)},R.getLastNalUnit=function e(){var R,_,I=this.avcSample;if(!I||0===I.units.length){var C=this._avcTrack.samples;I=C[C.length-1]}if(null!==(R=I)&&void 0!==R&&R.units){var w=I.units;_=w[w.length-1]}return _},R.parseAVCNALu=function e(R){var _,I,C=R.byteLength,w=this._avcTrack,O=w.naluState||0,x=O,P=[],F=0,M=-1,N=0;for(-1===O&&(M=0,N=31&R[0],O=0,F=1);F<C;)if(_=R[F++],O)if(1!==O)if(_)if(1===_){if(M>=0){var B={"data":R.subarray(M,F-O-1),"type":N};P.push(B)}else{var U=this.getLastNalUnit();if(U&&(x&&F<=4-x&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-x)),(I=F-O-1)>0)){var G=new Uint8Array(U.data.byteLength+I);G.set(U.data,0),G.set(R.subarray(0,I),U.data.byteLength),U.data=G,U.state=0}}F<C?(M=F,N=31&R[F],O=0):O=-1}else O=0;else O=3;else O=_?0:2;else O=_?0:1;if(M>=0&&O>=0){var j={"data":R.subarray(M,C),"type":N,"state":O};P.push(j)}if(0===P.length){var K=this.getLastNalUnit();if(K){var H=new Uint8Array(K.data.byteLength+R.byteLength);H.set(K.data,0),H.set(R,K.data.byteLength),K.data=H}}return w.naluState=O,P},R.parseAACPES=function e(R){var _,I,w,O,x,P=0,M=this._audioTrack,U=this.aacOverFlow,G=R.data;if(U){this.aacOverFlow=null;var j=U.sample.unit.byteLength,K=Math.min(U.missing,j),H=j-K;U.sample.unit.set(G.subarray(0,K),H),M.samples.push(U.sample),P=U.missing}for(_=P,I=G.length;_<I-1&&!C.isHeader(G,_);_++);if(_!==P&&(_<I-1?(w="AAC PES did not start with ADTS header,offset:"+_,O=!1):(w="no ADTS header found in AAC PES",O=!0),N.logger.warn("parsing error:"+w),this.observer.emit(F.Events.ERROR,F.Events.ERROR,{"type":B.ErrorTypes.MEDIA_ERROR,"details":B.ErrorDetails.FRAG_PARSING_ERROR,"fatal":O,"reason":w}),O))return;if(C.initTrackConfig(M,this.observer,G,_,this.audioCodec),void 0!==R.pts)x=R.pts;else{if(!U)return void N.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var V=C.getFrameDuration(M.samplerate);x=U.sample.pts+V}for(var W=0;_<I;){if(C.isHeader(G,_)){if(_+5<I){var Y=C.appendFrame(M,G,_,x,W);if(Y){if(!Y.missing){_+=Y.length,W++;continue}this.aacOverFlow=Y}}break}_++}},R.parseMPEGPES=function e(R){var _=R.data,I=_.length,C=0,O=0,x=R.pts;if(void 0!==x)for(;O<I;)if(w.isHeader(_,O)){var P=w.appendFrame(this._audioTrack,_,O,x,C);if(!P)break;O+=P.length,C++}else O++;else N.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},R.parseID3PES=function e(R){void 0!==R.pts?this._id3Track.samples.push(R):N.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function v(R,_,I,C){return{"key":R,"frame":!1,"pts":_,"dts":I,"units":[],"debug":C,"length":0}}function g(R,_){return(31&R[_+10])<<8|R[_+11]}function p(R,_,I,C){var w={"audio":-1,"avc":-1,"id3":-1,"isAAC":!0},O=_+3+((15&R[_+1])<<8|R[_+2])-4;for(_+=12+((15&R[_+10])<<8|R[_+11]);_<O;){var x=(31&R[_+1])<<8|R[_+2];switch(R[_]){case 207:if(!C){N.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===w.audio&&(w.audio=x);break;case 21:-1===w.id3&&(w.id3=x);break;case 219:if(!C){N.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===w.avc&&(w.avc=x);break;case 3:case 4:I?-1===w.audio&&(w.audio=x,w.isAAC=!1):N.logger.log("MPEG audio found, not supported in this browser");break;case 36:N.logger.warn("Unsupported HEVC stream type found")}_+=5+((15&R[_+3])<<8|R[_+4])}return w}function m(R){var _,I,C,w,O,x=0,P=R.data;if(!R||0===R.size)return null;for(;P[0].length<19&&P.length>1;){var F=new Uint8Array(P[0].length+P[1].length);F.set(P[0]),F.set(P[1],P[0].length),P[0]=F,P.splice(1,1)}if(1===((_=P[0])[0]<<16)+(_[1]<<8)+_[2]){if((I=(_[4]<<8)+_[5])&&I>R.size-6)return null;var M=_[7];192&M&&(w=536870912*(14&_[9])+4194304*(255&_[10])+16384*(254&_[11])+128*(255&_[12])+(254&_[13])/2,64&M?w-(O=536870912*(14&_[14])+4194304*(255&_[15])+16384*(254&_[16])+128*(255&_[17])+(254&_[18])/2)>54e5&&(N.logger.warn(Math.round((w-O)/9e4)+"s delta between PTS and DTS, align them"),w=O):O=w);var B=(C=_[8])+9;if(R.size<=B)return null;R.size-=B;for(var U=new Uint8Array(R.size),G=0,j=P.length;G<j;G++){var K=(_=P[G]).byteLength;if(B){if(B>K){B-=K;continue}_=_.subarray(B),K-=B,B=0}U.set(_,x),x+=K}return I&&(I-=C+3),{"data":U,"pts":w,"dts":O,"len":I}}return null}function y(R,_){if(R.units.length&&R.frame){if(void 0===R.pts){var I=_.samples,C=I.length;if(!C)return void _.dropped++;var w=I[C-1];R.pts=w.pts,R.dts=w.dts}_.samples.push(R)}R.debug.length&&N.logger.log(R.pts+"/"+R.dts+":"+R.debug)}function E(R,_){var I=R.length;if(I>0){if(_.pts>=R[I-1].pts)R.push(_);else for(var C=I-1;C>=0;C--)if(_.pts<R[C].pts){R.splice(C,0,_);break}}else R.push(_)}function T(R){for(var _=R.byteLength,I=[],C=1;C<_-2;)0===R[C]&&0===R[C+1]&&3===R[C+2]?(I.push(C+2),C+=2):C++;if(0===I.length)return R;var w=_-I.length,O=new Uint8Array(w),x=0;for(C=0;C<w;x++,C++)x===I[0]&&(x++,I.shift()),O[C]=R[x];return O}G.minProbeByteLength=188,_.default=G},"./src/errors.ts":function _src_errorsTs(R,_,I){var C,w;I.r(_),I.d(_,"ErrorTypes",(function(){return C})),I.d(_,"ErrorDetails",(function(){return w})),function(R){R.NETWORK_ERROR="networkError",R.MEDIA_ERROR="mediaError",R.KEY_SYSTEM_ERROR="keySystemError",R.MUX_ERROR="muxError",R.OTHER_ERROR="otherError"}(C||(C={})),function(R){R.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",R.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",R.KEY_SYSTEM_NO_SESSION="keySystemNoSession",R.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",R.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",R.MANIFEST_LOAD_ERROR="manifestLoadError",R.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",R.MANIFEST_PARSING_ERROR="manifestParsingError",R.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",R.LEVEL_EMPTY_ERROR="levelEmptyError",R.LEVEL_LOAD_ERROR="levelLoadError",R.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",R.LEVEL_SWITCH_ERROR="levelSwitchError",R.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",R.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",R.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",R.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",R.FRAG_LOAD_ERROR="fragLoadError",R.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",R.FRAG_DECRYPT_ERROR="fragDecryptError",R.FRAG_PARSING_ERROR="fragParsingError",R.REMUX_ALLOC_ERROR="remuxAllocError",R.KEY_LOAD_ERROR="keyLoadError",R.KEY_LOAD_TIMEOUT="keyLoadTimeOut",R.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",R.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",R.BUFFER_APPEND_ERROR="bufferAppendError",R.BUFFER_APPENDING_ERROR="bufferAppendingError",R.BUFFER_STALLED_ERROR="bufferStalledError",R.BUFFER_FULL_ERROR="bufferFullError",R.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",R.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",R.INTERNAL_EXCEPTION="internalException",R.INTERNAL_ABORTED="aborted",R.UNKNOWN="unknown"}(w||(w={}))},"./src/events.ts":function _src_eventsTs(R,_,I){var C;I.r(_),I.d(_,"Events",(function(){return C})),function(R){R.MEDIA_ATTACHING="hlsMediaAttaching",R.MEDIA_ATTACHED="hlsMediaAttached",R.MEDIA_DETACHING="hlsMediaDetaching",R.MEDIA_DETACHED="hlsMediaDetached",R.BUFFER_RESET="hlsBufferReset",R.BUFFER_CODECS="hlsBufferCodecs",R.BUFFER_CREATED="hlsBufferCreated",R.BUFFER_APPENDING="hlsBufferAppending",R.BUFFER_APPENDED="hlsBufferAppended",R.BUFFER_EOS="hlsBufferEos",R.BUFFER_FLUSHING="hlsBufferFlushing",R.BUFFER_FLUSHED="hlsBufferFlushed",R.MANIFEST_LOADING="hlsManifestLoading",R.MANIFEST_LOADED="hlsManifestLoaded",R.MANIFEST_PARSED="hlsManifestParsed",R.LEVEL_SWITCHING="hlsLevelSwitching",R.LEVEL_SWITCHED="hlsLevelSwitched",R.LEVEL_LOADING="hlsLevelLoading",R.LEVEL_LOADED="hlsLevelLoaded",R.LEVEL_UPDATED="hlsLevelUpdated",R.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",R.LEVELS_UPDATED="hlsLevelsUpdated",R.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",R.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",R.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",R.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",R.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",R.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",R.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",R.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",R.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",R.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",R.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",R.CUES_PARSED="hlsCuesParsed",R.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",R.INIT_PTS_FOUND="hlsInitPtsFound",R.FRAG_LOADING="hlsFragLoading",R.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",R.FRAG_LOADED="hlsFragLoaded",R.FRAG_DECRYPTED="hlsFragDecrypted",R.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",R.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",R.FRAG_PARSING_METADATA="hlsFragParsingMetadata",R.FRAG_PARSED="hlsFragParsed",R.FRAG_BUFFERED="hlsFragBuffered",R.FRAG_CHANGED="hlsFragChanged",R.FPS_DROP="hlsFpsDrop",R.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",R.ERROR="hlsError",R.DESTROYING="hlsDestroying",R.KEY_LOADING="hlsKeyLoading",R.KEY_LOADED="hlsKeyLoaded",R.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",R.BACK_BUFFER_REACHED="hlsBackBufferReached"}(C||(C={}))},"./src/hls.ts":function _src_hlsTs(R,_,I){I.r(_),I.d(_,"default",(function(){return V}));var C=I("./node_modules/url-toolkit/src/url-toolkit.js"),w=I("./src/loader/playlist-loader.ts"),O=I("./src/loader/key-loader.ts"),x=I("./src/controller/id3-track-controller.ts"),P=I("./src/controller/latency-controller.ts"),F=I("./src/controller/level-controller.ts"),M=I("./src/controller/fragment-tracker.ts"),N=I("./src/controller/stream-controller.ts"),B=I("./src/is-supported.ts"),U=I("./src/utils/logger.ts"),G=I("./src/config.ts"),j=I("./node_modules/eventemitter3/index.js"),K=I("./src/events.ts"),H=I("./src/errors.ts");function m(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}var V=function(){function e(R){void 0===R&&(R={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new j.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var _=this.config=Object(G.mergeConfig)(e.DefaultConfig,R);this.userConfig=R,Object(U.enableLogs)(_.debug),this._autoLevelCapping=-1,_.progressive&&Object(G.enableStreamingMode)(_);var I=_.abrController,C=_.bufferController,B=_.capLevelController,K=_.fpsController,H=this.abrController=new I(this),V=this.bufferController=new C(this),W=this.capLevelController=new B(this),Y=new K(this),z=new w.default(this),X=new O.default(this),q=new x.default(this),Z=this.levelController=new F.default(this),Q=new M.FragmentTracker(this),J=this.streamController=new N.default(this,Q);W.setStreamController(J),Y.setStreamController(J);var $=[Z,J];this.networkControllers=$;var ee=[z,X,H,V,W,Y,q,Q];this.audioTrackController=this.createController(_.audioTrackController,null,$),this.createController(_.audioStreamController,Q,$),this.subtitleTrackController=this.createController(_.subtitleTrackController,null,$),this.createController(_.subtitleStreamController,Q,$),this.createController(_.timelineController,null,ee),this.emeController=this.createController(_.emeController,null,ee),this.cmcdController=this.createController(_.cmcdController,null,ee),this.latencyController=this.createController(P.default,null,ee),this.coreComponents=ee}e.isSupported=function e(){return Object(B.isSupported)()};var R=e.prototype;return R.createController=function e(R,_,I){if(R){var C=_?new R(this,_):new R(this);return I&&I.push(C),C}return null},R.on=function e(R,_,I){void 0===I&&(I=this),this._emitter.on(R,_,I)},R.once=function e(R,_,I){void 0===I&&(I=this),this._emitter.once(R,_,I)},R.removeAllListeners=function e(R){this._emitter.removeAllListeners(R)},R.off=function e(R,_,I,C){void 0===I&&(I=this),this._emitter.off(R,_,I,C)},R.listeners=function e(R){return this._emitter.listeners(R)},R.emit=function e(R,_,I){return this._emitter.emit(R,_,I)},R.trigger=function e(R,_){if(this.config.debug)return this.emit(R,R,_);try{return this.emit(R,R,_)}catch(e){U.logger.error("An internal error happened while handling event "+R+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.trigger(K.Events.ERROR,{"type":H.ErrorTypes.OTHER_ERROR,"details":H.ErrorDetails.INTERNAL_EXCEPTION,"fatal":!1,"event":R,"error":e})}return!1},R.listenerCount=function e(R){return this._emitter.listenerCount(R)},R.destroy=function e(){U.logger.log("destroy"),this.trigger(K.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(R){return R.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(R){return R.destroy()})),this.coreComponents.length=0},R.attachMedia=function e(R){U.logger.log("attachMedia"),this._media=R,this.trigger(K.Events.MEDIA_ATTACHING,{"media":R})},R.detachMedia=function e(){U.logger.log("detachMedia"),this.trigger(K.Events.MEDIA_DETACHING,void 0),this._media=null},R.loadSource=function e(R){this.stopLoad();var _=this.media,I=this.url,w=this.url=C.buildAbsoluteURL(self.location.href,R,{"alwaysNormalize":!0});U.logger.log("loadSource:"+w),_&&I&&I!==w&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(_)),this.trigger(K.Events.MANIFEST_LOADING,{"url":R})},R.startLoad=function e(R){void 0===R&&(R=-1),U.logger.log("startLoad("+R+")"),this.networkControllers.forEach((function(_){_.startLoad(R)}))},R.stopLoad=function e(){U.logger.log("stopLoad"),this.networkControllers.forEach((function(R){R.stopLoad()}))},R.swapAudioCodec=function e(){U.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},R.recoverMediaError=function e(){U.logger.log("recoverMediaError");var R=this._media;this.detachMedia(),R&&this.attachMedia(R)},R.removeLevel=function e(R,_){void 0===_&&(_=0),this.levelController.removeLevel(R,_)},function y(R,_,I){return _&&m(R.prototype,_),I&&m(R,I),R}(e,[{"key":"levels","get":function e(){var R=this.levelController.levels;return R||[]}},{"key":"currentLevel","get":function e(){return this.streamController.currentLevel},"set":function e(R){U.logger.log("set currentLevel:"+R),this.loadLevel=R,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{"key":"nextLevel","get":function e(){return this.streamController.nextLevel},"set":function e(R){U.logger.log("set nextLevel:"+R),this.levelController.manualLevel=R,this.streamController.nextLevelSwitch()}},{"key":"loadLevel","get":function e(){return this.levelController.level},"set":function e(R){U.logger.log("set loadLevel:"+R),this.levelController.manualLevel=R}},{"key":"nextLoadLevel","get":function e(){return this.levelController.nextLoadLevel},"set":function e(R){this.levelController.nextLoadLevel=R}},{"key":"firstLevel","get":function e(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},"set":function e(R){U.logger.log("set firstLevel:"+R),this.levelController.firstLevel=R}},{"key":"startLevel","get":function e(){return this.levelController.startLevel},"set":function e(R){U.logger.log("set startLevel:"+R),-1!==R&&(R=Math.max(R,this.minAutoLevel)),this.levelController.startLevel=R}},{"key":"capLevelToPlayerSize","get":function e(){return this.config.capLevelToPlayerSize},"set":function e(R){var _=!!R;_!==this.config.capLevelToPlayerSize&&(_?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=_)}},{"key":"autoLevelCapping","get":function e(){return this._autoLevelCapping},"set":function e(R){this._autoLevelCapping!==R&&(U.logger.log("set autoLevelCapping:"+R),this._autoLevelCapping=R)}},{"key":"bandwidthEstimate","get":function e(){var R=this.abrController.bwEstimator;return R?R.getEstimate():NaN}},{"key":"autoLevelEnabled","get":function e(){return-1===this.levelController.manualLevel}},{"key":"manualLevel","get":function e(){return this.levelController.manualLevel}},{"key":"minAutoLevel","get":function e(){var R=this.levels,_=this.config.minAutoBitrate;if(!R)return 0;for(var I=R.length,C=0;C<I;C++)if(R[C].maxBitrate>_)return C;return 0}},{"key":"maxAutoLevel","get":function e(){var R=this.levels,_=this.autoLevelCapping;return-1===_&&R&&R.length?R.length-1:_}},{"key":"nextAutoLevel","get":function e(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},"set":function e(R){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,R)}},{"key":"audioTracks","get":function e(){var R=this.audioTrackController;return R?R.audioTracks:[]}},{"key":"audioTrack","get":function e(){var R=this.audioTrackController;return R?R.audioTrack:-1},"set":function e(R){var _=this.audioTrackController;_&&(_.audioTrack=R)}},{"key":"subtitleTracks","get":function e(){var R=this.subtitleTrackController;return R?R.subtitleTracks:[]}},{"key":"subtitleTrack","get":function e(){var R=this.subtitleTrackController;return R?R.subtitleTrack:-1},"set":function e(R){var _=this.subtitleTrackController;_&&(_.subtitleTrack=R)}},{"key":"media","get":function e(){return this._media}},{"key":"subtitleDisplay","get":function e(){var R=this.subtitleTrackController;return!!R&&R.subtitleDisplay},"set":function e(R){var _=this.subtitleTrackController;_&&(_.subtitleDisplay=R)}},{"key":"lowLatencyMode","get":function e(){return this.config.lowLatencyMode},"set":function e(R){this.config.lowLatencyMode=R}},{"key":"liveSyncPosition","get":function e(){return this.latencyController.liveSyncPosition}},{"key":"latency","get":function e(){return this.latencyController.latency}},{"key":"maxLatency","get":function e(){return this.latencyController.maxLatency}},{"key":"targetLatency","get":function e(){return this.latencyController.targetLatency}},{"key":"drift","get":function e(){return this.latencyController.drift}},{"key":"forceStartLoad","get":function e(){return this.streamController.forceStartLoad}}],[{"key":"version","get":function e(){return"1.1.5"}},{"key":"Events","get":function e(){return K.Events}},{"key":"ErrorTypes","get":function e(){return H.ErrorTypes}},{"key":"ErrorDetails","get":function e(){return H.ErrorDetails}},{"key":"DefaultConfig","get":function t(){return e.defaultConfig?e.defaultConfig:G.hlsDefaultConfig},"set":function t(R){e.defaultConfig=R}}]),e}();V.defaultConfig=void 0},"./src/is-supported.ts":function _src_isSupportedTs(R,_,I){I.r(_),I.d(_,"isSupported",(function(){return n})),I.d(_,"changeTypeSupported",(function(){return s}));var C=I("./src/utils/mediasource-helper.ts");function a(){return self.SourceBuffer||self.WebKitSourceBuffer}function n(){var R=Object(C.getMediaSource)();if(!R)return!1;var _=a(),I=R&&"function"==typeof R.isTypeSupported&&R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),w=!_||_.prototype&&"function"==typeof _.prototype.appendBuffer&&"function"==typeof _.prototype.remove;return!!I&&!!w}function s(){var R,_=a();return"function"==typeof(null==_||null===(R=_.prototype)||void 0===R?void 0:R.changeType)}},"./src/loader/fragment-loader.ts":function _src_loader_fragmentLoaderTs(R,_,I){I.r(_),I.d(_,"default",(function(){return x})),I.d(_,"LoadError",(function(){return P}));var C=I("./src/polyfills/number.ts"),w=I("./src/errors.ts");function s(R){var _="function"==typeof Map?new Map:void 0;return s=function e(R){if(null===R||!function u(R){return-1!==Function.toString.call(R).indexOf("[native code]")}(R))return R;if("function"!=typeof R)throw new TypeError("Super expression must either be null or a function");if(void 0!==_){if(_.has(R))return _.get(R);_.set(R,i)}function i(){return o(R,arguments,c(this).constructor)}return i.prototype=Object.create(R.prototype,{"constructor":{"value":i,"enumerable":!1,"writable":!0,"configurable":!0}}),f(i,R)},s(R)}function o(R,_,I){return o=function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(R){return!1}}()?Reflect.construct:function e(R,_,I){var C=[null];C.push.apply(C,_);var w=new(Function.bind.apply(R,C));return I&&f(w,I.prototype),w},o.apply(null,arguments)}function f(R,_){return f=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},f(R,_)}function c(R){return c=Object.setPrototypeOf?Object.getPrototypeOf:function e(R){return R.__proto__||Object.getPrototypeOf(R)},c(R)}var O=Math.pow(2,17),x=function(){function e(R){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=R}var R=e.prototype;return R.destroy=function e(){this.loader&&(this.loader.destroy(),this.loader=null)},R.abort=function e(){this.loader&&this.loader.abort()},R.load=function e(R,_){var I=this,C=R.url;if(!C)return Promise.reject(new P({"type":w.ErrorTypes.NETWORK_ERROR,"details":w.ErrorDetails.FRAG_LOAD_ERROR,"fatal":!1,"frag":R,"networkDetails":null},"Fragment does not have a "+(C?"part list":"url")));this.abort();var x=this.config,F=x.fLoader,M=x.loader;return new Promise((function(C,N){I.loader&&I.loader.destroy();var B=I.loader=R.loader=F?new F(x):new M(x),U=v(R),G={"timeout":x.fragLoadingTimeOut,"maxRetry":0,"retryDelay":0,"maxRetryDelay":x.fragLoadingMaxRetryTimeout,"highWaterMark":O};R.stats=B.stats,B.load(U,G,{"onSuccess":function r(_,w,O,x){I.resetLoader(R,B),C({"frag":R,"part":null,"payload":_.data,"networkDetails":x})},"onError":function e(_,C,O){I.resetLoader(R,B),N(new P({"type":w.ErrorTypes.NETWORK_ERROR,"details":w.ErrorDetails.FRAG_LOAD_ERROR,"fatal":!1,"frag":R,"response":_,"networkDetails":O}))},"onAbort":function e(_,C,O){I.resetLoader(R,B),N(new P({"type":w.ErrorTypes.NETWORK_ERROR,"details":w.ErrorDetails.INTERNAL_ABORTED,"fatal":!1,"frag":R,"networkDetails":O}))},"onTimeout":function e(_,C,O){I.resetLoader(R,B),N(new P({"type":w.ErrorTypes.NETWORK_ERROR,"details":w.ErrorDetails.FRAG_LOAD_TIMEOUT,"fatal":!1,"frag":R,"networkDetails":O}))},"onProgress":function e(I,C,w,O){_&&_({"frag":R,"part":null,"payload":w,"networkDetails":O})}})}))},R.loadPart=function e(R,_,I){var C=this;this.abort();var x=this.config,F=x.fLoader,M=x.loader;return new Promise((function(N,B){C.loader&&C.loader.destroy();var U=C.loader=R.loader=F?new F(x):new M(x),G=v(R,_),j={"timeout":x.fragLoadingTimeOut,"maxRetry":0,"retryDelay":0,"maxRetryDelay":x.fragLoadingMaxRetryTimeout,"highWaterMark":O};_.stats=U.stats,U.load(G,j,{"onSuccess":function a(w,O,x,P){C.resetLoader(R,U),C.updateStatsFromPart(R,_);var F={"frag":R,"part":_,"payload":w.data,"networkDetails":P};I(F),N(F)},"onError":function e(I,O,x){C.resetLoader(R,U),B(new P({"type":w.ErrorTypes.NETWORK_ERROR,"details":w.ErrorDetails.FRAG_LOAD_ERROR,"fatal":!1,"frag":R,"part":_,"response":I,"networkDetails":x}))},"onAbort":function e(I,O,x){R.stats.aborted=_.stats.aborted,C.resetLoader(R,U),B(new P({"type":w.ErrorTypes.NETWORK_ERROR,"details":w.ErrorDetails.INTERNAL_ABORTED,"fatal":!1,"frag":R,"part":_,"networkDetails":x}))},"onTimeout":function e(I,O,x){C.resetLoader(R,U),B(new P({"type":w.ErrorTypes.NETWORK_ERROR,"details":w.ErrorDetails.FRAG_LOAD_TIMEOUT,"fatal":!1,"frag":R,"part":_,"networkDetails":x}))}})}))},R.updateStatsFromPart=function e(R,_){var I=R.stats,C=_.stats,w=C.total;if(I.loaded+=C.loaded,w){var O=Math.round(R.duration/_.duration),x=Math.min(Math.round(I.loaded/w),O),P=(O-x)*Math.round(I.loaded/x);I.total=I.loaded+P}else I.total=Math.max(I.loaded,I.total);var F=I.loading,M=C.loading;F.start?F.first+=M.first-M.start:(F.start=M.start,F.first=M.first),F.end=M.end},R.resetLoader=function e(R,_){R.loader=null,this.loader===_&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),_.destroy()},e}();function v(R,_){void 0===_&&(_=null);var I=_||R,w={"frag":R,"part":_,"responseType":"arraybuffer","url":I.url,"headers":{},"rangeStart":0,"rangeEnd":0},O=I.byteRangeStartOffset,x=I.byteRangeEndOffset;return Object(C.isFiniteNumber)(O)&&Object(C.isFiniteNumber)(x)&&(w.rangeStart=O,w.rangeEnd=x),w}var P=function(R){function t(_){for(var I,C=arguments.length,w=new Array(C>1?C-1:0),O=1;O<C;O++)w[O-1]=arguments[O];return(I=R.call.apply(R,[this].concat(w))||this).data=void 0,I.data=_,I}return function n(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,f(R,_)}(t,R),t}(s(Error))},"./src/loader/fragment.ts":function _src_loader_fragmentTs(R,_,I){I.r(_),I.d(_,"ElementaryStreamTypes",(function(){return C})),I.d(_,"BaseSegment",(function(){return M})),I.d(_,"Fragment",(function(){return N})),I.d(_,"Part",(function(){return B}));var C,w=I("./src/polyfills/number.ts"),O=I("./node_modules/url-toolkit/src/url-toolkit.js"),x=I("./src/utils/logger.ts"),P=I("./src/loader/level-key.ts"),F=I("./src/loader/load-stats.ts");function l(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,u(R,_)}function u(R,_){return u=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},u(R,_)}function f(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}function c(R,_,I){return _&&f(R.prototype,_),I&&f(R,I),R}!function(R){R.AUDIO="audio",R.VIDEO="video",R.AUDIOVIDEO="audiovideo"}(C||(C={}));var M=function(){function e(R){var _;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((_={})[C.AUDIO]=null,_[C.VIDEO]=null,_[C.AUDIOVIDEO]=null,_),this.baseurl=R}return e.prototype.setByteRange=function e(R,_){var I=R.split("@",2),C=[];1===I.length?C[0]=_?_.byteRangeEndOffset:0:C[0]=parseInt(I[1]),C[1]=parseInt(I[0])+C[0],this._byteRange=C},c(e,[{"key":"byteRange","get":function e(){return this._byteRange?this._byteRange:[]}},{"key":"byteRangeStartOffset","get":function e(){return this.byteRange[0]}},{"key":"byteRangeEndOffset","get":function e(){return this.byteRange[1]}},{"key":"url","get":function e(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(O.buildAbsoluteURL)(this.baseurl,this.relurl,{"alwaysNormalize":!0})),this._url||""},"set":function e(R){this._url=R}}]),e}(),N=function(R){function t(_,I){var C;return(C=R.call(this,I)||this)._decryptdata=null,C.rawProgramDateTime=null,C.programDateTime=null,C.tagList=[],C.duration=0,C.sn=0,C.levelkey=void 0,C.type=void 0,C.loader=null,C.level=-1,C.cc=0,C.startPTS=void 0,C.endPTS=void 0,C.appendedPTS=void 0,C.startDTS=void 0,C.endDTS=void 0,C.start=0,C.deltaPTS=void 0,C.maxStartPTS=void 0,C.minEndPTS=void 0,C.stats=new F.LoadStats,C.urlId=0,C.data=void 0,C.bitrateTest=!1,C.title=null,C.initSegment=null,C.type=_,C}l(t,R);var _=t.prototype;return _.createInitializationVector=function e(R){for(var _=new Uint8Array(16),I=12;I<16;I++)_[I]=R>>8*(15-I)&255;return _},_.setDecryptDataFromLevelKey=function e(R,_){var I=R;return"AES-128"===(null==R?void 0:R.method)&&R.uri&&!R.iv&&((I=P.LevelKey.fromURI(R.uri)).method=R.method,I.iv=this.createInitializationVector(_),I.keyFormat="identity"),I},_.setElementaryStreamInfo=function e(R,_,I,C,w,O){void 0===O&&(O=!1);var x=this.elementaryStreams,P=x[R];P?(P.startPTS=Math.min(P.startPTS,_),P.endPTS=Math.max(P.endPTS,I),P.startDTS=Math.min(P.startDTS,C),P.endDTS=Math.max(P.endDTS,w)):x[R]={"startPTS":_,"endPTS":I,"startDTS":C,"endDTS":w,"partial":O}},_.clearElementaryStreamInfo=function e(){var R=this.elementaryStreams;R[C.AUDIO]=null,R[C.VIDEO]=null,R[C.AUDIOVIDEO]=null},c(t,[{"key":"decryptdata","get":function e(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var R=this.sn;"number"!=typeof R&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&x.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),R=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,R)}return this._decryptdata}},{"key":"end","get":function e(){return this.start+this.duration}},{"key":"endProgramDateTime","get":function e(){if(null===this.programDateTime)return null;if(!Object(w.isFiniteNumber)(this.programDateTime))return null;var R=Object(w.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*R}},{"key":"encrypted","get":function e(){var R;return!(null===(R=this.decryptdata)||void 0===R||!R.keyFormat||!this.decryptdata.uri)}}]),t}(M),B=function(R){function t(_,I,C,w,O){var x;(x=R.call(this,C)||this).fragOffset=0,x.duration=0,x.gap=!1,x.independent=!1,x.relurl=void 0,x.fragment=void 0,x.index=void 0,x.stats=new F.LoadStats,x.duration=_.decimalFloatingPoint("DURATION"),x.gap=_.bool("GAP"),x.independent=_.bool("INDEPENDENT"),x.relurl=_.enumeratedString("URI"),x.fragment=I,x.index=w;var P=_.enumeratedString("BYTERANGE");return P&&x.setByteRange(P,O),O&&(x.fragOffset=O.fragOffset+O.duration),x}return l(t,R),c(t,[{"key":"start","get":function e(){return this.fragment.start+this.fragOffset}},{"key":"end","get":function e(){return this.start+this.duration}},{"key":"loaded","get":function e(){var R=this.elementaryStreams;return!!(R.audio||R.video||R.audiovideo)}}]),t}(M)},"./src/loader/key-loader.ts":function _src_loader_keyLoaderTs(R,_,I){I.r(_),I.d(_,"default",(function(){return x}));var C=I("./src/events.ts"),w=I("./src/errors.ts"),O=I("./src/utils/logger.ts"),x=function(){function e(R){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=R,this._registerListeners()}var R=e.prototype;return R._registerListeners=function e(){this.hls.on(C.Events.KEY_LOADING,this.onKeyLoading,this)},R._unregisterListeners=function e(){this.hls.off(C.Events.KEY_LOADING,this.onKeyLoading)},R.destroy=function e(){for(var R in this._unregisterListeners(),this.loaders){var _=this.loaders[R];_&&_.destroy()}this.loaders={}},R.onKeyLoading=function e(R,_){var I=_.frag,w=I.type,x=this.loaders[w];if(I.decryptdata){var P=I.decryptdata.uri;if(P!==this.decrypturl||null===this.decryptkey){var F=this.hls.config;if(x&&(O.logger.warn("abort previous key loader for type:"+w),x.abort()),!P)return void O.logger.warn("key uri is falsy");var M=F.loader,N=I.loader=this.loaders[w]=new M(F);this.decrypturl=P,this.decryptkey=null;var B={"url":P,"frag":I,"responseType":"arraybuffer"},U={"timeout":F.fragLoadingTimeOut,"maxRetry":0,"retryDelay":F.fragLoadingRetryDelay,"maxRetryDelay":F.fragLoadingMaxRetryTimeout,"highWaterMark":0},G={"onSuccess":this.loadsuccess.bind(this),"onError":this.loaderror.bind(this),"onTimeout":this.loadtimeout.bind(this)};N.load(B,U,G)}else this.decryptkey&&(I.decryptdata.key=this.decryptkey,this.hls.trigger(C.Events.KEY_LOADED,{"frag":I}))}else O.logger.warn("Missing decryption data on fragment in onKeyLoading")},R.loadsuccess=function e(R,_,I){var w=I.frag;w.decryptdata?(this.decryptkey=w.decryptdata.key=new Uint8Array(R.data),w.loader=null,delete this.loaders[w.type],this.hls.trigger(C.Events.KEY_LOADED,{"frag":w})):O.logger.error("after key load, decryptdata unset")},R.loaderror=function e(R,_){var I=_.frag,O=I.loader;O&&O.abort(),delete this.loaders[I.type],this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.NETWORK_ERROR,"details":w.ErrorDetails.KEY_LOAD_ERROR,"fatal":!1,"frag":I,"response":R})},R.loadtimeout=function e(R,_){var I=_.frag,O=I.loader;O&&O.abort(),delete this.loaders[I.type],this.hls.trigger(C.Events.ERROR,{"type":w.ErrorTypes.NETWORK_ERROR,"details":w.ErrorDetails.KEY_LOAD_TIMEOUT,"fatal":!1,"frag":I})},e}()},"./src/loader/level-details.ts":function _src_loader_levelDetailsTs(R,_,I){I.r(_),I.d(_,"LevelDetails",(function(){return w}));var C=I("./src/polyfills/number.ts");function a(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}var w=function(){function e(R){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=R}return e.prototype.reloaded=function e(R){if(!R)return this.advanced=!0,void(this.updated=!0);var _=this.lastPartSn-R.lastPartSn,I=this.lastPartIndex-R.lastPartIndex;this.updated=this.endSN!==R.endSN||!!I||!!_,this.advanced=this.endSN>R.endSN||_>0||0===_&&I>0,this.updated||this.advanced?this.misses=Math.floor(.6*R.misses):this.misses=R.misses+1,this.availabilityDelay=R.availabilityDelay},function n(R,_,I){return _&&a(R.prototype,_),I&&a(R,I),R}(e,[{"key":"hasProgramDateTime","get":function e(){return!!this.fragments.length&&Object(C.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{"key":"levelTargetDuration","get":function e(){return this.averagetargetduration||this.targetduration||10}},{"key":"drift","get":function e(){var R=this.driftEndTime-this.driftStartTime;return R>0?1e3*(this.driftEnd-this.driftStart)/R:1}},{"key":"edge","get":function e(){return this.partEnd||this.fragmentEnd}},{"key":"partEnd","get":function e(){var R;return null!==(R=this.partList)&&void 0!==R&&R.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{"key":"fragmentEnd","get":function e(){var R;return null!==(R=this.fragments)&&void 0!==R&&R.length?this.fragments[this.fragments.length-1].end:0}},{"key":"age","get":function e(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{"key":"lastPartIndex","get":function e(){var R;return null!==(R=this.partList)&&void 0!==R&&R.length?this.partList[this.partList.length-1].index:-1}},{"key":"lastPartSn","get":function e(){var R;return null!==(R=this.partList)&&void 0!==R&&R.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}()},"./src/loader/level-key.ts":function _src_loader_levelKeyTs(R,_,I){I.r(_),I.d(_,"LevelKey",(function(){return w}));var C=I("./node_modules/url-toolkit/src/url-toolkit.js");function a(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}var w=function(){function e(R,_){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=_?Object(C.buildAbsoluteURL)(R,_,{"alwaysNormalize":!0}):R}return e.fromURL=function t(R,_){return new e(R,_)},e.fromURI=function t(R){return new e(R)},function n(R,_,I){return _&&a(R.prototype,_),I&&a(R,I),R}(e,[{"key":"uri","get":function e(){return this._uri}}]),e}()},"./src/loader/load-stats.ts":function _src_loader_loadStatsTs(R,_,I){I.r(_),I.d(_,"LoadStats",(function(){return C}));var C=function e(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={"start":0,"first":0,"end":0},this.parsing={"start":0,"end":0},this.buffering={"start":0,"first":0,"end":0}}},"./src/loader/m3u8-parser.ts":function _src_loader_m3u8ParserTs(R,_,I){I.r(_),I.d(_,"default",(function(){return H}));var C=I("./src/polyfills/number.ts"),w=I("./node_modules/url-toolkit/src/url-toolkit.js"),O=I("./src/loader/fragment.ts"),x=I("./src/loader/level-details.ts"),P=I("./src/loader/level-key.ts"),F=I("./src/utils/attr-list.ts"),M=I("./src/utils/logger.ts"),N=I("./src/utils/codecs.ts"),B=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,U=/#EXT-X-MEDIA:(.*)/g,G=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),j=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),K=/\.(mp4|m4s|m4v|m4a)$/i;function p(R){var _,I;return K.test(null!=(_=null===(I=w.parseURL(R))||void 0===I?void 0:I.path)?_:"")}var H=function(){function e(){}return e.findGroup=function e(R,_){for(var I=0;I<R.length;I++){var C=R[I];if(C.id===_)return C}},e.convertAVC1ToAVCOTI=function e(R){var _=R.split(".");if(_.length>2){var I=_.shift()+".";return I+=parseInt(_.shift()).toString(16),I+=("000"+parseInt(_.shift()).toString(16)).substr(-4)}return R},e.resolve=function e(R,_){return w.buildAbsoluteURL(_,R,{"alwaysNormalize":!0})},e.parseMasterPlaylist=function t(R,_){var I,C=[],w={},O=!1;for(B.lastIndex=0;null!=(I=B.exec(R));)if(I[1]){var x=new F.AttrList(I[1]),P={"attrs":x,"bitrate":x.decimalInteger("AVERAGE-BANDWIDTH")||x.decimalInteger("BANDWIDTH"),"name":x.NAME,"url":e.resolve(I[2],_)},M=x.decimalResolution("RESOLUTION");M&&(P.width=M.width,P.height=M.height),y((x.CODECS||"").split(/[ ,]+/).filter((function(R){return R})),P),P.videoCodec&&-1!==P.videoCodec.indexOf("avc1")&&(P.videoCodec=e.convertAVC1ToAVCOTI(P.videoCodec)),C.push(P)}else if(I[3]){var N=new F.AttrList(I[3]);N["DATA-ID"]&&(O=!0,w[N["DATA-ID"]]=N)}return{"levels":C,"sessionData":O?w:null}},e.parseMasterPlaylistMedia=function t(R,_,I,C){var w;void 0===C&&(C=[]);var O=[],x=0;for(U.lastIndex=0;null!==(w=U.exec(R));){var P=new F.AttrList(w[1]);if(P.TYPE===I){var M={"attrs":P,"bitrate":0,"id":x++,"groupId":P["GROUP-ID"],"instreamId":P["INSTREAM-ID"],"name":P.NAME||P.LANGUAGE||"","type":I,"default":P.bool("DEFAULT"),"autoselect":P.bool("AUTOSELECT"),"forced":P.bool("FORCED"),"lang":P.LANGUAGE,"url":P.URI?e.resolve(P.URI,_):""};if(C.length){var N=e.findGroup(C,M.groupId)||C[0];E(M,N,"audioCodec"),E(M,N,"textCodec")}O.push(M)}}return O},e.parseLevelPlaylist=function e(R,_,I,w,N){var B,U,K,H=new x.LevelDetails(_),V=H.fragments,W=null,Y=0,z=0,X=0,q=0,Z=null,Q=new O.Fragment(w,_),J=-1,$=!1;for(G.lastIndex=0,H.m3u8=R;null!==(B=G.exec(R));){$&&($=!1,(Q=new O.Fragment(w,_)).start=X,Q.sn=Y,Q.cc=q,Q.level=I,W&&(Q.initSegment=W,Q.rawProgramDateTime=W.rawProgramDateTime));var ee=B[1];if(ee){Q.duration=parseFloat(ee);var te=(" "+B[2]).slice(1);Q.title=te||null,Q.tagList.push(te?["INF",ee,te]:["INF",ee])}else if(B[3])Object(C.isFiniteNumber)(Q.duration)&&(Q.start=X,K&&(Q.levelkey=K),Q.sn=Y,Q.level=I,Q.cc=q,Q.urlId=N,V.push(Q),Q.relurl=(" "+B[3]).slice(1),b(Q,Z),Z=Q,X+=Q.duration,Y++,z=0,$=!0);else if(B[4]){var re=(" "+B[4]).slice(1);Z?Q.setByteRange(re,Z):Q.setByteRange(re)}else if(B[5])Q.rawProgramDateTime=(" "+B[5]).slice(1),Q.tagList.push(["PROGRAM-DATE-TIME",Q.rawProgramDateTime]),-1===J&&(J=V.length);else{if(!(B=B[0].match(j))){M.logger.warn("No matches on slow regex match for level playlist!");continue}for(U=1;U<B.length&&void 0===B[U];U++);var ie=(" "+B[U]).slice(1),ne=(" "+B[U+1]).slice(1),se=B[U+2]?(" "+B[U+2]).slice(1):"";switch(ie){case"PLAYLIST-TYPE":H.type=ne.toUpperCase();break;case"MEDIA-SEQUENCE":Y=H.startSN=parseInt(ne);break;case"SKIP":var ae=new F.AttrList(ne),oe=ae.decimalInteger("SKIPPED-SEGMENTS");if(Object(C.isFiniteNumber)(oe)){H.skippedSegments=oe;for(var le=oe;le--;)V.unshift(null);Y+=oe}var ue=ae.enumeratedString("RECENTLY-REMOVED-DATERANGES");ue&&(H.recentlyRemovedDateranges=ue.split("\t"));break;case"TARGETDURATION":H.targetduration=parseFloat(ne);break;case"VERSION":H.version=parseInt(ne);break;case"EXTM3U":break;case"ENDLIST":H.live=!1;break;case"#":(ne||se)&&Q.tagList.push(se?[ne,se]:[ne]);break;case"DIS":q++;case"GAP":Q.tagList.push([ie]);break;case"BITRATE":Q.tagList.push([ie,ne]);break;case"DISCONTINUITY-SEQ":q=parseInt(ne);break;case"KEY":var ce,de=new F.AttrList(ne),he=de.enumeratedString("METHOD"),fe=de.URI,ge=de.hexadecimalInteger("IV"),ve=de.enumeratedString("KEYFORMATVERSIONS"),pe=de.enumeratedString("KEYID"),me=null!=(ce=de.enumeratedString("KEYFORMAT"))?ce:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(me)>-1){M.logger.warn("Keyformat "+me+" is not supported from the manifest");continue}if("identity"!==me)continue;he&&(K=P.LevelKey.fromURL(_,fe),fe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(he)>=0&&(K.method=he,K.keyFormat=me,pe&&(K.keyID=pe),ve&&(K.keyFormatVersions=ve),K.iv=ge));break;case"START":var ye=new F.AttrList(ne).decimalFloatingPoint("TIME-OFFSET");Object(C.isFiniteNumber)(ye)&&(H.startTimeOffset=ye);break;case"MAP":var Ee=new F.AttrList(ne);Q.relurl=Ee.URI,Ee.BYTERANGE&&Q.setByteRange(Ee.BYTERANGE),Q.level=I,Q.sn="initSegment",K&&(Q.levelkey=K),Q.initSegment=null,W=Q,$=!0;break;case"SERVER-CONTROL":var Te=new F.AttrList(ne);H.canBlockReload=Te.bool("CAN-BLOCK-RELOAD"),H.canSkipUntil=Te.optionalFloat("CAN-SKIP-UNTIL",0),H.canSkipDateRanges=H.canSkipUntil>0&&Te.bool("CAN-SKIP-DATERANGES"),H.partHoldBack=Te.optionalFloat("PART-HOLD-BACK",0),H.holdBack=Te.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var be=new F.AttrList(ne);H.partTarget=be.decimalFloatingPoint("PART-TARGET");break;case"PART":var Se=H.partList;Se||(Se=H.partList=[]);var Ae=z>0?Se[Se.length-1]:void 0,Le=z++,De=new O.Part(new F.AttrList(ne),Q,_,Le,Ae);Se.push(De),Q.duration+=De.duration;break;case"PRELOAD-HINT":var Re=new F.AttrList(ne);H.preloadHint=Re;break;case"RENDITION-REPORT":var ke=new F.AttrList(ne);H.renditionReports=H.renditionReports||[],H.renditionReports.push(ke);break;default:M.logger.warn("line parsed but not handled: "+B)}}}Z&&!Z.relurl?(V.pop(),X-=Z.duration,H.partList&&(H.fragmentHint=Z)):H.partList&&(b(Q,Z),Q.cc=q,H.fragmentHint=Q);var _e=V.length,Ie=V[0],Ce=V[_e-1];if((X+=H.skippedSegments*H.targetduration)>0&&_e&&Ce){H.averagetargetduration=X/_e;var we=Ce.sn;H.endSN="initSegment"!==we?we:0,Ie&&(H.startCC=Ie.cc,Ie.initSegment||H.fragments.every((function(R){return R.relurl&&p(R.relurl)}))&&(M.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(Q=new O.Fragment(w,_)).relurl=Ce.relurl,Q.level=I,Q.sn="initSegment",Ie.initSegment=Q,H.needSidxRanges=!0))}else H.endSN=0,H.startCC=0;return H.fragmentHint&&(X+=H.fragmentHint.duration),H.totalduration=X,H.endCC=q,J>0&&function T(R,_){for(var I=R[_],C=_;C--;){var w=R[C];if(!w)return;w.programDateTime=I.programDateTime-1e3*w.duration,I=w}}(V,J),H},e}();function y(R,_){["video","audio","text"].forEach((function(I){var C=R.filter((function(R){return Object(N.isCodecType)(R,I)}));if(C.length){var w=C.filter((function(R){return 0===R.lastIndexOf("avc1",0)||0===R.lastIndexOf("mp4a",0)}));_[I+"Codec"]=w.length>0?w[0]:C[0],R=R.filter((function(R){return-1===C.indexOf(R)}))}})),_.unknownCodecs=R}function E(R,_,I){var C=_[I];C&&(R[I]=C)}function b(R,_){R.rawProgramDateTime?R.programDateTime=Date.parse(R.rawProgramDateTime):null!=_&&_.programDateTime&&(R.programDateTime=_.endProgramDateTime),Object(C.isFiniteNumber)(R.programDateTime)||(R.programDateTime=null,R.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function _src_loader_playlistLoaderTs(R,_,I){I.r(_);var C=I("./src/polyfills/number.ts"),w=I("./src/events.ts"),O=I("./src/errors.ts"),x=I("./src/utils/logger.ts"),P=I("./src/utils/mp4-tools.ts"),F=I("./src/loader/m3u8-parser.ts"),M=I("./src/types/loader.ts"),N=I("./src/utils/attr-list.ts");function d(R,_){var I=R.url;return void 0!==I&&0!==I.indexOf("data:")||(I=_.url),I}var B=function(){function e(R){this.hls=void 0,this.loaders=Object.create(null),this.hls=R,this.registerListeners()}var R=e.prototype;return R.registerListeners=function e(){var R=this.hls;R.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(w.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(w.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),R.on(w.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(w.Events.LEVEL_LOADING,this.onLevelLoading,this),R.off(w.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),R.off(w.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},R.createInternalLoader=function e(R){var _=this.hls.config,I=_.pLoader,C=_.loader,w=new(I||C)(_);return R.loader=w,this.loaders[R.type]=w,w},R.getInternalLoader=function e(R){return this.loaders[R.type]},R.resetInternalLoader=function e(R){this.loaders[R]&&delete this.loaders[R]},R.destroyInternalLoaders=function e(){for(var R in this.loaders){var _=this.loaders[R];_&&_.destroy(),this.resetInternalLoader(R)}},R.destroy=function e(){this.unregisterListeners(),this.destroyInternalLoaders()},R.onManifestLoading=function e(R,_){var I=_.url;this.load({"id":null,"groupId":null,"level":0,"responseType":"text","type":M.PlaylistContextType.MANIFEST,"url":I,"deliveryDirectives":null})},R.onLevelLoading=function e(R,_){var I=_.id,C=_.level,w=_.url,O=_.deliveryDirectives;this.load({"id":I,"groupId":null,"level":C,"responseType":"text","type":M.PlaylistContextType.LEVEL,"url":w,"deliveryDirectives":O})},R.onAudioTrackLoading=function e(R,_){var I=_.id,C=_.groupId,w=_.url,O=_.deliveryDirectives;this.load({"id":I,"groupId":C,"level":null,"responseType":"text","type":M.PlaylistContextType.AUDIO_TRACK,"url":w,"deliveryDirectives":O})},R.onSubtitleTrackLoading=function e(R,_){var I=_.id,C=_.groupId,w=_.url,O=_.deliveryDirectives;this.load({"id":I,"groupId":C,"level":null,"responseType":"text","type":M.PlaylistContextType.SUBTITLE_TRACK,"url":w,"deliveryDirectives":O})},R.load=function e(R){var _,I,C,w,O,P,F=this.hls.config,N=this.getInternalLoader(R);if(N){var B=N.context;if(B&&B.url===R.url)return void x.logger.trace("[playlist-loader]: playlist request ongoing");x.logger.log("[playlist-loader]: aborting previous loader for type: "+R.type),N.abort()}switch(R.type){case M.PlaylistContextType.MANIFEST:I=F.manifestLoadingMaxRetry,C=F.manifestLoadingTimeOut,w=F.manifestLoadingRetryDelay,O=F.manifestLoadingMaxRetryTimeout;break;case M.PlaylistContextType.LEVEL:case M.PlaylistContextType.AUDIO_TRACK:case M.PlaylistContextType.SUBTITLE_TRACK:I=0,C=F.levelLoadingTimeOut;break;default:I=F.levelLoadingMaxRetry,C=F.levelLoadingTimeOut,w=F.levelLoadingRetryDelay,O=F.levelLoadingMaxRetryTimeout}if((N=this.createInternalLoader(R),null!==(_=R.deliveryDirectives)&&void 0!==_&&_.part)&&(R.type===M.PlaylistContextType.LEVEL&&null!==R.level?P=this.hls.levels[R.level].details:R.type===M.PlaylistContextType.AUDIO_TRACK&&null!==R.id?P=this.hls.audioTracks[R.id].details:R.type===M.PlaylistContextType.SUBTITLE_TRACK&&null!==R.id&&(P=this.hls.subtitleTracks[R.id].details),P)){var U=P.partTarget,G=P.targetduration;U&&G&&(C=Math.min(1e3*Math.max(3*U,.8*G),C))}var j={"timeout":C,"maxRetry":I,"retryDelay":w,"maxRetryDelay":O,"highWaterMark":0},K={"onSuccess":this.loadsuccess.bind(this),"onError":this.loaderror.bind(this),"onTimeout":this.loadtimeout.bind(this)};N.load(R,j,K)},R.loadsuccess=function e(R,_,I,C){if(void 0===C&&(C=null),I.isSidxRequest)return this.handleSidxRequest(R,I),void this.handlePlaylistLoaded(R,_,I,C);this.resetInternalLoader(I.type);var w=R.data;0===w.indexOf("#EXTM3U")?(_.parsing.start=performance.now(),w.indexOf("#EXTINF:")>0||w.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(R,_,I,C):this.handleMasterPlaylist(R,_,I,C)):this.handleManifestParsingError(R,I,"no EXTM3U delimiter",C)},R.loaderror=function e(R,_,I){void 0===I&&(I=null),this.handleNetworkError(_,I,!1,R)},R.loadtimeout=function e(R,_,I){void 0===I&&(I=null),this.handleNetworkError(_,I,!0)},R.handleMasterPlaylist=function e(R,_,I,C){var O=this.hls,P=R.data,M=d(R,I),B=F.default.parseMasterPlaylist(P,M),U=B.levels,G=B.sessionData;if(U.length){var j=U.map((function(R){return{"id":R.attrs.AUDIO,"audioCodec":R.audioCodec}})),K=U.map((function(R){return{"id":R.attrs.SUBTITLES,"textCodec":R.textCodec}})),H=F.default.parseMasterPlaylistMedia(P,M,"AUDIO",j),V=F.default.parseMasterPlaylistMedia(P,M,"SUBTITLES",K),W=F.default.parseMasterPlaylistMedia(P,M,"CLOSED-CAPTIONS");if(H.length){var Y=H.some((function(R){return!R.url}));Y||!U[0].audioCodec||U[0].attrs.AUDIO||(x.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),H.unshift({"type":"main","name":"main","default":!1,"autoselect":!1,"forced":!1,"id":-1,"attrs":new N.AttrList({}),"bitrate":0,"url":""}))}O.trigger(w.Events.MANIFEST_LOADED,{"levels":U,"audioTracks":H,"subtitles":V,"captions":W,"url":M,"stats":_,"networkDetails":C,"sessionData":G})}else this.handleManifestParsingError(R,I,"no level found in manifest",C)},R.handleTrackOrLevelPlaylist=function e(R,_,I,x){var P=this.hls,B=I.id,U=I.level,G=I.type,j=d(R,I),K=Object(C.isFiniteNumber)(B)?B:0,H=Object(C.isFiniteNumber)(U)?U:K,V=function c(R){switch(R.type){case M.PlaylistContextType.AUDIO_TRACK:return M.PlaylistLevelType.AUDIO;case M.PlaylistContextType.SUBTITLE_TRACK:return M.PlaylistLevelType.SUBTITLE;default:return M.PlaylistLevelType.MAIN}}(I),W=F.default.parseLevelPlaylist(R.data,j,H,V,K);if(W.fragments.length){if(G===M.PlaylistContextType.MANIFEST){var Y={"attrs":new N.AttrList({}),"bitrate":0,"details":W,"name":"","url":j};P.trigger(w.Events.MANIFEST_LOADED,{"levels":[Y],"audioTracks":[],"url":j,"stats":_,"networkDetails":x,"sessionData":null})}if(_.parsing.end=performance.now(),W.needSidxRanges){var z,X=null===(z=W.fragments[0].initSegment)||void 0===z?void 0:z.url;this.load({"url":X,"isSidxRequest":!0,"type":G,"level":U,"levelDetails":W,"id":B,"groupId":null,"rangeStart":0,"rangeEnd":2048,"responseType":"arraybuffer","deliveryDirectives":null})}else I.levelDetails=W,this.handlePlaylistLoaded(R,_,I,x)}else P.trigger(w.Events.ERROR,{"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.LEVEL_EMPTY_ERROR,"fatal":!1,"url":j,"reason":"no fragments found in level","level":"number"==typeof I.level?I.level:void 0})},R.handleSidxRequest=function e(R,_){var I=Object(P.parseSegmentIndex)(new Uint8Array(R.data));if(I){var C=I.references,w=_.levelDetails;C.forEach((function(R,_){var C=R.info,O=w.fragments[_];0===O.byteRange.length&&O.setByteRange(String(1+C.end-C.start)+"@"+String(C.start)),O.initSegment&&O.initSegment.setByteRange(String(I.moovEndOffset)+"@0")}))}},R.handleManifestParsingError=function e(R,_,I,C){this.hls.trigger(w.Events.ERROR,{"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.MANIFEST_PARSING_ERROR,"fatal":_.type===M.PlaylistContextType.MANIFEST,"url":R.url,"reason":I,"response":R,"context":_,"networkDetails":C})},R.handleNetworkError=function e(R,_,I,C){void 0===I&&(I=!1),x.logger.warn("[playlist-loader]: A network "+(I?"timeout":"error")+" occurred while loading "+R.type+" level: "+R.level+" id: "+R.id+' group-id: "'+R.groupId+'"');var P=O.ErrorDetails.UNKNOWN,F=!1,N=this.getInternalLoader(R);switch(R.type){case M.PlaylistContextType.MANIFEST:P=I?O.ErrorDetails.MANIFEST_LOAD_TIMEOUT:O.ErrorDetails.MANIFEST_LOAD_ERROR,F=!0;break;case M.PlaylistContextType.LEVEL:P=I?O.ErrorDetails.LEVEL_LOAD_TIMEOUT:O.ErrorDetails.LEVEL_LOAD_ERROR,F=!1;break;case M.PlaylistContextType.AUDIO_TRACK:P=I?O.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,F=!1;break;case M.PlaylistContextType.SUBTITLE_TRACK:P=I?O.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:O.ErrorDetails.SUBTITLE_LOAD_ERROR,F=!1}N&&this.resetInternalLoader(R.type);var B={"type":O.ErrorTypes.NETWORK_ERROR,"details":P,"fatal":F,"url":R.url,"loader":N,"context":R,"networkDetails":_};C&&(B.response=C),this.hls.trigger(w.Events.ERROR,B)},R.handlePlaylistLoaded=function e(R,_,I,C){var O=I.type,x=I.level,P=I.id,F=I.groupId,N=I.loader,B=I.levelDetails,U=I.deliveryDirectives;if(null!=B&&B.targetduration){if(N)switch(B.live&&(N.getCacheAge&&(B.ageHeader=N.getCacheAge()||0),N.getCacheAge&&!isNaN(B.ageHeader)||(B.ageHeader=0)),O){case M.PlaylistContextType.MANIFEST:case M.PlaylistContextType.LEVEL:this.hls.trigger(w.Events.LEVEL_LOADED,{"details":B,"level":x||0,"id":P||0,"stats":_,"networkDetails":C,"deliveryDirectives":U});break;case M.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(w.Events.AUDIO_TRACK_LOADED,{"details":B,"id":P||0,"groupId":F||"","stats":_,"networkDetails":C,"deliveryDirectives":U});break;case M.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(w.Events.SUBTITLE_TRACK_LOADED,{"details":B,"id":P||0,"groupId":F||"","stats":_,"networkDetails":C,"deliveryDirectives":U})}}else this.handleManifestParsingError(R,I,"invalid target duration",C)},e}();_.default=B},"./src/polyfills/number.ts":function _src_polyfills_numberTs(R,_,I){I.r(_),I.d(_,"isFiniteNumber",(function(){return C})),I.d(_,"MAX_SAFE_INTEGER",(function(){return w}));var C=Number.isFinite||function(R){return"number"==typeof R&&isFinite(R)},w=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function _src_remux_aacHelperTs(R,_,I){I.r(_);var C=function(){function e(){}return e.getSilentFrame=function e(R,_){if("mp4a.40.2"===R){if(1===_)return new Uint8Array([0,200,0,128,35,128]);if(2===_)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===_)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===_)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===_)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===_)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===_)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===_)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===_)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}();_.default=C},"./src/remux/mp4-generator.ts":function _src_remux_mp4GeneratorTs(R,_,I){I.r(_);var C=Math.pow(2,32)-1,w=function(){function e(){}return e.init=function t(){var R;for(R in e.types={"avc1":[],"avcC":[],"btrt":[],"dinf":[],"dref":[],"esds":[],"ftyp":[],"hdlr":[],"mdat":[],"mdhd":[],"mdia":[],"mfhd":[],"minf":[],"moof":[],"moov":[],"mp4a":[],".mp3":[],"mvex":[],"mvhd":[],"pasp":[],"sdtp":[],"stbl":[],"stco":[],"stsc":[],"stsd":[],"stsz":[],"stts":[],"tfdt":[],"tfhd":[],"traf":[],"trak":[],"trun":[],"trex":[],"tkhd":[],"vmhd":[],"smhd":[]},e.types)e.types.hasOwnProperty(R)&&(e.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var _=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),I=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={"video":_,"audio":I};var C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),w=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=w,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var O=new Uint8Array([105,115,111,109]),x=new Uint8Array([97,118,99,49]),P=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,O,P,O,x),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,C))},e.box=function e(R){for(var _=8,I=arguments.length,C=new Array(I>1?I-1:0),w=1;w<I;w++)C[w-1]=arguments[w];for(var O=C.length,x=O;O--;)_+=C[O].byteLength;var P=new Uint8Array(_);for(P[0]=_>>24&255,P[1]=_>>16&255,P[2]=_>>8&255,P[3]=255&_,P.set(R,4),O=0,_=8;O<x;O++)P.set(C[O],_),_+=C[O].byteLength;return P},e.hdlr=function t(R){return e.box(e.types.hdlr,e.HDLR_TYPES[R])},e.mdat=function t(R){return e.box(e.types.mdat,R)},e.mdhd=function t(R,_){_*=R;var I=Math.floor(_/(C+1)),w=Math.floor(_%(C+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,I>>24,I>>16&255,I>>8&255,255&I,w>>24,w>>16&255,w>>8&255,255&w,85,196,0,0]))},e.mdia=function t(R){return e.box(e.types.mdia,e.mdhd(R.timescale,R.duration),e.hdlr(R.type),e.minf(R))},e.mfhd=function t(R){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,255&R]))},e.minf=function t(R){return"audio"===R.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(R)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(R))},e.moof=function t(R,_,I){return e.box(e.types.moof,e.mfhd(R),e.traf(I,_))},e.moov=function t(R){for(var _=R.length,I=[];_--;)I[_]=e.trak(R[_]);return e.box.apply(null,[e.types.moov,e.mvhd(R[0].timescale,R[0].duration)].concat(I).concat(e.mvex(R)))},e.mvex=function t(R){for(var _=R.length,I=[];_--;)I[_]=e.trex(R[_]);return e.box.apply(null,[e.types.mvex].concat(I))},e.mvhd=function t(R,_){_*=R;var I=Math.floor(_/(C+1)),w=Math.floor(_%(C+1)),O=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,I>>24,I>>16&255,I>>8&255,255&I,w>>24,w>>16&255,w>>8&255,255&w,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,O)},e.sdtp=function t(R){var _,I,C=R.samples||[],w=new Uint8Array(4+C.length);for(_=0;_<C.length;_++)I=C[_].flags,w[_+4]=I.dependsOn<<4|I.isDependedOn<<2|I.hasRedundancy;return e.box(e.types.sdtp,w)},e.stbl=function t(R){return e.box(e.types.stbl,e.stsd(R),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function t(R){var _,I,C,w=[],O=[];for(_=0;_<R.sps.length;_++)C=(I=R.sps[_]).byteLength,w.push(C>>>8&255),w.push(255&C),w=w.concat(Array.prototype.slice.call(I));for(_=0;_<R.pps.length;_++)C=(I=R.pps[_]).byteLength,O.push(C>>>8&255),O.push(255&C),O=O.concat(Array.prototype.slice.call(I));var x=e.box(e.types.avcC,new Uint8Array([1,w[3],w[4],w[5],255,224|R.sps.length].concat(w).concat([R.pps.length]).concat(O))),P=R.width,F=R.height,M=R.pixelRatio[0],N=R.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,P>>8&255,255&P,F>>8&255,255&F,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),x,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([M>>24,M>>16&255,M>>8&255,255&M,N>>24,N>>16&255,N>>8&255,255&N])))},e.esds=function e(R){var _=R.config.length;return new Uint8Array([0,0,0,0,3,23+_,0,1,0,4,15+_,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([_]).concat(R.config).concat([6,1,2]))},e.mp4a=function t(R){var _=R.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,_>>8&255,255&_,0,0]),e.box(e.types.esds,e.esds(R)))},e.mp3=function t(R){var _=R.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,_>>8&255,255&_,0,0]))},e.stsd=function t(R){return"audio"===R.type?R.isAAC||"mp3"!==R.codec?e.box(e.types.stsd,e.STSD,e.mp4a(R)):e.box(e.types.stsd,e.STSD,e.mp3(R)):e.box(e.types.stsd,e.STSD,e.avc1(R))},e.tkhd=function t(R){var _=R.id,I=R.duration*R.timescale,w=R.width,O=R.height,x=Math.floor(I/(C+1)),P=Math.floor(I%(C+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,255&_,0,0,0,0,x>>24,x>>16&255,x>>8&255,255&x,P>>24,P>>16&255,P>>8&255,255&P,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,w>>8&255,255&w,0,0,O>>8&255,255&O,0,0]))},e.traf=function t(R,_){var I=e.sdtp(R),w=R.id,O=Math.floor(_/(C+1)),x=Math.floor(_%(C+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,w>>24,w>>16&255,w>>8&255,255&w])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,O>>24,O>>16&255,O>>8&255,255&O,x>>24,x>>16&255,x>>8&255,255&x])),e.trun(R,I.length+16+20+8+16+8+8),I)},e.trak=function t(R){return R.duration=R.duration||4294967295,e.box(e.types.trak,e.tkhd(R),e.mdia(R))},e.trex=function t(R){var _=R.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,255&_,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function t(R,_){var I,C,w,O,x,P,F=R.samples||[],M=F.length,N=12+16*M,B=new Uint8Array(N);for(_+=8+N,B.set([0,0,15,1,M>>>24&255,M>>>16&255,M>>>8&255,255&M,_>>>24&255,_>>>16&255,_>>>8&255,255&_],0),I=0;I<M;I++)w=(C=F[I]).duration,O=C.size,x=C.flags,P=C.cts,B.set([w>>>24&255,w>>>16&255,w>>>8&255,255&w,O>>>24&255,O>>>16&255,O>>>8&255,255&O,x.isLeading<<2|x.dependsOn,x.isDependedOn<<6|x.hasRedundancy<<4|x.paddingValue<<1|x.isNonSync,61440&x.degradPrio,15&x.degradPrio,P>>>24&255,P>>>16&255,P>>>8&255,255&P],12+16*I);return e.box(e.types.trun,B)},e.initSegment=function t(R){e.types||e.init();var _=e.moov(R),I=new Uint8Array(e.FTYP.byteLength+_.byteLength);return I.set(e.FTYP),I.set(_,e.FTYP.byteLength),I},e}();w.types=void 0,w.HDLR_TYPES=void 0,w.STTS=void 0,w.STSC=void 0,w.STCO=void 0,w.STSZ=void 0,w.VMHD=void 0,w.SMHD=void 0,w.STSD=void 0,w.FTYP=void 0,w.DINF=void 0,_.default=w},"./src/remux/mp4-remuxer.ts":function _src_remux_mp4RemuxerTs(R,_,I){I.r(_),I.d(_,"default",(function(){return j})),I.d(_,"normalizePts",(function(){return E}));var C=I("./src/polyfills/number.ts"),w=I("./src/remux/aac-helper.ts"),O=I("./src/remux/mp4-generator.ts"),x=I("./src/events.ts"),P=I("./src/errors.ts"),F=I("./src/utils/logger.ts"),M=I("./src/types/loader.ts"),N=I("./src/utils/timescale-conversion.ts");function c(){return c=Object.assign||function(R){for(var _=1;_<arguments.length;_++){var I=arguments[_];for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(R[C]=I[C])}return R},c.apply(this,arguments)}var B=null,U=null,G=!1,j=function(){function e(R,_,I,C){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=R,this.config=_,this.typeSupported=I,this.ISGenerated=!1,null===B){var w=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);B=w?parseInt(w[1]):0}if(null===U){var O=navigator.userAgent.match(/Safari\/(\d+)/i);U=O?parseInt(O[1]):0}G=!!B&&B<75||!!U&&U<600}var R=e.prototype;return R.destroy=function e(){},R.resetTimeStamp=function e(R){F.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=R},R.resetNextTimestamp=function e(){F.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},R.resetInitSegment=function e(){F.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},R.getVideoStartPts=function e(R){var _=!1,I=R.reduce((function(R,I){var C=I.pts-R;return C<-4294967296?(_=!0,E(R,I.pts)):C>0?R:I.pts}),R[0].pts);return _&&F.logger.debug("PTS rollover detected"),I},R.remux=function e(R,_,I,C,w,O,x,P){var N,B,U,G,j,K,H=w,V=w,W=R.pid>-1,Y=_.pid>-1,z=_.samples.length,X=R.samples.length>0,q=z>1;if((!W||X)&&(!Y||q)||this.ISGenerated||x){this.ISGenerated||(U=this.generateIS(R,_,w));var Z=this.isVideoContiguous,Q=-1;if(q&&(Q=function T(R){for(var _=0;_<R.length;_++)if(R[_].key)return _;return-1}(_.samples),!Z&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,Q>0){F.logger.warn("[mp4-remuxer]: Dropped "+Q+" out of "+z+" video samples due to a missing keyframe");var J=this.getVideoStartPts(_.samples);_.samples=_.samples.slice(Q),_.dropped+=Q,V+=(_.samples[0].pts-J)/(_.timescale||9e4)}else-1===Q&&(F.logger.warn("[mp4-remuxer]: No keyframe found out of "+z+" video samples"),K=!1);if(this.ISGenerated){if(X&&q){var $=this.getVideoStartPts(_.samples),ee=(E(R.samples[0].pts,$)-$)/_.inputTimeScale;H+=Math.max(0,ee),V+=Math.max(0,-ee)}if(X){if(R.samplerate||(F.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(R,_,w)),B=this.remuxAudio(R,H,this.isAudioContiguous,O,Y||q||P===M.PlaylistLevelType.AUDIO?V:void 0),q){var te=B?B.endPTS-B.startPTS:0;_.inputTimeScale||(F.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(R,_,w)),N=this.remuxVideo(_,V,Z,te)}}else q&&(N=this.remuxVideo(_,V,Z,0));N&&(N.firstKeyFrame=Q,N.independent=-1!==Q)}}return this.ISGenerated&&(I.samples.length&&(j=this.remuxID3(I,w)),C.samples.length&&(G=this.remuxText(C,w))),{"audio":B,"video":N,"initSegment":U,"independent":K,"text":G,"id3":j}},R.generateIS=function e(R,_,I){var w,x,P,F=R.samples,M=_.samples,N=this.typeSupported,B={},U=!Object(C.isFiniteNumber)(this._initPTS),G="audio/mp4";if(U&&(w=x=1/0),R.config&&F.length&&(R.timescale=R.samplerate,R.isAAC||(N.mpeg?(G="audio/mpeg",R.codec=""):N.mp3&&(R.codec="mp3")),B.audio={"id":"audio","container":G,"codec":R.codec,"initSegment":!R.isAAC&&N.mpeg?new Uint8Array(0):O.default.initSegment([R]),"metadata":{"channelCount":R.channelCount}},U&&(P=R.inputTimeScale,w=x=F[0].pts-Math.round(P*I))),_.sps&&_.pps&&M.length&&(_.timescale=_.inputTimeScale,B.video={"id":"main","container":"video/mp4","codec":_.codec,"initSegment":O.default.initSegment([_]),"metadata":{"width":_.width,"height":_.height}},U)){P=_.inputTimeScale;var j=this.getVideoStartPts(M),K=Math.round(P*I);x=Math.min(x,E(M[0].dts,j)-K),w=Math.min(w,j-K)}if(Object.keys(B).length)return this.ISGenerated=!0,U&&(this._initPTS=w,this._initDTS=x),{"tracks":B,"initPTS":w,"timescale":P}},R.remuxVideo=function e(R,_,I,C){var w,M,U,j=R.inputTimeScale,H=R.samples,V=[],W=H.length,Y=this._initPTS,z=this.nextAvcDts,X=8,q=Number.POSITIVE_INFINITY,Z=Number.NEGATIVE_INFINITY,Q=0,J=!1;I&&null!==z||(z=_*j-(H[0].pts-E(H[0].dts,H[0].pts)));for(var $=0;$<W;$++){var ee=H[$];if(ee.pts=E(ee.pts-Y,z),ee.dts=E(ee.dts-Y,z),ee.dts>ee.pts){Q=Math.max(Math.min(Q,ee.pts-ee.dts),-18e3)}ee.dts<H[$>0?$-1:$].dts&&(J=!0)}J&&H.sort((function(R,_){var I=R.dts-_.dts,C=R.pts-_.pts;return I||C})),M=H[0].dts,U=H[H.length-1].dts;var te=Math.round((U-M)/(W-1));if(Q<0){if(Q<-2*te){F.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(N.toMsFromMpegTsClock)(-te,!0)+" ms");for(var re=Q,ie=0;ie<W;ie++)H[ie].dts=re=Math.max(re,H[ie].pts-te),H[ie].pts=Math.max(re,H[ie].pts)}else{F.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(N.toMsFromMpegTsClock)(Q,!0)+" ms to overcome this issue");for(var ne=0;ne<W;ne++)H[ne].dts=H[ne].dts+Q}M=H[0].dts}if(I){var se=M-z,ae=se>te;if(ae||se<-1){ae?F.logger.warn("AVC: "+Object(N.toMsFromMpegTsClock)(se,!0)+" ms ("+se+"dts) hole between fragments detected, filling it"):F.logger.warn("AVC: "+Object(N.toMsFromMpegTsClock)(-se,!0)+" ms ("+se+"dts) overlapping between fragments detected"),M=z;var oe=H[0].pts-se;H[0].dts=M,H[0].pts=oe,F.logger.log("Video: First PTS/DTS adjusted: "+Object(N.toMsFromMpegTsClock)(oe,!0)+"/"+Object(N.toMsFromMpegTsClock)(M,!0)+", delta: "+Object(N.toMsFromMpegTsClock)(se,!0)+" ms")}}G&&(M=Math.max(0,M));for(var le=0,ue=0,ce=0;ce<W;ce++){for(var de=H[ce],he=de.units,fe=he.length,ge=0,ve=0;ve<fe;ve++)ge+=he[ve].data.length;ue+=ge,le+=fe,de.length=ge,de.dts=Math.max(de.dts,M),de.pts=Math.max(de.pts,de.dts,0),q=Math.min(de.pts,q),Z=Math.max(de.pts,Z)}U=H[W-1].dts;var pe,me=ue+4*le+8;try{pe=new Uint8Array(me)}catch(e){return void this.observer.emit(x.Events.ERROR,x.Events.ERROR,{"type":P.ErrorTypes.MUX_ERROR,"details":P.ErrorDetails.REMUX_ALLOC_ERROR,"fatal":!1,"bytes":me,"reason":"fail allocating video mdat "+me})}var ye=new DataView(pe.buffer);ye.setUint32(0,me),pe.set(O.default.types.mdat,4);for(var Ee=0;Ee<W;Ee++){for(var Te=H[Ee],be=Te.units,Se=0,Ae=0,Le=be.length;Ae<Le;Ae++){var De=be[Ae],Re=De.data,ke=De.data.byteLength;ye.setUint32(X,ke),X+=4,pe.set(Re,X),X+=ke,Se+=4+ke}if(Ee<W-1)w=H[Ee+1].dts-Te.dts;else{var _e=this.config,Ie=Te.dts-H[Ee>0?Ee-1:Ee].dts;if(_e.stretchShortVideoTrack&&null!==this.nextAudioPts){var Ce=Math.floor(_e.maxBufferHole*j),we=(C?q+C*j:this.nextAudioPts)-Te.pts;we>Ce?((w=we-Ie)<0&&(w=Ie),F.logger.log("[mp4-remuxer]: It is approximately "+we/90+" ms to the next segment; using duration "+w/90+" ms for the last video frame.")):w=Ie}else w=Ie}var Oe=Math.round(Te.pts-Te.dts);V.push(new K(Te.key,w,Se,Oe))}if(V.length&&B&&B<70){var xe=V[0].flags;xe.dependsOn=2,xe.isNonSync=0}console.assert(void 0!==w,"mp4SampleDuration must be computed"),this.nextAvcDts=z=U+w,this.isVideoContiguous=!0;var Pe={"data1":O.default.moof(R.sequenceNumber++,M,c({},R,{"samples":V})),"data2":pe,"startPTS":q/j,"endPTS":(Z+w)/j,"startDTS":M/j,"endDTS":z/j,"type":"video","hasAudio":!1,"hasVideo":!0,"nb":V.length,"dropped":R.dropped};return R.samples=[],R.dropped=0,console.assert(pe.length,"MDAT length must not be zero"),Pe},R.remuxAudio=function e(R,_,I,C,M){var N=R.inputTimeScale,B=N/(R.samplerate?R.samplerate:N),U=R.isAAC?1024:1152,G=U*B,j=this._initPTS,H=!R.isAAC&&this.typeSupported.mpeg,V=[],W=R.samples,Y=H?0:8,z=this.nextAudioPts||-1,X=_*N;if(this.isAudioContiguous=I=I||W.length&&z>0&&(C&&Math.abs(X-z)<9e3||Math.abs(E(W[0].pts-j,X)-z)<20*G),W.forEach((function(R){R.pts=E(R.pts-j,X)})),!I||z<0){if(W=W.filter((function(R){return R.pts>=0})),!W.length)return;z=0===M?0:C?Math.max(0,X):W[0].pts}if(R.isAAC)for(var q=void 0!==M,Z=this.config.maxAudioFramesDrift,Q=0,J=z;Q<W.length;Q++){var $=W[Q],ee=$.pts,te=ee-J,re=Math.abs(1e3*te/N);if(te<=-Z*G&&q)0===Q&&(F.logger.warn("Audio frame @ "+(ee/N).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*te/N)+" ms."),this.nextAudioPts=z=J=ee);else if(te>=Z*G&&re<1e4&&q){var ie=Math.round(te/G);(J=ee-ie*G)<0&&(ie--,J+=G),0===Q&&(this.nextAudioPts=z=J),F.logger.warn("[mp4-remuxer]: Injecting "+ie+" audio frame @ "+(J/N).toFixed(3)+"s due to "+Math.round(1e3*te/N)+" ms gap.");for(var ne=0;ne<ie;ne++){var se=Math.max(J,0),ae=w.default.getSilentFrame(R.manifestCodec||R.codec,R.channelCount);ae||(F.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ae=$.unit.subarray()),W.splice(Q,0,{"unit":ae,"pts":se}),J+=G,Q++}}$.pts=J,J+=G}for(var oe,le=null,ue=null,ce=0,de=W.length;de--;)ce+=W[de].unit.byteLength;for(var he=0,fe=W.length;he<fe;he++){var ge=W[he],ve=ge.unit,pe=ge.pts;if(null!==ue){V[he-1].duration=Math.round((pe-ue)/B)}else{if(I&&R.isAAC&&(pe=z),le=pe,!(ce>0))return;ce+=Y;try{oe=new Uint8Array(ce)}catch(e){return void this.observer.emit(x.Events.ERROR,x.Events.ERROR,{"type":P.ErrorTypes.MUX_ERROR,"details":P.ErrorDetails.REMUX_ALLOC_ERROR,"fatal":!1,"bytes":ce,"reason":"fail allocating audio mdat "+ce})}H||(new DataView(oe.buffer).setUint32(0,ce),oe.set(O.default.types.mdat,4))}oe.set(ve,Y);var me=ve.byteLength;Y+=me,V.push(new K(!0,U,me,0)),ue=pe}var ye=V.length;if(ye){var Ee=V[V.length-1];this.nextAudioPts=z=ue+B*Ee.duration;var Te=H?new Uint8Array(0):O.default.moof(R.sequenceNumber++,le/B,c({},R,{"samples":V}));R.samples=[];var be=le/N,Se=z/N,Ae={"data1":Te,"data2":oe,"startPTS":be,"endPTS":Se,"startDTS":be,"endDTS":Se,"type":"audio","hasAudio":!0,"hasVideo":!1,"nb":ye};return this.isAudioContiguous=!0,console.assert(oe.length,"MDAT length must not be zero"),Ae}},R.remuxEmptyAudio=function e(R,_,I,C){var O=R.inputTimeScale,x=O/(R.samplerate?R.samplerate:O),P=this.nextAudioPts,M=(null!==P?P:C.startDTS*O)+this._initDTS,N=C.endDTS*O+this._initDTS,B=1024*x,U=Math.ceil((N-M)/B),G=w.default.getSilentFrame(R.manifestCodec||R.codec,R.channelCount);if(F.logger.warn("[mp4-remuxer]: remux empty Audio"),G){for(var j=[],K=0;K<U;K++){var H=M+K*B;j.push({"unit":G,"pts":H,"dts":H})}return R.samples=j,this.remuxAudio(R,_,I,!1)}F.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},R.remuxID3=function e(R,_){var I=R.samples.length;if(I){for(var C=R.inputTimeScale,w=this._initPTS,O=this._initDTS,x=0;x<I;x++){var P=R.samples[x];P.pts=E(P.pts-w,_*C)/C,P.dts=E(P.dts-O,_*C)/C}var F=R.samples;return R.samples=[],{"samples":F}}},R.remuxText=function e(R,_){var I=R.samples.length;if(I){for(var C=R.inputTimeScale,w=this._initPTS,O=0;O<I;O++){var x=R.samples[O];x.pts=E(x.pts-w,_*C)/C}R.samples.sort((function(R,_){return R.pts-_.pts}));var P=R.samples;return R.samples=[],{"samples":P}}},e}();function E(R,_){var I;if(null===_)return R;for(I=_<R?-8589934592:8589934592;Math.abs(R-_)>4294967296;)R+=I;return R}var K=function e(R,_,I,C){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=_,this.size=I,this.cts=C,this.flags=new H(R)},H=function e(R){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=R?2:1,this.isNonSync=R?0:1}},"./src/remux/passthrough-remuxer.ts":function _src_remux_passthroughRemuxerTs(R,_,I){I.r(_);var C=I("./src/polyfills/number.ts"),w=I("./src/utils/mp4-tools.ts"),O=I("./src/loader/fragment.ts"),x=I("./src/utils/logger.ts"),P=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var R=e.prototype;return R.destroy=function e(){},R.resetTimeStamp=function e(R){this.initPTS=R,this.lastEndDTS=null},R.resetNextTimestamp=function e(){this.lastEndDTS=null},R.resetInitSegment=function e(R,_,I){this.audioCodec=_,this.videoCodec=I,this.generateInitSegment(R),this.emitInitSegment=!0},R.generateInitSegment=function e(R){var _=this.audioCodec,I=this.videoCodec;if(!R||!R.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var C=this.initData=Object(w.parseInitSegment)(R);_||(_=u(C.audio,O.ElementaryStreamTypes.AUDIO)),I||(I=u(C.video,O.ElementaryStreamTypes.VIDEO));var P={};C.audio&&C.video?P.audiovideo={"container":"video/mp4","codec":_+","+I,"initSegment":R,"id":"main"}:C.audio?P.audio={"container":"audio/mp4","codec":_,"initSegment":R,"id":"audio"}:C.video?P.video={"container":"video/mp4","codec":I,"initSegment":R,"id":"main"}:x.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=P},R.remux=function e(R,_,I,O,P){var M=this.initPTS,N=this.lastEndDTS,B={"audio":void 0,"video":void 0,"text":O,"id3":I,"initSegment":void 0};Object(C.isFiniteNumber)(N)||(N=this.lastEndDTS=P||0);var U=_.samples;if(!U||!U.length)return B;var G={"initPTS":void 0,"timescale":1},j=this.initData;if(j&&j.length||(this.generateInitSegment(U),j=this.initData),!j||!j.length)return x.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),B;this.emitInitSegment&&(G.tracks=this.initTracks,this.emitInitSegment=!1),Object(C.isFiniteNumber)(M)||(this.initPTS=G.initPTS=M=F(j,U,N));var K=Object(w.getDuration)(U,j),H=N,V=K+H;Object(w.offsetStartDTS)(j,U,M),K>0?this.lastEndDTS=V:(x.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var W=!!j.audio,Y=!!j.video,z="";W&&(z+="audio"),Y&&(z+="video");var X={"data1":U,"startPTS":H,"startDTS":H,"endPTS":V,"endDTS":V,"type":z,"hasAudio":W,"hasVideo":Y,"nb":1,"dropped":0};return B.audio="audio"===X.type?X:void 0,B.video="audio"!==X.type?X:void 0,B.text=O,B.id3=I,B.initSegment=G,B},e}(),F=function e(R,_,I){return Object(w.getStartDTS)(R,_)-I};function u(R,_){var I=null==R?void 0:R.codec;return I&&I.length>4?I:"hvc1"===I?"hvc1.1.c.L120.90":"av01"===I?"av01.0.04M.08":"avc1"===I||_===O.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}_.default=P},"./src/task-loop.ts":function _src_taskLoopTs(R,_,I){I.r(_),I.d(_,"default",(function(){return C}));var C=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var R=e.prototype;return R.destroy=function e(){this.onHandlerDestroying(),this.onHandlerDestroyed()},R.onHandlerDestroying=function e(){this.clearNextTick(),this.clearInterval()},R.onHandlerDestroyed=function e(){},R.hasInterval=function e(){return!!this._tickInterval},R.hasNextTick=function e(){return!!this._tickTimer},R.setInterval=function e(R){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,R),!0)},R.clearInterval=function e(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},R.clearNextTick=function e(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},R.tick=function e(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},R.tickImmediate=function e(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},R.doTick=function e(){},e}()},"./src/types/cmcd.ts":function _src_types_cmcdTs(R,_,I){I.r(_),I.d(_,"CMCDVersion",(function(){return x})),I.d(_,"CMCDObjectType",(function(){return C})),I.d(_,"CMCDStreamingFormat",(function(){return w})),I.d(_,"CMCDStreamType",(function(){return O}));var C,w,O,x=1;!function(R){R.MANIFEST="m",R.AUDIO="a",R.VIDEO="v",R.MUXED="av",R.INIT="i",R.CAPTION="c",R.TIMED_TEXT="tt",R.KEY="k",R.OTHER="o"}(C||(C={})),function(R){R.DASH="d",R.HLS="h",R.SMOOTH="s",R.OTHER="o"}(w||(w={})),function(R){R.VOD="v",R.LIVE="l"}(O||(O={}))},"./src/types/level.ts":function _src_types_levelTs(R,_,I){function i(R,_){for(var I=0;I<_.length;I++){var C=_[I];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(R,C.key,C)}}var C;function s(R,_){var I=R.canSkipUntil,w=R.canSkipDateRanges,O=R.endSN;return I&&(void 0!==_?_-O:0)<I?w?C.v2:C.Yes:C.No}I.r(_),I.d(_,"HlsSkip",(function(){return C})),I.d(_,"getSkipValue",(function(){return s})),I.d(_,"HlsUrlParameters",(function(){return w})),I.d(_,"Level",(function(){return O})),function(R){R.No="",R.Yes="YES",R.v2="v2"}(C||(C={}));var w=function(){function e(R,_,I){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=R,this.part=_,this.skip=I}return e.prototype.addDirectives=function e(R){var _=new self.URL(R);return void 0!==this.msn&&_.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&_.searchParams.set("_HLS_part",this.part.toString()),this.skip&&_.searchParams.set("_HLS_skip",this.skip),_.toString()},e}(),O=function(){function e(R){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[R.url],this.attrs=R.attrs,this.bitrate=R.bitrate,R.details&&(this.details=R.details),this.id=R.id||0,this.name=R.name,this.width=R.width||0,this.height=R.height||0,this.audioCodec=R.audioCodec,this.videoCodec=R.videoCodec,this.unknownCodecs=R.unknownCodecs,this.codecSet=[R.videoCodec,R.audioCodec].filter((function(R){return R})).join(",").replace(/\.[^.,]+/g,"")}return function a(R,_,I){return _&&i(R.prototype,_),I&&i(R,I),R}(e,[{"key":"maxBitrate","get":function e(){return Math.max(this.realBitrate,this.bitrate)}},{"key":"uri","get":function e(){return this.url[this._urlId]||""}},{"key":"urlId","get":function e(){return this._urlId},"set":function e(R){var _=R%this.url.length;this._urlId!==_&&(this.details=void 0,this._urlId=_)}}]),e}()},"./src/types/loader.ts":function _src_types_loaderTs(R,_,I){var C,w;I.r(_),I.d(_,"PlaylistContextType",(function(){return C})),I.d(_,"PlaylistLevelType",(function(){return w})),function(R){R.MANIFEST="manifest",R.LEVEL="level",R.AUDIO_TRACK="audioTrack",R.SUBTITLE_TRACK="subtitleTrack"}(C||(C={})),function(R){R.MAIN="main",R.AUDIO="audio",R.SUBTITLE="subtitle"}(w||(w={}))},"./src/types/transmuxer.ts":function _src_types_transmuxerTs(R,_,I){I.r(_),I.d(_,"ChunkMetadata",(function(){return C}));var C=function e(R,_,I,C,w,O){void 0===C&&(C=0),void 0===w&&(w=-1),void 0===O&&(O=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={"start":0,"executeStart":0,"executeEnd":0,"end":0},this.buffering={"audio":{"start":0,"executeStart":0,"executeEnd":0,"end":0},"video":{"start":0,"executeStart":0,"executeEnd":0,"end":0},"audiovideo":{"start":0,"executeStart":0,"executeEnd":0,"end":0}},this.level=R,this.sn=_,this.id=I,this.size=C,this.part=w,this.partial=O}},"./src/utils/attr-list.ts":function _src_utils_attrListTs(R,_,I){I.r(_),I.d(_,"AttrList",(function(){return O}));var C=/^(\d+)x(\d+)$/,w=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,O=function(){function e(R){for(var _ in"string"==typeof R&&(R=e.parseAttrList(R)),R)R.hasOwnProperty(_)&&(this[_]=R[_])}var R=e.prototype;return R.decimalInteger=function e(R){var _=parseInt(this[R],10);return _>Number.MAX_SAFE_INTEGER?1/0:_},R.hexadecimalInteger=function e(R){if(this[R]){var _=(this[R]||"0x").slice(2);_=(1&_.length?"0":"")+_;for(var I=new Uint8Array(_.length/2),C=0;C<_.length/2;C++)I[C]=parseInt(_.slice(2*C,2*C+2),16);return I}return null},R.hexadecimalIntegerAsNumber=function e(R){var _=parseInt(this[R],16);return _>Number.MAX_SAFE_INTEGER?1/0:_},R.decimalFloatingPoint=function e(R){return parseFloat(this[R])},R.optionalFloat=function e(R,_){var I=this[R];return I?parseFloat(I):_},R.enumeratedString=function e(R){return this[R]},R.bool=function e(R){return"YES"===this[R]},R.decimalResolution=function e(R){var _=C.exec(this[R]);if(null!==_)return{"width":parseInt(_[1],10),"height":parseInt(_[2],10)}},e.parseAttrList=function e(R){var _,I={};for(w.lastIndex=0;null!==(_=w.exec(R));){var C=_[2];0===C.indexOf('"')&&C.lastIndexOf('"')===C.length-1&&(C=C.slice(1,-1)),I[_[1]]=C}return I},e}()},"./src/utils/binary-search.ts":function _src_utils_binarySearchTs(R,_,I){I.r(_);_.default={"search":function e(R,_){for(var I=0,C=R.length-1,w=null,O=null;I<=C;){var x=_(O=R[w=(I+C)/2|0]);if(x>0)I=w+1;else{if(!(x<0))return O;C=w-1}}return null}}},"./src/utils/buffer-helper.ts":function _src_utils_bufferHelperTs(R,_,I){I.r(_),I.d(_,"BufferHelper",(function(){return O}));var C=I("./src/utils/logger.ts"),w={"length":0,"start":function e(){return 0},"end":function e(){return 0}},O=function(){function e(){}return e.isBuffered=function t(R,_){try{if(R)for(var I=e.getBuffered(R),C=0;C<I.length;C++)if(_>=I.start(C)&&_<=I.end(C))return!0}catch(R){}return!1},e.bufferInfo=function t(R,_,I){try{if(R){var C,w=e.getBuffered(R),O=[];for(C=0;C<w.length;C++)O.push({"start":w.start(C),"end":w.end(C)});return this.bufferedInfo(O,_,I)}}catch(R){}return{"len":0,"start":_,"end":_,"nextStart":void 0}},e.bufferedInfo=function e(R,_,I){_=Math.max(0,_),R.sort((function(R,_){var I=R.start-_.start;return I||_.end-R.end}));var C=[];if(I)for(var w=0;w<R.length;w++){var O=C.length;if(O){var x=C[O-1].end;R[w].start-x<I?R[w].end>x&&(C[O-1].end=R[w].end):C.push(R[w])}else C.push(R[w])}else C=R;for(var P,F=0,M=_,N=_,B=0;B<C.length;B++){var U=C[B].start,G=C[B].end;if(_+I>=U&&_<G)M=U,F=(N=G)-_;else if(_+I<U){P=U;break}}return{"len":F,"start":M||0,"end":N||0,"nextStart":P}},e.getBuffered=function e(R){try{return R.buffered}catch(e){return C.logger.log("failed to get media.buffered",e),w}},e}()},"./src/utils/cea-608-parser.ts":function _src_utils_cea608ParserTs(R,_,I){I.r(_),I.d(_,"Row",(function(){return W})),I.d(_,"CaptionScreen",(function(){return Y}));var C,w=I("./src/utils/logger.ts"),O={"42":225,"92":233,"94":237,"95":243,"96":250,"123":231,"124":247,"125":209,"126":241,"127":9608,"128":174,"129":176,"130":189,"131":191,"132":8482,"133":162,"134":163,"135":9834,"136":224,"137":32,"138":232,"139":226,"140":234,"141":238,"142":244,"143":251,"144":193,"145":201,"146":211,"147":218,"148":220,"149":252,"150":8216,"151":161,"152":42,"153":8217,"154":9473,"155":169,"156":8480,"157":8226,"158":8220,"159":8221,"160":192,"161":194,"162":199,"163":200,"164":202,"165":203,"166":235,"167":206,"168":207,"169":239,"170":212,"171":217,"172":249,"173":219,"174":171,"175":187,"176":195,"177":227,"178":205,"179":204,"180":236,"181":210,"182":242,"183":213,"184":245,"185":123,"186":125,"187":92,"188":94,"189":95,"190":124,"191":8764,"192":196,"193":228,"194":214,"195":246,"196":223,"197":165,"198":164,"199":9475,"200":197,"201":229,"202":216,"203":248,"204":9487,"205":9491,"206":9495,"207":9499},x=function e(R){var _=R;return O.hasOwnProperty(R)&&(_=O[R]),String.fromCharCode(_)},P=15,F=100,M={"17":1,"18":3,"21":5,"22":7,"23":9,"16":11,"19":12,"20":14},N={"17":2,"18":4,"21":6,"22":8,"23":10,"19":13,"20":15},B={"25":1,"26":3,"29":5,"30":7,"31":9,"24":11,"27":12,"28":14},U={"25":2,"26":4,"29":6,"30":8,"31":10,"27":13,"28":15},G=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(R){R[R.ERROR=0]="ERROR",R[R.TEXT=1]="TEXT",R[R.WARNING=2]="WARNING",R[R.INFO=2]="INFO",R[R.DEBUG=3]="DEBUG",R[R.DATA=3]="DATA"}(C||(C={}));var j=function(){function e(){this.time=null,this.verboseLevel=C.ERROR}return e.prototype.log=function e(R,_){this.verboseLevel>=R&&w.logger.log(this.time+" ["+R+"] "+_)},e}(),K=function e(R){for(var _=[],I=0;I<R.length;I++)_.push(R[I].toString(16));return _},H=function(){function e(R,_,I,C,w){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=R||"white",this.underline=_||!1,this.italics=I||!1,this.background=C||"black",this.flash=w||!1}var R=e.prototype;return R.reset=function e(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},R.setStyles=function e(R){for(var _=["foreground","underline","italics","background","flash"],I=0;I<_.length;I++){var C=_[I];R.hasOwnProperty(C)&&(this[C]=R[C])}},R.isDefault=function e(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},R.equals=function e(R){return this.foreground===R.foreground&&this.underline===R.underline&&this.italics===R.italics&&this.background===R.background&&this.flash===R.flash},R.copy=function e(R){this.foreground=R.foreground,this.underline=R.underline,this.italics=R.italics,this.background=R.background,this.flash=R.flash},R.toString=function e(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),V=function(){function e(R,_,I,C,w,O){this.uchar=void 0,this.penState=void 0,this.uchar=R||" ",this.penState=new H(_,I,C,w,O)}var R=e.prototype;return R.reset=function e(){this.uchar=" ",this.penState.reset()},R.setChar=function e(R,_){this.uchar=R,this.penState.copy(_)},R.setPenState=function e(R){this.penState.copy(R)},R.equals=function e(R){return this.uchar===R.uchar&&this.penState.equals(R.penState)},R.copy=function e(R){this.uchar=R.uchar,this.penState.copy(R.penState)},R.isEmpty=function e(){return" "===this.uchar&&this.penState.isDefault()},e}(),W=function(){function e(R){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var _=0;_<F;_++)this.chars.push(new V);this.logger=R,this.pos=0,this.currPenState=new H}var R=e.prototype;return R.equals=function e(R){for(var _=!0,I=0;I<F;I++)if(!this.chars[I].equals(R.chars[I])){_=!1;break}return _},R.copy=function e(R){for(var _=0;_<F;_++)this.chars[_].copy(R.chars[_])},R.isEmpty=function e(){for(var R=!0,_=0;_<F;_++)if(!this.chars[_].isEmpty()){R=!1;break}return R},R.setCursor=function e(R){this.pos!==R&&(this.pos=R),this.pos<0?(this.logger.log(C.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>F&&(this.logger.log(C.DEBUG,"Too large cursor position "+this.pos),this.pos=F)},R.moveCursor=function e(R){var _=this.pos+R;if(R>1)for(var I=this.pos+1;I<_+1;I++)this.chars[I].setPenState(this.currPenState);this.setCursor(_)},R.backSpace=function e(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},R.insertChar=function e(R){R>=144&&this.backSpace();var _=x(R);this.pos>=F?this.logger.log(C.ERROR,"Cannot insert "+R.toString(16)+" ("+_+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(_,this.currPenState),this.moveCursor(1))},R.clearFromPos=function e(R){var _;for(_=R;_<F;_++)this.chars[_].reset()},R.clear=function e(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},R.clearToEndOfRow=function e(){this.clearFromPos(this.pos)},R.getTextString=function e(){for(var R=[],_=!0,I=0;I<F;I++){var C=this.chars[I].uchar;" "!==C&&(_=!1),R.push(C)}return _?"":R.join("")},R.setPenStyles=function e(R){this.currPenState.setStyles(R),this.chars[this.pos].setPenState(this.currPenState)},e}(),Y=function(){function e(R){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var _=0;_<P;_++)this.rows.push(new W(R));this.logger=R,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var R=e.prototype;return R.reset=function e(){for(var R=0;R<P;R++)this.rows[R].clear();this.currRow=14},R.equals=function e(R){for(var _=!0,I=0;I<P;I++)if(!this.rows[I].equals(R.rows[I])){_=!1;break}return _},R.copy=function e(R){for(var _=0;_<P;_++)this.rows[_].copy(R.rows[_])},R.isEmpty=function e(){for(var R=!0,_=0;_<P;_++)if(!this.rows[_].isEmpty()){R=!1;break}return R},R.backSpace=function e(){this.rows[this.currRow].backSpace()},R.clearToEndOfRow=function e(){this.rows[this.currRow].clearToEndOfRow()},R.insertChar=function e(R){this.rows[this.currRow].insertChar(R)},R.setPen=function e(R){this.rows[this.currRow].setPenStyles(R)},R.moveCursor=function e(R){this.rows[this.currRow].moveCursor(R)},R.setCursor=function e(R){this.logger.log(C.INFO,"setCursor: "+R),this.rows[this.currRow].setCursor(R)},R.setPAC=function e(R){this.logger.log(C.INFO,"pacData = "+JSON.stringify(R));var _=R.row-1;if(this.nrRollUpRows&&_<this.nrRollUpRows-1&&(_=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==_){for(var I=0;I<P;I++)this.rows[I].clear();var w=this.currRow+1-this.nrRollUpRows,O=this.lastOutputScreen;if(O){var x=O.rows[w].cueStartTime,F=this.logger.time;if(x&&null!==F&&x<F)for(var M=0;M<this.nrRollUpRows;M++)this.rows[_-this.nrRollUpRows+M+1].copy(O.rows[w+M])}}this.currRow=_;var N=this.rows[this.currRow];if(null!==R.indent){var B=R.indent,U=Math.max(B-1,0);N.setCursor(R.indent),R.color=N.chars[U].penState.foreground}var G={"foreground":R.color,"underline":R.underline,"italics":R.italics,"background":"black","flash":!1};this.setPen(G)},R.setBkgData=function e(R){this.logger.log(C.INFO,"bkgData = "+JSON.stringify(R)),this.backSpace(),this.setPen(R),this.insertChar(32)},R.setRollUpRows=function e(R){this.nrRollUpRows=R},R.rollUp=function e(){if(null!==this.nrRollUpRows){this.logger.log(C.TEXT,this.getDisplayText());var R=this.currRow+1-this.nrRollUpRows,_=this.rows.splice(R,1)[0];_.clear(),this.rows.splice(this.currRow,0,_),this.logger.log(C.INFO,"Rolling up")}else this.logger.log(C.DEBUG,"roll_up but nrRollUpRows not set yet")},R.getDisplayText=function e(R){R=R||!1;for(var _=[],I="",C=-1,w=0;w<P;w++){var O=this.rows[w].getTextString();O&&(C=w+1,R?_.push("Row "+C+": '"+O+"'"):_.push(O.trim()))}return _.length>0&&(I=R?"["+_.join(" | ")+"]":_.join("\n")),I},R.getTextAndFormat=function e(){return this.rows},e}(),z=function(){function e(R,_,I){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=R,this.outputFilter=_,this.mode=null,this.verbose=0,this.displayedMemory=new Y(I),this.nonDisplayedMemory=new Y(I),this.lastOutputScreen=new Y(I),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=I}var R=e.prototype;return R.reset=function e(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},R.getHandler=function e(){return this.outputFilter},R.setHandler=function e(R){this.outputFilter=R},R.setPAC=function e(R){this.writeScreen.setPAC(R)},R.setBkgData=function e(R){this.writeScreen.setBkgData(R)},R.setMode=function e(R){R!==this.mode&&(this.mode=R,this.logger.log(C.INFO,"MODE="+R),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=R)},R.insertChars=function e(R){for(var _=0;_<R.length;_++)this.writeScreen.insertChar(R[_]);var I=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(C.INFO,I+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(C.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},R.ccRCL=function e(){this.logger.log(C.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},R.ccBS=function e(){this.logger.log(C.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},R.ccAOF=function e(){},R.ccAON=function e(){},R.ccDER=function e(){this.logger.log(C.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},R.ccRU=function e(R){this.logger.log(C.INFO,"RU("+R+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(R)},R.ccFON=function e(){this.logger.log(C.INFO,"FON - Flash On"),this.writeScreen.setPen({"flash":!0})},R.ccRDC=function e(){this.logger.log(C.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},R.ccTR=function e(){this.logger.log(C.INFO,"TR"),this.setMode("MODE_TEXT")},R.ccRTD=function e(){this.logger.log(C.INFO,"RTD"),this.setMode("MODE_TEXT")},R.ccEDM=function e(){this.logger.log(C.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},R.ccCR=function e(){this.logger.log(C.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},R.ccENM=function e(){this.logger.log(C.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},R.ccEOC=function e(){if(this.logger.log(C.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var R=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=R,this.writeScreen=this.nonDisplayedMemory,this.logger.log(C.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},R.ccTO=function e(R){this.logger.log(C.INFO,"TO("+R+") - Tab Offset"),this.writeScreen.moveCursor(R)},R.ccMIDROW=function e(R){var _={"flash":!1};if(_.underline=R%2==1,_.italics=R>=46,_.italics)_.foreground="white";else{var I=Math.floor(R/2)-16;_.foreground=["white","green","blue","cyan","red","yellow","magenta"][I]}this.logger.log(C.INFO,"MIDROW: "+JSON.stringify(_)),this.writeScreen.setPen(_)},R.outputDataUpdate=function e(R){void 0===R&&(R=!1);var _=this.logger.time;null!==_&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,_,this.lastOutputScreen),R&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:_):this.cueStartTime=_,this.lastOutputScreen.copy(this.displayedMemory))},R.cueSplitAtTime=function e(R){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,R,this.displayedMemory),this.cueStartTime=R))},e}(),X=function(){function e(R,_,I){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var C=new j;this.channels=[null,new z(R,_,C),new z(R+1,I,C)],this.cmdHistory={"a":null,"b":null},this.logger=C}var R=e.prototype;return R.getHandler=function e(R){return this.channels[R].getHandler()},R.setHandler=function e(R,_){this.channels[R].setHandler(_)},R.addData=function e(R,_){var I,w,O,x=!1;this.logger.time=R;for(var P=0;P<_.length;P+=2)if(w=127&_[P],O=127&_[P+1],0!==w||0!==O){if(this.logger.log(C.DATA,"["+K([_[P],_[P+1]])+"] -> ("+K([w,O])+")"),(I=this.parseCmd(w,O))||(I=this.parseMidrow(w,O)),I||(I=this.parsePAC(w,O)),I||(I=this.parseBackgroundAttributes(w,O)),!I&&(x=this.parseChars(w,O))){var F=this.currentChannel;if(F&&F>0)this.channels[F].insertChars(x);else this.logger.log(C.WARNING,"No channel found yet. TEXT-MODE?")}I||x||this.logger.log(C.WARNING,"Couldn't parse cleaned data "+K([w,O])+" orig: "+K([_[P],_[P+1]]))}},R.parseCmd=function e(R,_){var I=this.cmdHistory;if(!((20===R||28===R||21===R||29===R)&&_>=32&&_<=47)&&!((23===R||31===R)&&_>=33&&_<=35))return!1;if(A(R,_,I))return S(null,null,I),this.logger.log(C.DEBUG,"Repeated command ("+K([R,_])+") is dropped"),!0;var w=20===R||21===R||23===R?1:2,O=this.channels[w];return 20===R||21===R||28===R||29===R?32===_?O.ccRCL():33===_?O.ccBS():34===_?O.ccAOF():35===_?O.ccAON():36===_?O.ccDER():37===_?O.ccRU(2):38===_?O.ccRU(3):39===_?O.ccRU(4):40===_?O.ccFON():41===_?O.ccRDC():42===_?O.ccTR():43===_?O.ccRTD():44===_?O.ccEDM():45===_?O.ccCR():46===_?O.ccENM():47===_&&O.ccEOC():O.ccTO(_-32),S(R,_,I),this.currentChannel=w,!0},R.parseMidrow=function e(R,_){var I=0;if((17===R||25===R)&&_>=32&&_<=47){if((I=17===R?1:2)!==this.currentChannel)return this.logger.log(C.ERROR,"Mismatch channel in midrow parsing"),!1;var w=this.channels[I];return!!w&&(w.ccMIDROW(_),this.logger.log(C.DEBUG,"MIDROW ("+K([R,_])+")"),!0)}return!1},R.parsePAC=function e(R,_){var I,C=this.cmdHistory;if(!((R>=17&&R<=23||R>=25&&R<=31)&&_>=64&&_<=127)&&!((16===R||24===R)&&_>=64&&_<=95))return!1;if(A(R,_,C))return S(null,null,C),!0;var w=R<=23?1:2;I=_>=64&&_<=95?1===w?M[R]:B[R]:1===w?N[R]:U[R];var O=this.channels[w];return!!O&&(O.setPAC(this.interpretPAC(I,_)),S(R,_,C),this.currentChannel=w,!0)},R.interpretPAC=function e(R,_){var I,C={"color":null,"italics":!1,"indent":null,"underline":!1,"row":R};return I=_>95?_-96:_-64,C.underline=!(1&~I),I<=13?C.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(I/2)]:I<=15?(C.italics=!0,C.color="white"):C.indent=4*Math.floor((I-16)/2),C},R.parseChars=function e(R,_){var I,w,O=null,P=null;(R>=25?(I=2,P=R-8):(I=1,P=R),P>=17&&P<=19)?(w=17===P?_+80:18===P?_+112:_+144,this.logger.log(C.INFO,"Special char '"+x(w)+"' in channel "+I),O=[w]):R>=32&&R<=127&&(O=0===_?[R]:[R,_]);if(O){var F=K(O);this.logger.log(C.DEBUG,"Char codes =  "+F.join(",")),S(R,_,this.cmdHistory)}return O},R.parseBackgroundAttributes=function e(R,_){var I;if(!((16===R||24===R)&&_>=32&&_<=47)&&!((23===R||31===R)&&_>=45&&_<=47))return!1;var C={};16===R||24===R?(I=Math.floor((_-32)/2),C.background=G[I],_%2==1&&(C.background=C.background+"_semi")):45===_?C.background="transparent":(C.foreground="black",47===_&&(C.underline=!0));var w=R<=23?1:2;return this.channels[w].setBkgData(C),S(R,_,this.cmdHistory),!0},R.reset=function e(){for(var R=0;R<Object.keys(this.channels).length;R++){var _=this.channels[R];_&&_.reset()}this.cmdHistory={"a":null,"b":null}},R.cueSplitAtTime=function e(R){for(var _=0;_<this.channels.length;_++){var I=this.channels[_];I&&I.cueSplitAtTime(R)}},e}();function S(R,_,I){I.a=R,I.b=_}function A(R,_,I){return I.a===R&&I.b===_}_.default=X},"./src/utils/codecs.ts":function _src_utils_codecsTs(R,_,I){I.r(_),I.d(_,"isCodecType",(function(){return a})),I.d(_,"isCodecSupportedInMp4",(function(){return n}));var C={"audio":{"a3ds":!0,"ac-3":!0,"ac-4":!0,"alac":!0,"alaw":!0,"dra1":!0,"dts+":!0,"dts-":!0,"dtsc":!0,"dtse":!0,"dtsh":!0,"ec-3":!0,"enca":!0,"g719":!0,"g726":!0,"m4ae":!0,"mha1":!0,"mha2":!0,"mhm1":!0,"mhm2":!0,"mlpa":!0,"mp4a":!0,"raw ":!0,"Opus":!0,"samr":!0,"sawb":!0,"sawp":!0,"sevc":!0,"sqcp":!0,"ssmv":!0,"twos":!0,"ulaw":!0},"video":{"avc1":!0,"avc2":!0,"avc3":!0,"avc4":!0,"avcp":!0,"av01":!0,"drac":!0,"dvav":!0,"dvhe":!0,"encv":!0,"hev1":!0,"hvc1":!0,"mjp2":!0,"mp4v":!0,"mvc1":!0,"mvc2":!0,"mvc3":!0,"mvc4":!0,"resv":!0,"rv60":!0,"s263":!0,"svc1":!0,"svc2":!0,"vc-1":!0,"vp08":!0,"vp09":!0},"text":{"stpp":!0,"wvtt":!0}};function a(R,_){var I=C[_];return!!I&&!0===I[R.slice(0,4)]}function n(R,_){return MediaSource.isTypeSupported((_||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":function _src_utils_cuesTs(R,_,I){I.r(_);var C=I("./src/utils/vttparser.ts"),w=I("./src/utils/webvtt-parser.ts"),O=I("./src/utils/texttrack-utils.ts"),x=/\s/,P={"newCue":function e(R,_,I,P){for(var F,M,N,B,U,G=[],j=self.VTTCue||self.TextTrackCue,K=0;K<P.rows.length;K++)if(N=!0,B=0,U="",!(F=P.rows[K]).isEmpty()){for(var H=0;H<F.chars.length;H++)x.test(F.chars[H].uchar)&&N?B++:(U+=F.chars[H].uchar,N=!1);F.cueStartTime=_,_===I&&(I+=1e-4),B>=16?B--:B++;var V=Object(C.fixLineBreaks)(U.trim()),W=Object(w.generateCueId)(_,I,V);R&&R.cues&&R.cues.getCueById(W)||((M=new j(_,I,V)).id=W,M.line=K+1,M.align="left",M.position=10+Math.min(80,10*Math.floor(8*B/32)),G.push(M))}return R&&G.length&&(G.sort((function(R,_){return"auto"===R.line||"auto"===_.line?0:R.line>8&&_.line>8?_.line-R.line:R.line-_.line})),G.forEach((function(_){return Object(O.addCueToTrack)(R,_)}))),G}};_.default=P},"./src/utils/discontinuities.ts":function _src_utils_discontinuitiesTs(R,_,I){I.r(_),I.d(_,"findFirstFragWithCC",(function(){return s})),I.d(_,"shouldAlignOnDiscontinuities",(function(){return o})),I.d(_,"findDiscontinuousReferenceFrag",(function(){return l})),I.d(_,"adjustSlidingStart",(function(){return f})),I.d(_,"alignStream",(function(){return c})),I.d(_,"alignPDT",(function(){return h})),I.d(_,"alignFragmentByPDTDelta",(function(){return v})),I.d(_,"alignMediaPlaylistByPDT",(function(){return g}));var C=I("./src/polyfills/number.ts"),w=I("./src/utils/logger.ts"),O=I("./src/controller/level-helper.ts");function s(R,_){for(var I=null,C=0,w=R.length;C<w;C++){var O=R[C];if(O&&O.cc===_){I=O;break}}return I}function o(R,_,I){return!(!_.details||!(I.endCC>I.startCC||R&&R.cc<I.startCC))}function l(R,_){var I=R.fragments,C=_.fragments;if(C.length&&I.length){var O=s(I,C[0].cc);if(O&&(!O||O.startPTS))return O;w.logger.log("No frag in previous level to align on")}else w.logger.log("No fragments to align")}function u(R,_){if(R){var I=R.start+_;R.start=R.startPTS=I,R.endPTS=I+R.duration}}function f(R,_){for(var I=_.fragments,C=0,w=I.length;C<w;C++)u(I[C],R);_.fragmentHint&&u(_.fragmentHint,R),_.alignedSliding=!0}function c(R,_,I){_&&(!function d(R,_,I){if(o(R,I,_)){var O=l(I.details,_);O&&Object(C.isFiniteNumber)(O.start)&&(w.logger.log("Adjusting PTS using last level due to CC increase within current level "+_.url),f(O.start,_))}}(R,I,_),!I.alignedSliding&&_.details&&h(I,_.details),I.alignedSliding||!_.details||I.skippedSegments||Object(O.adjustSliding)(_.details,I))}function h(R,_){if(_.fragments.length&&R.hasProgramDateTime&&_.hasProgramDateTime){var I=_.fragments[0].programDateTime,O=R.fragments[0].programDateTime,x=(O-I)/1e3+_.fragments[0].start;x&&Object(C.isFiniteNumber)(x)&&(w.logger.log("Adjusting PTS using programDateTime delta "+(O-I)+"ms, sliding:"+x.toFixed(3)+" "+R.url+" "),f(x,R))}}function v(R,_){var I=R.programDateTime;if(I){var C=(I-_)/1e3;R.start=R.startPTS=C,R.endPTS=C+R.duration}}function g(R,_){if(_.fragments.length&&R.hasProgramDateTime&&_.hasProgramDateTime){var I=_.fragments[0].programDateTime-1e3*_.fragments[0].start;R.fragments.forEach((function(R){v(R,I)})),R.fragmentHint&&v(R.fragmentHint,I),R.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function _src_utils_ewmaBandwidthEstimatorTs(R,_,I){I.r(_);var C=I("./src/utils/ewma.ts"),w=function(){function e(R,_,I){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=I,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new C.default(R),this.fast_=new C.default(_)}var R=e.prototype;return R.update=function e(R,_){var I=this.slow_,w=this.fast_;this.slow_.halfLife!==R&&(this.slow_=new C.default(R,I.getEstimate(),I.getTotalWeight())),this.fast_.halfLife!==_&&(this.fast_=new C.default(_,w.getEstimate(),w.getTotalWeight()))},R.sample=function e(R,_){var I=(R=Math.max(R,this.minDelayMs_))/1e3,C=8*_/I;this.fast_.sample(I,C),this.slow_.sample(I,C)},R.canEstimate=function e(){var R=this.fast_;return R&&R.getTotalWeight()>=this.minWeight_},R.getEstimate=function e(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},R.destroy=function e(){},e}();_.default=w},"./src/utils/ewma.ts":function _src_utils_ewmaTs(R,_,I){I.r(_);var C=function(){function e(R,_,I){void 0===_&&(_=0),void 0===I&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=R,this.alpha_=R?Math.exp(Math.log(.5)/R):0,this.estimate_=_,this.totalWeight_=I}var R=e.prototype;return R.sample=function e(R,_){var I=Math.pow(this.alpha_,R);this.estimate_=_*(1-I)+I*this.estimate_,this.totalWeight_+=R},R.getTotalWeight=function e(){return this.totalWeight_},R.getEstimate=function e(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},e}();_.default=C},"./src/utils/fetch-loader.ts":function _src_utils_fetchLoaderTs(R,_,I){I.r(_),I.d(_,"fetchSupported",(function(){return v}));var C=I("./src/polyfills/number.ts"),w=I("./src/loader/load-stats.ts"),O=I("./src/demux/chunk-cache.ts");function o(R){var _="function"==typeof Map?new Map:void 0;return o=function e(R){if(null===R||!function f(R){return-1!==Function.toString.call(R).indexOf("[native code]")}(R))return R;if("function"!=typeof R)throw new TypeError("Super expression must either be null or a function");if(void 0!==_){if(_.has(R))return _.get(R);_.set(R,i)}function i(){return l(R,arguments,d(this).constructor)}return i.prototype=Object.create(R.prototype,{"constructor":{"value":i,"enumerable":!1,"writable":!0,"configurable":!0}}),c(i,R)},o(R)}function l(R,_,I){return l=function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(R){return!1}}()?Reflect.construct:function e(R,_,I){var C=[null];C.push.apply(C,_);var w=new(Function.bind.apply(R,C));return I&&c(w,I.prototype),w},l.apply(null,arguments)}function c(R,_){return c=Object.setPrototypeOf||function e(R,_){return R.__proto__=_,R},c(R,_)}function d(R){return d=Object.setPrototypeOf?Object.getPrototypeOf:function e(R){return R.__proto__||Object.getPrototypeOf(R)},d(R)}function h(){return h=Object.assign||function(R){for(var _=1;_<arguments.length;_++){var I=arguments[_];for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(R[C]=I[C])}return R},h.apply(this,arguments)}function v(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(R){}return!1}var x=function(){function e(R){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=R.fetchSetup||m,this.controller=new self.AbortController,this.stats=new w.LoadStats}var R=e.prototype;return R.destroy=function e(){this.loader=this.callbacks=null,this.abortInternal()},R.abortInternal=function e(){var R=this.response;R&&R.ok||(this.stats.aborted=!0,this.controller.abort())},R.abort=function e(){var R;this.abortInternal(),null!==(R=this.callbacks)&&void 0!==R&&R.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},R.load=function e(R,_,I){var w=this,O=this.stats;if(O.loading.start)throw new Error("Loader can only be used once.");O.loading.start=self.performance.now();var x=function p(R,_){var I={"method":"GET","mode":"cors","credentials":"same-origin","signal":_,"headers":new self.Headers(h({},R.headers))};R.rangeEnd&&I.headers.set("Range","bytes="+R.rangeStart+"-"+String(R.rangeEnd-1));return I}(R,this.controller.signal),F=I.onProgress,M="arraybuffer"===R.responseType,N=M?"byteLength":"length";this.context=R,this.config=_,this.callbacks=I,this.request=this.fetchSetup(R,x),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){w.abortInternal(),I.onTimeout(O,R,w.response)}),_.timeout),self.fetch(this.request).then((function(I){if(w.response=w.loader=I,!I.ok){var x=I.status,N=I.statusText;throw new P(N||"fetch, bad network response",x,I)}return O.loading.first=Math.max(self.performance.now(),O.loading.start),O.total=parseInt(I.headers.get("Content-Length")||"0"),F&&Object(C.isFiniteNumber)(_.highWaterMark)?w.loadProgressively(I,O,R,_.highWaterMark,F):M?I.arrayBuffer():I.text()})).then((function(x){var P=w.response;self.clearTimeout(w.requestTimeout),O.loading.end=Math.max(self.performance.now(),O.loading.first),O.loaded=O.total=x[N];var M={"url":P.url,"data":x};F&&!Object(C.isFiniteNumber)(_.highWaterMark)&&F(O,R,x,P),I.onSuccess(M,O,R,P)})).catch((function(_){if(self.clearTimeout(w.requestTimeout),!O.aborted){var C=_.code||0;I.onError({"code":C,"text":_.message},R,_.details)}}))},R.getCacheAge=function e(){var R=null;if(this.response){var _=this.response.headers.get("age");R=_?parseFloat(_):null}return R},R.loadProgressively=function e(R,_,I,C,w){void 0===C&&(C=0);var x=new O.default,P=R.body.getReader();return function e(){return P.read().then((function(O){if(O.done)return x.dataLength&&w(_,I,x.flush(),R),Promise.resolve(new ArrayBuffer(0));var P=O.value,F=P.length;return _.loaded+=F,F<C||x.dataLength?(x.push(P),x.dataLength>=C&&w(_,I,x.flush(),R)):w(_,I,P,R),e()})).catch((function(){return Promise.reject()}))}()},e}();function m(R,_){return new self.Request(R.url,_)}var P=function(R){function t(_,I,C){var w;return(w=R.call(this,_)||this).code=void 0,w.details=void 0,w.code=I,w.details=C,w}return function s(R,_){R.prototype=Object.create(_.prototype),R.prototype.constructor=R,c(R,_)}(t,R),t}(o(Error));_.default=x},"./src/utils/imsc1-ttml-parser.ts":function _src_utils_imsc1TtmlParserTs(R,_,I){I.r(_),I.d(_,"IMSC1_CODEC",(function(){return M})),I.d(_,"parseIMSC1",(function(){return v}));var C=I("./src/utils/mp4-tools.ts"),w=I("./src/utils/vttparser.ts"),O=I("./src/utils/vttcue.ts"),x=I("./src/demux/id3.ts"),P=I("./src/utils/timescale-conversion.ts"),F=I("./src/utils/webvtt-parser.ts");function u(){return u=Object.assign||function(R){for(var _=1;_<arguments.length;_++){var I=arguments[_];for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(R[C]=I[C])}return R},u.apply(this,arguments)}var M="stpp.ttml.im1t",N=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,B=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,U={"left":"start","center":"center","right":"end","start":"start","end":"end"};function v(R,_,I,w,O){var F=Object(C.findBox)(new Uint8Array(R),["mdat"]);if(0!==F.length){var M=F[0],N=Object(x.utf8ArrayToStr)(new Uint8Array(R,M.start,M.end-M.start)),B=Object(P.toTimescaleFromScale)(_,1,I);try{w(g(N,B))}catch(R){O(R)}}else O(new Error("Could not parse IMSC1 mdat"))}function g(R,_){var I=(new DOMParser).parseFromString(R,"text/xml").getElementsByTagName("tt")[0];if(!I)throw new Error("Invalid ttml");var C={"frameRate":30,"subFrameRate":1,"frameRateMultiplier":0,"tickRate":0},w=Object.keys(C).reduce((function(R,_){return R[_]=I.getAttribute("ttp:"+_)||C[_],R}),{}),x="preserve"!==I.getAttribute("xml:space"),P=m(p(I,"styling","style")),M=m(p(I,"layout","region")),N=p(I,"body","[begin]");return[].map.call(N,(function(R){var I=y(R,x);if(!I||!R.hasAttribute("begin"))return null;var C=S(R.getAttribute("begin"),w),N=S(R.getAttribute("dur"),w),B=S(R.getAttribute("end"),w);if(null===C)throw b(R);if(null===B){if(null===N)throw b(R);B=C+N}var G=new O.default(C-_,B-_,I);G.id=Object(F.generateCueId)(G.startTime,G.endTime,G.text);var j=M[R.getAttribute("region")],K=P[R.getAttribute("style")];G.position=10,G.size=80;var H=E(j,K),V=H.textAlign;if(V){var W=U[V];W&&(G.lineAlign=W),G.align=V}return u(G,H),G})).filter((function(R){return null!==R}))}function p(R,_,I){var C=R.getElementsByTagName(_)[0];return C?[].slice.call(C.querySelectorAll(I)):[]}function m(R){return R.reduce((function(R,_){var I=_.getAttribute("xml:id");return I&&(R[I]=_),R}),{})}function y(R,_){return[].slice.call(R.childNodes).reduce((function(R,I,C){var w;return"br"===I.nodeName&&C?R+"\n":null!==(w=I.childNodes)&&void 0!==w&&w.length?y(I,_):_?R+I.textContent.trim().replace(/\s+/g," "):R+I.textContent}),"")}function E(R,_){var I="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(C,w){var O=T(_,I,w)||T(R,I,w);return O&&(C[w]=O),C}),{})}function T(R,_,I){return R.hasAttributeNS(_,I)?R.getAttributeNS(_,I):null}function b(R){return new Error("Could not parse ttml timestamp "+R)}function S(R,_){if(!R)return null;var I=Object(w.parseTimeStamp)(R);return null===I&&(N.test(R)?I=function A(R,_){var I=N.exec(R),C=(0|I[4])+(0|I[5])/_.subFrameRate;return 3600*(0|I[1])+60*(0|I[2])+(0|I[3])+C/_.frameRate}(R,_):B.test(R)&&(I=function L(R,_){var I=B.exec(R),C=Number(I[1]);switch(I[2]){case"h":return 3600*C;case"m":return 60*C;case"ms":return 1e3*C;case"f":return C/_.frameRate;case"t":return C/_.tickRate}return C}(R,_))),I}},"./src/utils/logger.ts":function _src_utils_loggerTs(R,_,I){I.r(_),I.d(_,"enableLogs",(function(){return l})),I.d(_,"logger",(function(){return x}));var C=function e(){},w={"trace":C,"debug":C,"log":C,"warn":C,"info":C,"error":C},O=w;function s(R){var _=self.console[R];return _?_.bind(self.console,"["+R+"] >"):C}function l(R){if(self.console&&!0===R||"object"==typeof R){!function o(R){for(var _=arguments.length,I=new Array(_>1?_-1:0),C=1;C<_;C++)I[C-1]=arguments[C];I.forEach((function(_){O[_]=R[_]?R[_].bind(R):s(_)}))}(R,"debug","log","info","warn","error");try{O.log()}catch(R){O=w}}else O=w}var x=w},"./src/utils/mediakeys-helper.ts":function _src_utils_mediakeysHelperTs(R,_,I){var C;I.r(_),I.d(_,"KeySystems",(function(){return C})),I.d(_,"requestMediaKeySystemAccess",(function(){return w})),function(R){R.WIDEVINE="com.widevine.alpha",R.PLAYREADY="com.microsoft.playready"}(C||(C={}));var w="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function _src_utils_mediasourceHelperTs(R,_,I){function i(){return self.MediaSource||self.WebKitMediaSource}I.r(_),I.d(_,"getMediaSource",(function(){return i}))},"./src/utils/mp4-tools.ts":function _src_utils_mp4ToolsTs(R,_,I){I.r(_),I.d(_,"bin2str",(function(){return o})),I.d(_,"readUint16",(function(){return l})),I.d(_,"readUint32",(function(){return u})),I.d(_,"writeUint32",(function(){return f})),I.d(_,"findBox",(function(){return c})),I.d(_,"parseSegmentIndex",(function(){return d})),I.d(_,"parseInitSegment",(function(){return h})),I.d(_,"getStartDTS",(function(){return v})),I.d(_,"getDuration",(function(){return g})),I.d(_,"computeRawDurationFromSamples",(function(){return p})),I.d(_,"offsetStartDTS",(function(){return m})),I.d(_,"segmentValidRange",(function(){return y})),I.d(_,"appendUint8Array",(function(){return E}));var C=I("./src/utils/typed-array.ts"),w=I("./src/loader/fragment.ts"),O=Math.pow(2,32)-1,x=[].push;function o(R){return String.fromCharCode.apply(null,R)}function l(R,_){"data"in R&&(_+=R.start,R=R.data);var I=R[_]<<8|R[_+1];return I<0?65536+I:I}function u(R,_){"data"in R&&(_+=R.start,R=R.data);var I=R[_]<<24|R[_+1]<<16|R[_+2]<<8|R[_+3];return I<0?4294967296+I:I}function f(R,_,I){"data"in R&&(_+=R.start,R=R.data),R[_]=I>>24,R[_+1]=I>>16&255,R[_+2]=I>>8&255,R[_+3]=255&I}function c(R,_){var I,C,w,O=[];if(!_.length)return O;"data"in R?(I=R.data,C=R.start,w=R.end):(C=0,w=(I=R).byteLength);for(var P=C;P<w;){var F=u(I,P),M=F>1?P+F:w;if(o(I.subarray(P+4,P+8))===_[0])if(1===_.length)O.push({"data":I,"start":P+8,"end":M});else{var N=c({"data":I,"start":P+8,"end":M},_.slice(1));N.length&&x.apply(O,N)}P=M}return O}function d(R){var _=c(R,["moov"])[0],I=_?_.end:null,C=c(R,["sidx"]);if(!C||!C[0])return null;var w=[],O=C[0],x=O.data[0],P=0===x?8:16,F=u(O,P);P+=4;P+=0===x?8:16,P+=2;var M=O.end+0,N=l(O,P);P+=2;for(var B=0;B<N;B++){var U=P,G=u(O,U);U+=4;var j=2147483647&G;if(1===(2147483648&G)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var K=u(O,U);U+=4,w.push({"referenceSize":j,"subsegmentDuration":K,"info":{"duration":K/F,"start":M,"end":M+j-1}}),M+=j,P=U+=4}return{"earliestPresentationTime":0,"timescale":F,"version":x,"referencesCount":N,"references":w,"moovEndOffset":I}}function h(R){for(var _=[],I=c(R,["moov","trak"]),C=0;C<I.length;C++){var O=I[C],x=c(O,["tkhd"])[0];if(x){var P=x.data[x.start],F=0===P?12:20,M=u(x,F),N=c(O,["mdia","mdhd"])[0];if(N){var B=u(N,F=0===(P=N.data[N.start])?12:20),U=c(O,["mdia","hdlr"])[0];if(U){var G=o(U.data.subarray(U.start+8,U.start+12)),j={"soun":w.ElementaryStreamTypes.AUDIO,"vide":w.ElementaryStreamTypes.VIDEO}[G];if(j){var K=c(O,["mdia","minf","stbl","stsd"])[0],H=void 0;K&&(H=o(K.data.subarray(K.start+12,K.start+16))),_[M]={"timescale":B,"type":j},_[j]={"timescale":B,"id":M,"codec":H}}}}}}return c(R,["moov","mvex","trex"]).forEach((function(R){var I=u(R,4),C=_[I];C&&(C.default={"duration":u(R,12),"flags":u(R,20)})})),_}function v(R,_){return c(_,["moof","traf"]).reduce((function(_,I){var C=c(I,["tfdt"])[0],w=C.data[C.start],O=c(I,["tfhd"]).reduce((function(_,I){var O=u(I,4),x=R[O];if(x){var P=u(C,4);1===w&&(P*=Math.pow(2,32),P+=u(C,8));var F=P/(x.timescale||9e4);if(isFinite(F)&&(null===_||F<_))return F}return _}),null);return null!==O&&isFinite(O)&&(null===_||O<_)?O:_}),null)||0}function g(R,_){for(var I=0,C=0,O=0,x=c(R,["moof","traf"]),P=0;P<x.length;P++){var F=x[P],M=c(F,["tfhd"])[0],N=_[u(M,4)];if(N){var B=N.default,U=u(M,0)|(null==B?void 0:B.flags),G=null==B?void 0:B.duration;8&U&&(G=u(M,2&U?12:8));for(var j=N.timescale||9e4,K=c(F,["trun"]),H=0;H<K.length;H++){if(!(I=p(K[H]))&&G)I=G*u(K[H],4);N.type===w.ElementaryStreamTypes.VIDEO?C+=I/j:N.type===w.ElementaryStreamTypes.AUDIO&&(O+=I/j)}}}if(0===C&&0===O){var V=d(R);if(null!=V&&V.references)return V.references.reduce((function(R,_){return R+_.info.duration||0}),0)}return C||O}function p(R){var _=u(R,0),I=8;1&_&&(I+=4),4&_&&(I+=4);for(var C=0,w=u(R,4),O=0;O<w;O++){if(256&_)C+=u(R,I),I+=4;512&_&&(I+=4),1024&_&&(I+=4),2048&_&&(I+=4)}return C}function m(R,_,I){c(_,["moof","traf"]).forEach((function(_){c(_,["tfhd"]).forEach((function(C){var w=u(C,4),x=R[w];if(x){var P=x.timescale||9e4;c(_,["tfdt"]).forEach((function(R){var _=R.data[R.start],C=u(R,4);if(0===_)f(R,4,C-I*P);else{C*=Math.pow(2,32),C+=u(R,8),C-=I*P,C=Math.max(C,0);var w=Math.floor(C/(O+1)),x=Math.floor(C%(O+1));f(R,4,w),f(R,8,x)}}))}}))}))}function y(R){var _={"valid":null,"remainder":null},I=c(R,["moof"]);if(!I)return _;if(I.length<2)return _.remainder=R,_;var w=I[I.length-1];return _.valid=Object(C.sliceUint8)(R,0,w.start-8),_.remainder=Object(C.sliceUint8)(R,w.start-8),_}function E(R,_){var I=new Uint8Array(R.length+_.length);return I.set(R),I.set(_,R.length),I}},"./src/utils/output-filter.ts":function _src_utils_outputFilterTs(R,_,I){I.r(_),I.d(_,"default",(function(){return C}));var C=function(){function e(R,_){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=_}var R=e.prototype;return R.dispatchCue=function e(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},R.newCue=function e(R,_,I){(null===this.startTime||this.startTime>R)&&(this.startTime=R),this.endTime=_,this.screen=I,this.timelineController.createCaptionsTrack(this.trackName)},R.reset=function e(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":function _src_utils_texttrackUtilsTs(R,_,I){I.r(_),I.d(_,"sendAddTrackEvent",(function(){return a})),I.d(_,"addCueToTrack",(function(){return n})),I.d(_,"clearCurrentCues",(function(){return s})),I.d(_,"removeCuesInRange",(function(){return o})),I.d(_,"getCuesInRange",(function(){return u}));var C=I("./src/utils/logger.ts");function a(R,_){var I;try{I=new Event("addtrack")}catch(R){(I=document.createEvent("Event")).initEvent("addtrack",!1,!1)}I.track=R,_.dispatchEvent(I)}function n(R,_){var I=R.mode;if("disabled"===I&&(R.mode="hidden"),R.cues&&!R.cues.getCueById(_.id))try{if(R.addCue(_),!R.cues.getCueById(_.id))throw new Error("addCue is failed for: "+_)}catch(I){C.logger.debug("[texttrack-utils]: "+I);var w=new self.TextTrackCue(_.startTime,_.endTime,_.text);w.id=_.id,R.addCue(w)}"disabled"===I&&(R.mode=I)}function s(R){var _=R.mode;if("disabled"===_&&(R.mode="hidden"),R.cues)for(var I=R.cues.length;I--;)R.removeCue(R.cues[I]);"disabled"===_&&(R.mode=_)}function o(R,_,I){var C=R.mode;if("disabled"===C&&(R.mode="hidden"),R.cues&&R.cues.length>0)for(var w=u(R.cues,_,I),O=0;O<w.length;O++)R.removeCue(w[O]);"disabled"===C&&(R.mode=C)}function u(R,_,I){var C=[],w=function l(R,_){if(_<R[0].startTime)return 0;var I=R.length-1;if(_>R[I].endTime)return-1;for(var C=0,w=I;C<=w;){var O=Math.floor((w+C)/2);if(_<R[O].startTime)w=O-1;else{if(!(_>R[O].startTime&&C<I))return O;C=O+1}}return R[C].startTime-_<_-R[w].startTime?C:w}(R,_);if(w>-1)for(var O=w,x=R.length;O<x;O++){var P=R[O];if(P.startTime>=_&&P.endTime<=I)C.push(P);else if(P.startTime>I)return C}return C}},"./src/utils/time-ranges.ts":function _src_utils_timeRangesTs(R,_,I){I.r(_);_.default={"toString":function e(R){for(var _="",I=R.length,C=0;C<I;C++)_+="["+R.start(C).toFixed(3)+","+R.end(C).toFixed(3)+"]";return _}}},"./src/utils/timescale-conversion.ts":function _src_utils_timescaleConversionTs(R,_,I){I.r(_),I.d(_,"toTimescaleFromBase",(function(){return a})),I.d(_,"toTimescaleFromScale",(function(){return n})),I.d(_,"toMsFromMpegTsClock",(function(){return s})),I.d(_,"toMpegTsClockFromTimescale",(function(){return o}));var C=9e4;function a(R,_,I,C){void 0===I&&(I=1),void 0===C&&(C=!1);var w=R*_*I;return C?Math.round(w):w}function n(R,_,I,C){return void 0===I&&(I=1),void 0===C&&(C=!1),a(R,_,1/I,C)}function s(R,_){return void 0===_&&(_=!1),a(R,1e3,1/C,_)}function o(R,_){return void 0===_&&(_=1),a(R,C,1/_)}},"./src/utils/typed-array.ts":function _src_utils_typedArrayTs(R,_,I){function i(R,_,I){return Uint8Array.prototype.slice?R.slice(_,I):new Uint8Array(Array.prototype.slice.call(R,_,I))}I.r(_),I.d(_,"sliceUint8",(function(){return i}))},"./src/utils/vttcue.ts":function _src_utils_vttcueTs(R,_,I){I.r(_),_.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var R=["","lr","rl"],_=["start","middle","end","left","right"];function r(R,_){if("string"!=typeof _)return!1;if(!Array.isArray(R))return!1;var I=_.toLowerCase();return!!~R.indexOf(I)&&I}function i(_){return r(R,_)}function a(R){return r(_,R)}function n(R){for(var _=arguments.length,I=new Array(_>1?_-1:0),C=1;C<_;C++)I[C-1]=arguments[C];for(var w=1;w<arguments.length;w++){var O=arguments[w];for(var x in O)R[x]=O[x]}return R}function s(R,_,I){var C=this,w={"enumerable":!0};C.hasBeenReset=!1;var O="",x=!1,P=R,F=_,M=I,N=null,B="",U=!0,G="auto",j="start",K=50,H="middle",V=50,W="middle";Object.defineProperty(C,"id",n({},w,{"get":function e(){return O},"set":function e(R){O=""+R}})),Object.defineProperty(C,"pauseOnExit",n({},w,{"get":function e(){return x},"set":function e(R){x=!!R}})),Object.defineProperty(C,"startTime",n({},w,{"get":function e(){return P},"set":function e(R){if("number"!=typeof R)throw new TypeError("Start time must be set to a number.");P=R,this.hasBeenReset=!0}})),Object.defineProperty(C,"endTime",n({},w,{"get":function e(){return F},"set":function e(R){if("number"!=typeof R)throw new TypeError("End time must be set to a number.");F=R,this.hasBeenReset=!0}})),Object.defineProperty(C,"text",n({},w,{"get":function e(){return M},"set":function e(R){M=""+R,this.hasBeenReset=!0}})),Object.defineProperty(C,"region",n({},w,{"get":function e(){return N},"set":function e(R){N=R,this.hasBeenReset=!0}})),Object.defineProperty(C,"vertical",n({},w,{"get":function e(){return B},"set":function e(R){var _=i(R);if(!1===_)throw new SyntaxError("An invalid or illegal string was specified.");B=_,this.hasBeenReset=!0}})),Object.defineProperty(C,"snapToLines",n({},w,{"get":function e(){return U},"set":function e(R){U=!!R,this.hasBeenReset=!0}})),Object.defineProperty(C,"line",n({},w,{"get":function e(){return G},"set":function e(R){if("number"!=typeof R&&"auto"!==R)throw new SyntaxError("An invalid number or illegal string was specified.");G=R,this.hasBeenReset=!0}})),Object.defineProperty(C,"lineAlign",n({},w,{"get":function e(){return j},"set":function e(R){var _=a(R);if(!_)throw new SyntaxError("An invalid or illegal string was specified.");j=_,this.hasBeenReset=!0}})),Object.defineProperty(C,"position",n({},w,{"get":function e(){return K},"set":function e(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");K=R,this.hasBeenReset=!0}})),Object.defineProperty(C,"positionAlign",n({},w,{"get":function e(){return H},"set":function e(R){var _=a(R);if(!_)throw new SyntaxError("An invalid or illegal string was specified.");H=_,this.hasBeenReset=!0}})),Object.defineProperty(C,"size",n({},w,{"get":function e(){return V},"set":function e(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");V=R,this.hasBeenReset=!0}})),Object.defineProperty(C,"align",n({},w,{"get":function e(){return W},"set":function e(R){var _=a(R);if(!_)throw new SyntaxError("An invalid or illegal string was specified.");W=_,this.hasBeenReset=!0}})),C.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}()},"./src/utils/vttparser.ts":function _src_utils_vttparserTs(R,_,I){I.r(_),I.d(_,"parseTimeStamp",(function(){return n})),I.d(_,"fixLineBreaks",(function(){return c})),I.d(_,"VTTParser",(function(){return F}));var C=I("./src/utils/vttcue.ts"),w=function(){function e(){}return e.prototype.decode=function e(R,_){if(!R)return"";if("string"!=typeof R)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(R))},e}();function n(R){function t(R,_,I,C){return 3600*(0|R)+60*(0|_)+(0|I)+parseFloat(C||0)}var _=R.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return _?parseFloat(_[2])>59?t(_[2],_[3],0,_[4]):t(_[1],_[2],_[3],_[4]):null}var O=function(){function e(){this.values=Object.create(null)}var R=e.prototype;return R.set=function e(R,_){this.get(R)||""===_||(this.values[R]=_)},R.get=function e(R,_,I){return I?this.has(R)?this.values[R]:_[I]:this.has(R)?this.values[R]:_},R.has=function e(R){return R in this.values},R.alt=function e(R,_,I){for(var C=0;C<I.length;++C)if(_===I[C]){this.set(R,_);break}},R.integer=function e(R,_){/^-?\d+$/.test(_)&&this.set(R,parseInt(_,10))},R.percent=function e(R,_){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(_)){var e=parseFloat(_);if(e>=0&&e<=100)return this.set(R,e),!0}return!1},e}();function o(R,_,I,C){var w=C?R.split(C):[R];for(var O in w)if("string"==typeof w[O]){var x=w[O].split(I);if(2===x.length)_(x[0],x[1])}}var x=new C.default(0,0,""),P="middle"===x.align?"middle":"center";function f(R,_,I){var C=R;function a(){var _=n(R);if(null===_)throw new Error("Malformed timestamp: "+C);return R=R.replace(/^[^\sa-zA-Z-]+/,""),_}function c(){R=R.replace(/^\s+/,"")}if(c(),_.startTime=a(),c(),"--\x3e"!==R.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+C);R=R.substr(3),c(),_.endTime=a(),c(),function f(R,_){var C=new O;o(R,(function(R,_){var w;switch(R){case"region":for(var O=I.length-1;O>=0;O--)if(I[O].id===_){C.set(R,I[O].region);break}break;case"vertical":C.alt(R,_,["rl","lr"]);break;case"line":w=_.split(","),C.integer(R,w[0]),C.percent(R,w[0])&&C.set("snapToLines",!1),C.alt(R,w[0],["auto"]),2===w.length&&C.alt("lineAlign",w[1],["start",P,"end"]);break;case"position":w=_.split(","),C.percent(R,w[0]),2===w.length&&C.alt("positionAlign",w[1],["start",P,"end","line-left","line-right","auto"]);break;case"size":C.percent(R,_);break;case"align":C.alt(R,_,["start",P,"end","left","right"])}}),/:/,/\s/),_.region=C.get("region",null),_.vertical=C.get("vertical","");var w=C.get("line","auto");"auto"===w&&-1===x.line&&(w=-1),_.line=w,_.lineAlign=C.get("lineAlign","start"),_.snapToLines=C.get("snapToLines",!0),_.size=C.get("size",100),_.align=C.get("align",P);var F=C.get("position","auto");"auto"===F&&50===x.position&&(F="start"===_.align||"left"===_.align?0:"end"===_.align||"right"===_.align?100:50),_.position=F}(R,_)}function c(R){return R.replace(/<br(?: \/)?>/gi,"\n")}var F=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new w,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var R=e.prototype;return R.parse=function e(R){var _=this;function a(){var R=_.buffer,I=0;for(R=c(R);I<R.length&&"\r"!==R[I]&&"\n"!==R[I];)++I;var C=R.substr(0,I);return"\r"===R[I]&&++I,"\n"===R[I]&&++I,_.buffer=R.substr(I),C}function n(R){o(R,(function(R,_){}),/:/)}R&&(_.buffer+=_.decoder.decode(R,{"stream":!0}));try{var I="";if("INITIAL"===_.state){if(!/\r\n|\n/.test(_.buffer))return this;var w=(I=a()).match(/^()?WEBVTT([ \t].*)?$/);if(!w||!w[0])throw new Error("Malformed WebVTT signature.");_.state="HEADER"}for(var O=!1;_.buffer;){if(!/\r\n|\n/.test(_.buffer))return this;switch(O?O=!1:I=a(),_.state){case"HEADER":/:/.test(I)?n(I):I||(_.state="ID");continue;case"NOTE":I||(_.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(I)){_.state="NOTE";break}if(!I)continue;if(_.cue=new C.default(0,0,""),_.state="CUE",-1===I.indexOf("--\x3e")){_.cue.id=I;continue}case"CUE":if(!_.cue){_.state="BADCUE";continue}try{f(I,_.cue,_.regionList)}catch(e){_.cue=null,_.state="BADCUE";continue}_.state="CUETEXT";continue;case"CUETEXT":var x=-1!==I.indexOf("--\x3e");if(!I||x&&(O=!0)){_.oncue&&_.cue&&_.oncue(_.cue),_.cue=null,_.state="ID";continue}if(null===_.cue)continue;_.cue.text&&(_.cue.text+="\n"),_.cue.text+=I;continue;case"BADCUE":I||(_.state="ID")}}}catch(e){"CUETEXT"===_.state&&_.cue&&_.oncue&&_.oncue(_.cue),_.cue=null,_.state="INITIAL"===_.state?"BADWEBVTT":"BADCUE"}return this},R.flush=function e(){var R=this;try{if((R.cue||"HEADER"===R.state)&&(R.buffer+="\n\n",R.parse()),"INITIAL"===R.state||"BADWEBVTT"===R.state)throw new Error("Malformed WebVTT signature.")}catch(e){R.onparsingerror&&R.onparsingerror(e)}return R.onflush&&R.onflush(),this},e}()},"./src/utils/webvtt-parser.ts":function _src_utils_webvttParserTs(R,_,I){I.r(_),I.d(_,"generateCueId",(function(){return d})),I.d(_,"parseWebVTT",(function(){return v}));var C=I("./src/polyfills/number.ts"),w=I("./src/utils/vttparser.ts"),O=I("./src/demux/id3.ts"),x=I("./src/utils/timescale-conversion.ts"),P=I("./src/remux/mp4-remuxer.ts"),F=/\r\n|\n\r|\n|\r/g,M=function e(R,_,I){return void 0===I&&(I=0),R.substr(I,_.length)===_},N=function e(R){var _=parseInt(R.substr(-3)),I=parseInt(R.substr(-6,2)),w=parseInt(R.substr(-9,2)),O=R.length>9?parseInt(R.substr(0,R.indexOf(":"))):0;if(!(Object(C.isFiniteNumber)(_)&&Object(C.isFiniteNumber)(I)&&Object(C.isFiniteNumber)(w)&&Object(C.isFiniteNumber)(O)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+R);return _+=1e3*I,_+=6e4*w,_+=36e5*O},B=function e(R){for(var e=5381,_=R.length;_;)e=33*e^R.charCodeAt(--_);return(e>>>0).toString()};function d(R,_,I){return B(R.toString())+B(_.toString())+B(I)}var U=function e(R,_,I){var C=R[_],w=R[C.prevCC];if(!w||!w.new&&C.new)return R.ccOffset=R.presentationOffset=C.start,void(C.new=!1);for(;null!==(O=w)&&void 0!==O&&O.new;){var O;R.ccOffset+=C.start-w.start,C.new=!1,w=R[(C=w).prevCC]}R.presentationOffset=I};function v(R,_,I,C,B,G,j,K){var H,V=new w.VTTParser,W=Object(O.utf8ArrayToStr)(new Uint8Array(R)).trim().replace(F,"\n").split("\n"),Y=[],z=Object(x.toMpegTsClockFromTimescale)(_,I),X="00:00.000",q=0,Z=0,Q=!0,J=!1;V.oncue=function(R){var _=C[B],I=C.ccOffset,w=(q-z)/9e4;if(null!=_&&_.new&&(void 0!==Z?I=C.ccOffset=_.start:U(C,B,w)),w&&(I=w-C.presentationOffset),J){var O=R.endTime-R.startTime,x=Object(P.normalizePts)(9e4*(R.startTime+I-Z),9e4*G)/9e4;R.startTime=x,R.endTime=x+O}var F=R.text.trim();R.text=decodeURIComponent(encodeURIComponent(F)),R.id||(R.id=d(R.startTime,R.endTime,F)),R.endTime>0&&Y.push(R)},V.onparsingerror=function(R){H=R},V.onflush=function(){H?K(H):j(Y)},W.forEach((function(R){if(Q){if(M(R,"X-TIMESTAMP-MAP=")){Q=!1,J=!0,R.substr(16).split(",").forEach((function(R){M(R,"LOCAL:")?X=R.substr(6):M(R,"MPEGTS:")&&(q=parseInt(R.substr(7)))}));try{Z=N(X)/1e3}catch(R){J=!1,H=R}return}""===R&&(Q=!1)}V.parse(R+"\n")})),V.flush()}},"./src/utils/xhr-loader.ts":function _src_utils_xhrLoaderTs(R,_,I){I.r(_);var C=I("./src/utils/logger.ts"),w=I("./src/loader/load-stats.ts"),O=/^age:\s*[\d.]+\s*$/m,x=function(){function e(R){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=R?R.xhrSetup:null,this.stats=new w.LoadStats,this.retryDelay=0}var R=e.prototype;return R.destroy=function e(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function e(){var R=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),R&&(R.onreadystatechange=null,R.onprogress=null,4!==R.readyState&&(this.stats.aborted=!0,R.abort()))},R.abort=function e(){var R;this.abortInternal(),null!==(R=this.callbacks)&&void 0!==R&&R.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function e(R,_,I){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=R,this.config=_,this.callbacks=I,this.retryDelay=_.retryDelay,this.loadInternal()},R.loadInternal=function e(){var R=this.config,_=this.context;if(R){var I=this.loader=new self.XMLHttpRequest,C=this.stats;C.loading.first=0,C.loaded=0;var w=this.xhrSetup;try{if(w)try{w(I,_.url)}catch(e){I.open("GET",_.url,!0),w(I,_.url)}I.readyState||I.open("GET",_.url,!0);var O=this.context.headers;if(O)for(var x in O)I.setRequestHeader(x,O[x])}catch(e){return void this.callbacks.onError({"code":I.status,"text":e.message},_,I)}_.rangeEnd&&I.setRequestHeader("Range","bytes="+_.rangeStart+"-"+(_.rangeEnd-1)),I.onreadystatechange=this.readystatechange.bind(this),I.onprogress=this.loadprogress.bind(this),I.responseType=_.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),R.timeout),I.send()}},R.readystatechange=function e(){var R=this.context,_=this.loader,I=this.stats;if(R&&_){var w=_.readyState,O=this.config;if(!I.aborted&&w>=2)if(self.clearTimeout(this.requestTimeout),0===I.loading.first&&(I.loading.first=Math.max(self.performance.now(),I.loading.start)),4===w){_.onreadystatechange=null,_.onprogress=null;var x=_.status;if(x>=200&&x<300){var P,F;if(I.loading.end=Math.max(self.performance.now(),I.loading.first),F="arraybuffer"===R.responseType?(P=_.response).byteLength:(P=_.responseText).length,I.loaded=I.total=F,!this.callbacks)return;var M=this.callbacks.onProgress;if(M&&M(I,R,P,_),!this.callbacks)return;var N={"url":_.responseURL,"data":P};this.callbacks.onSuccess(N,I,R,_)}else I.retry>=O.maxRetry||x>=400&&x<499?(C.logger.error(x+" while loading "+R.url),this.callbacks.onError({"code":x,"text":_.statusText},R,_)):(C.logger.warn(x+" while loading "+R.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,O.maxRetryDelay),I.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),O.timeout)}},R.loadtimeout=function e(){C.logger.warn("timeout while loading "+this.context.url);var R=this.callbacks;R&&(this.abortInternal(),R.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function e(R){var _=this.stats;_.loaded=R.loaded,R.lengthComputable&&(_.total=R.total)},R.getCacheAge=function e(){var R=null;if(this.loader&&O.test(this.loader.getAllResponseHeaders())){var _=this.loader.getResponseHeader("age");R=_?parseFloat(_):null}return R},e}();_.default=x}}).default}))})),U=(0,w.g)(B),__awaiter$1=function(R,_,I,C){function a(R){return R instanceof I?R:new I((function(_){_(R)}))}return new(I||(I=Promise))((function(I,w){function s(R){try{l(C.next(R))}catch(R){w(R)}}function o(R){try{l(C.throw(R))}catch(R){w(R)}}function l(R){R.done?I(R.value):a(R.value).then(s,o)}l((C=C.apply(R,_||[])).next())}))},G=function(){function e(R){var _=this;(0,C.r)(this,R),this.onPlay=(0,C.c)(this,"play",7),this.onPause=(0,C.c)(this,"pause",7),this.onEnded=(0,C.c)(this,"ended",7),this.onTimeUpdate=(0,C.c)(this,"timeupdate",7),this.onError=(0,C.c)(this,"error",7),this.onFullScreenChange=(0,C.c)(this,"fullscreenchange",7),this.onProgress=(0,C.c)(this,"progress",7),this.onLoadedMetaData=(0,C.c)(this,"loadedmetadata",7),this.currentTime=0,this.isDraggingProgress=!1,this.gestureType="none",this.controls=!0,this.autoplay=!1,this.loop=!1,this.muted=!1,this.initialTime=0,this.objectFit="contain",this.showProgress=!0,this.showFullscreenBtn=!0,this.showPlayBtn=!0,this.showCenterPlayBtn=!0,this.showMuteBtn=!1,this.danmuBtn=!1,this.enableDanmu=!1,this.enablePlayGesture=!1,this.enableProgressGesture=!0,this.vslideGesture=!1,this.vslideGestureInFullscreen=!0,this.nativeProps={},this._enableDanmu=!1,this.isPlaying=!1,this.isFirst=!0,this.isFullScreen=!1,this.fullScreenTimestamp=(new Date).getTime(),this.isMute=!1,this.analyzeGesture=function(R){var I,C={"type":"none"},w=R.touches[0].screenX,O=R.touches[0].screenY,x=w-_.lastTouchScreenX,F=O-_.lastTouchScreenY,M=_.isFullScreen?_.vslideGestureInFullscreen:_.vslideGesture;if("none"===_.gestureType){var N=function calcDist(R,_){return Math.sqrt(Math.pow(R,2)+Math.pow(_,2))}(x,F);if(N<10)return C;if(Math.abs(F)>=Math.abs(x)){if(!M)return C;_.gestureType="adjustVolume",_.lastVolume=_.videoRef.volume}else if(Math.abs(F)<Math.abs(x)){if(!_.enableProgressGesture)return C;_.gestureType="adjustProgress",_.lastPercentage=_.currentTime/(null!==(I=_.duration)&&void 0!==I?I:_._duration)}}return C.type=_.gestureType,C.dataX=P(x/200),C.dataY=P(F/200),C},this.loadNativePlayer=function(){_.videoRef&&(_.videoRef.src=_.src,_.videoRef.load())},this.init=function(){var R=_,I=R.src,C=R.videoRef;!function isHls(R){return/\.(m3u8)($|\?)/i.test(R)}(I)?_.loadNativePlayer():U.isSupported()?(_.hls&&_.hls.destroy(),_.hls=new U,_.hls.loadSource(I),_.hls.attachMedia(C),_.hls.on(U.Events.MANIFEST_PARSED,(function(){_.autoplay&&_.play()})),_.hls.on(U.Events.ERROR,(function(R,I){_.handleError(I)}))):C.canPlayType("application/vnd.apple.mpegurl")?_.loadNativePlayer():console.error(" HLS ")},this.handlePlay=function(){_.isPlaying=!0,_.isFirst=!1,_.controlsRef.toggleVisibility(!0),_.onPlay.emit()},this.handlePause=function(){_.isPlaying=!1,_.controlsRef.toggleVisibility(!0),_.onPause.emit()},this.handleEnded=function(){_.isFirst=!0,_.pause(),_.controlsRef.toggleVisibility(),_.onEnded.emit()},this.handleTimeUpdate=(0,O.t)((function(R){return __awaiter$1(_,void 0,void 0,(function(){var _,I,C,w;return __generator(this,(function(O){switch(O.label){case 0:return this.currentTime=this.videoRef.currentTime,C=this.duration||this._duration,[4,this.controlsRef.getIsDraggingProgressBall()];case 1:return w=O.sent(),this.controls&&this.showProgress&&(w||this.isDraggingProgress||(this.controlsRef.setProgressBall(this.currentTime/C),this.controlsRef.setCurrentTime(this.currentTime))),this.danmuRef.tick(this.currentTime),this.onTimeUpdate.emit({"duration":null===(_=R.target)||void 0===_?void 0:_.duration,"currentTime":null===(I=R.target)||void 0===I?void 0:I.currentTime}),this.duration&&this.currentTime>=this.duration&&(this.seek(0),this.handleEnded()),[2]}}))}))}),250),this.handleError=function(R){var I,C;if(_.hls)switch(R.type){case U.ErrorTypes.NETWORK_ERROR:_.onError.emit({"errMsg":R.response}),_.hls.startLoad();break;case U.ErrorTypes.MEDIA_ERROR:_.onError.emit({"errMsg":R.reason||","}),_.hls.recoverMediaError()}else _.onError.emit({"errMsg":null===(C=null===(I=R.target)||void 0===I?void 0:I.error)||void 0===C?void 0:C.message})},this.handleDurationChange=function(){_._duration=_.videoRef.duration},this.handleProgress=function(){_.onProgress.emit()},this.handleLoadedMetaData=function(R){var I=R.target;_.onLoadedMetaData.emit({"width":I.videoWidth,"height":I.videoHeight,"duration":I.duration})},this._play=function(){return _.videoRef.play()},this._pause=function(){return _.videoRef.pause()},this._stop=function(){_.videoRef.pause(),_._seek(0)},this._seek=function(R){_.videoRef.currentTime=R},this.onTouchStartContainer=function(R){_.lastTouchScreenX=R.touches[0].screenX,_.lastTouchScreenY=R.touches[0].screenY},this.onClickContainer=function(){if(_.enablePlayGesture){var R=Date.now();R-_.lastClickedTime<300&&(_.isPlaying?_.pause():_.play()),_.lastClickedTime=R}_.controlsRef.toggleVisibility()},this.onClickFullScreenBtn=function(R){R.stopPropagation(),_.toggleFullScreen()},this.handleFullScreenChange=function(R){var I=(new Date).getTime();!R.detail&&_.isFullScreen&&!document[M.fullscreenElement]&&I-_.fullScreenTimestamp>100&&_.toggleFullScreen(!1)},this.toggleFullScreen=function(R){void 0===R&&(R=!_.isFullScreen),_.isFullScreen=R,_.controlsRef.toggleVisibility(!0),_.fullScreenTimestamp=(new Date).getTime(),_.onFullScreenChange.emit({"fullScreen":_.isFullScreen,"direction":"vertical"}),_.isFullScreen&&!document[M.fullscreenElement]&&setTimeout((function(){_.videoRef[M.requestFullscreen]({"navigationUI":"auto"})}),0)},this.toggleMute=function(R){R.stopPropagation(),_.videoRef.muted=!_.isMute,_.controlsRef.toggleVisibility(!0),_.isMute=!_.isMute},this.toggleDanmu=function(R){R.stopPropagation(),_.controlsRef.toggleVisibility(!0),_._enableDanmu=!_._enableDanmu}}return e.prototype.componentWillLoad=function(){this._enableDanmu=this.enableDanmu},e.prototype.componentDidLoad=function(){this.init(),this.initialTime&&(this.videoRef.currentTime=this.initialTime),this.danmuRef.sendDanmu(this.danmuList),document.addEventListener&&document.addEventListener(M.fullscreenchange,this.handleFullScreenChange),this.videoRef&&"iOS"===F&&this.videoRef.addEventListener("webkitendfullscreen",this.handleFullScreenChange)},e.prototype.componentDidRender=function(){},e.prototype.disconnectedCallback=function(){document.removeEventListener&&document.removeEventListener(M.fullscreenchange,this.handleFullScreenChange),this.videoRef&&"iOS"===F&&this.videoRef.removeEventListener("webkitendfullscreen",this.handleFullScreenChange)},e.prototype.watchEnableDanmu=function(R){this._enableDanmu=R},e.prototype.watchSrc=function(){this.init()},e.prototype.onDocumentTouchMove=function(R){return __awaiter$1(this,void 0,void 0,(function(){var _,I,C;return __generator(this,(function(w){switch(w.label){case 0:return void 0===this.lastTouchScreenX||void 0===this.lastTouchScreenY?[2]:[4,this.controlsRef.getIsDraggingProgressBall()];case 1:return w.sent()||("adjustVolume"===(_=this.analyzeGesture(R)).type?(this.toastVolumeRef.style.visibility="visible",I=Math.max(Math.min(this.lastVolume-_.dataY,1),0),this.videoRef.volume=I,this.toastVolumeBarRef.style.width=100*I+"%"):"adjustProgress"===_.type&&(this.isDraggingProgress=!0,this.nextPercentage=Math.max(Math.min(this.lastPercentage+_.dataX,1),0),this.controls&&this.showProgress&&(this.controlsRef.setProgressBall(this.nextPercentage),this.controlsRef.toggleVisibility(!0)),C=this.duration||this._duration,this.toastProgressTitleRef.innerHTML=x(this.nextPercentage*C)+" / "+x(C),this.toastProgressRef.style.visibility="visible")),[2]}}))}))},e.prototype.onDocumentTouchEnd=function(){var R;"adjustVolume"===this.gestureType?this.toastVolumeRef.style.visibility="hidden":"adjustProgress"===this.gestureType&&(this.toastProgressRef.style.visibility="hidden"),this.isDraggingProgress&&(this.isDraggingProgress=!1,this.seek(this.nextPercentage*(null!==(R=this.duration)&&void 0!==R?R:this._duration))),this.gestureType="none",this.lastTouchScreenX=void 0,this.lastTouchScreenY=void 0},e.prototype.play=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this._play(),[2]}))}))},e.prototype.pause=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this._pause(),[2]}))}))},e.prototype.stop=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this._stop(),[2]}))}))},e.prototype.seek=function(R){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(_){return this._seek(R),[2]}))}))},e.prototype.requestFullScreen=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this.toggleFullScreen(!0),[2]}))}))},e.prototype.exitFullScreen=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this.toggleFullScreen(!1),[2]}))}))},e.prototype.render=function(){var R=this,_=this,I=_.controls,O=_.autoplay,P=_.loop,F=_.muted,M=_.poster,N=_.objectFit,B=_.isFirst,U=_.isMute,G=_.isFullScreen,j=_.showCenterPlayBtn,K=_.isPlaying,H=_._enableDanmu,V=_.showMuteBtn,W=_.danmuBtn,Y=_.showFullscreenBtn,z=_.nativeProps,X=this.duration||this._duration,q=x(X);return(0,C.h)(C.H,{"class":(0,w.c)("taro-video-container",{"taro-video-type-fullscreen":G}),"onTouchStart":this.onTouchStartContainer,"onClick":this.onClickContainer},(0,C.h)("video",Object.assign({"class":"taro-video-video","style":{"object-fit":N},"ref":function ref(_){_&&(R.videoRef=_)},"autoplay":O,"loop":P,"muted":F,"poster":I?M:void 0,"playsinline":!0,"webkit-playsinline":!0,"onPlay":this.handlePlay,"onPause":this.handlePause,"onEnded":this.handleEnded,"onTimeUpdate":this.handleTimeUpdate,"onError":this.handleError,"onDurationChange":this.handleDurationChange,"onProgress":this.handleProgress,"onLoadedMetaData":this.handleLoadedMetaData},z),""),(0,C.h)("taro-video-danmu",{"ref":function ref(_){_&&(R.danmuRef=_)},"enable":H}),B&&j&&!K&&(0,C.h)("div",{"class":"taro-video-cover"},(0,C.h)("div",{"class":"taro-video-cover-play-button","onClick":function onClick(){return R.play()}}),(0,C.h)("p",{"class":"taro-video-cover-duration"},q)),(0,C.h)("taro-video-control",{"ref":function ref(_){_&&(R.controlsRef=_)},"controls":I,"currentTime":this.currentTime,"duration":X,"isPlaying":this.isPlaying,"pauseFunc":this._pause,"playFunc":this._play,"seekFunc":this._seek,"showPlayBtn":this.showPlayBtn,"showProgress":this.showProgress},V&&(0,C.h)("div",{"class":(0,w.c)("taro-video-mute",{"taro-video-type-mute":U}),"onClick":this.toggleMute}),W&&(0,C.h)("div",{"class":(0,w.c)("taro-video-danmu-button",{"taro-video-danmu-button-active":H}),"onClick":this.toggleDanmu},""),Y&&(0,C.h)("div",{"class":(0,w.c)("taro-video-fullscreen",{"taro-video-type-fullscreen":G}),"onClick":this.onClickFullScreenBtn})),(0,C.h)("div",{"class":"taro-video-toast taro-video-toast-volume","ref":function ref(_){_&&(R.toastVolumeRef=_)}},(0,C.h)("div",{"class":"taro-video-toast-title"},""),(0,C.h)("div",{"class":"taro-video-toast-icon"}),(0,C.h)("div",{"class":"taro-video-toast-value"},(0,C.h)("div",{"class":"taro-video-toast-value-content","ref":function ref(_){_&&(R.toastVolumeBarRef=_)}},(0,C.h)("div",{"class":"taro-video-toast-volume-grids"},Array(10).fill(1).map((function(){return(0,C.h)("div",{"class":"taro-video-toast-volume-grids-item"})})))))),(0,C.h)("div",{"class":"taro-video-toast taro-video-toast-progress","ref":function ref(_){_&&(R.toastProgressRef=_)}},(0,C.h)("div",{"class":"taro-video-toast-title","ref":function ref(_){_&&(R.toastProgressTitleRef=_)}})))},Object.defineProperty(e.prototype,"el",{"get":function get(){return(0,C.g)(this)},"enumerable":!1,"configurable":!0}),Object.defineProperty(e,"watchers",{"get":function get(){return{"enableDanmu":["watchEnableDanmu"],"src":["watchSrc"]}},"enumerable":!1,"configurable":!0}),e}();G.style='.taro-video{display:inline-block;overflow:hidden;position:relative;width:100%;height:225px;line-height:0}.taro-video[hidden]{display:none}.taro-video-container{display:inline-block;position:absolute;left:0;top:0;width:100%;height:100%;background-color:#000;-o-object-position:inherit;object-position:inherit}.taro-video-container.taro-video-type-fullscreen{position:fixed;left:0;right:0;top:0;bottom:0;z-index:999}.taro-video-container.taro-video-type-fullscreen.taro-video-type-rotate-left{-webkit-transform:translate(-50%, -50%) rotate(-90deg);transform:translate(-50%, -50%) rotate(-90deg)}.taro-video-container.taro-video-type-fullscreen.taro-video-type-rotate-right{-webkit-transform:translate(-50%, -50%) rotate(90deg);transform:translate(-50%, -50%) rotate(90deg)}.taro-video-video{width:100%;height:100%;-o-object-position:inherit;object-position:inherit}.taro-video-cover{display:-ms-flexbox;display:flex;position:absolute;left:0;top:0;bottom:0;z-index:1;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;width:100%;background-color:rgba(1, 1, 1, 0.5);-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-box-pack:center;-webkit-box-align:center}.taro-video-cover-play-button{width:40px;height:40px;background-repeat:no-repeat;background-position:50% 50%;background-size:50%}.taro-video-cover-duration{margin-top:10px;line-height:1;font-size:16px;color:#fff}.taro-video-bar{display:-ms-flexbox;display:flex;visibility:hidden;overflow:hidden;position:absolute;right:0;bottom:0;z-index:1;-ms-flex-align:center;align-items:center;padding:0 10px;height:44px;background-color:rgba(0, 0, 0, 0.5);-webkit-box-align:center}.taro-video-bar.taro-video-bar-full{left:0}.taro-video-controls{display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;margin:0 8.5px}.taro-video-control-button{-webkit-box-sizing:content-box;box-sizing:content-box;margin-left:-8.5px;padding:14.5px 12.5px;width:13px;height:15px}.taro-video-control-button::after{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50% 50%;background-size:100%;content:""}.taro-video-control-button.taro-video-control-button-play::after,.taro-video-cover-play-button{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAeCAYAAAAy2w7YAAAAAXNSR0IArs4c6QAAAWhJREFUSA1j+P///0cgBoHjQGzCQCsAtgJB/AMy5wCxGNXtQ9iBwvoA5BUCMQvVLEQxHpNzDSjkRhXLMM3GKrIeKKpEkYVYjcUu+AMo3ALE3GRZiN1MvKKPgbIRJFuG10j8koeA0gZEW4jfLIKyf4EqpgOxMEELCRpFnIJ3QGU5QMyM00LizCFa1SWgSkeslhFtBGkKVwGVy6FYSJp+klR/A6quB2JOkIWMIK0oNlOf8xBoZDE9LAI7nYn6HsBq4l96WHQEaLUpAyiOaASeAM2NgvuPBpaACt82IEYtfKls0UagecpwXyAzqGTRdaA57sjmYrAptAjUsCkGYlYMg9EFyLQI1IiZB8Ti6Obh5JNh0QmgHlOcBuKSIMGi50C18UDMiMssvOJEWPQLqKYbiHnxGkRIkoBF24DyaoTMIEoeh0W3geI+RBlArCI0iz4D+RVAzEasfqLVAQ19AcSg5LoYiKWI1kiiQgCMBLnEEcfDSgAAAABJRU5ErkJggg==")}.taro-video-control-button.taro-video-control-button-pause::after{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAgCAYAAAAffCjxAAAAAXNSR0IArs4c6QAAAFlJREFUSA3tksEKACAIQ7X//5zq98wOgQayum8QaGweHhMzG/6OujzKAymn+0LMqivu1XznWmX8/echTIyMyAgTwA72iIwwAexgj8gIE8CO3aMRbDPMaEy5BRGaKcZv8YxRAAAAAElFTkSuQmCC")}.taro-video-current-time,.taro-video-duration{margin-top:15px;margin-bottom:14.5px;height:14.5px;line-height:14.5px;font-size:12px;color:#cbcbcb}.taro-video-progress-container{position:relative;-ms-flex-positive:2;flex-grow:2;-webkit-box-flex:2}.taro-video-progress{position:relative;margin:21px 12px;height:2px;background-color:rgba(255, 255, 255, 0.4)}.taro-video-progress-buffered{position:absolute;left:0;top:0;width:0;height:100%;background-color:rgba(255, 255, 255, 0.8);-webkit-transition:width 0.1s;transition:width 0.1s}.taro-video-ball{position:absolute;left:0;top:-21px;-webkit-box-sizing:content-box;box-sizing:content-box;margin-left:-22px;padding:14px;width:16px;height:16px}.taro-video-inner{border-radius:50%;width:100%;height:100%;background-color:#fff}.taro-video-danmu-button{margin:0 8.5px;padding:2px 10px;border:1px solid #fff;border-radius:5px;line-height:1;font-size:13px;color:#fff;white-space:nowrap}.taro-video-danmu-button.taro-video-danmu-button-active{border-color:#48c23d;color:#48c23d}.taro-video-fullscreen,.taro-video-mute{-webkit-box-sizing:content-box;box-sizing:content-box;padding:8.5px;width:17px;height:17px;background-repeat:no-repeat;background-position:50% 50%;background-size:50%}.taro-video-fullscreen{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAhUlEQVRYR+2WSwrAMAhEnZO3PfmULLooGEFTiIXJ2s/kRY2wzQeb85sE9CRA8jSzY1YfAFzhJBnU1AVgxH2dSiArCnD9QgGzRNnOech48SRABHoSyFb5in3PSbhyo6yvCPQkEM3u7BsPe/0FIvBfAh/vhKmVbO9SWun1qk/PSVi9TcVPBG6R1YIhgWwNpQAAAABJRU5ErkJggg==")}.taro-video-fullscreen.taro-video-type-fullscreen{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+2Xu0pDURBF1/ZLxNcHKNiIlfhA7C0UBSEE8RNEBNFPUEQEEbGxFiSSSrCwEHsf5E/ccsSUuWfUhKQ40947+y42Z8+ZK/pcinzf9hhwD1xJ2q/qsb0JHAOzkl5y+lGAGnCWICQtZgAS6DxQk3TeLYA6cAo0JSXxjmW7CcwBdUkJurKiDhSA4kBvHbA9CqwBQx2O7BSw8ssU3ALPFRF4knT3nQLbr8B4LjLBOdAAFgJaLUkjbYC9n+zm+i4kXWbmwCqwnRMCHiXthuZAQOzPrxSA4kBxYDAcsH0EzATCfCLpJjOINoCtgFZabg7bk7AFDAeaGpKWgitZTu5N0kQbYBmYrujo9mX0CVxL+gidAdu9vY5zXhWA4sAgOND3X7NJ4AHYCaxkB8B62gslvecSFpoDOZH/PP8Cnt7hIaM5xCEAAAAASUVORK5CYII=")}.taro-video-mute{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAGAGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTktMDQtMTFUMTA6MTg6MjArMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE5LTA0LTExVDEwOjIyOjIyKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTA0LTExVDEwOjIyOjIyKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk3YmE4Yjg0LTFhNTYtNGM1MS04NDVkLTNiZmYyMGI0ZDc0ZiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjg1NGQ3MjlkLWUwNjctZjU0OC1hMTlhLTBlZjQ4OGRkYjJiOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjA1ODY3ZDFlLWQ3NGEtNDgyNC04MDU3LTYzYmRmMTdjODk5ZSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDU4NjdkMWUtZDc0YS00ODI0LTgwNTctNjNiZGYxN2M4OTllIiBzdEV2dDp3aGVuPSIyMDE5LTA0LTExVDEwOjE4OjIwKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6OTdiYThiODQtMWE1Ni00YzUxLTg0NWQtM2JmZjIwYjRkNzRmIiBzdEV2dDp3aGVuPSIyMDE5LTA0LTExVDEwOjIyOjIyKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz459+FoAAABqElEQVRYhc2XPWsVQRSGnxPjF4oGRfxoRQKGWCU2Ft7CykrQWosEyf/If0hhIPgHDEmbNJZqCFxiQEgTUGxsBUVEHgvnyrjZZJO92V1fGIaZnTPvszPszNlQ6VIjnbr/DwCoDLMNak/dUVfUK0f2rQugnlcX/FevWgFQH6gf3autRgHUC+piiXHzAOmtPx9gXgug8itQx9SXwDpw47AGKXZWvXvQmNFCwE3gCXA2dY0Az4GrRzHONA9cU/vAbERsllEOyh31e8USV2mrMPdG9uyn+rDom2/BHHCm5puWKiKmgdtAnz+rvaxO5mNygEvHaZ5BfADuARvAaWBpP4DGFBHfgBngFzClTrUKkCDeA+9S837rAEnbqb7VFcCpVJ/oCmCw959aB1AfAROpudYqgDoOLKRmPyLelAF8bcD4pPoMeAtcB34AT4uDBqXXwFG8XXUU/72MIuK1OgE8Bs6l7mEvo8up7lN1Ge0n9aK6VHMFZvJTr9S3CiALaCQhqZOSvegMIAvu2UVSWpigLC1fbQ0gm6in7qpfLCQbhwGIYcyPQ53/G3YO8BtUtd35bvKcVwAAAABJRU5ErkJggg==")}.taro-video-mute.taro-video-type-mute{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAgCAYAAAB3j6rJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGAGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTktMDQtMTFUMTA6MTk6MDMrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE5LTA0LTExVDEwOjIyOjMzKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTA0LTExVDEwOjIyOjMzKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAzYjJmNjE2LTZmZTUtNDJjNC1iNTgwLTczNzZjZjI2NzdmNSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjYzZjQ2NTYzLWE0ZjktOGQ0Mi1hM2FhLTY3ODJhNDBhYWNjMSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjIyYWNjMWFlLTg4ZmMtNDBlZi1iMWM1LTNmODgwY2QzYWI2MiI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjJhY2MxYWUtODhmYy00MGVmLWIxYzUtM2Y4ODBjZDNhYjYyIiBzdEV2dDp3aGVuPSIyMDE5LTA0LTExVDEwOjE5OjAzKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDNiMmY2MTYtNmZlNS00MmM0LWI1ODAtNzM3NmNmMjY3N2Y1IiBzdEV2dDp3aGVuPSIyMDE5LTA0LTExVDEwOjIyOjMzKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5PmxYVAAACLklEQVRYhc2XP2sVQRRHz40hKoqaQgVBCy1EozFlGiVFxMLGh4piYWEh+hkEP4YKAVFEEFTyughaCH6DqIVpAhYWEgIxoJE8cywyi5tNHu/tJmvyg2WZO3dmzt47/zZUtoJ6Nhsg09YDiYhKDzACTAFNYH9lEpUq80TdrT5wpV5n/ZV9KoGoo+pXV2uyKkipOaLuUceAt8DhUvQd1FsCYhR4ChzaSIBMHSOi7lOfsByFWiCgEBH1GHAF2JlMPcBt4GC3HUYEaj9wF3gVEVPtfNVTwAXgWX7CDKq/1piAZTSZBmim8qJ6sQ3EgDqb/L7kU3MH2NHtl3dQX3r3Ak21UYAYAj4A/cl0JB+RF+uMRj4iQ+p8zt7KYFLdXKHuRi0gacBhV6a6pd5bA6KRNagFJPU9qv5u47toLmW1HnoR8Q5oAK1CVQu4FBHj/wUkaXsb+4pzpVaQFPqXrN7Be4Fx9VztIOr1BLEtmX4A94E/qdwHTKjDWYM6lu81dSlnn3V570BtuLxaMs2rZ/IgYxsBovaoPwsQA4VoFWEm8ql5DiysNyURsQTMpOIMcDYiPhd8xoGr/FtNC2G6FKXD6ihwGdiVHMoeeh8jYlA9ANwE3kTEp3bO6vE03qOONzR1r/q4RGrquaFFxFxE3ALOA9+6jExpdb180y55AhirhaRTatq0GXEzL8+ZIuI9cBJ4WKiartJf9nWV/mty7UfUafW7erpqRGI9EBuprffvu9n6C1KOmsqwI5A1AAAAAElFTkSuQmCC")}.taro-video-danmu{overflow:visible;position:absolute;left:0;top:0;bottom:0;margin-top:14px;margin-bottom:44px;width:100%;line-height:14px;font-size:14px}.taro-video-danmu-item{position:absolute;left:100%;line-height:1;color:#fff;white-space:nowrap;-webkit-transform:translateX(0);transform:translateX(0);-webkit-transition-property:left, -webkit-transform;transition-property:left, -webkit-transform;transition-property:left, transform;transition-property:left, transform, -webkit-transform;-webkit-transition-duration:3s;transition-duration:3s;-webkit-transition-timing-function:linear;transition-timing-function:linear}.taro-video-toast{display:block;visibility:hidden;position:absolute;left:50%;top:50%;border-radius:5px;background-color:rgba(255, 255, 255, 0.8);pointer-events:none;color:#000;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%)}.taro-video-toast.taro-video-toast-volume{display:block;width:100px;height:100px}.taro-video-toast-volume .taro-video-toast-title{display:block;margin-top:10px;width:100%;line-height:16px;text-align:center;font-size:12px}.taro-video-toast-volume .taro-video-toast-icon{display:block;margin-left:25%;width:50%;height:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAFhklEQVR4Xu2aeaxfQxTHP1VBES0NIQitWtpaaxeCUkQtaYVa0tiClAq1ExIiQTVppaWxt8RWSa2tWkJQRGgtQaSIpUKEpG0ssbbk28yV2+mZO/e9e3vvu/e98897mZnfzPl+75mZs0wvurn06ub46SGgxwLqZaA3sB/wO/A+8G/V6tS5BU4BJgJbO9DvAMOB36okoQ4CNgAeBEYbQK8Bbm4zAdsBc4EdAyA/APZoKwHHAA8DG2UA/AnYrG0ErAVcD1yXA9gfQJ8c40obsqbPgH7AY8CROTVuFQFD3X7fJid4DWsNAWOAGZ0w58YTsDZwKzChA189PbTRBGwKzAYO6iT4srbAMHfTfAksjulS1iG4JzAH2Dy2YKS/qAVcCdzi1vgZOBZ4PWvNGAG6wgYCW0IwctzNmf06BcEXtYABwOeA4otEfgEOdnGGqV6IAAUopwM6zDYuAVjeKYpYwCjgCWOhH513+b2lhE+Avrj89NPyalzyuCIE6EN9BfQ1dHoPOAD40+9LE6D/5aoqSqtLsgiQC60DTiHzfGCFoaSsQAexZdlTgEuyCDgLuK8u5G7dEAHyKN8CBrtxLwDHAX8Z+l4N3GS0L3db4aN0X5opmc+2XZQAfb2LPd2eciG1lUSRJZ9qYHkZONwiYAjwSc3gs24BXWWWfzEVuMjQez13HljX8v7A28lvEgsInaBVcxLaAvr6sgJLtBWeNTrOB+4w2p8DRvoEnAPcXTVaY70QAbrbXwIONX7zBSAL/tvrk1+iviTllnRry2irr/QSEws4D7izCxMg1XQLLAQGGXpeCkw22kOWI49RMUujCJC+uwAfGtfcImAng4AtAMsBeg04pIkESOfbgQsMsNoGnxrtSrfv7rXrSlwXWN6kLZBgEBiB8iWUUZZPIN/AF1nMoiYSICDfAlt5iB4CxhpAzwXuMtqPBuY1lYB5wFEeqFeAwwyguvIUqvuiQO/xphJwP3Cmhyh0EKrOoGDIF7n+M5pKwEwXrqdBCaQSM77Ig7SSIicDs5pKwIvACA+pzFwZIF9OlKm36QyQV7jEqDDJk5VD58uFgGIGX1Se+6yJFqAKsqI6X84GdDb4Mh0Y5zUqjFYFakUTCXja5QLSmBQHbAL8ahAgT1AeYVreSKLLphGwF/CuAfLJQLldGSTFD75c5d4mNCoWyAqG9gYWGED1AOMKo12ZbiWA/idA++deY2DVTZ0Jh5UJPsFQtD/wDaAHGWl5EzgwaUi2gK4UXS11S0cTIjrMFBtYQdAk4DID0BnAAz4B6wNLgTKKG0VIDBHwqitwpOcW+OOB540FdeipNKbUWFrUtn06o5xOij4KyDuqU0IE3Obl/rLA63pTzm9XA8jKACjdniZAaSKFmUpB1yUhAlTsUEpMh913wEkuTe7rKTzPAHqO44vpKPkFhH3cWWBVV6ogJVYZUgz/tXtIYelzI3Ct0fExIGx6j7iKWBUUveyYBehv1RIjIEsfqziq8Xp4pSBJOYTVJFQcVY3wCFeKUjVGyYfQWB00+5bEVBECrNS+qsOKBpVHNCVWHs+LS7H5PV5pOu9v0+OKEOAXR39w1e1C7wM6AkJ1eLmkRcrpRQiQrqobXO5S3vL3/4kBKMsCknV0k+iasVLUMV3UX5SAPGtED8EOT+L9YENnCasUIXNO2goChFWHqAIRyxXN4qI1BCQg9dJESYq8LnbrCBAR8t50Lig6i0krCRBoVWhVlt45wkBrCRBuRZyPuAguxIPe9lXqhpd9DcZMXOvdkPF0Xu/8dohNUmZ/1QQkuitXr+d4fryuFx3jywQYm6suAqSX8vLTXKJDt4QqO6rtLYspXWZ/nQQkOJTAUJZGIav19q9MvKvN1RUIWKMAY5P3EBBjqO393d4C/gMVHwRQlpx21QAAAABJRU5ErkJggg==");background-repeat:no-repeat;background-position:50% 50%;background-size:50%;fill:#000}.taro-video-toast-volume .taro-video-toast-value{margin-left:10px;margin-top:5px;width:80px;height:5px}.taro-video-toast-volume .taro-video-toast-value>.taro-video-toast-value-content{overflow:hidden}.taro-video-toast-volume-grids{width:80px;height:5px}.taro-video-toast-volume-grids-item{float:left;width:7.1px;height:5px;background-color:#000}.taro-video-toast-volume-grids-item:not(:first-child){margin-left:1px}.taro-video-toast.taro-video-toast-progress{padding:6px;background-color:rgba(0, 0, 0, 0.8);line-height:18px;font-size:14px;color:#fff}';var __awaiter=function(R,_,I,C){function a(R){return R instanceof I?R:new I((function(_){_(R)}))}return new(I||(I=Promise))((function(I,w){function s(R){try{l(C.next(R))}catch(R){w(R)}}function o(R){try{l(C.throw(R))}catch(R){w(R)}}function l(R){R.done?I(R.value):a(R.value).then(s,o)}l((C=C.apply(R,_||[])).next())}))},j=function(){function e(R){(0,C.r)(this,R),this.list=[],this.danmuElList=[],this.currentTime=0,this.enable=!1,this.danmuList=[]}return e.prototype.ensureProperties=function(R){var _=Object.assign({},R);return"time"in R||(_.time=this.currentTime),_.key=Math.random(),_.bottom=90*Math.random()+5+"%",_},e.prototype.sendDanmu=function(R){return void 0===R&&(R=[]),__awaiter(this,void 0,void 0,(function(){var _,I=this;return __generator(this,(function(C){return Array.isArray(R)?this.list=__spreadArray(__spreadArray([],this.list),R.map((function(R){return I.ensureProperties(R)}))):(_=R,this.list=__spreadArray(__spreadArray([],this.list),[Object.assign({},this.ensureProperties(_))])),[2]}))}))},e.prototype.tick=function(R){return __awaiter(this,void 0,void 0,(function(){var _,I,C,w;return __generator(this,(function(O){return this.currentTime=R,this.enable?(_=this.list,I=_.filter((function(_){var I=_.time;return R-I<4&&R>I})),C=!1,w=this.danmuList,C=I.length!==w.length||I.some((function(R){var _=R.key;return w.every((function(R){return _!==R.key}))})),C&&(this.danmuList=I),[2]):[2]}))}))},e.prototype.componentDidUpdate=function(){var R=this;requestAnimationFrame((function(){setTimeout((function(){R.danmuElList.splice(0).forEach((function(R){R.style.left="0",R.style.webkitTransform="translateX(-100%)",R.style.transform="translateX(-100%)"}))}))}))},e.prototype.render=function(){var R=this;return this.enable?(0,C.h)(C.H,{"class":"taro-video-danmu"},this.danmuList.map((function(_){var I=_.text,w=_.color,O=_.bottom,x=_.key;return(0,C.h)("p",{"class":"taro-video-danmu-item","key":x,"style":{"color":w,"bottom":O},"ref":function ref(_){_&&R.danmuElList.push(_)}},I)}))):""},e}()}}]);