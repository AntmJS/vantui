/*! For license information please see 4753_ca62596c68e5c694be6e.js.LICENSE.txt */
"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[4753],{"4753":function(R,C,I){I.r(C),I.d(C,{"h":function(){return w}});var _=I(8840),O=(0,_.a)((function(R,C){"undefined"!=typeof window&&function t(C,I){R.exports=I()}(_.b,(function(){return function(R){var C={};function r(I){if(C[I])return C[I].exports;var _=C[I]={"i":I,"l":!1,"exports":{}};return R[I].call(_.exports,_,_.exports,r),_.l=!0,_.exports}return r.m=R,r.c=C,r.d=function(R,C,I){r.o(R,C)||Object.defineProperty(R,C,{"enumerable":!0,"get":I})},r.r=function(R){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(R,Symbol.toStringTag,{"value":"Module"}),Object.defineProperty(R,"__esModule",{"value":!0})},r.t=function(R,C){if(1&C&&(R=r(R)),8&C)return R;if(4&C&&"object"==typeof R&&R&&R.__esModule)return R;var I=Object.create(null);if(r.r(I),Object.defineProperty(I,"default",{"enumerable":!0,"value":R}),2&C&&"string"!=typeof R)for(var _ in R)r.d(I,_,function(C){return R[C]}.bind(null,_));return I},r.n=function(R){var C=R&&R.__esModule?function t(){return R.default}:function t(){return R};return r.d(C,"a",C),C},r.o=function(R,C){return Object.prototype.hasOwnProperty.call(R,C)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function node_modulesEventemitter3IndexJs(R,C,I){var _=Object.prototype.hasOwnProperty,O="~";function n(){}function s(R,C,I){this.fn=R,this.context=C,this.once=I||!1}function o(R,C,I,_,x){if("function"!=typeof I)throw new TypeError("The listener must be a function");var w=new s(I,_||R,x),P=O?O+C:C;return R._events[P]?R._events[P].fn?R._events[P]=[R._events[P],w]:R._events[P].push(w):(R._events[P]=w,R._eventsCount++),R}function l(R,C){0==--R._eventsCount?R._events=new n:delete R._events[C]}function u(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(O=!1)),u.prototype.eventNames=function e(){var R,C,I=[];if(0===this._eventsCount)return I;for(C in R=this._events)_.call(R,C)&&I.push(O?C.slice(1):C);return Object.getOwnPropertySymbols?I.concat(Object.getOwnPropertySymbols(R)):I},u.prototype.listeners=function e(R){var C=O?O+R:R,I=this._events[C];if(!I)return[];if(I.fn)return[I.fn];for(var _=0,x=I.length,w=new Array(x);_<x;_++)w[_]=I[_].fn;return w},u.prototype.listenerCount=function e(R){var C=O?O+R:R,I=this._events[C];return I?I.fn?1:I.length:0},u.prototype.emit=function e(R,C,I,_,x,w){var P=O?O+R:R;if(!this._events[P])return!1;var F,M,N=this._events[P],U=arguments.length;if(N.fn){switch(N.once&&this.removeListener(R,N.fn,void 0,!0),U){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,C),!0;case 3:return N.fn.call(N.context,C,I),!0;case 4:return N.fn.call(N.context,C,I,_),!0;case 5:return N.fn.call(N.context,C,I,_,x),!0;case 6:return N.fn.call(N.context,C,I,_,x,w),!0}for(M=1,F=new Array(U-1);M<U;M++)F[M-1]=arguments[M];N.fn.apply(N.context,F)}else{var B,G=N.length;for(M=0;M<G;M++)switch(N[M].once&&this.removeListener(R,N[M].fn,void 0,!0),U){case 1:N[M].fn.call(N[M].context);break;case 2:N[M].fn.call(N[M].context,C);break;case 3:N[M].fn.call(N[M].context,C,I);break;case 4:N[M].fn.call(N[M].context,C,I,_);break;default:if(!F)for(B=1,F=new Array(U-1);B<U;B++)F[B-1]=arguments[B];N[M].fn.apply(N[M].context,F)}}return!0},u.prototype.on=function e(R,C,I){return o(this,R,C,I,!1)},u.prototype.once=function e(R,C,I){return o(this,R,C,I,!0)},u.prototype.removeListener=function e(R,C,I,_){var x=O?O+R:R;if(!this._events[x])return this;if(!C)return l(this,x),this;var w=this._events[x];if(w.fn)w.fn!==C||_&&!w.once||I&&w.context!==I||l(this,x);else{for(var P=0,F=[],M=w.length;P<M;P++)(w[P].fn!==C||_&&!w[P].once||I&&w[P].context!==I)&&F.push(w[P]);F.length?this._events[x]=1===F.length?F[0]:F:l(this,x)}return this},u.prototype.removeAllListeners=function e(R){var C;return R?(C=O?O+R:R,this._events[C]&&l(this,C)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=O,u.EventEmitter=u,R.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":function node_modulesUrlToolkitSrcUrlToolkitJs(R,C,I){!function(C){var I=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,_=/^([^\/?#]*)([^]*)$/,O=/(?:\/|^)\.(?=\/)/g,x=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,w={"buildAbsoluteURL":function buildAbsoluteURL(R,C,I){if(I=I||{},R=R.trim(),!(C=C.trim())){if(!I.alwaysNormalize)return R;var O=w.parseURL(R);if(!O)throw new Error("Error trying to parse base URL.");return O.path=w.normalizePath(O.path),w.buildURLFromParts(O)}var x=w.parseURL(C);if(!x)throw new Error("Error trying to parse relative URL.");if(x.scheme)return I.alwaysNormalize?(x.path=w.normalizePath(x.path),w.buildURLFromParts(x)):C;var P=w.parseURL(R);if(!P)throw new Error("Error trying to parse base URL.");if(!P.netLoc&&P.path&&"/"!==P.path[0]){var F=_.exec(P.path);P.netLoc=F[1],P.path=F[2]}P.netLoc&&!P.path&&(P.path="/");var M={"scheme":P.scheme,"netLoc":x.netLoc,"path":null,"params":x.params,"query":x.query,"fragment":x.fragment};if(!x.netLoc&&(M.netLoc=P.netLoc,"/"!==x.path[0]))if(x.path){var N=P.path,U=N.substring(0,N.lastIndexOf("/")+1)+x.path;M.path=w.normalizePath(U)}else M.path=P.path,x.params||(M.params=P.params,x.query||(M.query=P.query));return null===M.path&&(M.path=I.alwaysNormalize?w.normalizePath(x.path):x.path),w.buildURLFromParts(M)},"parseURL":function parseURL(R){var C=I.exec(R);return C?{"scheme":C[1]||"","netLoc":C[2]||"","path":C[3]||"","params":C[4]||"","query":C[5]||"","fragment":C[6]||""}:null},"normalizePath":function normalizePath(R){for(R=R.split("").reverse().join("").replace(O,"");R.length!==(R=R.replace(x,"")).length;);return R.split("").reverse().join("")},"buildURLFromParts":function buildURLFromParts(R){return R.scheme+R.netLoc+R.path+R.params+R.query+R.fragment}};R.exports=w}()},"./node_modules/webworkify-webpack/index.js":function node_modulesWebworkifyWebpackIndexJs(R,C,I){function i(R){var C={};function r(I){if(C[I])return C[I].exports;var _=C[I]={"i":I,"l":!1,"exports":{}};return R[I].call(_.exports,_,_.exports,r),_.l=!0,_.exports}r.m=R,r.c=C,r.i=function(R){return R},r.d=function(R,C,I){r.o(R,C)||Object.defineProperty(R,C,{"configurable":!1,"enumerable":!0,"get":I})},r.r=function(R){Object.defineProperty(R,"__esModule",{"value":!0})},r.n=function(R){var C=R&&R.__esModule?function t(){return R.default}:function t(){return R};return r.d(C,"a",C),C},r.o=function(R,C){return Object.prototype.hasOwnProperty.call(R,C)},r.p="/",r.oe=function(R){throw console.error(R),R};var I=r(r.s=ENTRY_MODULE);return I.default||I}var _="[\\.|\\-|\\+|\\w|/|@]+",O="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+_+").*?\\)";function s(R){return(R+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(R){return!isNaN(1*R)}function l(R,C,x){var w={};w[x]=[];var P=C.toString(),F=P.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!F)return w;for(var M,N=F[1],U=new RegExp("(\\\\n|\\W)"+s(N)+O,"g");M=U.exec(P);)"dll-reference"!==M[3]&&w[x].push(M[3]);for(U=new RegExp("\\("+s(N)+'\\("(dll-reference\\s('+_+'))"\\)\\)'+O,"g");M=U.exec(P);)R[M[2]]||(w[x].push(M[1]),R[M[2]]=I(M[1]).m),w[M[2]]=w[M[2]]||[],w[M[2]].push(M[4]);for(var B=Object.keys(w),G=0;G<B.length;G++)for(var j=0;j<w[B[G]].length;j++)o(w[B[G]][j])&&(w[B[G]][j]=1*w[B[G]][j]);return w}function u(R){return Object.keys(R).reduce((function(C,I){return C||R[I].length>0}),!1)}function f(R,C){for(var I={"main":[C]},_={"main":[]},O={"main":{}};u(I);)for(var x=Object.keys(I),w=0;w<x.length;w++){var P=x[w],F=I[P].pop();if(O[P]=O[P]||{},!O[P][F]&&R[P][F]){O[P][F]=!0,_[P]=_[P]||[],_[P].push(F);for(var M=l(R,R[P][F],P),N=Object.keys(M),U=0;U<N.length;U++)I[N[U]]=I[N[U]]||[],I[N[U]]=I[N[U]].concat(M[N[U]])}}return _}R.exports=function(R,C){C=C||{};var _={"main":I.m},O=C.all?{"main":Object.keys(_.main)}:f(_,R),x="";Object.keys(O).filter((function(R){return"main"!==R})).forEach((function(R){for(var C=0;O[R][C];)C++;O[R].push(C),_[R][C]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",x=x+"var "+R+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(C))+")({"+O[R].map((function(C){return JSON.stringify(C)+": "+_[R][C].toString()})).join(",")+"});\n"})),x=x+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(R))+")({"+O.main.map((function(R){return JSON.stringify(R)+": "+_.main[R].toString()})).join(",")+"}))(self);";var w=new window.Blob([x],{"type":"text/javascript"});if(C.bare)return w;var P=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(w),F=new window.Worker(P);return F.objectURL=P,F}},"./src/config.ts":function srcConfigTs(R,C,I){I.r(C),I.d(C,"hlsDefaultConfig",(function(){return Y})),I.d(C,"mergeConfig",(function(){return D})),I.d(C,"enableStreamingMode",(function(){return k}));var _=I("./src/controller/abr-controller.ts"),O=I("./src/controller/audio-stream-controller.ts"),x=I("./src/controller/audio-track-controller.ts"),w=I("./src/controller/subtitle-stream-controller.ts"),P=I("./src/controller/subtitle-track-controller.ts"),F=I("./src/controller/buffer-controller.ts"),M=I("./src/controller/timeline-controller.ts"),N=I("./src/controller/cap-level-controller.ts"),U=I("./src/controller/fps-controller.ts"),B=I("./src/controller/eme-controller.ts"),G=I("./src/controller/cmcd-controller.ts"),j=I("./src/utils/xhr-loader.ts"),K=I("./src/utils/fetch-loader.ts"),H=I("./src/utils/cues.ts"),V=I("./src/utils/mediakeys-helper.ts"),W=I("./src/utils/logger.ts");function E(){return E=Object.assign||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var _ in I)Object.prototype.hasOwnProperty.call(I,_)&&(R[_]=I[_])}return R},E.apply(this,arguments)}function T(R,C){var I=Object.keys(R);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(R);C&&(_=_.filter((function(C){return Object.getOwnPropertyDescriptor(R,C).enumerable}))),I.push.apply(I,_)}return I}function S(R){for(var C=1;C<arguments.length;C++){var I=null!=arguments[C]?arguments[C]:{};C%2?T(Object(I),!0).forEach((function(C){b(R,C,I[C])})):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(I)):T(Object(I)).forEach((function(C){Object.defineProperty(R,C,Object.getOwnPropertyDescriptor(I,C))}))}return R}function b(R,C,I){return C in R?Object.defineProperty(R,C,{"value":I,"enumerable":!0,"configurable":!0,"writable":!0}):R[C]=I,R}var Y=S(S({"autoStartLoad":!0,"startPosition":-1,"defaultAudioCodec":void 0,"debug":!1,"capLevelOnFPSDrop":!1,"capLevelToPlayerSize":!1,"initialLiveManifestSize":1,"maxBufferLength":30,"backBufferLength":1/0,"maxBufferSize":6e7,"maxBufferHole":.1,"highBufferWatchdogPeriod":2,"nudgeOffset":.1,"nudgeMaxRetry":3,"maxFragLookUpTolerance":.25,"liveSyncDurationCount":3,"liveMaxLatencyDurationCount":1/0,"liveSyncDuration":void 0,"liveMaxLatencyDuration":void 0,"maxLiveSyncPlaybackRate":1,"liveDurationInfinity":!1,"liveBackBufferLength":null,"maxMaxBufferLength":600,"enableWorker":!0,"enableSoftwareAES":!0,"manifestLoadingTimeOut":1e4,"manifestLoadingMaxRetry":1,"manifestLoadingRetryDelay":1e3,"manifestLoadingMaxRetryTimeout":64e3,"startLevel":void 0,"levelLoadingTimeOut":1e4,"levelLoadingMaxRetry":4,"levelLoadingRetryDelay":1e3,"levelLoadingMaxRetryTimeout":64e3,"fragLoadingTimeOut":2e4,"fragLoadingMaxRetry":6,"fragLoadingRetryDelay":1e3,"fragLoadingMaxRetryTimeout":64e3,"startFragPrefetch":!1,"fpsDroppedMonitoringPeriod":5e3,"fpsDroppedMonitoringThreshold":.2,"appendErrorMaxRetry":3,"loader":j.default,"fLoader":void 0,"pLoader":void 0,"xhrSetup":void 0,"licenseXhrSetup":void 0,"licenseResponseCallback":void 0,"abrController":_.default,"bufferController":F.default,"capLevelController":N.default,"fpsController":U.default,"stretchShortVideoTrack":!1,"maxAudioFramesDrift":1,"forceKeyFrameOnDiscontinuity":!0,"abrEwmaFastLive":3,"abrEwmaSlowLive":9,"abrEwmaFastVoD":3,"abrEwmaSlowVoD":9,"abrEwmaDefaultEstimate":5e5,"abrBandWidthFactor":.95,"abrBandWidthUpFactor":.7,"abrMaxWithRealBitrate":!1,"maxStarvationDelay":4,"maxLoadingDelay":4,"minAutoBitrate":0,"emeEnabled":!1,"widevineLicenseUrl":void 0,"drmSystemOptions":{},"requestMediaKeySystemAccessFunc":V.requestMediaKeySystemAccess,"testBandwidth":!0,"progressive":!1,"lowLatencyMode":!0,"cmcd":void 0},function A(){return{"cueHandler":H.default,"enableCEA708Captions":!0,"enableWebVTT":!0,"enableIMSC1":!0,"captionsTextTrack1Label":"English","captionsTextTrack1LanguageCode":"en","captionsTextTrack2Label":"Spanish","captionsTextTrack2LanguageCode":"es","captionsTextTrack3Label":"Unknown CC","captionsTextTrack3LanguageCode":"","captionsTextTrack4Label":"Unknown CC","captionsTextTrack4LanguageCode":"","renderTextTracksNatively":!0}}()),{},{"subtitleStreamController":w.SubtitleStreamController,"subtitleTrackController":P.default,"timelineController":M.TimelineController,"audioStreamController":O.default,"audioTrackController":x.default,"emeController":B.default,"cmcdController":G.default});function D(R,C){if((C.liveSyncDurationCount||C.liveMaxLatencyDurationCount)&&(C.liveSyncDuration||C.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==C.liveMaxLatencyDurationCount&&(void 0===C.liveSyncDurationCount||C.liveMaxLatencyDurationCount<=C.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==C.liveMaxLatencyDuration&&(void 0===C.liveSyncDuration||C.liveMaxLatencyDuration<=C.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return E({},R,C)}function k(R){var C=R.loader;C!==K.default&&C!==j.default?(W.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),R.progressive=!1):Object(K.fetchSupported)()&&(R.loader=K.default,R.progressive=!0,R.enableSoftwareAES=!0,W.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function srcControllerAbrControllerTs(R,C,I){I.r(C);var _=I("./src/polyfills/number.ts"),O=I("./src/utils/ewma-bandwidth-estimator.ts"),x=I("./src/events.ts"),w=I("./src/utils/buffer-helper.ts"),P=I("./src/errors.ts"),F=I("./src/types/loader.ts"),M=I("./src/utils/logger.ts");function f(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}var N=function(){function e(R){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=R;var C=R.config;this.bwEstimator=new O.default(C.abrEwmaSlowVoD,C.abrEwmaFastVoD,C.abrEwmaDefaultEstimate),this.registerListeners()}var R=e.prototype;return R.registerListeners=function e(){var R=this.hls;R.on(x.Events.FRAG_LOADING,this.onFragLoading,this),R.on(x.Events.FRAG_LOADED,this.onFragLoaded,this),R.on(x.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.on(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(x.Events.ERROR,this.onError,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(x.Events.FRAG_LOADING,this.onFragLoading,this),R.off(x.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(x.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.off(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(x.Events.ERROR,this.onError,this)},R.destroy=function e(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},R.onFragLoading=function e(R,C){var I,_=C.frag;_.type===F.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=_,this.partCurrent=null!=(I=C.part)?I:null,this.timer=self.setInterval(this.onCheck,100)))},R.onLevelLoaded=function e(R,C){var I=this.hls.config;C.details.live?this.bwEstimator.update(I.abrEwmaSlowLive,I.abrEwmaFastLive):this.bwEstimator.update(I.abrEwmaSlowVoD,I.abrEwmaFastVoD)},R._abandonRulesCheck=function e(){var R=this.fragCurrent,C=this.partCurrent,I=this.hls,O=I.autoLevelEnabled,P=I.config,F=I.media;if(R&&F){var N=C?C.stats:R.stats,U=C?C.duration:R.duration;if(N.aborted)return M.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(O&&!F.paused&&F.playbackRate&&F.readyState){var B=performance.now()-N.loading.start,G=Math.abs(F.playbackRate);if(!(B<=500*U/G)){var j=I.levels,K=I.minAutoLevel,H=j[R.level],V=N.total||Math.max(N.loaded,Math.round(U*H.maxBitrate/8)),W=Math.max(1,N.bwEstimate?N.bwEstimate/8:1e3*N.loaded/B),Y=(V-N.loaded)/W,q=F.currentTime,X=(w.BufferHelper.bufferInfo(F,q,P.maxBufferHole).end-q)/G;if(!(X>=2*U/G||Y<=X)){var z,Q=Number.POSITIVE_INFINITY;for(z=R.level-1;z>K;z--){if((Q=U*j[z].maxBitrate/(6.4*W))<X)break}if(!(Q>=Y)){var J=this.bwEstimator.getEstimate();M.logger.warn("Fragment "+R.sn+(C?" part "+C.index:"")+" of level "+R.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+z+"\n      Current BW estimate: "+(Object(_.isFiniteNumber)(J)?(J/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+Y.toFixed(3)+" s\n      Estimated load time for the next fragment: "+Q.toFixed(3)+" s\n      Time to underbuffer: "+X.toFixed(3)+" s"),I.nextLoadLevel=z,this.bwEstimator.sample(B,N.loaded),this.clearTimer(),R.loader&&(this.fragCurrent=this.partCurrent=null,R.loader.abort()),I.trigger(x.Events.FRAG_LOAD_EMERGENCY_ABORTED,{"frag":R,"part":C,"stats":N})}}}}}},R.onFragLoaded=function e(R,C){var I=C.frag,O=C.part;if(I.type===F.PlaylistLevelType.MAIN&&Object(_.isFiniteNumber)(I.sn)){var w=O?O.stats:I.stats,P=O?O.duration:I.duration;if(this.clearTimer(),this.lastLoadedFragLevel=I.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var M=this.hls.levels[I.level],N=(M.loaded?M.loaded.bytes:0)+w.loaded,U=(M.loaded?M.loaded.duration:0)+P;M.loaded={"bytes":N,"duration":U},M.realBitrate=Math.round(8*N/U)}if(I.bitrateTest){var B={"stats":w,"frag":I,"part":O,"id":I.type};this.onFragBuffered(x.Events.FRAG_BUFFERED,B),I.bitrateTest=!1}}},R.onFragBuffered=function e(R,C){var I=C.frag,_=C.part,O=_?_.stats:I.stats;if(!O.aborted&&I.type===F.PlaylistLevelType.MAIN&&"initSegment"!==I.sn){var x=O.parsing.end-O.loading.start;this.bwEstimator.sample(x,O.loaded),O.bwEstimate=this.bwEstimator.getEstimate(),I.bitrateTest?this.bitrateTestDelay=x/1e3:this.bitrateTestDelay=0}},R.onError=function e(R,C){switch(C.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},R.clearTimer=function e(){self.clearInterval(this.timer),this.timer=void 0},R.getNextABRAutoLevel=function e(){var R=this.fragCurrent,C=this.partCurrent,I=this.hls,_=I.maxAutoLevel,O=I.config,x=I.minAutoLevel,P=I.media,F=C?C.duration:R?R.duration:0,N=P?P.currentTime:0,U=P&&0!==P.playbackRate?Math.abs(P.playbackRate):1,B=this.bwEstimator?this.bwEstimator.getEstimate():O.abrEwmaDefaultEstimate,G=(w.BufferHelper.bufferInfo(P,N,O.maxBufferHole).end-N)/U,j=this.findBestLevel(B,x,_,G,O.abrBandWidthFactor,O.abrBandWidthUpFactor);if(j>=0)return j;M.logger.trace((G?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var K=F?Math.min(F,O.maxStarvationDelay):O.maxStarvationDelay,H=O.abrBandWidthFactor,V=O.abrBandWidthUpFactor;if(!G){var W=this.bitrateTestDelay;if(W)K=(F?Math.min(F,O.maxLoadingDelay):O.maxLoadingDelay)-W,M.logger.trace("bitrate test took "+Math.round(1e3*W)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*K)+" ms"),H=V=1}return j=this.findBestLevel(B,x,_,G+K,H,V),Math.max(j,0)},R.findBestLevel=function e(R,C,I,_,O,x){for(var w,P=this.fragCurrent,F=this.partCurrent,N=this.lastLoadedFragLevel,U=this.hls.levels,B=U[N],G=!(null==B||null===(w=B.details)||void 0===w||!w.live),j=null==B?void 0:B.codecSet,K=F?F.duration:P?P.duration:0,H=I;H>=C;H--){var V=U[H];if(V&&(!j||V.codecSet===j)){var W=V.details,Y=(F?null==W?void 0:W.partTarget:null==W?void 0:W.averagetargetduration)||K,q=void 0;q=H<=N?O*R:x*R;var X=U[H].maxBitrate,z=X*Y/q;if(M.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+H+"/"+Math.round(q)+"/"+X+"/"+Y+"/"+_+"/"+z),q>X&&(!z||G&&!this.bitrateTestDelay||z<_))return H}}return-1},function d(R,C,I){return C&&f(R.prototype,C),I&&f(R,I),R}(e,[{"key":"nextAutoLevel","get":function e(){var R=this._nextAutoLevel,C=this.bwEstimator;if(!(-1===R||C&&C.canEstimate()))return R;var I=this.getNextABRAutoLevel();return-1!==R&&(I=Math.min(R,I)),I},"set":function e(R){this._nextAutoLevel=R}}]),e}();C.default=N},"./src/controller/audio-stream-controller.ts":function srcControllerAudioStreamControllerTs(R,C,I){I.r(C);var _=I("./src/polyfills/number.ts"),O=I("./src/controller/base-stream-controller.ts"),x=I("./src/events.ts"),w=I("./src/utils/buffer-helper.ts"),P=I("./src/controller/fragment-tracker.ts"),F=I("./src/types/level.ts"),M=I("./src/types/loader.ts"),N=I("./src/loader/fragment.ts"),U=I("./src/demux/chunk-cache.ts"),B=I("./src/demux/transmuxer-interface.ts"),G=I("./src/types/transmuxer.ts"),j=I("./src/controller/fragment-finders.ts"),K=I("./src/utils/discontinuities.ts"),H=I("./src/errors.ts"),V=I("./src/utils/logger.ts");function y(){return y=Object.assign||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var _ in I)Object.prototype.hasOwnProperty.call(I,_)&&(R[_]=I[_])}return R},y.apply(this,arguments)}function T(R,C){return T=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},T(R,C)}var W=function(R){function t(C,I){var _;return(_=R.call(this,C,I,"[audio-stream-controller]")||this).videoBuffer=null,_.videoTrackCC=-1,_.waitingVideoCC=-1,_.audioSwitch=!1,_.trackId=-1,_.waitingData=null,_.mainDetails=null,_.bufferFlushed=!1,_._registerListeners(),_}!function E(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,T(R,C)}(t,R);var C=t.prototype;return C.onHandlerDestroying=function e(){this._unregisterListeners(),this.mainDetails=null},C._registerListeners=function e(){var R=this.hls;R.on(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(x.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),R.on(x.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.on(x.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.on(x.Events.ERROR,this.onError,this),R.on(x.Events.BUFFER_RESET,this.onBufferReset,this),R.on(x.Events.BUFFER_CREATED,this.onBufferCreated,this),R.on(x.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.on(x.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.on(x.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C._unregisterListeners=function e(){var R=this.hls;R.off(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(x.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),R.off(x.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.off(x.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.off(x.Events.ERROR,this.onError,this),R.off(x.Events.BUFFER_RESET,this.onBufferReset,this),R.off(x.Events.BUFFER_CREATED,this.onBufferCreated,this),R.off(x.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.off(x.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.off(x.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C.onInitPtsFound=function e(R,C){var I=C.frag,_=C.id,x=C.initPTS;if("main"===_){var w=I.cc;this.initPTS[I.cc]=x,this.log("InitPTS for cc: "+w+" found from main: "+x),this.videoTrackCC=w,this.state===O.State.WAITING_INIT_PTS&&this.tick()}},C.startLoad=function e(R){if(!this.levels)return this.startPosition=R,void(this.state=O.State.STOPPED);var C=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,C>0&&-1===R?(this.log("Override startPosition with lastCurrentTime @"+C.toFixed(3)),this.state=O.State.IDLE):(this.loadedmetadata=!1,this.state=O.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=R,this.tick()},C.doTick=function t(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_TRACK:var C,I=this.levels,_=this.trackId,x=null==I||null===(C=I[_])||void 0===C?void 0:C.details;if(x){if(this.waitForCdnTuneIn(x))break;this.state=O.State.WAITING_INIT_PTS}break;case O.State.FRAG_LOADING_WAITING_RETRY:var P,F=performance.now(),M=this.retryDate;(!M||F>=M||null!==(P=this.media)&&void 0!==P&&P.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=O.State.IDLE);break;case O.State.WAITING_INIT_PTS:var N=this.waitingData;if(N){var U=N.frag,B=N.part,G=N.cache,K=N.complete;if(void 0!==this.initPTS[U.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.FRAG_LOADING;var H={"frag":U,"part":B,"payload":G.flush(),"networkDetails":null};this._handleFragmentLoadProgress(H),K&&R.prototype._handleFragmentLoadComplete.call(this,H)}else if(this.videoTrackCC!==this.waitingVideoCC)V.logger.log("Waiting fragment cc ("+U.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var W=this.getLoadPosition(),Y=w.BufferHelper.bufferInfo(this.mediaBuffer,W,this.config.maxBufferHole);Object(j.fragmentWithinToleranceTest)(Y.end,this.config.maxFragLookUpTolerance,U)<0&&(V.logger.log("Waiting fragment cc ("+U.cc+") @ "+U.start+" cancelled because another fragment at "+Y.end+" is needed"),this.clearWaitingFragment())}}else this.state=O.State.IDLE}this.onTickEnd()},C.clearWaitingFragment=function e(){var R=this.waitingData;R&&(this.fragmentTracker.removeFragment(R.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.IDLE)},C.onTickEnd=function e(){var R=this.media;if(R&&R.readyState){var C=(this.mediaBuffer?this.mediaBuffer:R).buffered;!this.loadedmetadata&&C.length&&(this.loadedmetadata=!0),this.lastCurrentTime=R.currentTime}},C.doTickIdle=function e(){var R,C,I=this.hls,_=this.levels,w=this.media,P=this.trackId,F=I.config;if(_&&_[P]&&(w||!this.startFragRequested&&F.startFragPrefetch)){var U=_[P].details;if(!U||U.live&&this.levelLastLoaded!==P||this.waitForCdnTuneIn(U))this.state=O.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,N.ElementaryStreamTypes.AUDIO,M.PlaylistLevelType.AUDIO));var B=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,M.PlaylistLevelType.AUDIO);if(null!==B){var G=B.len,j=this.getMaxBufferLength(),K=this.audioSwitch;if(!(G>=j)||K){if(!K&&this._streamEnded(B,U))return I.trigger(x.Events.BUFFER_EOS,{"type":"audio"}),void(this.state=O.State.ENDED);var H=U.fragments[0].start,V=B.end;if(K){var W=this.getLoadPosition();V=W,U.PTSKnown&&W<H&&(B.end>H||B.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),w.currentTime=H+.05)}var Y=this.getNextFragment(V,U);Y?"identity"!==(null===(R=Y.decryptdata)||void 0===R?void 0:R.keyFormat)||null!==(C=Y.decryptdata)&&void 0!==C&&C.key?this.loadFragment(Y,U,V):this.loadKey(Y,U):this.bufferFlushed=!0}}}}},C.getMaxBufferLength=function t(){var C=R.prototype.getMaxBufferLength.call(this),I=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,M.PlaylistLevelType.MAIN);return null===I?C:Math.max(C,I.len)},C.onMediaDetaching=function t(){this.videoBuffer=null,R.prototype.onMediaDetaching.call(this)},C.onAudioTracksUpdated=function e(R,C){var I=C.audioTracks;this.resetTransmuxer(),this.levels=I.map((function(R){return new F.Level(R)}))},C.onAudioTrackSwitching=function e(R,C){var I=!!C.url;this.trackId=C.id;var _=this.fragCurrent;null!=_&&_.loader&&_.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),I?this.setInterval(100):this.resetTransmuxer(),I?(this.audioSwitch=!0,this.state=O.State.IDLE):this.state=O.State.STOPPED,this.tick()},C.onManifestLoading=function e(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},C.onLevelLoaded=function e(R,C){this.mainDetails=C.details},C.onAudioTrackLoaded=function e(R,C){var I,_=this.levels,x=C.details,w=C.id;if(_){this.log("Track "+w+" loaded ["+x.startSN+","+x.endSN+"],duration:"+x.totalduration);var P=_[w],F=0;if(x.live||null!==(I=P.details)&&void 0!==I&&I.live){var M=this.mainDetails;if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed||!M)return;!P.details&&x.hasProgramDateTime&&M.hasProgramDateTime?(Object(K.alignMediaPlaylistByPDT)(x,M),F=x.fragments[0].start):F=this.alignPlaylists(x,P.details)}P.details=x,this.levelLastLoaded=w,this.startFragRequested||!this.mainDetails&&x.live||this.setStartPosition(P.details,F),this.state!==O.State.WAITING_TRACK||this.waitForCdnTuneIn(x)||(this.state=O.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+w)},C._handleFragmentLoadProgress=function e(R){var C,I=R.frag,_=R.part,x=R.payload,w=this.config,P=this.trackId,F=this.levels;if(F){var N=F[P];console.assert(N,"Audio track is defined on fragment load progress");var j=N.details;console.assert(j,"Audio track details are defined on fragment load progress");var K=w.defaultAudioCodec||N.audioCodec||"mp4a.40.2",H=this.transmuxer;H||(H=this.transmuxer=new B.default(this.hls,M.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var W=this.initPTS[I.cc],Y=null===(C=I.initSegment)||void 0===C?void 0:C.data;if(void 0!==W){var q=_?_.index:-1,X=-1!==q,z=new G.ChunkMetadata(I.level,I.sn,I.stats.chunkCount,x.byteLength,q,X);H.push(x,Y,K,"",I,_,j.totalduration,!1,z,W)}else{V.logger.log("Unknown video PTS for cc "+I.cc+", waiting for video PTS before demuxing audio frag "+I.sn+" of ["+j.startSN+" ,"+j.endSN+"],track "+P),(this.waitingData=this.waitingData||{"frag":I,"part":_,"cache":new U.default,"complete":!1}).cache.push(new Uint8Array(x)),this.waitingVideoCC=this.videoTrackCC,this.state=O.State.WAITING_INIT_PTS}}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+I.sn+" of level "+I.level+" will not be buffered")},C._handleFragmentLoadComplete=function t(C){this.waitingData?this.waitingData.complete=!0:R.prototype._handleFragmentLoadComplete.call(this,C)},C.onBufferReset=function e(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},C.onBufferCreated=function e(R,C){var I=C.tracks.audio;I&&(this.mediaBuffer=I.buffer),C.tracks.video&&(this.videoBuffer=C.tracks.video.buffer)},C.onFragBuffered=function e(R,C){var I=C.frag,_=C.part;I.type===M.PlaylistLevelType.AUDIO&&(this.fragContextChanged(I)?this.warn("Fragment "+I.sn+(_?" p: "+_.index:"")+" of level "+I.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==I.sn&&(this.fragPrevious=I,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(x.Events.AUDIO_TRACK_SWITCHED,{"id":this.trackId}))),this.fragBufferedComplete(I,_)))},C.onError=function t(C,I){switch(I.details){case H.ErrorDetails.FRAG_LOAD_ERROR:case H.ErrorDetails.FRAG_LOAD_TIMEOUT:case H.ErrorDetails.KEY_LOAD_ERROR:case H.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(M.PlaylistLevelType.AUDIO,I);break;case H.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case H.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==O.State.ERROR&&this.state!==O.State.STOPPED&&(this.state=I.fatal?O.State.ERROR:O.State.IDLE,this.warn(I.details+" while loading frag, switching to "+this.state+" state"));break;case H.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===I.parent&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var _=!0,x=this.getFwdBufferInfo(this.mediaBuffer,M.PlaylistLevelType.AUDIO);x&&x.len>.5&&(_=!this.reduceMaxBufferLength(x.len)),_&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,R.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},C.onBufferFlushed=function e(R,C){C.type===N.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},C._handleTransmuxComplete=function e(R){var C,I="audio",_=this.hls,w=R.remuxResult,P=R.chunkMeta,F=this.getCurrentContext(P);if(!F)return this.warn("The loading context changed while buffering fragment "+P.sn+" of level "+P.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(P.level);var M=F.frag,U=F.part,B=w.audio,G=w.text,j=w.id3,K=w.initSegment;if(!this.fragContextChanged(M)){if(this.state=O.State.PARSING,this.audioSwitch&&B&&this.completeAudioSwitch(),null!=K&&K.tracks&&(this._bufferInitSegment(K.tracks,M,P),_.trigger(x.Events.FRAG_PARSING_INIT_SEGMENT,{"frag":M,"id":I,"tracks":K.tracks})),B){var H=B.startPTS,V=B.endPTS,W=B.startDTS,Y=B.endDTS;U&&(U.elementaryStreams[N.ElementaryStreamTypes.AUDIO]={"startPTS":H,"endPTS":V,"startDTS":W,"endDTS":Y}),M.setElementaryStreamInfo(N.ElementaryStreamTypes.AUDIO,H,V,W,Y),this.bufferFragmentData(B,M,U,P)}if(null!=j&&null!==(C=j.samples)&&void 0!==C&&C.length){var q=y({"frag":M,"id":I},j);_.trigger(x.Events.FRAG_PARSING_METADATA,q)}if(G){var X=y({"frag":M,"id":I},G);_.trigger(x.Events.FRAG_PARSING_USERDATA,X)}}},C._bufferInitSegment=function e(R,C,I){if(this.state===O.State.PARSING){R.video&&delete R.video;var _=R.audio;if(_){_.levelCodec=_.codec,_.id="audio",this.log("Init audio buffer, container:"+_.container+", codecs[parsed]=["+_.codec+"]"),this.hls.trigger(x.Events.BUFFER_CODECS,R);var w=_.initSegment;if(null!=w&&w.byteLength){var P={"type":"audio","frag":C,"part":null,"chunkMeta":I,"parent":C.type,"data":w};this.hls.trigger(x.Events.BUFFER_APPENDING,P)}this.tick()}}},C.loadFragment=function t(C,I,x){var w=this.fragmentTracker.getState(C);this.fragCurrent=C,(this.audioSwitch||w===P.FragmentState.NOT_LOADED||w===P.FragmentState.PARTIAL)&&("initSegment"===C.sn?this._loadInitSegment(C):I.live&&!Object(_.isFiniteNumber)(this.initPTS[C.cc])?(this.log("Waiting for video PTS in continuity counter "+C.cc+" of live stream before loading audio fragment "+C.sn+" of level "+this.trackId),this.state=O.State.WAITING_INIT_PTS):(this.startFragRequested=!0,R.prototype.loadFragment.call(this,C,I,x)))},C.completeAudioSwitch=function t(){var C=this.hls,I=this.media,_=this.trackId;I&&(this.log("Switching audio track : flushing all audio"),R.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,C.trigger(x.Events.AUDIO_TRACK_SWITCHED,{"id":_})},t}(O.default);C.default=W},"./src/controller/audio-track-controller.ts":function srcControllerAudioTrackControllerTs(R,C,I){I.r(C);var _=I("./src/events.ts"),O=I("./src/errors.ts"),x=I("./src/controller/base-playlist-controller.ts"),w=I("./src/types/loader.ts");function o(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}function f(R,C){return f=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},f(R,C)}var P=function(R){function t(C){var I;return(I=R.call(this,C,"[audio-track-controller]")||this).tracks=[],I.groupId=null,I.tracksInGroup=[],I.trackId=-1,I.trackName="",I.selectDefaultTrack=!0,I.registerListeners(),I}!function u(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,f(R,C)}(t,R);var C=t.prototype;return C.registerListeners=function e(){var R=this.hls;R.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.on(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.on(_.Events.ERROR,this.onError,this)},C.unregisterListeners=function e(){var R=this.hls;R.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),R.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.off(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.off(_.Events.ERROR,this.onError,this)},C.destroy=function t(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,R.prototype.destroy.call(this)},C.onManifestLoading=function e(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},C.onManifestParsed=function e(R,C){this.tracks=C.audioTracks||[]},C.onAudioTrackLoaded=function e(R,C){var I=C.id,_=C.details,O=this.tracksInGroup[I];if(O){var x=O.details;O.details=C.details,this.log("audioTrack "+I+" loaded ["+_.startSN+"-"+_.endSN+"]"),I===this.trackId&&(this.retryCount=0,this.playlistLoaded(I,C,x))}else this.warn("Invalid audio track id "+I)},C.onLevelLoading=function e(R,C){this.switchLevel(C.level)},C.onLevelSwitching=function e(R,C){this.switchLevel(C.level)},C.switchLevel=function e(R){var C=this.hls.levels[R];if(null!=C&&C.audioGroupIds){var I=C.audioGroupIds[C.urlId];if(this.groupId!==I){this.groupId=I;var O=this.tracks.filter((function(R){return!I||R.groupId===I}));this.selectDefaultTrack&&!O.some((function(R){return R.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=O;var x={"audioTracks":O};this.log("Updating audio tracks, "+O.length+' track(s) found in "'+I+'" group-id'),this.hls.trigger(_.Events.AUDIO_TRACKS_UPDATED,x),this.selectInitialTrack()}}},C.onError=function t(C,I){R.prototype.onError.call(this,C,I),!I.fatal&&I.context&&I.context.type===w.PlaylistContextType.AUDIO_TRACK&&I.context.id===this.trackId&&I.context.groupId===this.groupId&&this.retryLoadingOrFail(I)},C.setAudioTrack=function e(R){var C=this.tracksInGroup;if(R<0||R>=C.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var I=C[this.trackId];this.log("Now switching to audio-track index "+R);var O=C[R],x=O.id,w=O.groupId,P=void 0===w?"":w,F=O.name,M=O.type,N=O.url;if(this.trackId=R,this.trackName=F,this.selectDefaultTrack=!1,this.hls.trigger(_.Events.AUDIO_TRACK_SWITCHING,{"id":x,"groupId":P,"name":F,"type":M,"url":N}),!O.details||O.details.live){var U=this.switchParams(O.url,null==I?void 0:I.details);this.loadPlaylist(U)}}},C.selectInitialTrack=function e(){var R=this.tracksInGroup;console.assert(R.length,"Initial audio track should be selected when tracks are known");var C=this.trackName,I=this.findTrackId(C)||this.findTrackId();-1!==I?this.setAudioTrack(I):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,"fatal":!0}))},C.findTrackId=function e(R){for(var C=this.tracksInGroup,I=0;I<C.length;I++){var _=C[I];if((!this.selectDefaultTrack||_.default)&&(!R||R===_.name))return _.id}return-1},C.loadPlaylist=function e(R){var C=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(C)){var I=C.id,O=C.groupId,x=C.url;if(R)try{x=R.addDirectives(x)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("loading audio-track playlist for id: "+I),this.clearTimer(),this.hls.trigger(_.Events.AUDIO_TRACK_LOADING,{"url":x,"id":I,"groupId":O,"deliveryDirectives":R||null})}},function l(R,C,I){return C&&o(R.prototype,C),I&&o(R,I),R}(t,[{"key":"audioTracks","get":function e(){return this.tracksInGroup}},{"key":"audioTrack","get":function e(){return this.trackId},"set":function e(R){this.selectDefaultTrack=!1,this.setAudioTrack(R)}}]),t}(x.default);C.default=P},"./src/controller/base-playlist-controller.ts":function srcControllerBasePlaylistControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return F}));var _=I("./src/polyfills/number.ts"),O=I("./src/types/level.ts"),x=I("./src/controller/level-helper.ts"),w=I("./src/utils/logger.ts"),P=I("./src/errors.ts"),F=function(){function e(R,C){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=w.logger.log.bind(w.logger,C+":"),this.warn=w.logger.warn.bind(w.logger,C+":"),this.hls=R}var R=e.prototype;return R.destroy=function e(){this.clearTimer(),this.hls=this.log=this.warn=null},R.onError=function e(R,C){C.fatal&&C.type===P.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},R.clearTimer=function e(){clearTimeout(this.timer),this.timer=-1},R.startLoad=function e(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},R.stopLoad=function e(){this.canLoad=!1,this.clearTimer()},R.switchParams=function e(R,C){var I=null==C?void 0:C.renditionReports;if(I)for(var x=0;x<I.length;x++){var w=I[x],P=""+w.URI;if(P===R.substr(-P.length)){var F=parseInt(w["LAST-MSN"]),M=parseInt(w["LAST-PART"]);if(C&&this.hls.config.lowLatencyMode){var N=Math.min(C.age-C.partTarget,C.targetduration);void 0!==M&&N>C.partTarget&&(M+=1)}if(Object(_.isFiniteNumber)(F))return new O.HlsUrlParameters(F,Object(_.isFiniteNumber)(M)?M:void 0,O.HlsSkip.No)}}},R.loadPlaylist=function e(R){},R.shouldLoadTrack=function e(R){return this.canLoad&&R&&!!R.url&&(!R.details||R.details.live)},R.playlistLoaded=function e(R,C,I){var _=this,O=C.details,w=C.stats,P=w.loading.end?Math.max(0,self.performance.now()-w.loading.end):0;if(O.advancedDateTime=Date.now()-P,O.live||null!=I&&I.live){if(O.reloaded(I),I&&this.log("live playlist "+R+" "+(O.advanced?"REFRESHED "+O.lastPartSn+"-"+O.lastPartIndex:"MISSED")),I&&O.fragments.length>0&&Object(x.mergeDetails)(I,O),!this.canLoad||!O.live)return;var F,M=void 0,N=void 0;if(O.canBlockReload&&O.endSN&&O.advanced){var U=this.hls.config.lowLatencyMode,B=O.lastPartSn,G=O.endSN,j=O.lastPartIndex,K=B===G;-1!==j?(M=K?G+1:B,N=K?U?0:j:j+1):M=G+1;var H=O.age,V=H+O.ageHeader,W=Math.min(V-O.partTarget,1.5*O.targetduration);if(W>0){if(I&&W>I.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+I.tuneInGoal+" to: "+W+" with playlist age: "+O.age),W=0;else{var Y=Math.floor(W/O.targetduration);if(M+=Y,void 0!==N)N+=Math.round(W%O.targetduration/O.partTarget);this.log("CDN Tune-in age: "+O.ageHeader+"s last advanced "+H.toFixed(2)+"s goal: "+W+" skip sn "+Y+" to part "+N)}O.tuneInGoal=W}if(F=this.getDeliveryDirectives(O,C.deliveryDirectives,M,N),U||!K)return void this.loadPlaylist(F)}else F=this.getDeliveryDirectives(O,C.deliveryDirectives,M,N);var q=Object(x.computeReloadInterval)(O,w);void 0!==M&&O.canBlockReload&&(q-=O.partTarget||1),this.log("reload live playlist "+R+" in "+Math.round(q)+" ms"),this.timer=self.setTimeout((function(){return _.loadPlaylist(F)}),q)}else this.clearTimer()},R.getDeliveryDirectives=function e(R,C,I,_){var x=Object(O.getSkipValue)(R,I);return null!=C&&C.skip&&R.deltaUpdateFailed&&(I=C.msn,_=C.part,x=O.HlsSkip.No),new O.HlsUrlParameters(I,_,x)},R.retryLoadingOrFail=function e(R){var C,I=this,_=this.hls.config,O=this.retryCount<_.levelLoadingMaxRetry;if(O)if(this.retryCount++,R.details.indexOf("LoadTimeOut")>-1&&null!==(C=R.context)&&void 0!==C&&C.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+R.details+'"'),this.loadPlaylist();else{var x=Math.min(Math.pow(2,this.retryCount)*_.levelLoadingRetryDelay,_.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return I.loadPlaylist()}),x),this.warn("retry playlist loading #"+this.retryCount+" in "+x+' ms after "'+R.details+'"')}else this.warn('cannot recover from error "'+R.details+'"'),this.clearTimer(),R.fatal=!0;return O},e}()},"./src/controller/base-stream-controller.ts":function srcControllerBaseStreamControllerTs(R,C,I){I.r(C),I.d(C,"State",(function(){return Y})),I.d(C,"default",(function(){return q}));var _=I("./src/polyfills/number.ts"),O=I("./src/task-loop.ts"),x=I("./src/controller/fragment-tracker.ts"),w=I("./src/utils/buffer-helper.ts"),P=I("./src/utils/logger.ts"),F=I("./src/events.ts"),M=I("./src/errors.ts"),N=I("./src/types/transmuxer.ts"),U=I("./src/utils/mp4-tools.ts"),B=I("./src/utils/discontinuities.ts"),G=I("./src/controller/fragment-finders.ts"),j=I("./src/controller/level-helper.ts"),K=I("./src/loader/fragment-loader.ts"),H=I("./src/crypt/decrypter.ts"),V=I("./src/utils/time-ranges.ts"),W=I("./src/types/loader.ts");function E(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}function L(R,C){return L=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},L(R,C)}var Y={"STOPPED":"STOPPED","IDLE":"IDLE","KEY_LOADING":"KEY_LOADING","FRAG_LOADING":"FRAG_LOADING","FRAG_LOADING_WAITING_RETRY":"FRAG_LOADING_WAITING_RETRY","WAITING_TRACK":"WAITING_TRACK","PARSING":"PARSING","PARSED":"PARSED","BACKTRACKING":"BACKTRACKING","ENDED":"ENDED","ERROR":"ERROR","WAITING_INIT_PTS":"WAITING_INIT_PTS","WAITING_LEVEL":"WAITING_LEVEL"},q=function(R){function t(C,I,_){var O;return(O=R.call(this)||this).hls=void 0,O.fragPrevious=null,O.fragCurrent=null,O.fragmentTracker=void 0,O.transmuxer=null,O._state=Y.STOPPED,O.media=void 0,O.mediaBuffer=void 0,O.config=void 0,O.bitrateTest=!1,O.lastCurrentTime=0,O.nextLoadPosition=0,O.startPosition=0,O.loadedmetadata=!1,O.fragLoadError=0,O.retryDate=0,O.levels=null,O.fragmentLoader=void 0,O.levelLastLoaded=null,O.startFragRequested=!1,O.decrypter=void 0,O.initPTS=[],O.onvseeking=null,O.onvended=null,O.logPrefix="",O.log=void 0,O.warn=void 0,O.logPrefix=_,O.log=P.logger.log.bind(P.logger,_+":"),O.warn=P.logger.warn.bind(P.logger,_+":"),O.hls=C,O.fragmentLoader=new K.default(C.config),O.fragmentTracker=I,O.config=C.config,O.decrypter=new H.default(C,C.config),C.on(F.Events.KEY_LOADED,O.onKeyLoaded,function S(R){if(void 0===R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}(O)),O}!function b(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,L(R,C)}(t,R);var C=t.prototype;return C.doTick=function e(){this.onTickEnd()},C.onTickEnd=function e(){},C.startLoad=function e(R){},C.stopLoad=function e(){this.fragmentLoader.abort();var R=this.fragCurrent;R&&this.fragmentTracker.removeFragment(R),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Y.STOPPED},C._streamEnded=function e(R,C){var I=this.fragCurrent,_=this.fragmentTracker;if(!C.live&&I&&I.sn>=C.endSN&&!R.nextStart){var O=C.partList;if(null!=O&&O.length){var P=O[O.length-1];return w.BufferHelper.isBuffered(this.media,P.start+P.duration/2)}var F=_.getState(I);return F===x.FragmentState.PARTIAL||F===x.FragmentState.OK}return!1},C.onMediaAttached=function e(R,C){var I=this.media=this.mediaBuffer=C.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var _=this.config;this.levels&&_.autoStartLoad&&this.state===Y.STOPPED&&this.startLoad(_.startPosition)},C.onMediaDetaching=function e(){var R=this.media;null!=R&&R.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),R&&(R.removeEventListener("seeking",this.onvseeking),R.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},C.onMediaSeeking=function e(){var R=this.config,C=this.fragCurrent,I=this.media,O=this.mediaBuffer,x=this.state,P=I?I.currentTime:0,F=w.BufferHelper.bufferInfo(O||I,P,R.maxBufferHole);if(this.log("media seeking to "+(Object(_.isFiniteNumber)(P)?P.toFixed(3):P)+", state: "+x),x===Y.ENDED)this.resetLoadingState();else if(C&&!F.len){var M=R.maxFragLookUpTolerance,N=C.start-M,U=P>C.start+C.duration+M;(P<N||U)&&(U&&C.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),C.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=P),this.loadedmetadata||F.len||(this.nextLoadPosition=this.startPosition=P),this.tickImmediate()},C.onMediaEnded=function e(){this.startPosition=this.lastCurrentTime=0},C.onKeyLoaded=function e(R,C){if(this.state===Y.KEY_LOADING&&C.frag===this.fragCurrent&&this.levels){this.state=Y.IDLE;var I=this.levels[C.frag.level].details;I&&this.loadFragment(C.frag,I,C.frag.start)}},C.onHandlerDestroying=function t(){this.stopLoad(),R.prototype.onHandlerDestroying.call(this)},C.onHandlerDestroyed=function t(){this.state=Y.STOPPED,this.hls.off(F.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,R.prototype.onHandlerDestroyed.call(this)},C.loadKey=function e(R,C){this.log("Loading key for "+R.sn+" of ["+C.startSN+"-"+C.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+R.level),this.state=Y.KEY_LOADING,this.fragCurrent=R,this.hls.trigger(F.Events.KEY_LOADING,{"frag":R})},C.loadFragment=function e(R,C,I){this._loadFragForPlayback(R,C,I)},C._loadFragForPlayback=function e(R,C,I){var _=this;this._doFragLoad(R,C,I,(function e(C){if(_.fragContextChanged(R))return _.warn("Fragment "+R.sn+(C.part?" p: "+C.part.index:"")+" of level "+R.level+" was dropped during download."),void _.fragmentTracker.removeFragment(R);R.stats.chunkCount++,_._handleFragmentLoadProgress(C)})).then((function(C){if(C){_.fragLoadError=0;var I=_.state;if(!_.fragContextChanged(R))return"payload"in C&&(_.log("Loaded fragment "+R.sn+" of level "+R.level),_.hls.trigger(F.Events.FRAG_LOADED,C),_.state===Y.BACKTRACKING)?(_.fragmentTracker.backtrack(R,C),void _.resetFragmentLoading(R)):void _._handleFragmentLoadComplete(C);(I===Y.FRAG_LOADING||I===Y.BACKTRACKING||!_.fragCurrent&&I===Y.PARSING)&&(_.fragmentTracker.removeFragment(R),_.state=Y.IDLE)}})).catch((function(C){_.warn(C),_.resetFragmentLoading(R)}))},C.flushMainBuffer=function e(R,C,I){if(void 0===I&&(I=null),R-C){var _={"startOffset":R,"endOffset":C,"type":I};this.fragLoadError=0,this.hls.trigger(F.Events.BUFFER_FLUSHING,_)}},C._loadInitSegment=function e(R){var C=this;this._doFragLoad(R).then((function(I){if(!I||C.fragContextChanged(R)||!C.levels)throw new Error("init load aborted");return I})).then((function(I){var _=C.hls,O=I.payload,x=R.decryptdata;if(O&&O.byteLength>0&&x&&x.key&&x.iv&&"AES-128"===x.method){var w=self.performance.now();return C.decrypter.webCryptoDecrypt(new Uint8Array(O),x.key.buffer,x.iv.buffer).then((function(C){var O=self.performance.now();return _.trigger(F.Events.FRAG_DECRYPTED,{"frag":R,"payload":C,"stats":{"tstart":w,"tdecrypt":O}}),I.payload=C,I}))}return I})).then((function(I){var _=C.fragCurrent,O=C.hls,x=C.levels;if(!x)throw new Error("init load aborted, missing levels");var w=x[R.level].details;console.assert(w,"Level details are defined when init segment is loaded");var P=R.stats;C.state=Y.IDLE,C.fragLoadError=0,R.data=new Uint8Array(I.payload),P.parsing.start=P.buffering.start=self.performance.now(),P.parsing.end=P.buffering.end=self.performance.now(),I.frag===_&&O.trigger(F.Events.FRAG_BUFFERED,{"stats":P,"frag":_,"part":null,"id":R.type}),C.tick()})).catch((function(I){C.warn(I),C.resetFragmentLoading(R)}))},C.fragContextChanged=function e(R){var C=this.fragCurrent;return!R||!C||R.level!==C.level||R.sn!==C.sn||R.urlId!==C.urlId},C.fragBufferedComplete=function e(R,C){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+R.type+" sn: "+R.sn+(C?" part: "+C.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+R.level+" "+V.default.toString(w.BufferHelper.getBuffered(I))),this.state=Y.IDLE,this.tick()},C._handleFragmentLoadComplete=function e(R){var C=this.transmuxer;if(C){var I=R.frag,_=R.part,O=R.partsLoaded,x=!O||0===O.length||O.some((function(R){return!R})),w=new N.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,_?_.index:-1,!x);C.flush(w)}},C._handleFragmentLoadProgress=function e(R){},C._doFragLoad=function e(R,C,I,O){var x=this;if(void 0===I&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(R.start,I||0),this.config.lowLatencyMode&&C){var w=C.partList;if(w&&O){I>R.end&&C.fragmentHint&&(R=C.fragmentHint);var P=this.getNextPart(w,R,I);if(P>-1){var M=w[P];return this.log("Loading part sn: "+R.sn+" p: "+M.index+" cc: "+R.cc+" of playlist ["+C.startSN+"-"+C.endSN+"] parts [0-"+P+"-"+(w.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+R.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=M.start+M.duration,this.state=Y.FRAG_LOADING,this.hls.trigger(F.Events.FRAG_LOADING,{"frag":R,"part":w[P],"targetBufferTime":I}),this.doFragPartsLoad(R,w,P,O).catch((function(R){return x.handleFragLoadError(R)}))}if(!R.url||this.loadedEndOfParts(w,I))return Promise.resolve(null)}}return this.log("Loading fragment "+R.sn+" cc: "+R.cc+" "+(C?"of ["+C.startSN+"-"+C.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+R.level+", target: "+parseFloat(I.toFixed(3))),Object(_.isFiniteNumber)(R.sn)&&!this.bitrateTest&&(this.nextLoadPosition=R.start+R.duration),this.state=Y.FRAG_LOADING,this.hls.trigger(F.Events.FRAG_LOADING,{"frag":R,"targetBufferTime":I}),this.fragmentLoader.load(R,O).catch((function(R){return x.handleFragLoadError(R)}))},C.doFragPartsLoad=function e(R,C,I,_){var O=this;return new Promise((function(x,w){var P=[];!function i(I){var M=C[I];O.fragmentLoader.loadPart(R,M,_).then((function(_){P[M.index]=_;var w=_.part;O.hls.trigger(F.Events.FRAG_LOADED,_);var N=C[I+1];if(!N||N.fragment!==R)return x({"frag":R,"part":w,"partsLoaded":P});i(I+1)})).catch(w)}(I)}))},C.handleFragLoadError=function e(R){var C=R.data;return C&&C.details===M.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(C.frag,C.part):this.hls.trigger(F.Events.ERROR,C),null},C._handleTransmuxerFlush=function e(R){var C=this.getCurrentContext(R);if(C&&this.state===Y.PARSING){var I=C.frag,_=C.part,O=C.level,x=self.performance.now();I.stats.parsing.end=x,_&&(_.stats.parsing.end=x),this.updateLevelTiming(I,_,O,R.partial)}else this.fragCurrent||(this.state=Y.IDLE)},C.getCurrentContext=function e(R){var C=this.levels,I=R.level,_=R.sn,O=R.part;if(!C||!C[I])return this.warn("Levels object was unset while buffering fragment "+_+" of level "+I+". The current chunk will not be buffered."),null;var x=C[I],w=O>-1?Object(j.getPartWith)(x,_,O):null,P=w?w.fragment:Object(j.getFragmentWithSN)(x,_,this.fragCurrent);return P?{"frag":P,"part":w,"level":x}:null},C.bufferFragmentData=function e(R,C,I,_){if(R&&this.state===Y.PARSING){var O=R.data1,x=R.data2,w=O;if(O&&x&&(w=Object(U.appendUint8Array)(O,x)),w&&w.length){var P={"type":R.type,"frag":C,"part":I,"chunkMeta":_,"parent":C.type,"data":w};this.hls.trigger(F.Events.BUFFER_APPENDING,P),R.dropped&&R.independent&&!I&&this.flushBufferGap(C)}}},C.flushBufferGap=function e(R){var C=this.media;if(C)if(w.BufferHelper.isBuffered(C,C.currentTime)){var I=C.currentTime,_=w.BufferHelper.bufferInfo(C,I,0),O=R.duration,x=Math.min(2*this.config.maxFragLookUpTolerance,.25*O),P=Math.max(Math.min(R.start-x,_.end-x),I+x);R.start-P>x&&this.flushMainBuffer(P,R.start)}else this.flushMainBuffer(0,R.start)},C.getFwdBufferInfo=function e(R,C){var I=this.config,O=this.getLoadPosition();if(!Object(_.isFiniteNumber)(O))return null;var x=w.BufferHelper.bufferInfo(R,O,I.maxBufferHole);if(0===x.len&&void 0!==x.nextStart){var P=this.fragmentTracker.getBufferedFrag(O,C);if(P&&x.nextStart<P.end)return w.BufferHelper.bufferInfo(R,O,Math.max(x.nextStart,I.maxBufferHole))}return x},C.getMaxBufferLength=function e(R){var C,I=this.config;return C=R?Math.max(8*I.maxBufferSize/R,I.maxBufferLength):I.maxBufferLength,Math.min(C,I.maxMaxBufferLength)},C.reduceMaxBufferLength=function e(R){var C=this.config,I=R||C.maxBufferLength;return C.maxMaxBufferLength>=I&&(C.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+C.maxMaxBufferLength+"s"),!0)},C.getNextFragment=function e(R,C){var I,_,O=C.fragments,x=O.length;if(!x)return null;var w,P=this.config,F=O[0].start;if(C.live){var M=P.initialLiveManifestSize;if(x<M)return this.warn("Not enough fragments to start playback (have: "+x+", need: "+M+")"),null;C.PTSKnown||this.startFragRequested||-1!==this.startPosition||(w=this.getInitialLiveFragment(C,O),this.startPosition=w?this.hls.liveSyncPosition||w.start:R)}else R<=F&&(w=O[0]);if(!w){var N=P.lowLatencyMode?C.partEnd:C.fragmentEnd;w=this.getFragmentAtPosition(R,N,C)}return null===(I=w)||void 0===I||!I.initSegment||null!==(_=w)&&void 0!==_&&_.initSegment.data||this.bitrateTest||(w=w.initSegment),w},C.getNextPart=function e(R,C,I){for(var _=-1,O=!1,x=!0,w=0,P=R.length;w<P;w++){var F=R[w];if(x=x&&!F.independent,_>-1&&I<F.start)break;var M=F.loaded;!M&&(O||F.independent||x)&&F.fragment===C&&(_=w),O=M}return _},C.loadedEndOfParts=function e(R,C){var I=R[R.length-1];return I&&C>I.start&&I.loaded},C.getInitialLiveFragment=function e(R,C){var I=this.fragPrevious,_=null;if(I){if(R.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),_=Object(G.findFragmentByPDT)(C,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!_){var O=I.sn+1;if(O>=R.startSN&&O<=R.endSN){var x=C[O-R.startSN];I.cc===x.cc&&(_=x,this.log("Live playlist, switching playlist, load frag with next SN: "+_.sn))}_||(_=Object(G.findFragWithCC)(C,I.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+_.sn)}}else{var w=this.hls.liveSyncPosition;null!==w&&(_=this.getFragmentAtPosition(w,this.bitrateTest?R.fragmentEnd:R.edge,R))}return _},C.getFragmentAtPosition=function e(R,C,I){var _,O=this.config,w=this.fragPrevious,P=I.fragments,F=I.endSN,M=I.fragmentHint,N=O.maxFragLookUpTolerance,U=!!(O.lowLatencyMode&&I.partList&&M);if(U&&M&&!this.bitrateTest&&(P=P.concat(M),F=M.sn),R<C){var B=R>C-N?0:N;_=Object(G.findFragmentByPTS)(w,P,R,B)}else _=P[P.length-1];if(_){var j=_.sn-I.startSN,K=w&&_.level===w.level,H=P[j+1];if(this.fragmentTracker.getState(_)===x.FragmentState.BACKTRACKED){_=null;for(var V=j;P[V]&&this.fragmentTracker.getState(P[V])===x.FragmentState.BACKTRACKED;)_=w?P[V--]:P[--V];_||(_=H)}else w&&_.sn===w.sn&&!U&&K&&(_.sn<F&&this.fragmentTracker.getState(H)!==x.FragmentState.OK?(this.log("SN "+_.sn+" just loaded, load next one: "+H.sn),_=H):_=null)}return _},C.synchronizeToLiveEdge=function e(R){var C=this.config,I=this.media;if(I){var _=this.hls.liveSyncPosition,O=I.currentTime,x=R.fragments[0].start,w=R.edge,P=O>=x-C.maxFragLookUpTolerance&&O<=w;if(null!==_&&I.duration>_&&(O<_||!P)){var F=void 0!==C.liveMaxLatencyDuration?C.liveMaxLatencyDuration:C.liveMaxLatencyDurationCount*R.targetduration;(!P&&I.readyState<4||O<w-F)&&(this.loadedmetadata||(this.nextLoadPosition=_),I.readyState&&(this.warn("Playback: "+O.toFixed(3)+" is located too far from the end of live sliding playlist: "+w+", reset currentTime to : "+_.toFixed(3)),I.currentTime=_))}}},C.alignPlaylists=function e(R,C){var I=this.levels,O=this.levelLastLoaded,x=this.fragPrevious,w=null!==O?I[O]:null,P=R.fragments.length;if(!P)return this.warn("No fragments in live playlist"),0;var F=R.fragments[0].start,M=!C,N=R.alignedSliding&&Object(_.isFiniteNumber)(F);if(M||!N&&!F){Object(B.alignStream)(x,w,R);var U=R.fragments[0].start;return this.log("Live playlist sliding: "+U.toFixed(2)+" start-sn: "+(C?C.startSN:"na")+"->"+R.startSN+" prev-sn: "+(x?x.sn:"na")+" fragments: "+P),U}return F},C.waitForCdnTuneIn=function e(R){return R.live&&R.canBlockReload&&R.tuneInGoal>Math.max(R.partHoldBack,3*R.partTarget)},C.setStartPosition=function e(R,C){var I=this.startPosition;if(I<C&&(I=-1),-1===I||-1===this.lastCurrentTime){var O=R.startTimeOffset;Object(_.isFiniteNumber)(O)?(I=C+O,O<0&&(I+=R.totalduration),I=Math.min(Math.max(C,I),C+R.totalduration),this.log("Start time offset "+O+" found in playlist, adjust startPosition to "+I),this.startPosition=I):R.live?I=this.hls.liveSyncPosition||C:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},C.getLoadPosition=function e(){var R=this.media,C=0;return this.loadedmetadata&&R?C=R.currentTime:this.nextLoadPosition&&(C=this.nextLoadPosition),C},C.handleFragLoadAborted=function e(R,C){this.transmuxer&&"initSegment"!==R.sn&&R.stats.aborted&&(this.warn("Fragment "+R.sn+(C?" part"+C.index:"")+" of level "+R.level+" was aborted"),this.resetFragmentLoading(R))},C.resetFragmentLoading=function e(R){this.fragCurrent&&this.fragContextChanged(R)||(this.state=Y.IDLE)},C.onFragmentOrKeyLoadError=function e(R,C){if(!C.fatal){var I=C.frag;if(I&&I.type===R){var _=this.fragCurrent;console.assert(_&&I.sn===_.sn&&I.level===_.level&&I.urlId===_.urlId,"Frag load error must match current frag to retry");var O=this.config;if(this.fragLoadError+1<=O.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(I.level))return;var x=Math.min(Math.pow(2,this.fragLoadError)*O.fragLoadingRetryDelay,O.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+R+" "+I.level+" failed to load, retrying in "+x+"ms"),this.retryDate=self.performance.now()+x,this.fragLoadError++,this.state=Y.FRAG_LOADING_WAITING_RETRY}else C.levelRetry?(R===W.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=Y.IDLE):(P.logger.error(C.details+" reaches max retry, redispatch as fatal ..."),C.fatal=!0,this.hls.stopLoad(),this.state=Y.ERROR)}}},C.afterBufferFlushed=function e(R,C,I){if(R){var _=w.BufferHelper.getBuffered(R);this.fragmentTracker.detectEvictedFragments(C,_,I),this.state===Y.ENDED&&this.resetLoadingState()}},C.resetLoadingState=function e(){this.fragCurrent=null,this.fragPrevious=null,this.state=Y.IDLE},C.resetLiveStartWhenNotLoaded=function e(R){if(!this.loadedmetadata){this.startFragRequested=!1;var C=this.levels?this.levels[R].details:null;if(null!=C&&C.live)return this.startPosition=-1,this.setStartPosition(C,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},C.updateLevelTiming=function e(R,C,I,_){var O=this,x=I.details;console.assert(!!x,"level.details must be defined");var w=Object.keys(R.elementaryStreams).reduce((function(C,w){var P=R.elementaryStreams[w];if(P){var M=P.endPTS-P.startPTS;if(M<=0)return O.warn("Could not parse fragment "+R.sn+" "+w+" duration reliably ("+M+") resetting transmuxer to fallback to playlist timing"),O.resetTransmuxer(),C||!1;var N=_?0:Object(j.updateFragPTSDTS)(x,R,P.startPTS,P.endPTS,P.startDTS,P.endDTS);return O.hls.trigger(F.Events.LEVEL_PTS_UPDATED,{"details":x,"level":I,"drift":N,"type":w,"frag":R,"start":P.startPTS,"end":P.endPTS}),!0}return C}),!1);w?(this.state=Y.PARSED,this.hls.trigger(F.Events.FRAG_PARSED,{"frag":R,"part":C})):this.resetLoadingState()},C.resetTransmuxer=function e(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},function T(R,C,I){return C&&E(R.prototype,C),I&&E(R,I),R}(t,[{"key":"state","get":function e(){return this._state},"set":function e(R){var C=this._state;C!==R&&(this._state=R,this.log(C+"->"+R))}}]),t}(O.default)},"./src/controller/buffer-controller.ts":function srcControllerBufferControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return G}));var _=I("./src/polyfills/number.ts"),O=I("./src/events.ts"),x=I("./src/utils/logger.ts"),w=I("./src/errors.ts"),P=I("./src/utils/buffer-helper.ts"),F=I("./src/utils/mediasource-helper.ts"),M=I("./src/loader/fragment.ts"),N=I("./src/controller/buffer-operation-queue.ts"),U=Object(F.getMediaSource)(),B=/([ha]vc.)(?:\.[^.,]+)+/,G=function(){function e(R){var C=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var R=C.hls,I=C.media,_=C.mediaSource;x.logger.log("[buffer-controller]: Media source opened"),I&&(C.updateMediaElementDuration(),R.trigger(O.Events.MEDIA_ATTACHED,{"media":I})),_&&_.removeEventListener("sourceopen",C._onMediaSourceOpen),C.checkPendingTracks()},this._onMediaSourceClose=function(){x.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){x.logger.log("[buffer-controller]: Media source ended")},this.hls=R,this._initSourceBuffer(),this.registerListeners()}var R=e.prototype;return R.hasSourceTypes=function e(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},R.destroy=function e(){this.unregisterListeners(),this.details=null},R.registerListeners=function e(){var R=this.hls;R.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(O.Events.BUFFER_RESET,this.onBufferReset,this),R.on(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),R.on(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.on(O.Events.BUFFER_EOS,this.onBufferEos,this),R.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),R.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),R.on(O.Events.FRAG_PARSED,this.onFragParsed,this),R.on(O.Events.FRAG_CHANGED,this.onFragChanged,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(O.Events.BUFFER_RESET,this.onBufferReset,this),R.off(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),R.off(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.off(O.Events.BUFFER_EOS,this.onBufferEos,this),R.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),R.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),R.off(O.Events.FRAG_PARSED,this.onFragParsed,this),R.off(O.Events.FRAG_CHANGED,this.onFragChanged,this)},R._initSourceBuffer=function e(){this.sourceBuffer={},this.operationQueue=new N.default(this.sourceBuffer),this.listeners={"audio":[],"video":[],"audiovideo":[]}},R.onManifestParsed=function e(R,C){var I=2;(C.audio&&!C.video||!C.altAudio)&&(I=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=I,this.details=null,x.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},R.onMediaAttaching=function e(R,C){var I=this.media=C.media;if(I&&U){var _=this.mediaSource=new U;_.addEventListener("sourceopen",this._onMediaSourceOpen),_.addEventListener("sourceended",this._onMediaSourceEnded),_.addEventListener("sourceclose",this._onMediaSourceClose),I.src=self.URL.createObjectURL(_),this._objectUrl=I.src}},R.onMediaDetaching=function e(){var R=this.media,C=this.mediaSource,I=this._objectUrl;if(C){if(x.logger.log("[buffer-controller]: media source detaching"),"open"===C.readyState)try{C.endOfStream()}catch(e){x.logger.warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}this.onBufferReset(),C.removeEventListener("sourceopen",this._onMediaSourceOpen),C.removeEventListener("sourceended",this._onMediaSourceEnded),C.removeEventListener("sourceclose",this._onMediaSourceClose),R&&(I&&self.URL.revokeObjectURL(I),R.src===I?(R.removeAttribute("src"),R.load()):x.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(O.Events.MEDIA_DETACHED,void 0)},R.onBufferReset=function e(){var R=this;this.getSourceBufferTypes().forEach((function(C){var I=R.sourceBuffer[C];try{I&&(R.removeBufferListeners(C),R.mediaSource&&R.mediaSource.removeSourceBuffer(I),R.sourceBuffer[C]=void 0)}catch(R){x.logger.warn("[buffer-controller]: Failed to reset the "+C+" buffer",R)}})),this._initSourceBuffer()},R.onBufferCodecs=function e(R,C){var I=this,_=this.getSourceBufferTypes().length;Object.keys(C).forEach((function(R){if(_){var O=I.tracks[R];if(O&&"function"==typeof O.buffer.changeType){var x=C[R],w=x.codec,P=x.levelCodec,F=x.container;if((O.levelCodec||O.codec).replace(B,"$1")!==(P||w).replace(B,"$1")){var M=F+";codecs="+(P||w);I.appendChangeType(R,M)}}}else I.pendingTracks[R]=C[R]})),_||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},R.appendChangeType=function e(R,C){var I=this,_=this.operationQueue,O={"execute":function e(){var O=I.sourceBuffer[R];O&&(x.logger.log("[buffer-controller]: changing "+R+" sourceBuffer type to "+C),O.changeType(C)),_.shiftAndExecuteNext(R)},"onStart":function e(){},"onComplete":function e(){},"onError":function e(C){x.logger.warn("[buffer-controller]: Failed to change "+R+" SourceBuffer type",C)}};_.append(O,R)},R.onBufferAppending=function e(R,C){var I=this,_=this.hls,F=this.operationQueue,M=this.tracks,N=C.data,U=C.type,B=C.frag,G=C.part,j=C.chunkMeta,K=j.buffering[U],H=self.performance.now();K.start=H;var V=B.stats.buffering,W=G?G.stats.buffering:null;0===V.start&&(V.start=H),W&&0===W.start&&(W.start=H);var Y=M.audio,q="audio"===U&&1===j.id&&"audio/mpeg"===(null==Y?void 0:Y.container),X={"execute":function e(){if(K.executeStart=self.performance.now(),q){var R=I.sourceBuffer[U];if(R){var C=B.start-R.timestampOffset;Math.abs(C)>=.1&&(x.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+B.start+" (delta: "+C+") sn: "+B.sn+")"),R.timestampOffset=B.start)}}I.appendExecutor(N,U)},"onStart":function e(){},"onComplete":function e(){var R=self.performance.now();K.executeEnd=K.end=R,0===V.first&&(V.first=R),W&&0===W.first&&(W.first=R);var C=I.sourceBuffer,_={};for(var x in C)_[x]=P.BufferHelper.getBuffered(C[x]);I.appendError=0,I.hls.trigger(O.Events.BUFFER_APPENDED,{"type":U,"frag":B,"part":G,"chunkMeta":j,"parent":B.type,"timeRanges":_})},"onError":function e(R){x.logger.error("[buffer-controller]: Error encountered while trying to append to the "+U+" SourceBuffer",R);var C={"type":w.ErrorTypes.MEDIA_ERROR,"parent":B.type,"details":w.ErrorDetails.BUFFER_APPEND_ERROR,"err":R,"fatal":!1};R.code===DOMException.QUOTA_EXCEEDED_ERR?C.details=w.ErrorDetails.BUFFER_FULL_ERROR:(I.appendError++,C.details=w.ErrorDetails.BUFFER_APPEND_ERROR,I.appendError>_.config.appendErrorMaxRetry&&(x.logger.error("[buffer-controller]: Failed "+_.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),C.fatal=!0)),_.trigger(O.Events.ERROR,C)}};F.append(X,U)},R.onBufferFlushing=function e(R,C){var I=this,_=this.operationQueue,w=function e(R){return{"execute":I.removeExecutor.bind(I,R,C.startOffset,C.endOffset),"onStart":function e(){},"onComplete":function e(){I.hls.trigger(O.Events.BUFFER_FLUSHED,{"type":R})},"onError":function e(C){x.logger.warn("[buffer-controller]: Failed to remove from "+R+" SourceBuffer",C)}}};C.type?_.append(w(C.type),C.type):this.getSourceBufferTypes().forEach((function(R){_.append(w(R),R)}))},R.onFragParsed=function e(R,C){var I=this,_=C.frag,w=C.part,P=[],F=w?w.elementaryStreams:_.elementaryStreams;F[M.ElementaryStreamTypes.AUDIOVIDEO]?P.push("audiovideo"):(F[M.ElementaryStreamTypes.AUDIO]&&P.push("audio"),F[M.ElementaryStreamTypes.VIDEO]&&P.push("video"));0===P.length&&x.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+_.type+" level: "+_.level+" sn: "+_.sn),this.blockBuffers((function e(){var R=self.performance.now();_.stats.buffering.end=R,w&&(w.stats.buffering.end=R);var C=w?w.stats:_.stats;I.hls.trigger(O.Events.FRAG_BUFFERED,{"frag":_,"part":w,"stats":C,"id":_.type})}),P)},R.onFragChanged=function e(R,C){this.flushBackBuffer()},R.onBufferEos=function e(R,C){var I=this,_=this.getSourceBufferTypes().reduce((function(R,_){var O=I.sourceBuffer[_];return C.type&&C.type!==_||O&&!O.ended&&(O.ended=!0,x.logger.log("[buffer-controller]: "+_+" sourceBuffer now EOS")),R&&!(O&&!O.ended)}),!0);_&&this.blockBuffers((function(){var R=I.mediaSource;R&&"open"===R.readyState&&R.endOfStream()}))},R.onLevelUpdated=function e(R,C){var I=C.details;I.fragments.length&&(this.details=I,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},R.flushBackBuffer=function e(){var R=this.hls,C=this.details,I=this.media,x=this.sourceBuffer;if(I&&null!==C){var w=this.getSourceBufferTypes();if(w.length){var F=C.live&&null!==R.config.liveBackBufferLength?R.config.liveBackBufferLength:R.config.backBufferLength;if(Object(_.isFiniteNumber)(F)&&!(F<0)){var M=I.currentTime,N=C.levelTargetDuration,U=Math.max(F,N),B=Math.floor(M/N)*N-U;w.forEach((function(I){var _=x[I];if(_){var w=P.BufferHelper.getBuffered(_);w.length>0&&B>w.start(0)&&(R.trigger(O.Events.BACK_BUFFER_REACHED,{"bufferEnd":B}),C.live&&R.trigger(O.Events.LIVE_BACK_BUFFER_REACHED,{"bufferEnd":B}),R.trigger(O.Events.BUFFER_FLUSHING,{"startOffset":0,"endOffset":B,"type":I}))}}))}}}},R.updateMediaElementDuration=function e(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var R=this.details,C=this.hls,I=this.media,O=this.mediaSource,w=R.fragments[0].start+R.totalduration,P=I.duration,F=Object(_.isFiniteNumber)(O.duration)?O.duration:0;R.live&&C.config.liveDurationInfinity?(x.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),O.duration=1/0,this.updateSeekableRange(R)):(w>F&&w>P||!Object(_.isFiniteNumber)(P))&&(x.logger.log("[buffer-controller]: Updating Media Source duration to "+w.toFixed(3)),O.duration=w)}},R.updateSeekableRange=function e(R){var C=this.mediaSource,I=R.fragments;if(I.length&&R.live&&null!=C&&C.setLiveSeekableRange){var _=Math.max(0,I[0].start),O=Math.max(_,_+R.totalduration);C.setLiveSeekableRange(_,O)}},R.checkPendingTracks=function e(){var R=this.bufferCodecEventsExpected,C=this.operationQueue,I=this.pendingTracks,_=Object.keys(I).length;if(_&&!R||2===_){this.createSourceBuffers(I),this.pendingTracks={};var x=this.getSourceBufferTypes();if(0===x.length)return void this.hls.trigger(O.Events.ERROR,{"type":w.ErrorTypes.MEDIA_ERROR,"details":w.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,"fatal":!0,"reason":"could not create source buffer for media codec(s)"});x.forEach((function(R){C.executeNext(R)}))}},R.createSourceBuffers=function e(R){var C=this.sourceBuffer,I=this.mediaSource;if(!I)throw Error("createSourceBuffers called when mediaSource was null");var _=0;for(var P in R)if(!C[P]){var F=R[P];if(!F)throw Error("source buffer exists for track "+P+", however track does not");var M=F.levelCodec||F.codec,N=F.container+";codecs="+M;x.logger.log("[buffer-controller]: creating sourceBuffer("+N+")");try{var U=C[P]=I.addSourceBuffer(N),B=P;this.addBufferListener(B,"updatestart",this._onSBUpdateStart),this.addBufferListener(B,"updateend",this._onSBUpdateEnd),this.addBufferListener(B,"error",this._onSBUpdateError),this.tracks[P]={"buffer":U,"codec":M,"container":F.container,"levelCodec":F.levelCodec,"id":F.id},_++}catch(e){x.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(O.Events.ERROR,{"type":w.ErrorTypes.MEDIA_ERROR,"details":w.ErrorDetails.BUFFER_ADD_CODEC_ERROR,"fatal":!1,"error":e,"mimeType":N})}}_&&this.hls.trigger(O.Events.BUFFER_CREATED,{"tracks":this.tracks})},R._onSBUpdateStart=function e(R){this.operationQueue.current(R).onStart()},R._onSBUpdateEnd=function e(R){var C=this.operationQueue;C.current(R).onComplete(),C.shiftAndExecuteNext(R)},R._onSBUpdateError=function e(R,C){x.logger.error("[buffer-controller]: "+R+" SourceBuffer error",C),this.hls.trigger(O.Events.ERROR,{"type":w.ErrorTypes.MEDIA_ERROR,"details":w.ErrorDetails.BUFFER_APPENDING_ERROR,"fatal":!1});var I=this.operationQueue.current(R);I&&I.onError(C)},R.removeExecutor=function e(R,C,I){var O=this.media,w=this.mediaSource,P=this.operationQueue,F=this.sourceBuffer[R];if(!O||!w||!F)return x.logger.warn("[buffer-controller]: Attempting to remove from the "+R+" SourceBuffer, but it does not exist"),void P.shiftAndExecuteNext(R);var M=Object(_.isFiniteNumber)(O.duration)?O.duration:1/0,N=Object(_.isFiniteNumber)(w.duration)?w.duration:1/0,U=Math.max(0,C),B=Math.min(I,M,N);B>U?(x.logger.log("[buffer-controller]: Removing ["+U+","+B+"] from the "+R+" SourceBuffer"),console.assert(!F.updating,R+" sourceBuffer must not be updating"),F.remove(U,B)):P.shiftAndExecuteNext(R)},R.appendExecutor=function e(R,C){var I=this.operationQueue,_=this.sourceBuffer[C];if(!_)return x.logger.warn("[buffer-controller]: Attempting to append to the "+C+" SourceBuffer, but it does not exist"),void I.shiftAndExecuteNext(C);_.ended=!1,console.assert(!_.updating,C+" sourceBuffer must not be updating"),_.appendBuffer(R)},R.blockBuffers=function e(R,C){var I=this;if(void 0===C&&(C=this.getSourceBufferTypes()),C.length){var _=this.operationQueue,O=C.map((function(R){return _.appendBlocker(R)}));Promise.all(O).then((function(){R(),C.forEach((function(R){var C=I.sourceBuffer[R];C&&C.updating||_.shiftAndExecuteNext(R)}))}))}else x.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist")},R.getSourceBufferTypes=function e(){return Object.keys(this.sourceBuffer)},R.addBufferListener=function e(R,C,I){var _=this.sourceBuffer[R];if(_){var O=I.bind(this,R);this.listeners[R].push({"event":C,"listener":O}),_.addEventListener(C,O)}},R.removeBufferListeners=function e(R){var C=this.sourceBuffer[R];C&&this.listeners[R].forEach((function(R){C.removeEventListener(R.event,R.listener)}))},e}()},"./src/controller/buffer-operation-queue.ts":function srcControllerBufferOperationQueueTs(R,C,I){I.r(C),I.d(C,"default",(function(){return O}));var _=I("./src/utils/logger.ts"),O=function(){function e(R){this.buffers=void 0,this.queues={"video":[],"audio":[],"audiovideo":[]},this.buffers=R}var R=e.prototype;return R.append=function e(R,C){var I=this.queues[C];I.push(R),1===I.length&&this.buffers[C]&&this.executeNext(C)},R.insertAbort=function e(R,C){this.queues[C].unshift(R),this.executeNext(C)},R.appendBlocker=function e(R){var C,I=new Promise((function(R){C=R})),_={"execute":C,"onStart":function e(){},"onComplete":function e(){},"onError":function e(){}};return this.append(_,R),I},R.executeNext=function e(R){var C=this.buffers,I=this.queues,O=C[R],x=I[R];if(x.length){var w=x[0];try{w.execute()}catch(e){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),w.onError(e),O&&O.updating||(x.shift(),this.executeNext(R))}}},R.shiftAndExecuteNext=function e(R){this.queues[R].shift(),this.executeNext(R)},R.current=function e(R){return this.queues[R][0]},e}()},"./src/controller/cap-level-controller.ts":function srcControllerCapLevelControllerTs(R,C,I){I.r(C);var _=I("./src/events.ts");function a(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}var O=function(){function e(R){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=R,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var R=e.prototype;return R.setStreamController=function e(R){this.streamController=R},R.destroy=function e(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},R.registerListeners=function e(){var R=this.hls;R.on(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),R.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.unregisterListener=function e(){var R=this.hls;R.off(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),R.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.onFpsDropLevelCapping=function t(R,C){e.isLevelAllowed(C.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(C.droppedLevel)},R.onMediaAttaching=function e(R,C){this.media=C.media instanceof HTMLVideoElement?C.media:null},R.onManifestParsed=function e(R,C){var I=this.hls;this.restrictedLevels=[],this.firstLevel=C.firstLevel,I.config.capLevelToPlayerSize&&C.video&&this.startCapping()},R.onBufferCodecs=function e(R,C){this.hls.config.capLevelToPlayerSize&&C.video&&this.startCapping()},R.onMediaDetaching=function e(){this.stopCapping()},R.detectPlayerSize=function e(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var R=this.hls.levels;if(R.length){var C=this.hls;C.autoLevelCapping=this.getMaxLevel(R.length-1),C.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=C.autoLevelCapping}}},R.getMaxLevel=function t(R){var C=this,I=this.hls.levels;if(!I.length)return-1;var _=I.filter((function(I,_){return e.isLevelAllowed(_,C.restrictedLevels)&&_<=R}));return this.clientRect=null,e.getMaxLevelByMediaSize(_,this.mediaWidth,this.mediaHeight)},R.startCapping=function e(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},R.stopCapping=function e(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},R.getDimensions=function e(){if(this.clientRect)return this.clientRect;var R=this.media,C={"width":0,"height":0};if(R){var I=R.getBoundingClientRect();C.width=I.width,C.height=I.height,C.width||C.height||(C.width=I.right-I.left||R.width||0,C.height=I.bottom-I.top||R.height||0)}return this.clientRect=C,C},e.isLevelAllowed=function e(R,C){return void 0===C&&(C=[]),-1===C.indexOf(R)},e.getMaxLevelByMediaSize=function e(R,C,I){if(!R||!R.length)return-1;for(var _=function e(R,C){return!C||(R.width!==C.width||R.height!==C.height)},O=R.length-1,x=0;x<R.length;x+=1){var w=R[x];if((w.width>=C||w.height>=I)&&_(w,R[x+1])){O=x;break}}return O},function n(R,C,I){return C&&a(R.prototype,C),I&&a(R,I),R}(e,[{"key":"mediaWidth","get":function t(){return this.getDimensions().width*e.contentScaleFactor}},{"key":"mediaHeight","get":function t(){return this.getDimensions().height*e.contentScaleFactor}}],[{"key":"contentScaleFactor","get":function e(){var R=1;try{R=self.devicePixelRatio}catch(e){}return R}}]),e}();C.default=O},"./src/controller/cmcd-controller.ts":function srcControllerCmcdControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return P}));var _=I("./src/events.ts"),O=I("./src/types/cmcd.ts"),x=I("./src/utils/buffer-helper.ts"),w=I("./src/utils/logger.ts");function o(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}function l(R,C,I){return C&&o(R.prototype,C),I&&o(R,I),R}function u(R,C){var I="undefined"!=typeof Symbol&&R[Symbol.iterator]||R["@@iterator"];if(I)return(I=I.call(R)).next.bind(I);if(Array.isArray(R)||(I=function f(R,C){if(!R)return;if("string"==typeof R)return d(R,C);var I=Object.prototype.toString.call(R).slice(8,-1);"Object"===I&&R.constructor&&(I=R.constructor.name);if("Map"===I||"Set"===I)return Array.from(R);if("Arguments"===I||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(I))return d(R,C)}(R))||C&&R&&"number"==typeof R.length){I&&(R=I);var _=0;return function(){return _>=R.length?{"done":!0}:{"done":!1,"value":R[_++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(R,C){(null==C||C>R.length)&&(C=R.length);for(var I=0,_=new Array(C);I<C;I++)_[I]=R[I];return _}function c(){return c=Object.assign||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var _ in I)Object.prototype.hasOwnProperty.call(I,_)&&(R[_]=I[_])}return R},c.apply(this,arguments)}var P=function(){function e(R){var C=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){C.initialized&&(C.starved=!0),C.buffering=!0},this.onPlaying=function(){C.initialized||(C.initialized=!0),C.buffering=!1},this.applyPlaylistData=function(R){try{C.apply(R,{"ot":O.CMCDObjectType.MANIFEST,"su":!C.initialized})}catch(R){w.logger.warn("Could not generate manifest CMCD data.",R)}},this.applyFragmentData=function(R){try{var I=R.frag,_=C.hls.levels[I.level],x=C.getObjectType(I),P={"d":1e3*I.duration,"ot":x};x!==O.CMCDObjectType.VIDEO&&x!==O.CMCDObjectType.AUDIO&&x!=O.CMCDObjectType.MUXED||(P.br=_.bitrate/1e3,P.tb=C.getTopBandwidth(x)/1e3,P.bl=C.getBufferLength(x)),C.apply(R,P)}catch(R){w.logger.warn("Could not generate segment CMCD data.",R)}},this.hls=R;var I=this.config=R.config,_=I.cmcd;null!=_&&(I.pLoader=this.createPlaylistLoader(),I.fLoader=this.createFragmentLoader(),this.sid=_.sessionId||e.uuid(),this.cid=_.contentId,this.useHeaders=!0===_.useHeaders,this.registerListeners())}var R=e.prototype;return R.registerListeners=function e(){var R=this.hls;R.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),R.on(_.Events.BUFFER_CREATED,this.onBufferCreated,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),R.off(_.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},R.destroy=function e(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},R.onMediaAttached=function e(R,C){this.media=C.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},R.onMediaDetached=function e(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},R.onBufferCreated=function e(R,C){var I,_;this.audioBuffer=null===(I=C.tracks.audio)||void 0===I?void 0:I.buffer,this.videoBuffer=null===(_=C.tracks.video)||void 0===_?void 0:_.buffer},R.createData=function e(){var R;return{"v":O.CMCDVersion,"sf":O.CMCDStreamingFormat.HLS,"sid":this.sid,"cid":this.cid,"pr":null===(R=this.media)||void 0===R?void 0:R.playbackRate,"mtp":this.hls.bandwidthEstimate/1e3}},R.apply=function t(R,C){void 0===C&&(C={}),c(C,this.createData());var I=C.ot===O.CMCDObjectType.INIT||C.ot===O.CMCDObjectType.VIDEO||C.ot===O.CMCDObjectType.MUXED;if(this.starved&&I&&(C.bs=!0,C.su=!0,this.starved=!1),null==C.su&&(C.su=this.buffering),this.useHeaders){var _=e.toHeaders(C);if(!Object.keys(_).length)return;R.headers||(R.headers={}),c(R.headers,_)}else{var x=e.toQuery(C);if(!x)return;R.url=e.appendQueryToUri(R.url,x)}},R.getObjectType=function e(R){var C=R.type;return"subtitle"===C?O.CMCDObjectType.TIMED_TEXT:"initSegment"===R.sn?O.CMCDObjectType.INIT:"audio"===C?O.CMCDObjectType.AUDIO:"main"===C?this.hls.audioTracks.length?O.CMCDObjectType.VIDEO:O.CMCDObjectType.MUXED:void 0},R.getTopBandwidth=function e(R){var C,I=0,_=this.hls;if(R===O.CMCDObjectType.AUDIO)C=_.audioTracks;else{var x=_.maxAutoLevel,w=x>-1?x+1:_.levels.length;C=_.levels.slice(0,w)}for(var P,F=u(C);!(P=F()).done;){var M=P.value;M.bitrate>I&&(I=M.bitrate)}return I>0?I:NaN},R.getBufferLength=function e(R){var C=this.hls.media,I=R===O.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return I&&C?1e3*x.BufferHelper.bufferInfo(I,C.currentTime,this.config.maxBufferHole).len:NaN},R.createPlaylistLoader=function e(){var R=this.config.pLoader,C=this.applyPlaylistData,I=R||this.config.loader;return function(){function e(R){this.loader=void 0,this.loader=new I(R)}var R=e.prototype;return R.destroy=function e(){this.loader.destroy()},R.abort=function e(){this.loader.abort()},R.load=function e(R,I,_){C(R),this.loader.load(R,I,_)},l(e,[{"key":"stats","get":function e(){return this.loader.stats}},{"key":"context","get":function e(){return this.loader.context}}]),e}()},R.createFragmentLoader=function e(){var R=this.config.fLoader,C=this.applyFragmentData,I=R||this.config.loader;return function(){function e(R){this.loader=void 0,this.loader=new I(R)}var R=e.prototype;return R.destroy=function e(){this.loader.destroy()},R.abort=function e(){this.loader.abort()},R.load=function e(R,I,_){C(R),this.loader.load(R,I,_)},l(e,[{"key":"stats","get":function e(){return this.loader.stats}},{"key":"context","get":function e(){return this.loader.context}}]),e}()},e.uuid=function e(){var R=URL.createObjectURL(new Blob),e=R.toString();return URL.revokeObjectURL(R),e.substr(e.lastIndexOf("/")+1)},e.serialize=function e(R){for(var C,I=[],_=function e(R){return!Number.isNaN(R)&&null!=R&&""!==R&&!1!==R},O=function e(R){return Math.round(R)},x=function e(R){return 100*O(R/100)},w={"br":O,"d":O,"bl":x,"dl":x,"mtp":x,"nor":function e(R){return encodeURIComponent(R)},"rtp":x,"tb":O},P=u(Object.keys(R||{}).sort());!(C=P()).done;){var F=C.value,M=R[F];if(_(M)&&!("v"===F&&1===M||"pr"==F&&1===M)){var N=w[F];N&&(M=N(M));var U=typeof M,B=void 0;B="ot"===F||"sf"===F||"st"===F?F+"="+M:"boolean"===U?F:"number"===U?F+"="+M:F+"="+JSON.stringify(M),I.push(B)}}return I.join(",")},e.toHeaders=function t(R){for(var C={},I=["Object","Request","Session","Status"],_=[{},{},{},{}],O={"br":0,"d":0,"ot":0,"tb":0,"bl":1,"dl":1,"mtp":1,"nor":1,"nrr":1,"su":1,"cid":2,"pr":2,"sf":2,"sid":2,"st":2,"v":2,"bs":3,"rtp":3},x=0,w=Object.keys(R);x<w.length;x++){var P=w[x];_[null!=O[P]?O[P]:1][P]=R[P]}for(var F=0;F<_.length;F++){var M=e.serialize(_[F]);M&&(C["CMCD-"+I[F]]=M)}return C},e.toQuery=function t(R){return"CMCD="+encodeURIComponent(e.serialize(R))},e.appendQueryToUri=function e(R,C){if(!C)return R;var I=R.includes("?")?"&":"?";return""+R+I+C},e}()},"./src/controller/eme-controller.ts":function srcControllerEmeControllerTs(R,C,I){I.r(C);var _=I("./src/events.ts"),O=I("./src/errors.ts"),x=I("./src/utils/logger.ts"),w=I("./src/utils/mediakeys-helper.ts");function o(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}var P=function e(R,C,I,_){if(R===w.KeySystems.WIDEVINE)return function e(R,C,I){var _={"audioCapabilities":[],"videoCapabilities":[]};return R.forEach((function(R){_.audioCapabilities.push({"contentType":'audio/mp4; codecs="'+R+'"',"robustness":I.audioRobustness||""})})),C.forEach((function(R){_.videoCapabilities.push({"contentType":'video/mp4; codecs="'+R+'"',"robustness":I.videoRobustness||""})})),[_]}(C,I,_);throw new Error("Unknown key-system: "+R)},F=function(){function e(R){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=R,this._config=R.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var R=e.prototype;return R.destroy=function e(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},R._registerListeners=function e(){this.hls.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},R._unregisterListeners=function e(){this.hls.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},R.getLicenseServerUrl=function e(R){switch(R){case w.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+R+'"')},R._attemptKeySystemAccess=function e(R,C,I){var _=this,O=P(R,C,I,this._drmSystemOptions);x.logger.log("Requesting encrypted media key-system access");var w=this.requestMediaKeySystemAccess(R,O);this.mediaKeysPromise=w.then((function(C){return _._onMediaKeySystemAccessObtained(R,C)})),w.catch((function(C){x.logger.error('Failed to obtain key-system "'+R+'" access:',C)}))},R._onMediaKeySystemAccessObtained=function e(R,C){var I=this;x.logger.log('Access for key-system "'+R+'" obtained');var _={"mediaKeysSessionInitialized":!1,"mediaKeySystemAccess":C,"mediaKeySystemDomain":R};this._mediaKeysList.push(_);var O=Promise.resolve().then((function(){return C.createMediaKeys()})).then((function(C){return _.mediaKeys=C,x.logger.log('Media-keys created for key-system "'+R+'"'),I._onMediaKeysCreated(),C}));return O.catch((function(R){x.logger.error("Failed to create media-keys:",R)})),O},R._onMediaKeysCreated=function e(){var R=this;this._mediaKeysList.forEach((function(C){C.mediaKeysSession||(C.mediaKeysSession=C.mediaKeys.createSession(),R._onNewMediaKeySession(C.mediaKeysSession))}))},R._onNewMediaKeySession=function e(R){var C=this;x.logger.log("New key-system session "+R.sessionId),R.addEventListener("message",(function(I){C._onKeySessionMessage(R,I.message)}),!1)},R._onKeySessionMessage=function e(R,C){x.logger.log("Got EME message event, creating license request"),this._requestLicense(C,(function(C){x.logger.log("Received license data (length: "+(C?C.byteLength:C)+"), updating key-session"),R.update(C)}))},R.onMediaEncrypted=function e(R){var C=this;if(x.logger.log('Media is encrypted using "'+R.initDataType+'" init data type'),!this.mediaKeysPromise)return x.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.KEY_SYSTEM_ERROR,"details":O.ErrorDetails.KEY_SYSTEM_NO_KEYS,"fatal":!0});var I=function e(I){C._media&&(C._attemptSetMediaKeys(I),C._generateRequestWithPreferredKeySession(R.initDataType,R.initData))};this.mediaKeysPromise.then(I).catch(I)},R._attemptSetMediaKeys=function e(R){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var C=this._mediaKeysList[0];if(!C||!C.mediaKeys)return x.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.KEY_SYSTEM_ERROR,"details":O.ErrorDetails.KEY_SYSTEM_NO_KEYS,"fatal":!0});x.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(C.mediaKeys),this._hasSetMediaKeys=!0}},R._generateRequestWithPreferredKeySession=function e(R,C){var I=this,w=this._mediaKeysList[0];if(!w)return x.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.KEY_SYSTEM_ERROR,"details":O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,"fatal":!0});if(w.mediaKeysSessionInitialized)x.logger.warn("Key-Session already initialized but requested again");else{var P=w.mediaKeysSession;if(!P)return x.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.KEY_SYSTEM_ERROR,"details":O.ErrorDetails.KEY_SYSTEM_NO_SESSION,"fatal":!0});if(!C)return x.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.KEY_SYSTEM_ERROR,"details":O.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,"fatal":!0});x.logger.log('Generating key-session request for "'+R+'" init data type'),w.mediaKeysSessionInitialized=!0,P.generateRequest(R,C).then((function(){x.logger.debug("Key-session generation succeeded")})).catch((function(R){x.logger.error("Error generating key-session request:",R),I.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.KEY_SYSTEM_ERROR,"details":O.ErrorDetails.KEY_SYSTEM_NO_SESSION,"fatal":!1})}))}},R._createLicenseXhr=function e(R,C,I){var _=new XMLHttpRequest;_.responseType="arraybuffer",_.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,_,R,C,I);var O=this._licenseXhrSetup;if(O)try{O.call(this.hls,_,R),O=void 0}catch(e){x.logger.error(e)}try{_.readyState||_.open("POST",R,!0),O&&O.call(this.hls,_,R)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return _},R._onLicenseRequestReadyStageChange=function e(R,C,I,w){if(4===R.readyState)if(200===R.status){this._requestLicenseFailureCount=0,x.logger.log("License request succeeded");var P=R.response,F=this._licenseResponseCallback;if(F)try{P=F.call(this.hls,R,C)}catch(e){x.logger.error(e)}w(P)}else{if(x.logger.error("License Request XHR failed ("+C+"). Status: "+R.status+" ("+R.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.KEY_SYSTEM_ERROR,"details":O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,"fatal":!0});var M=3-this._requestLicenseFailureCount+1;x.logger.warn("Retrying license request, "+M+" attempts left"),this._requestLicense(I,w)}},R._generateLicenseRequestChallenge=function e(R,C){if(R.mediaKeySystemDomain===w.KeySystems.WIDEVINE)return C;throw new Error("unsupported key-system: "+R.mediaKeySystemDomain)},R._requestLicense=function e(R,C){x.logger.log("Requesting content license for key-system");var I=this._mediaKeysList[0];if(!I)return x.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.KEY_SYSTEM_ERROR,"details":O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,"fatal":!0});try{var w=this.getLicenseServerUrl(I.mediaKeySystemDomain),P=this._createLicenseXhr(w,R,C);x.logger.log("Sending license request to URL: "+w);var F=this._generateLicenseRequestChallenge(I,R);P.send(F)}catch(e){x.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.KEY_SYSTEM_ERROR,"details":O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,"fatal":!0})}},R.onMediaAttached=function e(R,C){if(this._emeEnabled){var I=C.media;this._media=I,I.addEventListener("encrypted",this._onMediaEncrypted)}},R.onMediaDetached=function e(){var R=this._media,C=this._mediaKeysList;R&&(R.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(C.map((function(R){if(R.mediaKeysSession)return R.mediaKeysSession.close().catch((function(){}))}))).then((function(){return R.setMediaKeys(null)})).catch((function(){})))},R.onManifestParsed=function e(R,C){if(this._emeEnabled){var I=C.levels.map((function(R){return R.audioCodec})).filter((function(R){return!!R})),_=C.levels.map((function(R){return R.videoCodec})).filter((function(R){return!!R}));this._attemptKeySystemAccess(w.KeySystems.WIDEVINE,I,_)}},function l(R,C,I){return C&&o(R.prototype,C),I&&o(R,I),R}(e,[{"key":"requestMediaKeySystemAccess","get":function e(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),e}();C.default=F},"./src/controller/fps-controller.ts":function srcControllerFpsControllerTs(R,C,I){I.r(C);var _=I("./src/events.ts"),O=I("./src/utils/logger.ts"),x=function(){function e(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var R=e.prototype;return R.setStreamController=function e(R){this.streamController=R},R.registerListeners=function e(){this.hls.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function e(){this.hls.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function e(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function e(R,C){var I=this.hls.config;if(I.capLevelOnFPSDrop){var _=C.media instanceof self.HTMLVideoElement?C.media:null;this.media=_,_&&"function"==typeof _.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),I.fpsDroppedMonitoringPeriod)}},R.checkFPS=function e(R,C,I){var x=performance.now();if(C){if(this.lastTime){var w=x-this.lastTime,P=I-this.lastDroppedFrames,F=C-this.lastDecodedFrames,M=1e3*P/w,N=this.hls;if(N.trigger(_.Events.FPS_DROP,{"currentDropped":P,"currentDecoded":F,"totalDroppedFrames":I}),M>0&&P>N.config.fpsDroppedMonitoringThreshold*F){var U=N.currentLevel;O.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+U),U>0&&(-1===N.autoLevelCapping||N.autoLevelCapping>=U)&&(U-=1,N.trigger(_.Events.FPS_DROP_LEVEL_CAPPING,{"level":U,"droppedLevel":N.currentLevel}),N.autoLevelCapping=U,this.streamController.nextLevelSwitch())}}this.lastTime=x,this.lastDroppedFrames=I,this.lastDecodedFrames=C}},R.checkFPSInterval=function e(){var R=this.media;if(R)if(this.isVideoPlaybackQualityAvailable){var C=R.getVideoPlaybackQuality();this.checkFPS(R,C.totalVideoFrames,C.droppedVideoFrames)}else this.checkFPS(R,R.webkitDecodedFrameCount,R.webkitDroppedFrameCount)},e}();C.default=x},"./src/controller/fragment-finders.ts":function srcControllerFragmentFindersTs(R,C,I){I.r(C),I.d(C,"findFragmentByPDT",(function(){return n})),I.d(C,"findFragmentByPTS",(function(){return s})),I.d(C,"fragmentWithinToleranceTest",(function(){return o})),I.d(C,"pdtWithinToleranceTest",(function(){return l})),I.d(C,"findFragWithCC",(function(){return u}));var _=I("./src/polyfills/number.ts"),O=I("./src/utils/binary-search.ts");function n(R,C,I){if(null===C||!Array.isArray(R)||!R.length||!Object(_.isFiniteNumber)(C))return null;if(C<(R[0].programDateTime||0))return null;if(C>=(R[R.length-1].endProgramDateTime||0))return null;I=I||0;for(var O=0;O<R.length;++O){var x=R[O];if(l(C,I,x))return x}return null}function s(R,C,I,_){void 0===I&&(I=0),void 0===_&&(_=0);var x=null;if(R?x=C[R.sn-C[0].sn+1]||null:0===I&&0===C[0].start&&(x=C[0]),x&&0===o(I,_,x))return x;var w=O.default.search(C,o.bind(null,I,_));return w||x}function o(R,C,I){void 0===R&&(R=0),void 0===C&&(C=0);var _=Math.min(C,I.duration+(I.deltaPTS?I.deltaPTS:0));return I.start+I.duration-_<=R?1:I.start-_>R&&I.start?-1:0}function l(R,C,I){var _=1e3*Math.min(C,I.duration+(I.deltaPTS?I.deltaPTS:0));return(I.endProgramDateTime||0)-_>R}function u(R,C){return O.default.search(R,(function(R){return R.cc<C?1:R.cc>C?-1:0}))}},"./src/controller/fragment-tracker.ts":function srcControllerFragmentTrackerTs(R,C,I){I.r(C),I.d(C,"FragmentState",(function(){return _})),I.d(C,"FragmentTracker",(function(){return w}));var _,O=I("./src/events.ts"),x=I("./src/types/loader.ts");!function(R){R.NOT_LOADED="NOT_LOADED",R.BACKTRACKED="BACKTRACKED",R.APPENDING="APPENDING",R.PARTIAL="PARTIAL",R.OK="OK"}(_||(_={}));var w=function(){function e(R){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=R,this._registerListeners()}var R=e.prototype;return R._registerListeners=function e(){var R=this.hls;R.on(O.Events.BUFFER_APPENDED,this.onBufferAppended,this),R.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.on(O.Events.FRAG_LOADED,this.onFragLoaded,this)},R._unregisterListeners=function e(){var R=this.hls;R.off(O.Events.BUFFER_APPENDED,this.onBufferAppended,this),R.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.off(O.Events.FRAG_LOADED,this.onFragLoaded,this)},R.destroy=function e(){this._unregisterListeners(),this.fragments=this.timeRanges=null},R.getAppendedFrag=function e(R,C){if(C===x.PlaylistLevelType.MAIN){var I=this.activeFragment,_=this.activeParts;if(!I)return null;if(_)for(var O=_.length;O--;){var w=_[O],P=w?w.end:I.appendedPTS;if(w.start<=R&&void 0!==P&&R<=P)return O>9&&(this.activeParts=_.slice(O-9)),w}else if(I.start<=R&&void 0!==I.appendedPTS&&R<=I.appendedPTS)return I}return this.getBufferedFrag(R,C)},R.getBufferedFrag=function e(R,C){for(var I=this.fragments,_=Object.keys(I),O=_.length;O--;){var x=I[_[O]];if((null==x?void 0:x.body.type)===C&&x.buffered){var w=x.body;if(w.start<=R&&R<=w.end)return w}}return null},R.detectEvictedFragments=function e(R,C,I){var _=this;Object.keys(this.fragments).forEach((function(O){var x=_.fragments[O];if(x)if(x.buffered){var w=x.range[R];w&&w.time.some((function(R){var I=!_.isTimeBuffered(R.startPTS,R.endPTS,C);return I&&_.removeFragment(x.body),I}))}else x.body.type===I&&_.removeFragment(x.body)}))},R.detectPartialFragments=function e(R){var C=this,I=this.timeRanges,_=R.frag,O=R.part;if(I&&"initSegment"!==_.sn){var x=l(_),w=this.fragments[x];w&&(Object.keys(I).forEach((function(R){var x=_.elementaryStreams[R];if(x){var P=I[R],F=null!==O||!0===x.partial;w.range[R]=C.getBufferedTimes(_,O,F,P)}})),w.backtrack=w.loaded=null,Object.keys(w.range).length?w.buffered=!0:this.removeFragment(w.body))}},R.fragBuffered=function e(R){var C=l(R),I=this.fragments[C];I&&(I.backtrack=I.loaded=null,I.buffered=!0)},R.getBufferedTimes=function e(R,C,I,_){for(var O={"time":[],"partial":I},x=C?C.start:R.start,w=C?C.end:R.end,P=R.minEndPTS||w,F=R.maxStartPTS||x,M=0;M<_.length;M++){var N=_.start(M)-this.bufferPadding,U=_.end(M)+this.bufferPadding;if(F>=N&&P<=U){O.time.push({"startPTS":Math.max(x,_.start(M)),"endPTS":Math.min(w,_.end(M))});break}if(x<U&&w>N)O.partial=!0,O.time.push({"startPTS":Math.max(x,_.start(M)),"endPTS":Math.min(w,_.end(M))});else if(w<=N)break}return O},R.getPartialFragment=function e(R){var C,I,_,O=null,x=0,w=this.bufferPadding,P=this.fragments;return Object.keys(P).forEach((function(F){var M=P[F];M&&o(M)&&(I=M.body.start-w,_=M.body.end+w,R>=I&&R<=_&&(C=Math.min(R-I,_-R),x<=C&&(O=M.body,x=C)))})),O},R.getState=function e(R){var C=l(R),I=this.fragments[C];return I?I.buffered?o(I)?_.PARTIAL:_.OK:I.backtrack?_.BACKTRACKED:_.APPENDING:_.NOT_LOADED},R.backtrack=function e(R,C){var I=l(R),_=this.fragments[I];if(!_||_.backtrack)return null;var e=_.backtrack=C||_.loaded;return _.loaded=null,e},R.getBacktrackData=function e(R){var C=l(R),I=this.fragments[C];if(I){var _,O=I.backtrack;if(null!=O&&null!==(_=O.payload)&&void 0!==_&&_.byteLength)return O;this.removeFragment(R)}return null},R.isTimeBuffered=function e(R,C,I){for(var _,O,x=0;x<I.length;x++){if(_=I.start(x)-this.bufferPadding,O=I.end(x)+this.bufferPadding,R>=_&&C<=O)return!0;if(C<=_)return!1}return!1},R.onFragLoaded=function e(R,C){var I=C.frag,_=C.part;if("initSegment"!==I.sn&&!I.bitrateTest&&!_){var O=l(I);this.fragments[O]={"body":I,"loaded":C,"backtrack":null,"buffered":!1,"range":Object.create(null)}}},R.onBufferAppended=function e(R,C){var I=this,_=C.frag,O=C.part,w=C.timeRanges;if(_.type===x.PlaylistLevelType.MAIN)if(this.activeFragment=_,O){var P=this.activeParts;P||(this.activeParts=P=[]),P.push(O)}else this.activeParts=null;this.timeRanges=w,Object.keys(w).forEach((function(R){var C=w[R];if(I.detectEvictedFragments(R,C),!O)for(var x=0;x<C.length;x++)_.appendedPTS=Math.max(C.end(x),_.appendedPTS||0)}))},R.onFragBuffered=function e(R,C){this.detectPartialFragments(C)},R.hasFragment=function e(R){var C=l(R);return!!this.fragments[C]},R.removeFragmentsInRange=function e(R,C,I){var _=this;Object.keys(this.fragments).forEach((function(O){var x=_.fragments[O];if(x&&x.buffered){var w=x.body;w.type===I&&w.start<C&&w.end>R&&_.removeFragment(w)}}))},R.removeFragment=function e(R){var C=l(R);R.stats.loaded=0,R.clearElementaryStreamInfo(),delete this.fragments[C]},R.removeAllFragments=function e(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},e}();function o(R){var C,I;return R.buffered&&((null===(C=R.range.video)||void 0===C?void 0:C.partial)||(null===(I=R.range.audio)||void 0===I?void 0:I.partial))}function l(R){return R.type+"_"+R.level+"_"+R.urlId+"_"+R.sn}},"./src/controller/gap-controller.ts":function srcControllerGapControllerTs(R,C,I){I.r(C),I.d(C,"STALL_MINIMUM_DURATION_MS",(function(){return P})),I.d(C,"MAX_START_GAP_JUMP",(function(){return F})),I.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return M})),I.d(C,"SKIP_BUFFER_RANGE_START",(function(){return N})),I.d(C,"default",(function(){return U}));var _=I("./src/utils/buffer-helper.ts"),O=I("./src/errors.ts"),x=I("./src/events.ts"),w=I("./src/utils/logger.ts"),P=250,F=2,M=.1,N=.05,U=function(){function e(R,C,I,_){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=R,this.media=C,this.fragmentTracker=I,this.hls=_}var R=e.prototype;return R.destroy=function e(){this.hls=this.fragmentTracker=this.media=null},R.poll=function e(R){var C=this.config,I=this.media,O=this.stalled,x=I.currentTime,M=I.seeking,N=this.seeking&&!M,U=!this.seeking&&M;if(this.seeking=M,x===R){if((U||N)&&(this.stalled=null),!I.paused&&!I.ended&&0!==I.playbackRate&&_.BufferHelper.getBuffered(I).length){var B=_.BufferHelper.bufferInfo(I,x,0),G=B.len>0,j=B.nextStart||0;if(G||j){if(M){var K=B.len>F,H=!j||j-x>F&&!this.fragmentTracker.getPartialFragment(x);if(K||H)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var V,W=Math.max(j,B.start||0)-x,Y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,q=(null==Y||null===(V=Y.details)||void 0===V?void 0:V.live)?2*Y.details.targetduration:F;if(W>0&&W<=q)return void this._trySkipBufferHole(null)}var X=self.performance.now();if(null!==O){var z=X-O;!M&&z>=P&&this._reportStall(B.len);var Q=_.BufferHelper.bufferInfo(I,x,C.maxBufferHole);this._tryFixBufferStall(Q,z)}else this.stalled=X}}}else if(this.moved=!0,null!==O){if(this.stallReported){var J=self.performance.now()-O;w.logger.warn("playback not stuck anymore @"+x+", after "+Math.round(J)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},R._tryFixBufferStall=function e(R,C){var I=this.config,_=this.fragmentTracker,O=this.media.currentTime,x=_.getPartialFragment(O);if(x&&this._trySkipBufferHole(x))return;R.len>I.maxBufferHole&&C>1e3*I.highBufferWatchdogPeriod&&(w.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},R._reportStall=function e(R){var C=this.hls,I=this.media;this.stallReported||(this.stallReported=!0,w.logger.warn("Playback stalling at @"+I.currentTime+" due to low buffer (buffer="+R+")"),C.trigger(x.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.BUFFER_STALLED_ERROR,"fatal":!1,"buffer":R}))},R._trySkipBufferHole=function e(R){for(var C=this.config,I=this.hls,P=this.media,F=P.currentTime,U=0,B=_.BufferHelper.getBuffered(P),G=0;G<B.length;G++){var j=B.start(G);if(F+C.maxBufferHole>=U&&F<j){var K=Math.max(j+N,P.currentTime+M);return w.logger.warn("skipping hole, adjusting currentTime from "+F+" to "+K),this.moved=!0,this.stalled=null,P.currentTime=K,R&&I.trigger(x.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.BUFFER_SEEK_OVER_HOLE,"fatal":!1,"reason":"fragment loaded with buffer holes, seeking from "+F+" to "+K,"frag":R}),K}U=B.end(G)}return 0},R._tryNudgeBuffer=function e(){var R=this.config,C=this.hls,I=this.media,_=I.currentTime,P=(this.nudgeRetry||0)+1;if(this.nudgeRetry=P,P<R.nudgeMaxRetry){var F=_+P*R.nudgeOffset;w.logger.warn("Nudging 'currentTime' from "+_+" to "+F),I.currentTime=F,C.trigger(x.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.BUFFER_NUDGE_ON_STALL,"fatal":!1})}else w.logger.error("Playhead still not moving while enough data buffered @"+_+" after "+R.nudgeMaxRetry+" nudges"),C.trigger(x.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.BUFFER_STALLED_ERROR,"fatal":!0})},e}()},"./src/controller/id3-track-controller.ts":function srcControllerId3TrackControllerTs(R,C,I){I.r(C);var _=I("./src/events.ts"),O=I("./src/utils/texttrack-utils.ts"),x=I("./src/demux/id3.ts"),w=function(){function e(R){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=R,this._registerListeners()}var R=e.prototype;return R.destroy=function e(){this._unregisterListeners()},R._registerListeners=function e(){var R=this.hls;R.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),R.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R._unregisterListeners=function e(){var R=this.hls;R.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),R.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R.onMediaAttached=function e(R,C){this.media=C.media},R.onMediaDetaching=function e(){this.id3Track&&(Object(O.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},R.getID3Track=function e(R){if(this.media){for(var C=0;C<R.length;C++){var I=R[C];if("metadata"===I.kind&&"id3"===I.label)return Object(O.sendAddTrackEvent)(I,this.media),I}return this.media.addTextTrack("metadata","id3")}},R.onFragParsingMetadata=function e(R,C){if(this.media){var I=C.frag,_=C.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var O=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,w=0;w<_.length;w++){var P=x.getID3Frames(_[w].data);if(P){var F=_[w].pts,M=w<_.length-1?_[w+1].pts:I.end;M-F<=0&&(M=F+.25);for(var N=0;N<P.length;N++){var U=P[N];if(!x.isTimeStampFrame(U)){var B=new O(F,M,"");B.value=U,this.id3Track.addCue(B)}}}}}},R.onBufferFlushing=function e(R,C){var I=C.startOffset,_=C.endOffset,x=C.type;if(!x||"audio"===x){var w=this.id3Track;w&&Object(O.removeCuesInRange)(w,I,_)}},e}();C.default=w},"./src/controller/latency-controller.ts":function srcControllerLatencyControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return w}));var _=I("./src/errors.ts"),O=I("./src/events.ts"),x=I("./src/utils/logger.ts");function s(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}var w=function(){function e(R){var C=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return C.timeupdate()},this.hls=R,this.config=R.config,this.registerListeners()}var R=e.prototype;return R.destroy=function e(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},R.registerListeners=function e(){this.hls.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(O.Events.ERROR,this.onError,this)},R.unregisterListeners=function e(){this.hls.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(O.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(O.Events.ERROR,this.onError)},R.onMediaAttached=function e(R,C){this.media=C.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},R.onMediaDetaching=function e(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},R.onManifestLoading=function e(){this.levelDetails=null,this._latency=null,this.stallCount=0},R.onLevelUpdated=function e(R,C){var I=C.details;this.levelDetails=I,I.advanced&&this.timeupdate(),!I.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},R.onError=function e(R,C){C.details===_.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,x.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},R.timeupdate=function e(){var R=this.media,C=this.levelDetails;if(R&&C){this.currentTime=R.currentTime;var I=this.computeLatency();if(null!==I){this._latency=I;var _=this.config,O=_.lowLatencyMode,x=_.maxLiveSyncPlaybackRate;if(O&&1!==x){var w=this.targetLatency;if(null!==w){var P=I-w,F=P<Math.min(this.maxLatency,w+C.targetduration);if(C.live&&F&&P>.05&&this.forwardBufferLength>1){var M=Math.min(2,Math.max(1,x)),N=Math.round(2/(1+Math.exp(-.75*P-this.edgeStalled))*20)/20;R.playbackRate=Math.min(M,Math.max(1,N))}else 1!==R.playbackRate&&0!==R.playbackRate&&(R.playbackRate=1)}}}}},R.estimateLiveEdge=function e(){var R=this.levelDetails;return null===R?null:R.edge+R.age},R.computeLatency=function e(){var R=this.estimateLiveEdge();return null===R?null:R-this.currentTime},function o(R,C,I){return C&&s(R.prototype,C),I&&s(R,I),R}(e,[{"key":"latency","get":function e(){return this._latency||0}},{"key":"maxLatency","get":function e(){var R=this.config,C=this.levelDetails;return void 0!==R.liveMaxLatencyDuration?R.liveMaxLatencyDuration:C?R.liveMaxLatencyDurationCount*C.targetduration:0}},{"key":"targetLatency","get":function e(){var R=this.levelDetails;if(null===R)return null;var C=R.holdBack,I=R.partHoldBack,_=R.targetduration,O=this.config,x=O.liveSyncDuration,w=O.liveSyncDurationCount,P=O.lowLatencyMode,F=this.hls.userConfig,M=P&&I||C;(F.liveSyncDuration||F.liveSyncDurationCount||0===M)&&(M=void 0!==x?x:w*_);var N=_;return M+Math.min(1*this.stallCount,N)}},{"key":"liveSyncPosition","get":function e(){var R=this.estimateLiveEdge(),C=this.targetLatency,I=this.levelDetails;if(null===R||null===C||null===I)return null;var _=I.edge,O=R-C-this.edgeStalled,x=_-I.totalduration,w=_-(this.config.lowLatencyMode&&I.partTarget||I.targetduration);return Math.min(Math.max(x,O),w)}},{"key":"drift","get":function e(){var R=this.levelDetails;return null===R?1:R.drift}},{"key":"edgeStalled","get":function e(){var R=this.levelDetails;if(null===R)return 0;var C=3*(this.config.lowLatencyMode&&R.partTarget||R.targetduration);return Math.max(R.age-C,0)}},{"key":"forwardBufferLength","get":function e(){var R=this.media,C=this.levelDetails;if(!R||!C)return 0;var I=R.buffered.length;return I?R.buffered.end(I-1):C.edge-this.currentTime}}]),e}()},"./src/controller/level-controller.ts":function srcControllerLevelControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return U}));var _=I("./src/types/level.ts"),O=I("./src/events.ts"),x=I("./src/errors.ts"),w=I("./src/utils/codecs.ts"),P=I("./src/controller/level-helper.ts"),F=I("./src/controller/base-playlist-controller.ts"),M=I("./src/types/loader.ts");function f(){return f=Object.assign||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var _ in I)Object.prototype.hasOwnProperty.call(I,_)&&(R[_]=I[_])}return R},f.apply(this,arguments)}function d(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}function v(R,C){return v=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},v(R,C)}var N=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),U=function(R){function t(C){var I;return(I=R.call(this,C,"[level-controller]")||this)._levels=[],I._firstLevel=-1,I._startLevel=void 0,I.currentLevelIndex=-1,I.manualLevelIndex=-1,I.onParsedComplete=void 0,I._registerListeners(),I}!function h(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,v(R,C)}(t,R);var C=t.prototype;return C._registerListeners=function e(){var R=this.hls;R.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),R.on(O.Events.ERROR,this.onError,this)},C._unregisterListeners=function e(){var R=this.hls;R.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(O.Events.ERROR,this.onError,this)},C.destroy=function t(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,R.prototype.destroy.call(this)},C.startLoad=function t(){this._levels.forEach((function(R){R.loadError=0})),R.prototype.startLoad.call(this)},C.onManifestLoaded=function e(R,C){var I,F,M=[],U=[],B=[],G={},j=!1,K=!1,H=!1;if(C.levels.forEach((function(R){var C=R.attrs;j=j||!(!R.width||!R.height),K=K||!!R.videoCodec,H=H||!!R.audioCodec,N&&R.audioCodec&&-1!==R.audioCodec.indexOf("mp4a.40.34")&&(R.audioCodec=void 0);var I=R.bitrate+"-"+R.attrs.RESOLUTION+"-"+R.attrs.CODECS;(F=G[I])?F.url.push(R.url):(F=new _.Level(R),G[I]=F,M.push(F)),C&&(C.AUDIO&&Object(P.addGroupId)(F,"audio",C.AUDIO),C.SUBTITLES&&Object(P.addGroupId)(F,"text",C.SUBTITLES))})),(j||K)&&H&&(M=M.filter((function(R){var C=R.videoCodec,I=R.width,_=R.height;return!!C||!(!I||!_)}))),M=M.filter((function(R){var C=R.audioCodec,I=R.videoCodec;return(!C||Object(w.isCodecSupportedInMp4)(C,"audio"))&&(!I||Object(w.isCodecSupportedInMp4)(I,"video"))})),C.audioTracks&&(U=C.audioTracks.filter((function(R){return!R.audioCodec||Object(w.isCodecSupportedInMp4)(R.audioCodec,"audio")})),Object(P.assignTrackIdsByGroup)(U)),C.subtitles&&(B=C.subtitles,Object(P.assignTrackIdsByGroup)(B)),M.length>0){I=M[0].bitrate,M.sort((function(R,C){return R.bitrate-C.bitrate})),this._levels=M;for(var V=0;V<M.length;V++)if(M[V].bitrate===I){this._firstLevel=V,this.log("manifest loaded, "+M.length+" level(s) found, first bitrate: "+I);break}var W=H&&!K,Y={"levels":M,"audioTracks":U,"subtitleTracks":B,"firstLevel":this._firstLevel,"stats":C.stats,"audio":H,"video":K,"altAudio":!W&&U.some((function(R){return!!R.url}))};this.hls.trigger(O.Events.MANIFEST_PARSED,Y),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(O.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,"fatal":!0,"url":C.url,"reason":"no level with compatible codecs found in manifest"})},C.onError=function t(C,I){if(R.prototype.onError.call(this,C,I),!I.fatal){var _=I.context,O=this._levels[this.currentLevelIndex];if(_&&(_.type===M.PlaylistContextType.AUDIO_TRACK&&O.audioGroupIds&&_.groupId===O.audioGroupIds[O.urlId]||_.type===M.PlaylistContextType.SUBTITLE_TRACK&&O.textGroupIds&&_.groupId===O.textGroupIds[O.urlId]))this.redundantFailover(this.currentLevelIndex);else{var w,P=!1,F=!0;switch(I.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:if(I.frag){var N=this._levels[I.frag.level];N?(N.fragmentError++,N.fragmentError>this.hls.config.fragLoadingMaxRetry&&(w=I.frag.level)):w=I.frag.level}break;case x.ErrorDetails.LEVEL_LOAD_ERROR:case x.ErrorDetails.LEVEL_LOAD_TIMEOUT:_&&(_.deliveryDirectives&&(F=!1),w=_.level),P=!0;break;case x.ErrorDetails.REMUX_ALLOC_ERROR:w=I.level,P=!0}void 0!==w&&this.recoverLevel(I,w,P,F)}}},C.recoverLevel=function e(R,C,I,_){var O=R.details,x=this._levels[C];if(x.loadError++,I){if(!this.retryLoadingOrFail(R))return void(this.currentLevelIndex=-1);R.levelRetry=!0}if(_){var w=x.url.length;if(w>1&&x.loadError<w)R.levelRetry=!0,this.redundantFailover(C);else if(-1===this.manualLevelIndex){var P=0===C?this._levels.length-1:C-1;this.currentLevelIndex!==P&&0===this._levels[P].loadError&&(this.warn(O+": switch to "+P),R.levelRetry=!0,this.hls.nextAutoLevel=P)}}},C.redundantFailover=function e(R){var C=this._levels[R],I=C.url.length;if(I>1){var _=(C.urlId+1)%I;this.warn("Switching to redundant URL-id "+_),this._levels.forEach((function(R){R.urlId=_})),this.level=R}},C.onFragLoaded=function e(R,C){var I=C.frag;if(void 0!==I&&I.type===M.PlaylistLevelType.MAIN){var _=this._levels[I.level];void 0!==_&&(_.fragmentError=0,_.loadError=0)}},C.onLevelLoaded=function e(R,C){var I,_,O=C.level,x=C.details,w=this._levels[O];if(!w)return this.warn("Invalid level index "+O),void(null!==(_=C.deliveryDirectives)&&void 0!==_&&_.skip&&(x.deltaUpdateFailed=!0));O===this.currentLevelIndex?(0===w.fragmentError&&(w.loadError=0,this.retryCount=0),this.playlistLoaded(O,C,w.details)):null!==(I=C.deliveryDirectives)&&void 0!==I&&I.skip&&(x.deltaUpdateFailed=!0)},C.onAudioTrackSwitched=function e(R,C){var I=this.hls.levels[this.currentLevelIndex];if(I&&I.audioGroupIds){for(var _=-1,O=this.hls.audioTracks[C.id].groupId,x=0;x<I.audioGroupIds.length;x++)if(I.audioGroupIds[x]===O){_=x;break}_!==I.urlId&&(I.urlId=_,this.startLoad())}},C.loadPlaylist=function e(R){var C=this.currentLevelIndex,I=this._levels[C];if(this.canLoad&&I&&I.url.length>0){var _=I.urlId,x=I.url[_];if(R)try{x=R.addDirectives(x)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Attempt loading level index "+C+(R?" at sn "+R.msn+" part "+R.part:"")+" with URL-id "+_+" "+x),this.clearTimer(),this.hls.trigger(O.Events.LEVEL_LOADING,{"url":x,"level":C,"id":_,"deliveryDirectives":R||null})}},C.removeLevel=function e(R,C){var I=function e(R,I){return I!==C},_=this._levels.filter((function(_,O){return O!==R||_.url.length>1&&void 0!==C&&(_.url=_.url.filter(I),_.audioGroupIds&&(_.audioGroupIds=_.audioGroupIds.filter(I)),_.textGroupIds&&(_.textGroupIds=_.textGroupIds.filter(I)),_.urlId=0,!0)})).map((function(R,C){var I=R.details;return null!=I&&I.fragments&&I.fragments.forEach((function(R){R.level=C})),R}));this._levels=_,this.hls.trigger(O.Events.LEVELS_UPDATED,{"levels":_})},function c(R,C,I){return C&&d(R.prototype,C),I&&d(R,I),R}(t,[{"key":"levels","get":function e(){return 0===this._levels.length?null:this._levels}},{"key":"level","get":function e(){return this.currentLevelIndex},"set":function e(R){var C,I=this._levels;if(0!==I.length&&(this.currentLevelIndex!==R||null===(C=I[R])||void 0===C||!C.details)){if(R<0||R>=I.length){var _=R<0;if(this.hls.trigger(O.Events.ERROR,{"type":x.ErrorTypes.OTHER_ERROR,"details":x.ErrorDetails.LEVEL_SWITCH_ERROR,"level":R,"fatal":_,"reason":"invalid level idx"}),_)return;R=Math.min(R,I.length-1)}this.clearTimer();var w=this.currentLevelIndex,P=I[w],F=I[R];this.log("switching to level "+R+" from "+w),this.currentLevelIndex=R;var M=f({},F,{"level":R,"maxBitrate":F.maxBitrate,"uri":F.uri,"urlId":F.urlId});delete M._urlId,this.hls.trigger(O.Events.LEVEL_SWITCHING,M);var N=F.details;if(!N||N.live){var U=this.switchParams(F.uri,null==P?void 0:P.details);this.loadPlaylist(U)}}}},{"key":"manualLevel","get":function e(){return this.manualLevelIndex},"set":function e(R){this.manualLevelIndex=R,void 0===this._startLevel&&(this._startLevel=R),-1!==R&&(this.level=R)}},{"key":"firstLevel","get":function e(){return this._firstLevel},"set":function e(R){this._firstLevel=R}},{"key":"startLevel","get":function e(){if(void 0===this._startLevel){var R=this.hls.config.startLevel;return void 0!==R?R:this._firstLevel}return this._startLevel},"set":function e(R){this._startLevel=R}},{"key":"nextLoadLevel","get":function e(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},"set":function e(R){this.level=R,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=R)}}]),t}(F.default)},"./src/controller/level-helper.ts":function srcControllerLevelHelperTs(R,C,I){I.r(C),I.d(C,"addGroupId",(function(){return n})),I.d(C,"assignTrackIdsByGroup",(function(){return s})),I.d(C,"updatePTS",(function(){return o})),I.d(C,"updateFragPTSDTS",(function(){return u})),I.d(C,"mergeDetails",(function(){return f})),I.d(C,"mapPartIntersection",(function(){return d})),I.d(C,"mapFragmentIntersection",(function(){return c})),I.d(C,"adjustSliding",(function(){return h})),I.d(C,"addSliding",(function(){return v})),I.d(C,"computeReloadInterval",(function(){return g})),I.d(C,"getFragmentWithSN",(function(){return p})),I.d(C,"getPartWith",(function(){return m}));var _=I("./src/polyfills/number.ts"),O=I("./src/utils/logger.ts");function n(R,C,I){switch(C){case"audio":R.audioGroupIds||(R.audioGroupIds=[]),R.audioGroupIds.push(I);break;case"text":R.textGroupIds||(R.textGroupIds=[]),R.textGroupIds.push(I)}}function s(R){var C={};R.forEach((function(R){var I=R.groupId||"";R.id=C[I]=C[I]||0,C[I]++}))}function o(R,C,I){l(R[C],R[I])}function l(R,C){var I=C.startPTS;if(Object(_.isFiniteNumber)(I)){var O,x=0;C.sn>R.sn?(x=I-R.start,O=R):(x=R.start-I,O=C),O.duration!==x&&(O.duration=x)}else if(C.sn>R.sn){R.cc===C.cc&&R.minEndPTS?C.start=R.start+(R.minEndPTS-R.start):C.start=R.start+R.duration}else C.start=Math.max(R.start-C.duration,0)}function u(R,C,I,x,w,P){x-I<=0&&(O.logger.warn("Fragment should have a positive duration",C),x=I+C.duration,P=w+C.duration);var F=I,M=x,N=C.startPTS,U=C.endPTS;if(Object(_.isFiniteNumber)(N)){var B=Math.abs(N-I);Object(_.isFiniteNumber)(C.deltaPTS)?C.deltaPTS=Math.max(B,C.deltaPTS):C.deltaPTS=B,F=Math.max(I,N),I=Math.min(I,N),w=Math.min(w,C.startDTS),M=Math.min(x,U),x=Math.max(x,U),P=Math.max(P,C.endDTS)}C.duration=x-I;var G=I-C.start;C.appendedPTS=x,C.start=C.startPTS=I,C.maxStartPTS=F,C.startDTS=w,C.endPTS=x,C.minEndPTS=M,C.endDTS=P;var j,K=C.sn;if(!R||K<R.startSN||K>R.endSN)return 0;var H=K-R.startSN,V=R.fragments;for(V[H]=C,j=H;j>0;j--)l(V[j],V[j-1]);for(j=H;j<V.length-1;j++)l(V[j],V[j+1]);return R.fragmentHint&&l(V[V.length-1],R.fragmentHint),R.PTSKnown=R.alignedSliding=!0,G}function f(R,C){for(var I=null,x=R.fragments,w=x.length-1;w>=0;w--){var P=x[w].initSegment;if(P){I=P;break}}R.fragmentHint&&delete R.fragmentHint.endPTS;var F,M=0;(c(R,C,(function(R,O){R.relurl&&(M=R.cc-O.cc),Object(_.isFiniteNumber)(R.startPTS)&&Object(_.isFiniteNumber)(R.endPTS)&&(O.start=O.startPTS=R.startPTS,O.startDTS=R.startDTS,O.appendedPTS=R.appendedPTS,O.maxStartPTS=R.maxStartPTS,O.endPTS=R.endPTS,O.endDTS=R.endDTS,O.minEndPTS=R.minEndPTS,O.duration=R.endPTS-R.startPTS,O.duration&&(F=O),C.PTSKnown=C.alignedSliding=!0),O.elementaryStreams=R.elementaryStreams,O.loader=R.loader,O.stats=R.stats,O.urlId=R.urlId,R.initSegment&&(O.initSegment=R.initSegment,I=R.initSegment)})),I)&&(C.fragmentHint?C.fragments.concat(C.fragmentHint):C.fragments).forEach((function(R){var C;R.initSegment&&R.initSegment.relurl!==(null===(C=I)||void 0===C?void 0:C.relurl)||(R.initSegment=I)}));if(C.skippedSegments&&(C.deltaUpdateFailed=C.fragments.some((function(R){return!R})),C.deltaUpdateFailed)){O.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var N=C.skippedSegments;N--;)C.fragments.shift();C.startSN=C.fragments[0].sn,C.startCC=C.fragments[0].cc}var U=C.fragments;if(M){O.logger.warn("discontinuity sliding from playlist, take drift into account");for(var B=0;B<U.length;B++)U[B].cc+=M}C.skippedSegments&&(C.startCC=C.fragments[0].cc),d(R.partList,C.partList,(function(R,C){C.elementaryStreams=R.elementaryStreams,C.stats=R.stats})),F?u(C,F,F.startPTS,F.endPTS,F.startDTS,F.endDTS):h(R,C),U.length&&(C.totalduration=C.edge-U[0].start),C.driftStartTime=R.driftStartTime,C.driftStart=R.driftStart;var G=C.advancedDateTime;if(C.advanced&&G){var j=C.edge;C.driftStart||(C.driftStartTime=G,C.driftStart=j),C.driftEndTime=G,C.driftEnd=j}else C.driftEndTime=R.driftEndTime,C.driftEnd=R.driftEnd,C.advancedDateTime=R.advancedDateTime}function d(R,C,I){if(R&&C)for(var _=0,O=0,x=R.length;O<=x;O++){var w=R[O],P=C[O+_];w&&P&&w.index===P.index&&w.fragment.sn===P.fragment.sn?I(w,P):_--}}function c(R,C,I){for(var _=C.skippedSegments,O=Math.max(R.startSN,C.startSN)-C.startSN,x=(R.fragmentHint?1:0)+(_?C.endSN:Math.min(R.endSN,C.endSN))-C.startSN,w=C.startSN-R.startSN,P=C.fragmentHint?C.fragments.concat(C.fragmentHint):C.fragments,F=R.fragmentHint?R.fragments.concat(R.fragmentHint):R.fragments,M=O;M<=x;M++){var N=F[w+M],U=P[M];_&&!U&&M<_&&(U=C.fragments[M]=N),N&&U&&I(N,U)}}function h(R,C){var I=C.startSN+C.skippedSegments-R.startSN,_=R.fragments;I<0||I>=_.length||v(C,_[I].start)}function v(R,C){if(C){for(var I=R.fragments,_=R.skippedSegments;_<I.length;_++)I[_].start+=C;R.fragmentHint&&(R.fragmentHint.start+=C)}}function g(R,C){var I,_=1e3*R.levelTargetDuration,O=_/2,x=R.age,w=x>0&&x<3*_,P=C.loading.end-C.loading.start,F=R.availabilityDelay;if(!1===R.updated)if(w){var M=333*R.misses;I=Math.max(Math.min(O,2*P),M),R.availabilityDelay=(R.availabilityDelay||0)+I}else I=O;else w?(F=Math.min(F||_/2,x),R.availabilityDelay=F,I=F+_-x):I=_-P;return Math.round(I)}function p(R,C,I){if(!R||!R.details)return null;var _=R.details,O=_.fragments[C-_.startSN];return O||((O=_.fragmentHint)&&O.sn===C?O:C<_.startSN&&I&&I.sn===C?I:null)}function m(R,C,I){if(!R||!R.details)return null;var _=R.details.partList;if(_)for(var O=_.length;O--;){var x=_[O];if(x.index===I&&x.fragment.sn===C)return x}return null}},"./src/controller/stream-controller.ts":function srcControllerStreamControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return H}));var _=I("./src/polyfills/number.ts"),O=I("./src/controller/base-stream-controller.ts"),x=I("./src/is-supported.ts"),w=I("./src/events.ts"),P=I("./src/utils/buffer-helper.ts"),F=I("./src/controller/fragment-tracker.ts"),M=I("./src/types/loader.ts"),N=I("./src/loader/fragment.ts"),U=I("./src/demux/transmuxer-interface.ts"),B=I("./src/types/transmuxer.ts"),G=I("./src/controller/gap-controller.ts"),j=I("./src/errors.ts"),K=I("./src/utils/logger.ts");function p(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}function E(R,C){return E=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},E(R,C)}var H=function(R){function t(C,I){var _;return(_=R.call(this,C,I,"[stream-controller]")||this).audioCodecSwap=!1,_.gapController=null,_.level=-1,_._forceStartLoad=!1,_.altAudio=!1,_.audioOnly=!1,_.fragPlaying=null,_.onvplaying=null,_.onvseeked=null,_.fragLastKbps=0,_.stalled=!1,_.couldBacktrack=!1,_.audioCodecSwitch=!1,_.videoBuffer=null,_._registerListeners(),_}!function y(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,E(R,C)}(t,R);var C=t.prototype;return C._registerListeners=function e(){var R=this.hls;R.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(w.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(w.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),R.on(w.Events.ERROR,this.onError,this),R.on(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.on(w.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.on(w.Events.BUFFER_CREATED,this.onBufferCreated,this),R.on(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.on(w.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),R.on(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C._unregisterListeners=function e(){var R=this.hls;R.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(w.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),R.off(w.Events.ERROR,this.onError,this),R.off(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.off(w.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.off(w.Events.BUFFER_CREATED,this.onBufferCreated,this),R.off(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.off(w.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),R.off(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C.onHandlerDestroying=function e(){this._unregisterListeners(),this.onMediaDetaching()},C.startLoad=function e(R){if(this.levels){var C=this.lastCurrentTime,I=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var _=I.startLevel;-1===_&&(I.config.testBandwidth?(_=0,this.bitrateTest=!0):_=I.nextAutoLevel),this.level=I.nextLoadLevel=_,this.loadedmetadata=!1}C>0&&-1===R&&(this.log("Override startPosition with lastCurrentTime @"+C.toFixed(3)),R=C),this.state=O.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=R,this.tick()}else this._forceStartLoad=!0,this.state=O.State.STOPPED},C.stopLoad=function t(){this._forceStartLoad=!1,R.prototype.stopLoad.call(this)},C.doTick=function e(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_LEVEL:var R,C=this.levels,I=this.level,_=null==C||null===(R=C[I])||void 0===R?void 0:R.details;if(_&&(!_.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(_))break;this.state=O.State.IDLE;break}break;case O.State.FRAG_LOADING_WAITING_RETRY:var x,w=self.performance.now(),P=this.retryDate;(!P||w>=P||null!==(x=this.media)&&void 0!==x&&x.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=O.State.IDLE)}this.onTickEnd()},C.onTickEnd=function t(){R.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},C.doTickIdle=function e(){var R,C,I=this.hls,_=this.levelLastLoaded,x=this.levels,P=this.media,U=I.config,B=I.nextLoadLevel;if(null!==_&&(P||!this.startFragRequested&&U.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&x&&x[B]){var G=x[B];this.level=I.nextLoadLevel=B;var j=G.details;if(!j||this.state===O.State.WAITING_LEVEL||j.live&&this.levelLastLoaded!==B)this.state=O.State.WAITING_LEVEL;else{var K=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:P,M.PlaylistLevelType.MAIN);if(null!==K)if(!(K.len>=this.getMaxBufferLength(G.maxBitrate))){if(this._streamEnded(K,j)){var H={};return this.altAudio&&(H.type="video"),this.hls.trigger(w.Events.BUFFER_EOS,H),void(this.state=O.State.ENDED)}var V=K.end,W=this.getNextFragment(V,j);if(this.couldBacktrack&&!this.fragPrevious&&W&&"initSegment"!==W.sn){var Y=W.sn-j.startSN;Y>1&&(W=j.fragments[Y-1],this.fragmentTracker.removeFragment(W))}if(W&&this.fragmentTracker.getState(W)===F.FragmentState.OK&&this.nextLoadPosition>V){var q=this.audioOnly&&!this.altAudio?N.ElementaryStreamTypes.AUDIO:N.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(P,q,M.PlaylistLevelType.MAIN),W=this.getNextFragment(this.nextLoadPosition,j)}W&&(!W.initSegment||W.initSegment.data||this.bitrateTest||(W=W.initSegment),"identity"!==(null===(R=W.decryptdata)||void 0===R?void 0:R.keyFormat)||null!==(C=W.decryptdata)&&void 0!==C&&C.key?this.loadFragment(W,j,V):this.loadKey(W,j))}}}},C.loadFragment=function t(C,I,_){var O,x=this.fragmentTracker.getState(C);if(this.fragCurrent=C,x===F.FragmentState.BACKTRACKED){var w=this.fragmentTracker.getBacktrackData(C);if(w)return this._handleFragmentLoadProgress(w),void this._handleFragmentLoadComplete(w);x=F.FragmentState.NOT_LOADED}x===F.FragmentState.NOT_LOADED||x===F.FragmentState.PARTIAL?"initSegment"===C.sn?this._loadInitSegment(C):this.bitrateTest?(C.bitrateTest=!0,this.log("Fragment "+C.sn+" of level "+C.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(C)):(this.startFragRequested=!0,R.prototype.loadFragment.call(this,C,I,_)):x===F.FragmentState.APPENDING?this.reduceMaxBufferLength(C.duration)&&this.fragmentTracker.removeFragment(C):0===(null===(O=this.media)||void 0===O?void 0:O.buffered.length)&&this.fragmentTracker.removeAllFragments()},C.getAppendedFrag=function e(R){var C=this.fragmentTracker.getAppendedFrag(R,M.PlaylistLevelType.MAIN);return C&&"fragment"in C?C.fragment:C},C.getBufferedFrag=function e(R){return this.fragmentTracker.getBufferedFrag(R,M.PlaylistLevelType.MAIN)},C.followingBufferedFrag=function e(R){return R?this.getBufferedFrag(R.end+.5):null},C.immediateLevelSwitch=function e(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},C.nextLevelSwitch=function e(){var R=this.levels,C=this.media;if(null!=C&&C.readyState){var I,_=this.getAppendedFrag(C.currentTime);if(_&&_.start>1&&this.flushMainBuffer(0,_.start-1),!C.paused&&R){var O=R[this.hls.nextLoadLevel],x=this.fragLastKbps;I=x&&this.fragCurrent?this.fragCurrent.duration*O.maxBitrate/(1e3*x)+1:0}else I=0;var w=this.getBufferedFrag(C.currentTime+I);if(w){var P=this.followingBufferedFrag(w);if(P){this.abortCurrentFrag();var F=P.maxStartPTS?P.maxStartPTS:P.start,M=P.duration,N=Math.max(w.end,F+Math.min(Math.max(M-this.config.maxFragLookUpTolerance,.5*M),.75*M));this.flushMainBuffer(N,Number.POSITIVE_INFINITY)}}}},C.abortCurrentFrag=function e(){var R=this.fragCurrent;this.fragCurrent=null,null!=R&&R.loader&&R.loader.abort(),this.state===O.State.KEY_LOADING&&(this.state=O.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},C.flushMainBuffer=function t(C,I){R.prototype.flushMainBuffer.call(this,C,I,this.altAudio?"video":null)},C.onMediaAttached=function t(C,I){R.prototype.onMediaAttached.call(this,C,I);var _=I.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),_.addEventListener("playing",this.onvplaying),_.addEventListener("seeked",this.onvseeked),this.gapController=new G.default(this.config,_,this.fragmentTracker,this.hls)},C.onMediaDetaching=function t(){var C=this.media;C&&(C.removeEventListener("playing",this.onvplaying),C.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),R.prototype.onMediaDetaching.call(this)},C.onMediaPlaying=function e(){this.tick()},C.onMediaSeeked=function e(){var R=this.media,C=R?R.currentTime:null;Object(_.isFiniteNumber)(C)&&this.log("Media seeked to "+C.toFixed(3)),this.tick()},C.onManifestLoading=function e(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(w.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},C.onManifestParsed=function e(R,C){var I,_=!1,O=!1;C.levels.forEach((function(R){(I=R.audioCodec)&&(-1!==I.indexOf("mp4a.40.2")&&(_=!0),-1!==I.indexOf("mp4a.40.5")&&(O=!0))})),this.audioCodecSwitch=_&&O&&!Object(x.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=C.levels,this.startFragRequested=!1},C.onLevelLoading=function e(R,C){var I=this.levels;if(I&&this.state===O.State.IDLE){var _=I[C.level];(!_.details||_.details.live&&this.levelLastLoaded!==C.level||this.waitForCdnTuneIn(_.details))&&(this.state=O.State.WAITING_LEVEL)}},C.onLevelLoaded=function e(R,C){var I,_=this.levels,x=C.level,P=C.details,F=P.totalduration;if(_){this.log("Level "+x+" loaded ["+P.startSN+","+P.endSN+"], cc ["+P.startCC+", "+P.endCC+"] duration:"+F);var M=this.fragCurrent;!M||this.state!==O.State.FRAG_LOADING&&this.state!==O.State.FRAG_LOADING_WAITING_RETRY||M.level!==C.level&&M.loader&&(this.state=O.State.IDLE,M.loader.abort());var N=_[x],U=0;if(P.live||null!==(I=N.details)&&void 0!==I&&I.live){if(P.fragments[0]||(P.deltaUpdateFailed=!0),P.deltaUpdateFailed)return;U=this.alignPlaylists(P,N.details)}if(N.details=P,this.levelLastLoaded=x,this.hls.trigger(w.Events.LEVEL_UPDATED,{"details":P,"level":x}),this.state===O.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(P))return;this.state=O.State.IDLE}this.startFragRequested?P.live&&this.synchronizeToLiveEdge(P):this.setStartPosition(P,U),this.tick()}else this.warn("Levels were reset while loading level "+x)},C._handleFragmentLoadProgress=function e(R){var C,I=R.frag,_=R.part,O=R.payload,x=this.levels;if(x){var w=x[I.level],P=w.details;if(P){var F=w.videoCodec,N=P.PTSKnown||!P.live,G=null===(C=I.initSegment)||void 0===C?void 0:C.data,j=this._getAudioCodec(w),K=this.transmuxer=this.transmuxer||new U.default(this.hls,M.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),H=_?_.index:-1,V=-1!==H,W=new B.ChunkMetadata(I.level,I.sn,I.stats.chunkCount,O.byteLength,H,V),Y=this.initPTS[I.cc];K.push(O,G,j,F,I,_,P.totalduration,N,W,Y)}else this.warn("Dropping fragment "+I.sn+" of level "+I.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+I.sn+" of level "+I.level+" will not be buffered")},C.onAudioTrackSwitching=function e(R,C){var I=this.altAudio,_=!!C.url,O=C.id;if(!_){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var x=this.fragCurrent;null!=x&&x.loader&&(this.log("Switching to main audio track, cancel main fragment load"),x.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var P=this.hls;I&&P.trigger(w.Events.BUFFER_FLUSHING,{"startOffset":0,"endOffset":Number.POSITIVE_INFINITY,"type":"audio"}),P.trigger(w.Events.AUDIO_TRACK_SWITCHED,{"id":O})}},C.onAudioTrackSwitched=function e(R,C){var I=C.id,_=!!this.hls.audioTracks[I].url;if(_){var O=this.videoBuffer;O&&this.mediaBuffer!==O&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=O)}this.altAudio=_,this.tick()},C.onBufferCreated=function e(R,C){var I,_,O=C.tracks,x=!1;for(var w in O){var P=O[w];if("main"===P.id){if(_=w,I=P,"video"===w){var F=O[w];F&&(this.videoBuffer=F.buffer)}}else x=!0}x&&I?(this.log("Alternate track found, use "+_+".buffered to schedule main fragment loading"),this.mediaBuffer=I.buffer):this.mediaBuffer=this.media},C.onFragBuffered=function e(R,C){var I=C.frag,_=C.part;if(!I||I.type===M.PlaylistLevelType.MAIN){if(this.fragContextChanged(I))return this.warn("Fragment "+I.sn+(_?" p: "+_.index:"")+" of level "+I.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===O.State.PARSED&&(this.state=O.State.IDLE));var x=_?_.stats:I.stats;this.fragLastKbps=Math.round(8*x.total/(x.buffering.end-x.loading.first)),"initSegment"!==I.sn&&(this.fragPrevious=I),this.fragBufferedComplete(I,_)}},C.onError=function e(R,C){switch(C.details){case j.ErrorDetails.FRAG_LOAD_ERROR:case j.ErrorDetails.FRAG_LOAD_TIMEOUT:case j.ErrorDetails.KEY_LOAD_ERROR:case j.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(M.PlaylistLevelType.MAIN,C);break;case j.ErrorDetails.LEVEL_LOAD_ERROR:case j.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==O.State.ERROR&&(C.fatal?(this.warn(""+C.details),this.state=O.State.ERROR):C.levelRetry||this.state!==O.State.WAITING_LEVEL||(this.state=O.State.IDLE));break;case j.ErrorDetails.BUFFER_FULL_ERROR:if("main"===C.parent&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var I=!0,_=this.getFwdBufferInfo(this.media,M.PlaylistLevelType.MAIN);_&&_.len>.5&&(I=!this.reduceMaxBufferLength(_.len)),I&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},C.checkBuffer=function e(){var R=this.media,C=this.gapController;if(R&&C&&R.readyState){var I=P.BufferHelper.getBuffered(R);!this.loadedmetadata&&I.length?(this.loadedmetadata=!0,this.seekToStartPos()):C.poll(this.lastCurrentTime),this.lastCurrentTime=R.currentTime}},C.onFragLoadEmergencyAborted=function e(){this.state=O.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},C.onBufferFlushed=function e(R,C){var I=C.type;if(I!==N.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var _=(I===N.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(_,I,M.PlaylistLevelType.MAIN)}},C.onLevelsUpdated=function e(R,C){this.levels=C.levels},C.swapAudioCodec=function e(){this.audioCodecSwap=!this.audioCodecSwap},C.seekToStartPos=function e(){var R=this.media,C=R.currentTime,I=this.startPosition;if(I>=0&&C<I){if(R.seeking)return void K.logger.log("could not seek to "+I+", already seeking at "+C);var _=P.BufferHelper.getBuffered(R),O=(_.length?_.start(0):0)-I;O>0&&(O<this.config.maxBufferHole||O<this.config.maxFragLookUpTolerance)&&(K.logger.log("adjusting start position by "+O+" to match buffer start"),I+=O,this.startPosition=I),this.log("seek to target start position "+I+" from current time "+C),R.currentTime=I}},C._getAudioCodec=function e(R){var C=this.config.defaultAudioCodec||R.audioCodec;return this.audioCodecSwap&&C&&(this.log("Swapping audio codec"),C=-1!==C.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),C},C._loadBitrateTestFrag=function e(R){var C=this;this._doFragLoad(R).then((function(I){var _=C.hls;if(I&&!_.nextLoadLevel&&!C.fragContextChanged(R)){C.fragLoadError=0,C.state=O.State.IDLE,C.startFragRequested=!1,C.bitrateTest=!1;var x=R.stats;x.parsing.start=x.parsing.end=x.buffering.start=x.buffering.end=self.performance.now(),_.trigger(w.Events.FRAG_LOADED,I)}}))},C._handleTransmuxComplete=function e(R){var C,I="main",x=this.hls,P=R.remuxResult,F=R.chunkMeta,M=this.getCurrentContext(F);if(!M)return this.warn("The loading context changed while buffering fragment "+F.sn+" of level "+F.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(F.level);var U=M.frag,B=M.part,G=M.level,j=P.video,K=P.text,H=P.id3,V=P.initSegment,W=this.altAudio?void 0:P.audio;if(!this.fragContextChanged(U)){if(this.state=O.State.PARSING,V){V.tracks&&(this._bufferInitSegment(G,V.tracks,U,F),x.trigger(w.Events.FRAG_PARSING_INIT_SEGMENT,{"frag":U,"id":I,"tracks":V.tracks}));var Y=V.initPTS,q=V.timescale;Object(_.isFiniteNumber)(Y)&&(this.initPTS[U.cc]=Y,x.trigger(w.Events.INIT_PTS_FOUND,{"frag":U,"id":I,"initPTS":Y,"timescale":q}))}if(j&&!1!==P.independent){if(G.details){var X=j.startPTS,z=j.endPTS,Q=j.startDTS,J=j.endDTS;if(B)B.elementaryStreams[j.type]={"startPTS":X,"endPTS":z,"startDTS":Q,"endDTS":J};else if(j.firstKeyFrame&&j.independent&&(this.couldBacktrack=!0),j.dropped&&j.independent){if(this.getLoadPosition()+this.config.maxBufferHole<X)return void this.backtrack(U);U.setElementaryStreamInfo(j.type,U.start,z,U.start,J,!0)}U.setElementaryStreamInfo(j.type,X,z,Q,J),this.bufferFragmentData(j,U,B,F)}}else if(!1===P.independent)return void this.backtrack(U);if(W){var $=W.startPTS,Z=W.endPTS,ee=W.startDTS,te=W.endDTS;B&&(B.elementaryStreams[N.ElementaryStreamTypes.AUDIO]={"startPTS":$,"endPTS":Z,"startDTS":ee,"endDTS":te}),U.setElementaryStreamInfo(N.ElementaryStreamTypes.AUDIO,$,Z,ee,te),this.bufferFragmentData(W,U,B,F)}if(null!=H&&null!==(C=H.samples)&&void 0!==C&&C.length){var re={"frag":U,"id":I,"samples":H.samples};x.trigger(w.Events.FRAG_PARSING_METADATA,re)}if(K){var ie={"frag":U,"id":I,"samples":K.samples};x.trigger(w.Events.FRAG_PARSING_USERDATA,ie)}}},C._bufferInitSegment=function e(R,C,I,_){var x=this;if(this.state===O.State.PARSING){this.audioOnly=!!C.audio&&!C.video,this.altAudio&&!this.audioOnly&&delete C.audio;var P=C.audio,F=C.video,M=C.audiovideo;if(P){var N=R.audioCodec,U=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(N&&(N=-1!==N.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==P.metadata.channelCount&&-1===U.indexOf("firefox")&&(N="mp4a.40.5")),-1!==U.indexOf("android")&&"audio/mpeg"!==P.container&&(N="mp4a.40.2",this.log("Android: force audio codec to "+N)),R.audioCodec&&R.audioCodec!==N&&this.log('Swapping manifest audio codec "'+R.audioCodec+'" for "'+N+'"'),P.levelCodec=N,P.id="main",this.log("Init audio buffer, container:"+P.container+", codecs[selected/level/parsed]=["+(N||"")+"/"+(R.audioCodec||"")+"/"+P.codec+"]")}F&&(F.levelCodec=R.videoCodec,F.id="main",this.log("Init video buffer, container:"+F.container+", codecs[level/parsed]=["+(R.videoCodec||"")+"/"+F.codec+"]")),M&&this.log("Init audiovideo buffer, container:"+M.container+", codecs[level/parsed]=["+(R.attrs.CODECS||"")+"/"+M.codec+"]"),this.hls.trigger(w.Events.BUFFER_CODECS,C),Object.keys(C).forEach((function(R){var O=C[R].initSegment;null!=O&&O.byteLength&&x.hls.trigger(w.Events.BUFFER_APPENDING,{"type":R,"data":O,"frag":I,"part":null,"chunkMeta":_,"parent":I.type})})),this.tick()}},C.backtrack=function e(R){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(R);var C=this.fragmentTracker.backtrack(R);this.fragPrevious=null,this.nextLoadPosition=R.start,C?this.resetFragmentLoading(R):this.state=O.State.BACKTRACKING},C.checkFragmentChanged=function e(){var R=this.media,C=null;if(R&&R.readyState>1&&!1===R.seeking){var I=R.currentTime;if(P.BufferHelper.isBuffered(R,I)?C=this.getAppendedFrag(I):P.BufferHelper.isBuffered(R,I+.1)&&(C=this.getAppendedFrag(I+.1)),C){var _=this.fragPlaying,O=C.level;_&&C.sn===_.sn&&_.level===O&&C.urlId===_.urlId||(this.hls.trigger(w.Events.FRAG_CHANGED,{"frag":C}),_&&_.level===O||this.hls.trigger(w.Events.LEVEL_SWITCHED,{"level":O}),this.fragPlaying=C)}}},function m(R,C,I){return C&&p(R.prototype,C),I&&p(R,I),R}(t,[{"key":"nextLevel","get":function e(){var R=this.nextBufferedFrag;return R?R.level:-1}},{"key":"currentLevel","get":function e(){var R=this.media;if(R){var C=this.getAppendedFrag(R.currentTime);if(C)return C.level}return-1}},{"key":"nextBufferedFrag","get":function e(){var R=this.media;if(R){var C=this.getAppendedFrag(R.currentTime);return this.followingBufferedFrag(C)}return null}},{"key":"forceStartLoad","get":function e(){return this._forceStartLoad}}]),t}(O.default)},"./src/controller/subtitle-stream-controller.ts":function srcControllerSubtitleStreamControllerTs(R,C,I){I.r(C),I.d(C,"SubtitleStreamController",(function(){return B}));var _=I("./src/events.ts"),O=I("./src/utils/buffer-helper.ts"),x=I("./src/controller/fragment-finders.ts"),w=I("./src/utils/discontinuities.ts"),P=I("./src/controller/level-helper.ts"),F=I("./src/controller/fragment-tracker.ts"),M=I("./src/controller/base-stream-controller.ts"),N=I("./src/types/loader.ts"),U=I("./src/types/level.ts");function c(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}function g(R,C){return g=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},g(R,C)}var B=function(R){function t(C,I){var _;return(_=R.call(this,C,I,"[subtitle-stream-controller]")||this).levels=[],_.currentTrackId=-1,_.tracksBuffered=[],_.mainDetails=null,_._registerListeners(),_}!function v(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,g(R,C)}(t,R);var C=t.prototype;return C.onHandlerDestroying=function e(){this._unregisterListeners(),this.mainDetails=null},C._registerListeners=function e(){var R=this.hls;R.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(_.Events.ERROR,this.onError,this),R.on(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.on(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),R.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.on(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),R.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},C._unregisterListeners=function e(){var R=this.hls;R.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(_.Events.ERROR,this.onError,this),R.off(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.off(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),R.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.off(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),R.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},C.startLoad=function e(){this.stopLoad(),this.state=M.State.IDLE,this.setInterval(500),this.tick()},C.onManifestLoading=function e(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},C.onLevelLoaded=function e(R,C){this.mainDetails=C.details},C.onSubtitleFragProcessed=function e(R,C){var I=C.frag,_=C.success;if(this.fragPrevious=I,this.state=M.State.IDLE,_){var O=this.tracksBuffered[this.currentTrackId];if(O){for(var x,w=I.start,P=0;P<O.length;P++)if(w>=O[P].start&&w<=O[P].end){x=O[P];break}var F=I.start+I.duration;x?x.end=F:(x={"start":w,"end":F},O.push(x)),this.fragmentTracker.fragBuffered(I)}}},C.onBufferFlushing=function e(R,C){var I=C.startOffset,_=C.endOffset;if(0===I&&_!==Number.POSITIVE_INFINITY){var O=this.currentTrackId,x=this.levels;if(!x.length||!x[O]||!x[O].details)return;var w=_-x[O].details.targetduration;if(w<=0)return;C.endOffsetSubtitles=Math.max(0,w),this.tracksBuffered.forEach((function(R){for(var C=0;C<R.length;)if(R[C].end<=w)R.shift();else{if(!(R[C].start<w))break;R[C].start=w,C++}})),this.fragmentTracker.removeFragmentsInRange(I,w,N.PlaylistLevelType.SUBTITLE)}},C.onError=function e(R,C){var I,_=C.frag;_&&_.type===N.PlaylistLevelType.SUBTITLE&&(null!==(I=this.fragCurrent)&&void 0!==I&&I.loader&&this.fragCurrent.loader.abort(),this.state=M.State.IDLE)},C.onSubtitleTracksUpdated=function e(R,C){var I=this,_=C.subtitleTracks;this.tracksBuffered=[],this.levels=_.map((function(R){return new U.Level(R)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(R){I.tracksBuffered[R.id]=[]})),this.mediaBuffer=null},C.onSubtitleTrackSwitch=function e(R,C){if(this.currentTrackId=C.id,this.levels.length&&-1!==this.currentTrackId){var I=this.levels[this.currentTrackId];null!=I&&I.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,I&&this.setInterval(500)}else this.clearInterval()},C.onSubtitleTrackLoaded=function e(R,C){var I,_=C.details,O=C.id,F=this.currentTrackId,N=this.levels;if(N.length){var U=N[F];if(!(O>=N.length||O!==F)&&U){if(this.mediaBuffer=this.mediaBufferTimeRanges,_.live||null!==(I=U.details)&&void 0!==I&&I.live){var B=this.mainDetails;if(_.deltaUpdateFailed||!B)return;var G=B.fragments[0];if(U.details)0===this.alignPlaylists(_,U.details)&&G&&Object(P.addSliding)(_,G.start);else _.hasProgramDateTime&&B.hasProgramDateTime?Object(w.alignMediaPlaylistByPDT)(_,B):G&&Object(P.addSliding)(_,G.start)}if(U.details=_,this.levelLastLoaded=O,this.tick(),_.live&&!this.fragCurrent&&this.media&&this.state===M.State.IDLE)Object(x.findFragmentByPTS)(null,_.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),U.details=void 0)}}},C._handleFragmentLoadComplete=function e(R){var C=R.frag,I=R.payload,O=C.decryptdata,x=this.hls;if(!this.fragContextChanged(C)&&I&&I.byteLength>0&&O&&O.key&&O.iv&&"AES-128"===O.method){var w=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(I),O.key.buffer,O.iv.buffer).then((function(R){var I=performance.now();x.trigger(_.Events.FRAG_DECRYPTED,{"frag":C,"payload":R,"stats":{"tstart":w,"tdecrypt":I}})}))}},C.doTick=function e(){if(this.media){if(this.state===M.State.IDLE){var R,C=this.currentTrackId,I=this.levels;if(!I.length||!I[C]||!I[C].details)return;var _=I[C].details,w=_.targetduration,P=this.config,N=this.media,U=O.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,N.currentTime-w,P.maxBufferHole),B=U.end;if(U.len>this.getMaxBufferLength()+w)return;console.assert(_,"Subtitle track details are defined on idle subtitle stream controller tick");var G,j=_.fragments,K=j.length,H=_.edge,V=this.fragPrevious;if(B<H){var W=P.maxFragLookUpTolerance;!(G=Object(x.findFragmentByPTS)(V,j,B,W))&&V&&V.start<j[0].start&&(G=j[0])}else G=j[K-1];null!==(R=G)&&void 0!==R&&R.encrypted?this.loadKey(G,_):G&&this.fragmentTracker.getState(G)===F.FragmentState.NOT_LOADED&&this.loadFragment(G,_,B)}}else this.state=M.State.IDLE},C.loadFragment=function t(C,I,_){this.fragCurrent=C,R.prototype.loadFragment.call(this,C,I,_)},function h(R,C,I){return C&&c(R.prototype,C),I&&c(R,I),R}(t,[{"key":"mediaBufferTimeRanges","get":function e(){return this.tracksBuffered[this.currentTrackId]||[]}}]),t}(M.default)},"./src/controller/subtitle-track-controller.ts":function srcControllerSubtitleTrackControllerTs(R,C,I){I.r(C);var _=I("./src/events.ts"),O=I("./src/utils/texttrack-utils.ts"),x=I("./src/controller/base-playlist-controller.ts"),w=I("./src/types/loader.ts");function o(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}function f(R,C){return f=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},f(R,C)}var P=function(R){function t(C){var I;return(I=R.call(this,C,"[subtitle-track-controller]")||this).media=null,I.tracks=[],I.groupId=null,I.tracksInGroup=[],I.trackId=-1,I.selectDefaultTrack=!0,I.queuedDefaultTrack=-1,I.trackChangeListener=function(){return I.onTextTracksChanged()},I.asyncPollTrackChange=function(){return I.pollTrackChange(0)},I.useTextTrackPolling=!1,I.subtitlePollingInterval=-1,I.subtitleDisplay=!0,I.registerListeners(),I}!function u(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,f(R,C)}(t,R);var C=t.prototype;return C.destroy=function t(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,R.prototype.destroy.call(this)},C.registerListeners=function e(){var R=this.hls;R.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.on(_.Events.ERROR,this.onError,this)},C.unregisterListeners=function e(){var R=this.hls;R.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),R.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.off(_.Events.ERROR,this.onError,this)},C.onMediaAttached=function e(R,C){this.media=C.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},C.pollTrackChange=function e(R){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,R)},C.onMediaDetaching=function e(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),c(this.media.textTracks).forEach((function(R){Object(O.clearCurrentCues)(R)})),this.subtitleTrack=-1,this.media=null)},C.onManifestLoading=function e(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},C.onManifestParsed=function e(R,C){this.tracks=C.subtitleTracks},C.onSubtitleTrackLoaded=function e(R,C){var I=C.id,_=C.details,O=this.trackId,x=this.tracksInGroup[O];if(x){var w=x.details;x.details=C.details,this.log("subtitle track "+I+" loaded ["+_.startSN+"-"+_.endSN+"]"),I===this.trackId&&(this.retryCount=0,this.playlistLoaded(I,C,w))}else this.warn("Invalid subtitle track id "+I)},C.onLevelLoading=function e(R,C){this.switchLevel(C.level)},C.onLevelSwitching=function e(R,C){this.switchLevel(C.level)},C.switchLevel=function e(R){var C=this.hls.levels[R];if(null!=C&&C.textGroupIds){var I=C.textGroupIds[C.urlId];if(this.groupId!==I){var O=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,x=this.tracks.filter((function(R){return!I||R.groupId===I}));this.tracksInGroup=x;var w=this.findTrackId(null==O?void 0:O.name)||this.findTrackId();this.groupId=I;var P={"subtitleTracks":x};this.log("Updating subtitle tracks, "+x.length+' track(s) found in "'+I+'" group-id'),this.hls.trigger(_.Events.SUBTITLE_TRACKS_UPDATED,P),-1!==w&&this.setSubtitleTrack(w,O)}}},C.findTrackId=function e(R){for(var C=this.tracksInGroup,I=0;I<C.length;I++){var _=C[I];if((!this.selectDefaultTrack||_.default)&&(!R||R===_.name))return _.id}return-1},C.onError=function t(C,I){R.prototype.onError.call(this,C,I),!I.fatal&&I.context&&I.context.type===w.PlaylistContextType.SUBTITLE_TRACK&&I.context.id===this.trackId&&I.context.groupId===this.groupId&&this.retryLoadingOrFail(I)},C.loadPlaylist=function e(R){var C=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(C)){var I=C.id,O=C.groupId,x=C.url;if(R)try{x=R.addDirectives(x)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Loading subtitle playlist for id "+I),this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADING,{"url":x,"id":I,"groupId":O,"deliveryDirectives":R||null})}},C.toggleTrackModes=function e(R){var C=this,I=this.media,_=this.subtitleDisplay,O=this.trackId;if(I){var x=c(I.textTracks),w=x.filter((function(R){return R.groupId===C.groupId}));if(-1===R)[].slice.call(x).forEach((function(R){R.mode="disabled"}));else{var P=w[O];P&&(P.mode="disabled")}var F=w[R];F&&(F.mode=_?"showing":"hidden")}},C.setSubtitleTrack=function e(R,C){var I,O=this.tracksInGroup;if(this.media){if(this.trackId!==R&&this.toggleTrackModes(R),!(this.trackId===R&&(-1===R||null!==(I=O[R])&&void 0!==I&&I.details)||R<-1||R>=O.length)){this.clearTimer();var x=O[R];if(this.log("Switching to subtitle track "+R),this.trackId=R,x){var w=x.id,P=x.groupId,F=void 0===P?"":P,M=x.name,N=x.type,U=x.url;this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{"id":w,"groupId":F,"name":M,"type":N,"url":U});var B=this.switchParams(x.url,null==C?void 0:C.details);this.loadPlaylist(B)}else this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{"id":R})}}else this.queuedDefaultTrack=R},C.onTextTracksChanged=function e(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var R=-1,C=c(this.media.textTracks),I=0;I<C.length;I++)if("hidden"===C[I].mode)R=I;else if("showing"===C[I].mode){R=I;break}this.subtitleTrack!==R&&(this.subtitleTrack=R)}},function l(R,C,I){return C&&o(R.prototype,C),I&&o(R,I),R}(t,[{"key":"subtitleTracks","get":function e(){return this.tracksInGroup}},{"key":"subtitleTrack","get":function e(){return this.trackId},"set":function e(R){this.selectDefaultTrack=!1;var C=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(R,C)}}]),t}(x.default);function c(R){for(var C=[],I=0;I<R.length;I++){var _=R[I];"subtitles"===_.kind&&_.label&&C.push(R[I])}return C}C.default=P},"./src/controller/timeline-controller.ts":function srcControllerTimelineControllerTs(R,C,I){I.r(C),I.d(C,"TimelineController",(function(){return B}));var _=I("./src/polyfills/number.ts"),O=I("./src/events.ts"),x=I("./src/utils/cea-608-parser.ts"),w=I("./src/utils/output-filter.ts"),P=I("./src/utils/webvtt-parser.ts"),F=I("./src/utils/texttrack-utils.ts"),M=I("./src/utils/imsc1-ttml-parser.ts"),N=I("./src/types/loader.ts"),U=I("./src/utils/logger.ts"),B=function(){function e(R){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={"ccOffset":0,"presentationOffset":0,"0":{"start":0,"prevCC":-1,"new":!1}},this.captionsProperties=void 0,this.hls=R,this.config=R.config,this.Cues=R.config.cueHandler,this.captionsProperties={"textTrack1":{"label":this.config.captionsTextTrack1Label,"languageCode":this.config.captionsTextTrack1LanguageCode},"textTrack2":{"label":this.config.captionsTextTrack2Label,"languageCode":this.config.captionsTextTrack2LanguageCode},"textTrack3":{"label":this.config.captionsTextTrack3Label,"languageCode":this.config.captionsTextTrack3LanguageCode},"textTrack4":{"label":this.config.captionsTextTrack4Label,"languageCode":this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var C=new w.default(this,"textTrack1"),I=new w.default(this,"textTrack2"),_=new w.default(this,"textTrack3"),P=new w.default(this,"textTrack4");this.cea608Parser1=new x.default(1,C,I),this.cea608Parser2=new x.default(3,_,P)}R.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.on(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.on(O.Events.FRAG_LOADING,this.onFragLoading,this),R.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),R.on(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),R.on(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),R.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.on(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),R.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var R=e.prototype;return R.destroy=function e(){var R=this.hls;R.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.off(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.off(O.Events.FRAG_LOADING,this.onFragLoading,this),R.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),R.off(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),R.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.off(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),R.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},R.addCues=function e(R,C,I,_,x){for(var w=!1,P=x.length;P--;){var F=x[P],M=v(F[0],F[1],C,I);if(M>=0&&(F[0]=Math.min(F[0],C),F[1]=Math.max(F[1],I),w=!0,M/(I-C)>.5))return}if(w||x.push([C,I]),this.config.renderTextTracksNatively){var N=this.captionsTracks[R];this.Cues.newCue(N,C,I,_)}else{var U=this.Cues.newCue(null,C,I,_);this.hls.trigger(O.Events.CUES_PARSED,{"type":"captions","cues":U,"track":R})}},R.onInitPtsFound=function e(R,C){var I=this,_=C.frag,x=C.id,w=C.initPTS,P=C.timescale,F=this.unparsedVttFrags;"main"===x&&(this.initPTS[_.cc]=w,this.timescale[_.cc]=P),F.length&&(this.unparsedVttFrags=[],F.forEach((function(R){I.onFragLoaded(O.Events.FRAG_LOADED,R)})))},R.getExistingTrack=function e(R){var C=this.media;if(C)for(var I=0;I<C.textTracks.length;I++){var _=C.textTracks[I];if(_[R])return _}return null},R.createCaptionsTrack=function e(R){this.config.renderTextTracksNatively?this.createNativeTrack(R):this.createNonNativeTrack(R)},R.createNativeTrack=function e(R){if(!this.captionsTracks[R]){var C=this.captionsProperties,I=this.captionsTracks,_=this.media,O=C[R],x=O.label,w=O.languageCode,P=this.getExistingTrack(R);if(P)I[R]=P,Object(F.clearCurrentCues)(I[R]),Object(F.sendAddTrackEvent)(I[R],_);else{var M=this.createTextTrack("captions",x,w);M&&(M[R]=!0,I[R]=M)}}},R.createNonNativeTrack=function e(R){if(!this.nonNativeCaptionsTracks[R]){var C=this.captionsProperties[R];if(C){var I={"_id":R,"label":C.label,"kind":"captions","default":!!C.media&&!!C.media.default,"closedCaptions":C.media};this.nonNativeCaptionsTracks[R]=I,this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{"tracks":[I]})}}},R.createTextTrack=function e(R,C,I){var _=this.media;if(_)return _.addTextTrack(R,C,I)},R.onMediaAttaching=function e(R,C){this.media=C.media,this._cleanTracks()},R.onMediaDetaching=function e(){var R=this.captionsTracks;Object.keys(R).forEach((function(C){Object(F.clearCurrentCues)(R[C]),delete R[C]})),this.nonNativeCaptionsTracks={}},R.onManifestLoading=function e(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={"ccOffset":0,"presentationOffset":0,"0":{"start":0,"prevCC":-1,"new":!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},R._cleanTracks=function e(){var R=this.media;if(R){var C=R.textTracks;if(C)for(var I=0;I<C.length;I++)Object(F.clearCurrentCues)(C[I])}},R.onSubtitleTracksUpdated=function e(R,C){var I=this;this.textTracks=[];var _=C.subtitleTracks||[],x=_.some((function(R){return R.textCodec===M.IMSC1_CODEC}));if(this.config.enableWebVTT||x&&this.config.enableIMSC1){var w=this.tracks&&_&&this.tracks.length===_.length;if(this.tracks=_||[],this.config.renderTextTracksNatively){var P=this.media?this.media.textTracks:[];this.tracks.forEach((function(R,C){var _;if(C<P.length){for(var O=null,x=0;x<P.length;x++)if(h(P[x],R)){O=P[x];break}O&&(_=O)}_?Object(F.clearCurrentCues)(_):(_=I.createTextTrack("subtitles",R.name,R.lang))&&(_.mode="disabled"),_&&(_.groupId=R.groupId,I.textTracks.push(_))}))}else if(!w&&this.tracks&&this.tracks.length){var N=this.tracks.map((function(R){return{"label":R.name,"kind":R.type.toLowerCase(),"default":R.default,"subtitleTrack":R}}));this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{"tracks":N})}}},R.onManifestLoaded=function e(R,C){var I=this;this.config.enableCEA708Captions&&C.captions&&C.captions.forEach((function(R){var C=/(?:CC|SERVICE)([1-4])/.exec(R.instreamId);if(C){var _="textTrack"+C[1],O=I.captionsProperties[_];O&&(O.label=R.name,R.lang&&(O.languageCode=R.lang),O.media=R)}}))},R.onFragLoading=function e(R,C){var I=this.cea608Parser1,_=this.cea608Parser2,O=this.lastSn,x=this.lastPartIndex;if(this.enabled&&I&&_&&C.frag.type===N.PlaylistLevelType.MAIN){var w,P,F=C.frag.sn,M=null!=(w=null==C||null===(P=C.part)||void 0===P?void 0:P.index)?w:-1;F===O+1||F===O&&M===x+1||(I.reset(),_.reset()),this.lastSn=F,this.lastPartIndex=M}},R.onFragLoaded=function e(R,C){var I=C.frag,x=C.payload,w=this.initPTS,P=this.unparsedVttFrags;if(I.type===N.PlaylistLevelType.SUBTITLE)if(x.byteLength){if(!Object(_.isFiniteNumber)(w[I.cc]))return P.push(C),void(w.length&&this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":I,"error":new Error("Missing initial subtitle PTS")}));var F=I.decryptdata,U="stats"in C;if(null==F||null==F.key||"AES-128"!==F.method||U){var B=this.tracks[I.level],G=this.vttCCs;G[I.cc]||(G[I.cc]={"start":I.start,"prevCC":this.prevCC,"new":!0},this.prevCC=I.cc),B&&B.textCodec===M.IMSC1_CODEC?this._parseIMSC1(I,x):this._parseVTTs(I,x,G)}}else this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":I,"error":new Error("Empty subtitle payload")})},R._parseIMSC1=function e(R,C){var I=this,_=this.hls;Object(M.parseIMSC1)(C,this.initPTS[R.cc],this.timescale[R.cc],(function(C){I._appendCues(C,R.level),_.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{"success":!0,"frag":R})}),(function(C){U.logger.log("Failed to parse IMSC1: "+C),_.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":R,"error":C})}))},R._parseVTTs=function e(R,C,I){var _=this,x=this.hls;Object(P.parseWebVTT)(C,this.initPTS[R.cc],this.timescale[R.cc],I,R.cc,R.start,(function(C){_._appendCues(C,R.level),x.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{"success":!0,"frag":R})}),(function(I){_._fallbackToIMSC1(R,C),U.logger.log("Failed to parse VTT cue: "+I),x.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":R,"error":I})}))},R._fallbackToIMSC1=function e(R,C){var I=this,_=this.tracks[R.level];_.textCodec||Object(M.parseIMSC1)(C,this.initPTS[R.cc],this.timescale[R.cc],(function(){_.textCodec=M.IMSC1_CODEC,I._parseIMSC1(R,C)}),(function(){_.textCodec="wvtt"}))},R._appendCues=function e(R,C){var I=this.hls;if(this.config.renderTextTracksNatively){var _=this.textTracks[C];if("disabled"===_.mode)return;R.forEach((function(R){return Object(F.addCueToTrack)(_,R)}))}else{var x=this.tracks[C].default?"default":"subtitles"+C;I.trigger(O.Events.CUES_PARSED,{"type":"subtitles","cues":R,"track":x})}},R.onFragDecrypted=function e(R,C){var I=C.frag;if(I.type===N.PlaylistLevelType.SUBTITLE){if(!Object(_.isFiniteNumber)(this.initPTS[I.cc]))return void this.unparsedVttFrags.push(C);this.onFragLoaded(O.Events.FRAG_LOADED,C)}},R.onSubtitleTracksCleared=function e(){this.tracks=[],this.captionsTracks={}},R.onFragParsingUserdata=function e(R,C){var I=this.cea608Parser1,_=this.cea608Parser2;if(this.enabled&&I&&_)for(var O=0;O<C.samples.length;O++){var x=C.samples[O].bytes;if(x){var w=this.extractCea608Data(x);I.addData(C.samples[O].pts,w[0]),_.addData(C.samples[O].pts,w[1])}}},R.onBufferFlushing=function e(R,C){var I=C.startOffset,_=C.endOffset,O=C.endOffsetSubtitles,x=C.type,w=this.media;if(w&&!(w.currentTime<_)){if(!x||"video"===x){var P=this.captionsTracks;Object.keys(P).forEach((function(R){return Object(F.removeCuesInRange)(P[R],I,_)}))}if(this.config.renderTextTracksNatively&&0===I&&void 0!==O){var M=this.textTracks;Object.keys(M).forEach((function(R){return Object(F.removeCuesInRange)(M[R],I,O)}))}}},R.extractCea608Data=function e(R){for(var C=31&R[0],I=2,_=[[],[]],O=0;O<C;O++){var x=R[I++],w=127&R[I++],P=127&R[I++],F=3&x;0===w&&0===P||0!=(4&x)&&(0!==F&&1!==F||(_[F].push(w),_[F].push(P)))}return _},e}();function h(R,C){return R&&R.label===C.name&&!(R.textTrack1||R.textTrack2)}function v(R,C,I,_){return Math.min(C,_)-Math.max(R,I)}},"./src/crypt/aes-crypto.ts":function srcCryptAesCryptoTs(R,C,I){I.r(C),I.d(C,"default",(function(){return _}));var _=function(){function e(R,C){this.subtle=void 0,this.aesIV=void 0,this.subtle=R,this.aesIV=C}return e.prototype.decrypt=function e(R,C){return this.subtle.decrypt({"name":"AES-CBC","iv":this.aesIV},C,R)},e}()},"./src/crypt/aes-decryptor.ts":function srcCryptAesDecryptorTs(R,C,I){I.r(C),I.d(C,"removePadding",(function(){return a})),I.d(C,"default",(function(){return O}));var _=I("./src/utils/typed-array.ts");function a(R){var C=R.byteLength,I=C&&new DataView(R.buffer).getUint8(C-1);return I?Object(_.sliceUint8)(R,0,C-I):R}var O=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=e.prototype;return R.uint8ArrayToUint32Array_=function e(R){for(var C=new DataView(R),I=new Uint32Array(4),_=0;_<4;_++)I[_]=C.getUint32(4*_);return I},R.initTable=function e(){var R=this.sBox,C=this.invSBox,I=this.subMix,_=I[0],O=I[1],x=I[2],w=I[3],P=this.invSubMix,F=P[0],M=P[1],N=P[2],U=P[3],B=new Uint32Array(256),G=0,j=0,K=0;for(K=0;K<256;K++)B[K]=K<128?K<<1:K<<1^283;for(K=0;K<256;K++){var H=j^j<<1^j<<2^j<<3^j<<4;H=H>>>8^255&H^99,R[G]=H,C[H]=G;var V=B[G],W=B[V],Y=B[W],q=257*B[H]^16843008*H;_[G]=q<<24|q>>>8,O[G]=q<<16|q>>>16,x[G]=q<<8|q>>>24,w[G]=q,q=16843009*Y^65537*W^257*V^16843008*G,F[H]=q<<24|q>>>8,M[H]=q<<16|q>>>16,N[H]=q<<8|q>>>24,U[H]=q,G?(G=V^B[B[B[Y^V]]],j^=B[B[j]]):G=j=1}},R.expandKey=function e(R){for(var C=this.uint8ArrayToUint32Array_(R),I=!0,_=0;_<C.length&&I;)I=C[_]===this.key[_],_++;if(!I){this.key=C;var O=this.keySize=C.length;if(4!==O&&6!==O&&8!==O)throw new Error("Invalid aes key size="+O);var x,w,P,F,M=this.ksRows=4*(O+6+1),N=this.keySchedule=new Uint32Array(M),U=this.invKeySchedule=new Uint32Array(M),B=this.sBox,G=this.rcon,j=this.invSubMix,K=j[0],H=j[1],V=j[2],W=j[3];for(x=0;x<M;x++)x<O?P=N[x]=C[x]:(F=P,x%O==0?(F=B[(F=F<<8|F>>>24)>>>24]<<24|B[F>>>16&255]<<16|B[F>>>8&255]<<8|B[255&F],F^=G[x/O|0]<<24):O>6&&x%O==4&&(F=B[F>>>24]<<24|B[F>>>16&255]<<16|B[F>>>8&255]<<8|B[255&F]),N[x]=P=(N[x-O]^F)>>>0);for(w=0;w<M;w++)x=M-w,F=3&w?N[x]:N[x-4],U[w]=w<4||x<=4?F:K[B[F>>>24]]^H[B[F>>>16&255]]^V[B[F>>>8&255]]^W[B[255&F]],U[w]=U[w]>>>0}},R.networkToHostOrderSwap=function e(R){return R<<24|(65280&R)<<8|(16711680&R)>>8|R>>>24},R.decrypt=function e(R,C,I){for(var _,O,x,w,P,F,M,N,U,B,G,j,K,H,V=this.keySize+6,W=this.invKeySchedule,Y=this.invSBox,q=this.invSubMix,X=q[0],z=q[1],Q=q[2],J=q[3],$=this.uint8ArrayToUint32Array_(I),Z=$[0],ee=$[1],te=$[2],re=$[3],ie=new Int32Array(R),ne=new Int32Array(ie.length),se=this.networkToHostOrderSwap;C<ie.length;){for(U=se(ie[C]),B=se(ie[C+1]),G=se(ie[C+2]),j=se(ie[C+3]),P=U^W[0],F=j^W[1],M=G^W[2],N=B^W[3],K=4,H=1;H<V;H++)_=X[P>>>24]^z[F>>16&255]^Q[M>>8&255]^J[255&N]^W[K],O=X[F>>>24]^z[M>>16&255]^Q[N>>8&255]^J[255&P]^W[K+1],x=X[M>>>24]^z[N>>16&255]^Q[P>>8&255]^J[255&F]^W[K+2],w=X[N>>>24]^z[P>>16&255]^Q[F>>8&255]^J[255&M]^W[K+3],P=_,F=O,M=x,N=w,K+=4;_=Y[P>>>24]<<24^Y[F>>16&255]<<16^Y[M>>8&255]<<8^Y[255&N]^W[K],O=Y[F>>>24]<<24^Y[M>>16&255]<<16^Y[N>>8&255]<<8^Y[255&P]^W[K+1],x=Y[M>>>24]<<24^Y[N>>16&255]<<16^Y[P>>8&255]<<8^Y[255&F]^W[K+2],w=Y[N>>>24]<<24^Y[P>>16&255]<<16^Y[F>>8&255]<<8^Y[255&M]^W[K+3],ne[C]=se(_^Z),ne[C+1]=se(w^ee),ne[C+2]=se(x^te),ne[C+3]=se(O^re),Z=U,ee=B,te=G,re=j,C+=4}return ne.buffer},e}()},"./src/crypt/decrypter.ts":function srcCryptDecrypterTs(R,C,I){I.r(C),I.d(C,"default",(function(){return M}));var _=I("./src/crypt/aes-crypto.ts"),O=I("./src/crypt/fast-aes-key.ts"),x=I("./src/crypt/aes-decryptor.ts"),w=I("./src/utils/logger.ts"),P=I("./src/utils/mp4-tools.ts"),F=I("./src/utils/typed-array.ts"),M=function(){function e(R,C,I){var _=(void 0===I?{}:I).removePKCS7Padding,O=void 0===_||_;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=R,this.config=C,this.removePKCS7Padding=O,O)try{var x=self.crypto;x&&(this.subtle=x.subtle||x.webkitSubtle)}catch(R){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var R=e.prototype;return R.destroy=function e(){this.observer=null},R.isSync=function e(){return this.config.enableSoftwareAES},R.flush=function e(){var R=this.currentResult;if(R){var C=new Uint8Array(R);return this.reset(),this.removePKCS7Padding?Object(x.removePadding)(C):C}this.reset()},R.reset=function e(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},R.decrypt=function e(R,C,I,_){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(R),C,I);var O=this.flush();O&&_(O.buffer)}else this.webCryptoDecrypt(new Uint8Array(R),C,I).then(_)},R.softwareDecrypt=function e(R,C,I){var _=this.currentIV,O=this.currentResult,w=this.remainderData;this.logOnce("JS AES decrypt"),w&&(R=Object(P.appendUint8Array)(w,R),this.remainderData=null);var M=this.getValidChunk(R);if(!M.length)return null;_&&(I=_);var N=this.softwareDecrypter;N||(N=this.softwareDecrypter=new x.default),N.expandKey(C);var U=O;return this.currentResult=N.decrypt(M.buffer,0,I),this.currentIV=Object(F.sliceUint8)(M,-16).buffer,U||null},R.webCryptoDecrypt=function e(R,C,I){var x=this,w=this.subtle;return this.key===C&&this.fastAesKey||(this.key=C,this.fastAesKey=new O.default(w,C)),this.fastAesKey.expandKey().then((function(C){return w?new _.default(w,I).decrypt(R.buffer,C):Promise.reject(new Error("web crypto not initialized"))})).catch((function(_){return x.onWebCryptoError(_,R,C,I)}))},R.onWebCryptoError=function e(R,C,I,_){return w.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",R),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(C,I,_)},R.getValidChunk=function e(R){var C=R,I=R.length-R.length%16;return I!==R.length&&(C=Object(F.sliceUint8)(R,0,I),this.remainderData=Object(F.sliceUint8)(R,I)),C},R.logOnce=function e(R){this.logEnabled&&(w.logger.log("[decrypter.ts]: "+R),this.logEnabled=!1)},e}()},"./src/crypt/fast-aes-key.ts":function srcCryptFastAesKeyTs(R,C,I){I.r(C),I.d(C,"default",(function(){return _}));var _=function(){function e(R,C){this.subtle=void 0,this.key=void 0,this.subtle=R,this.key=C}return e.prototype.expandKey=function e(){return this.subtle.importKey("raw",this.key,{"name":"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":function srcDemuxAacdemuxerTs(R,C,I){I.r(C);var _=I("./src/demux/base-audio-demuxer.ts"),O=I("./src/demux/adts.ts"),x=I("./src/utils/logger.ts"),w=I("./src/demux/id3.ts");function l(R,C){return l=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},l(R,C)}var P=function(R){function t(C,I){var _;return(_=R.call(this)||this).observer=void 0,_.config=void 0,_.observer=C,_.config=I,_}!function o(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,l(R,C)}(t,R);var C=t.prototype;return C.resetInitSegment=function t(C,I,_){R.prototype.resetInitSegment.call(this,C,I,_),this._audioTrack={"container":"audio/adts","type":"audio","id":2,"pid":-1,"sequenceNumber":0,"isAAC":!0,"samples":[],"manifestCodec":C,"duration":_,"inputTimeScale":9e4,"dropped":0}},t.probe=function e(R){if(!R)return!1;for(var C=(w.getID3Data(R,0)||[]).length,I=R.length;C<I;C++)if(O.probe(R,C))return x.logger.log("ADTS sync word found !"),!0;return!1},C.canParse=function e(R,C){return O.canParse(R,C)},C.appendFrame=function e(R,C,I){O.initTrackConfig(R,this.observer,C,I,R.manifestCodec);var _=O.appendFrame(R,C,I,this.initPTS,this.frameIndex);if(_&&0===_.missing)return _},t}(_.default);P.minProbeByteLength=9,C.default=P},"./src/demux/adts.ts":function srcDemuxAdtsTs(R,C,I){I.r(C),I.d(C,"getAudioConfig",(function(){return s})),I.d(C,"isHeaderPattern",(function(){return o})),I.d(C,"getHeaderLength",(function(){return l})),I.d(C,"getFullFrameLength",(function(){return u})),I.d(C,"canGetFrameLength",(function(){return f})),I.d(C,"isHeader",(function(){return d})),I.d(C,"canParse",(function(){return c})),I.d(C,"probe",(function(){return h})),I.d(C,"initTrackConfig",(function(){return v})),I.d(C,"getFrameDuration",(function(){return g})),I.d(C,"parseFrameHeader",(function(){return p})),I.d(C,"appendFrame",(function(){return m}));var _=I("./src/utils/logger.ts"),O=I("./src/errors.ts"),x=I("./src/events.ts");function s(R,C,I,w){var P,F,M,N,U=navigator.userAgent.toLowerCase(),B=w,G=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];P=1+((192&C[I+2])>>>6);var j=(60&C[I+2])>>>2;if(!(j>G.length-1))return M=(1&C[I+2])<<2,M|=(192&C[I+3])>>>6,_.logger.log("manifest codec:"+w+", ADTS type:"+P+", samplingIndex:"+j),/firefox/i.test(U)?j>=6?(P=5,N=new Array(4),F=j-3):(P=2,N=new Array(2),F=j):-1!==U.indexOf("android")?(P=2,N=new Array(2),F=j):(P=5,N=new Array(4),w&&(-1!==w.indexOf("mp4a.40.29")||-1!==w.indexOf("mp4a.40.5"))||!w&&j>=6?F=j-3:((w&&-1!==w.indexOf("mp4a.40.2")&&(j>=6&&1===M||/vivaldi/i.test(U))||!w&&1===M)&&(P=2,N=new Array(2)),F=j)),N[0]=P<<3,N[0]|=(14&j)>>1,N[1]|=(1&j)<<7,N[1]|=M<<3,5===P&&(N[1]|=(14&F)>>1,N[2]=(1&F)<<7,N[2]|=8,N[3]=0),{"config":N,"samplerate":G[j],"channelCount":M,"codec":"mp4a.40."+P,"manifestCodec":B};R.trigger(x.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.FRAG_PARSING_ERROR,"fatal":!0,"reason":"invalid ADTS sampling index:"+j})}function o(R,C){return 255===R[C]&&240==(246&R[C+1])}function l(R,C){return 1&R[C+1]?7:9}function u(R,C){return(3&R[C+3])<<11|R[C+4]<<3|(224&R[C+5])>>>5}function f(R,C){return C+5<R.length}function d(R,C){return C+1<R.length&&o(R,C)}function c(R,C){return f(R,C)&&o(R,C)&&u(R,C)<=R.length-C}function h(R,C){if(d(R,C)){var I=l(R,C);if(C+I>=R.length)return!1;var _=u(R,C);if(_<=I)return!1;var O=C+_;return O===R.length||d(R,O)}return!1}function v(R,C,I,O,x){if(!R.samplerate){var w=s(C,I,O,x);if(!w)return;R.config=w.config,R.samplerate=w.samplerate,R.channelCount=w.channelCount,R.codec=w.codec,R.manifestCodec=w.manifestCodec,_.logger.log("parsed codec:"+R.codec+", rate:"+w.samplerate+", channels:"+w.channelCount)}}function g(R){return 9216e4/R}function p(R,C,I,_,O){var x=l(R,C),w=u(R,C);if((w-=x)>0)return{"headerLength":x,"frameLength":w,"stamp":I+_*O}}function m(R,C,I,_,O){var x=p(C,I,_,O,g(R.samplerate));if(x){var w,P=x.frameLength,F=x.headerLength,M=x.stamp,N=F+P,U=Math.max(0,I+N-C.length);U?(w=new Uint8Array(N-F)).set(C.subarray(I+F,C.length),0):w=C.subarray(I+F,I+N);var B={"unit":w,"pts":M};return U||R.samples.push(B),{"sample":B,"length":N,"missing":U}}}},"./src/demux/base-audio-demuxer.ts":function srcDemuxBaseAudioDemuxerTs(R,C,I){I.r(C),I.d(C,"initPTSFn",(function(){return M}));var _=I("./src/polyfills/number.ts"),O=I("./src/demux/id3.ts"),x=I("./src/demux/dummy-demuxed-track.ts"),w=I("./src/utils/mp4-tools.ts"),P=I("./src/utils/typed-array.ts"),F=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var R=e.prototype;return R.resetInitSegment=function e(R,C,I){this._id3Track={"type":"id3","id":3,"pid":-1,"inputTimeScale":9e4,"sequenceNumber":0,"samples":[],"dropped":0}},R.resetTimeStamp=function e(){},R.resetContiguity=function e(){},R.canParse=function e(R,C){return!1},R.appendFrame=function e(R,C,I){},R.demux=function e(R,C){this.cachedData&&(R=Object(w.appendUint8Array)(this.cachedData,R),this.cachedData=null);var I,_,F=O.getID3Data(R,0),N=F?F.length:0,U=this._audioTrack,B=this._id3Track,G=F?O.getTimeStamp(F):void 0,j=R.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=M(G,C)),F&&F.length>0&&B.samples.push({"pts":this.initPTS,"dts":this.initPTS,"data":F}),_=this.initPTS;N<j;){if(this.canParse(R,N)){var K=this.appendFrame(U,R,N);K?(this.frameIndex++,_=K.sample.pts,I=N+=K.length):N=j}else O.canParse(R,N)?(F=O.getID3Data(R,N),B.samples.push({"pts":_,"dts":_,"data":F}),I=N+=F.length):N++;if(N===j&&I!==j){var H=Object(P.sliceUint8)(R,I);this.cachedData?this.cachedData=Object(w.appendUint8Array)(this.cachedData,H):this.cachedData=H}}return{"audioTrack":U,"avcTrack":Object(x.dummyTrack)(),"id3Track":B,"textTrack":Object(x.dummyTrack)()}},R.demuxSampleAes=function e(R,C,I){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},R.flush=function e(R){var C=this.cachedData;return C&&(this.cachedData=null,this.demux(C,0)),this.frameIndex=0,{"audioTrack":this._audioTrack,"avcTrack":Object(x.dummyTrack)(),"id3Track":this._id3Track,"textTrack":Object(x.dummyTrack)()}},R.destroy=function e(){},e}(),M=function e(R,C){return Object(_.isFiniteNumber)(R)?90*R:9e4*C};C.default=F},"./src/demux/chunk-cache.ts":function srcDemuxChunkCacheTs(R,C,I){I.r(C),I.d(C,"default",(function(){return _}));var _=function(){function e(){this.chunks=[],this.dataLength=0}var R=e.prototype;return R.push=function e(R){this.chunks.push(R),this.dataLength+=R.length},R.flush=function e(){var R,C=this.chunks,I=this.dataLength;return C.length?(R=1===C.length?C[0]:function a(R,C){for(var I=new Uint8Array(C),_=0,O=0;O<R.length;O++){var x=R[O];I.set(x,_),_+=x.length}return I}(C,I),this.reset(),R):new Uint8Array(0)},R.reset=function e(){this.chunks.length=0,this.dataLength=0},e}()},"./src/demux/dummy-demuxed-track.ts":function srcDemuxDummyDemuxedTrackTs(R,C,I){function i(){return{"type":"","id":-1,"pid":-1,"inputTimeScale":9e4,"sequenceNumber":-1,"samples":[],"dropped":0}}I.r(C),I.d(C,"dummyTrack",(function(){return i}))},"./src/demux/exp-golomb.ts":function srcDemuxExpGolombTs(R,C,I){I.r(C);var _=I("./src/utils/logger.ts"),O=function(){function e(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var R=e.prototype;return R.loadWord=function e(){var R=this.data,C=this.bytesAvailable,I=R.byteLength-C,_=new Uint8Array(4),O=Math.min(4,C);if(0===O)throw new Error("no bytes available");_.set(R.subarray(I,I+O)),this.word=new DataView(_.buffer).getUint32(0),this.bitsAvailable=8*O,this.bytesAvailable-=O},R.skipBits=function e(R){var C;this.bitsAvailable>R?(this.word<<=R,this.bitsAvailable-=R):(R-=this.bitsAvailable,R-=(C=R>>3)>>3,this.bytesAvailable-=C,this.loadWord(),this.word<<=R,this.bitsAvailable-=R)},R.readBits=function e(R){var C=Math.min(this.bitsAvailable,R),I=this.word>>>32-C;return R>32&&_.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=C,this.bitsAvailable>0?this.word<<=C:this.bytesAvailable>0&&this.loadWord(),(C=R-C)>0&&this.bitsAvailable?I<<C|this.readBits(C):I},R.skipLZ=function e(){var R;for(R=0;R<this.bitsAvailable;++R)if(0!=(this.word&2147483648>>>R))return this.word<<=R,this.bitsAvailable-=R,R;return this.loadWord(),R+this.skipLZ()},R.skipUEG=function e(){this.skipBits(1+this.skipLZ())},R.skipEG=function e(){this.skipBits(1+this.skipLZ())},R.readUEG=function e(){var R=this.skipLZ();return this.readBits(R+1)-1},R.readEG=function e(){var R=this.readUEG();return 1&R?1+R>>>1:-1*(R>>>1)},R.readBoolean=function e(){return 1===this.readBits(1)},R.readUByte=function e(){return this.readBits(8)},R.readUShort=function e(){return this.readBits(16)},R.readUInt=function e(){return this.readBits(32)},R.skipScalingList=function e(R){for(var C=8,I=8,_=0;_<R;_++)0!==I&&(I=(C+this.readEG()+256)%256),C=0===I?C:I},R.readSPS=function e(){var R,C,I,_=0,O=0,x=0,w=0,P=this.readUByte.bind(this),F=this.readBits.bind(this),M=this.readUEG.bind(this),N=this.readBoolean.bind(this),U=this.skipBits.bind(this),B=this.skipEG.bind(this),G=this.skipUEG.bind(this),j=this.skipScalingList.bind(this);P();var K=P();if(F(5),U(3),P(),G(),100===K||110===K||122===K||244===K||44===K||83===K||86===K||118===K||128===K){var H=M();if(3===H&&U(1),G(),G(),U(1),N())for(C=3!==H?8:12,I=0;I<C;I++)N()&&j(I<6?16:64)}G();var V=M();if(0===V)M();else if(1===V)for(U(1),B(),B(),R=M(),I=0;I<R;I++)B();G(),U(1);var W=M(),Y=M(),q=F(1);0===q&&U(1),U(1),N()&&(_=M(),O=M(),x=M(),w=M());var X=[1,1];if(N()&&N())switch(P()){case 1:X=[1,1];break;case 2:X=[12,11];break;case 3:X=[10,11];break;case 4:X=[16,11];break;case 5:X=[40,33];break;case 6:X=[24,11];break;case 7:X=[20,11];break;case 8:X=[32,11];break;case 9:X=[80,33];break;case 10:X=[18,11];break;case 11:X=[15,11];break;case 12:X=[64,33];break;case 13:X=[160,99];break;case 14:X=[4,3];break;case 15:X=[3,2];break;case 16:X=[2,1];break;case 255:X=[P()<<8|P(),P()<<8|P()]}return{"width":Math.ceil(16*(W+1)-2*_-2*O),"height":(2-q)*(Y+1)*16-(q?2:4)*(x+w),"pixelRatio":X}},R.readSliceType=function e(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();C.default=O},"./src/demux/id3.ts":function srcDemuxId3Ts(R,C,I){I.r(C),I.d(C,"isHeader",(function(){return O})),I.d(C,"isFooter",(function(){return x})),I.d(C,"getID3Data",(function(){return w})),I.d(C,"canParse",(function(){return F})),I.d(C,"getTimeStamp",(function(){return M})),I.d(C,"isTimeStampFrame",(function(){return N})),I.d(C,"getID3Frames",(function(){return B})),I.d(C,"decodeFrame",(function(){return G})),I.d(C,"utf8ArrayToStr",(function(){return W})),I.d(C,"testables",(function(){return Y}));var _,O=function e(R,C){return C+10<=R.length&&73===R[C]&&68===R[C+1]&&51===R[C+2]&&R[C+3]<255&&R[C+4]<255&&R[C+6]<128&&R[C+7]<128&&R[C+8]<128&&R[C+9]<128},x=function e(R,C){return C+10<=R.length&&51===R[C]&&68===R[C+1]&&73===R[C+2]&&R[C+3]<255&&R[C+4]<255&&R[C+6]<128&&R[C+7]<128&&R[C+8]<128&&R[C+9]<128},w=function e(R,C){for(var I=C,_=0;O(R,C);){_+=10,_+=P(R,C+6),x(R,C+10)&&(_+=10),C+=_}if(_>0)return R.subarray(I,I+_)},P=function e(R,C){var I=0;return I=(127&R[C])<<21,I|=(127&R[C+1])<<14,I|=(127&R[C+2])<<7,I|=127&R[C+3]},F=function e(R,C){return O(R,C)&&P(R,C+6)+10<=R.length-C},M=function e(R){for(var C=B(R),I=0;I<C.length;I++){var _=C[I];if(N(_))return V(_)}},N=function e(R){return R&&"PRIV"===R.key&&"com.apple.streaming.transportStreamTimestamp"===R.info},U=function e(R){var C=String.fromCharCode(R[0],R[1],R[2],R[3]),I=P(R,4);return{"type":C,"size":I,"data":R.subarray(10,10+I)}},B=function e(R){for(var C=0,I=[];O(R,C);){for(var _=P(R,C+6),w=(C+=10)+_;C+8<w;){var F=U(R.subarray(C)),M=G(F);M&&I.push(M),C+=F.size+10}x(R,C)&&(C+=10)}return I},G=function e(R){return"PRIV"===R.type?j(R):"W"===R.type[0]?H(R):K(R)},j=function e(R){if(!(R.size<2)){var C=W(R.data,!0),I=new Uint8Array(R.data.subarray(C.length+1));return{"key":R.type,"info":C,"data":I.buffer}}},K=function e(R){if(!(R.size<2)){if("TXXX"===R.type){var C=1,I=W(R.data.subarray(C),!0);C+=I.length+1;var _=W(R.data.subarray(C));return{"key":R.type,"info":I,"data":_}}var O=W(R.data.subarray(1));return{"key":R.type,"data":O}}},H=function e(R){if("WXXX"===R.type){if(R.size<2)return;var C=1,I=W(R.data.subarray(C),!0);C+=I.length+1;var _=W(R.data.subarray(C));return{"key":R.type,"info":I,"data":_}}var O=W(R.data);return{"key":R.type,"data":O}},V=function e(R){if(8===R.data.byteLength){var C=new Uint8Array(R.data),I=1&C[3],_=(C[4]<<23)+(C[5]<<15)+(C[6]<<7)+C[7];return _/=45,I&&(_+=47721858.84),Math.round(_)}},W=function e(R,C){void 0===C&&(C=!1);var I=function T(){_||void 0===self.TextDecoder||(_=new self.TextDecoder("utf-8"));return _}();if(I){var O=I.decode(R);if(C){var x=O.indexOf("\0");return-1!==x?O.substring(0,x):O}return O.replace(/\0/g,"")}for(var w,P,F,M=R.length,N="",U=0;U<M;){if(0===(w=R[U++])&&C)return N;if(0!==w&&3!==w)switch(w>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:N+=String.fromCharCode(w);break;case 12:case 13:P=R[U++],N+=String.fromCharCode((31&w)<<6|63&P);break;case 14:P=R[U++],F=R[U++],N+=String.fromCharCode((15&w)<<12|(63&P)<<6|(63&F)<<0)}}return N},Y={"decodeTextFrame":K}},"./src/demux/mp3demuxer.ts":function srcDemuxMp3demuxerTs(R,C,I){I.r(C);var _=I("./src/demux/base-audio-demuxer.ts"),O=I("./src/demux/id3.ts"),x=I("./src/utils/logger.ts"),w=I("./src/demux/mpegaudio.ts");function l(R,C){return l=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},l(R,C)}var P=function(R){function t(){return R.apply(this,arguments)||this}!function o(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,l(R,C)}(t,R);var C=t.prototype;return C.resetInitSegment=function t(C,I,_){R.prototype.resetInitSegment.call(this,C,I,_),this._audioTrack={"container":"audio/mpeg","type":"audio","id":2,"pid":-1,"sequenceNumber":0,"isAAC":!1,"samples":[],"manifestCodec":C,"duration":_,"inputTimeScale":9e4,"dropped":0}},t.probe=function e(R){if(!R)return!1;for(var C=(O.getID3Data(R,0)||[]).length,I=R.length;C<I;C++)if(w.probe(R,C))return x.logger.log("MPEG Audio sync word found !"),!0;return!1},C.canParse=function e(R,C){return w.canParse(R,C)},C.appendFrame=function e(R,C,I){if(null!==this.initPTS)return w.appendFrame(R,C,I,this.initPTS,this.frameIndex)},t}(_.default);P.minProbeByteLength=4,C.default=P},"./src/demux/mp4demuxer.ts":function srcDemuxMp4demuxerTs(R,C,I){I.r(C);var _=I("./src/utils/mp4-tools.ts"),O=I("./src/demux/dummy-demuxed-track.ts"),x=function(){function e(R,C){this.remainderData=null,this.config=void 0,this.config=C}var R=e.prototype;return R.resetTimeStamp=function e(){},R.resetInitSegment=function e(){},R.resetContiguity=function e(){},e.probe=function e(R){return Object(_.findBox)({"data":R,"start":0,"end":Math.min(R.length,16384)},["moof"]).length>0},R.demux=function e(R){var C=R,I=Object(O.dummyTrack)();if(this.config.progressive){this.remainderData&&(C=Object(_.appendUint8Array)(this.remainderData,R));var x=Object(_.segmentValidRange)(C);this.remainderData=x.remainder,I.samples=x.valid||new Uint8Array}else I.samples=C;return{"audioTrack":Object(O.dummyTrack)(),"avcTrack":I,"id3Track":Object(O.dummyTrack)(),"textTrack":Object(O.dummyTrack)()}},R.flush=function e(){var R=Object(O.dummyTrack)();return R.samples=this.remainderData||new Uint8Array,this.remainderData=null,{"audioTrack":Object(O.dummyTrack)(),"avcTrack":R,"id3Track":Object(O.dummyTrack)(),"textTrack":Object(O.dummyTrack)()}},R.demuxSampleAes=function e(R,C,I){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},R.destroy=function e(){},e}();x.minProbeByteLength=1024,C.default=x},"./src/demux/mpegaudio.ts":function srcDemuxMpegaudioTs(R,C,I){I.r(C),I.d(C,"appendFrame",(function(){return l})),I.d(C,"parseHeader",(function(){return u})),I.d(C,"isHeaderPattern",(function(){return f})),I.d(C,"isHeader",(function(){return d})),I.d(C,"canParse",(function(){return c})),I.d(C,"probe",(function(){return h}));var _=null,O=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],x=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],w=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],P=[0,1,1,4];function l(R,C,I,_,O){if(!(I+24>C.length)){var x=u(C,I);if(x&&I+x.frameLength<=C.length){var w=_+O*(9e4*x.samplesPerFrame/x.sampleRate),P={"unit":C.subarray(I,I+x.frameLength),"pts":w,"dts":w};return R.config=[],R.channelCount=x.channelCount,R.samplerate=x.sampleRate,R.samples.push(P),{"sample":P,"length":x.frameLength,"missing":0}}}}function u(R,C){var I=R[C+1]>>3&3,F=R[C+1]>>1&3,M=R[C+2]>>4&15,N=R[C+2]>>2&3;if(1!==I&&0!==M&&15!==M&&3!==N){var U=R[C+2]>>1&1,B=R[C+3]>>6,G=1e3*O[14*(3===I?3-F:3===F?3:4)+M-1],j=x[3*(3===I?0:2===I?1:2)+N],K=3===B?1:2,H=w[I][F],V=P[F],W=8*H*V,Y=Math.floor(H*G/j+U)*V;if(null===_){var q=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);_=q?parseInt(q[1]):0}return!!_&&_<=87&&2===F&&G>=224e3&&0===B&&(R[C+3]=128|R[C+3]),{"sampleRate":j,"channelCount":K,"frameLength":Y,"samplesPerFrame":W}}}function f(R,C){return 255===R[C]&&224==(224&R[C+1])&&0!=(6&R[C+1])}function d(R,C){return C+1<R.length&&f(R,C)}function c(R,C){return f(R,C)&&4<=R.length-C}function h(R,C){if(C+1<R.length&&f(R,C)){var I=u(R,C),_=4;null!=I&&I.frameLength&&(_=I.frameLength);var O=C+_;return O===R.length||d(R,O)}return!1}},"./src/demux/sample-aes.ts":function srcDemuxSampleAesTs(R,C,I){I.r(C);var _=I("./src/crypt/decrypter.ts"),O=I("./src/demux/tsdemuxer.ts"),x=function(){function e(R,C,I){this.keyData=void 0,this.decrypter=void 0,this.keyData=I,this.decrypter=new _.default(R,C,{"removePKCS7Padding":!1})}var R=e.prototype;return R.decryptBuffer=function e(R,C){this.decrypter.decrypt(R,this.keyData.key.buffer,this.keyData.iv.buffer,C)},R.decryptAacSample=function e(R,C,I,_){var O=R[C].unit,x=O.subarray(16,O.length-O.length%16),w=x.buffer.slice(x.byteOffset,x.byteOffset+x.length),P=this;this.decryptBuffer(w,(function(x){var w=new Uint8Array(x);O.set(w,16),_||P.decryptAacSamples(R,C+1,I)}))},R.decryptAacSamples=function e(R,C,I){for(;;C++){if(C>=R.length)return void I();if(!(R[C].unit.length<32)){var _=this.decrypter.isSync();if(this.decryptAacSample(R,C,I,_),!_)return}}},R.getAvcEncryptedData=function e(R){for(var C=16*Math.floor((R.length-48)/160)+16,I=new Int8Array(C),_=0,O=32;O<R.length-16;O+=160,_+=16)I.set(R.subarray(O,O+16),_);return I},R.getAvcDecryptedUnit=function e(R,C){for(var I=new Uint8Array(C),_=0,O=32;O<R.length-16;O+=160,_+=16)R.set(I.subarray(_,_+16),O);return R},R.decryptAvcSample=function e(R,C,I,_,x,w){var P=Object(O.discardEPB)(x.data),F=this.getAvcEncryptedData(P),M=this;this.decryptBuffer(F.buffer,(function(O){x.data=M.getAvcDecryptedUnit(P,O),w||M.decryptAvcSamples(R,C,I+1,_)}))},R.decryptAvcSamples=function e(R,C,I,_){if(R instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;C++,I=0){if(C>=R.length)return void _();for(var O=R[C].units;!(I>=O.length);I++){var x=O[I];if(!(x.data.length<=48||1!==x.type&&5!==x.type)){var w=this.decrypter.isSync();if(this.decryptAvcSample(R,C,I,_,x,w),!w)return}}}},e}();C.default=x},"./src/demux/transmuxer-interface.ts":function srcDemuxTransmuxerInterfaceTs(R,C,I){I.r(C),I.d(C,"default",(function(){return U}));var _=I("./node_modules/webworkify-webpack/index.js"),O=I("./src/events.ts"),x=I("./src/demux/transmuxer.ts"),w=I("./src/utils/logger.ts"),P=I("./src/errors.ts"),F=I("./src/utils/mediasource-helper.ts"),M=I("./node_modules/eventemitter3/index.js"),N=Object(F.getMediaSource)()||{"isTypeSupported":function e(){return!1}},U=function(){function e(R,C,I,F){var U=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=R,this.id=C,this.onTransmuxComplete=I,this.onFlush=F;var B=R.config,G=function t(C,I){(I=I||{}).frag=U.frag,I.id=U.id,R.trigger(C,I)};this.observer=new M.EventEmitter,this.observer.on(O.Events.FRAG_DECRYPTED,G),this.observer.on(O.Events.ERROR,G);var j={"mp4":N.isTypeSupported("video/mp4"),"mpeg":N.isTypeSupported("audio/mpeg"),"mp3":N.isTypeSupported('audio/mp4; codecs="mp3"')},K=navigator.vendor;if(B.enableWorker&&"undefined"!=typeof Worker){var H;w.logger.log("demuxing in webworker");try{H=this.worker=_("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),H.addEventListener("message",this.onwmsg),H.onerror=function(C){R.trigger(O.Events.ERROR,{"type":P.ErrorTypes.OTHER_ERROR,"details":P.ErrorDetails.INTERNAL_EXCEPTION,"fatal":!0,"event":"demuxerWorker","error":new Error(C.message+"  ("+C.filename+":"+C.lineno+")")})},H.postMessage({"cmd":"init","typeSupported":j,"vendor":K,"id":C,"config":JSON.stringify(B)})}catch(R){w.logger.warn("Error in worker:",R),w.logger.error("Error while initializing DemuxerWorker, fallback to inline"),H&&self.URL.revokeObjectURL(H.objectURL),this.transmuxer=new x.default(this.observer,j,B,K,C),this.worker=null}}else this.transmuxer=new x.default(this.observer,j,B,K,C)}var R=e.prototype;return R.destroy=function e(){var R=this.worker;if(R)R.removeEventListener("message",this.onwmsg),R.terminate(),this.worker=null;else{var C=this.transmuxer;C&&(C.destroy(),this.transmuxer=null)}var I=this.observer;I&&I.removeAllListeners(),this.observer=null},R.push=function e(R,C,I,_,O,P,F,M,N,U){var B,G,j=this;N.transmuxing.start=self.performance.now();var K=this.transmuxer,H=this.worker,V=P?P.start:O.start,W=O.decryptdata,Y=this.frag,q=!(Y&&O.cc===Y.cc),X=!(Y&&N.level===Y.level),z=Y?N.sn-Y.sn:-1,Q=this.part?N.part-this.part.index:1,J=!X&&(1===z||0===z&&1===Q),$=self.performance.now();(X||z||0===O.stats.parsing.start)&&(O.stats.parsing.start=$),!P||!Q&&J||(P.stats.parsing.start=$);var Z=!(Y&&(null===(B=O.initSegment)||void 0===B?void 0:B.url)===(null===(G=Y.initSegment)||void 0===G?void 0:G.url)),ee=new x.TransmuxState(q,J,M,X,V,Z);if(!J||q||Z){w.logger.log("[transmuxer-interface, "+O.type+"]: Starting new transmux session for sn: "+N.sn+" p: "+N.part+" level: "+N.level+" id: "+N.id+"\n        discontinuity: "+q+"\n        trackSwitch: "+X+"\n        contiguous: "+J+"\n        accurateTimeOffset: "+M+"\n        timeOffset: "+V+"\n        initSegmentChange: "+Z);var te=new x.TransmuxConfig(I,_,C,F,U);this.configureTransmuxer(te)}if(this.frag=O,this.part=P,H)H.postMessage({"cmd":"demux","data":R,"decryptdata":W,"chunkMeta":N,"state":ee},R instanceof ArrayBuffer?[R]:[]);else if(K){var re=K.push(R,W,N,ee);Object(x.isPromise)(re)?re.then((function(R){j.handleTransmuxComplete(R)})):this.handleTransmuxComplete(re)}},R.flush=function e(R){var C=this;R.transmuxing.start=self.performance.now();var I=this.transmuxer,_=this.worker;if(_)_.postMessage({"cmd":"flush","chunkMeta":R});else if(I){var O=I.flush(R);Object(x.isPromise)(O)?O.then((function(I){C.handleFlushResult(I,R)})):this.handleFlushResult(O,R)}},R.handleFlushResult=function e(R,C){var I=this;R.forEach((function(R){I.handleTransmuxComplete(R)})),this.onFlush(C)},R.onWorkerMessage=function e(R){var C=R.data,I=this.hls;switch(C.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(C.data);break;case"flush":this.onFlush(C.data);break;default:C.data=C.data||{},C.data.frag=this.frag,C.data.id=this.id,I.trigger(C.event,C.data)}},R.configureTransmuxer=function e(R){var C=this.worker,I=this.transmuxer;C?C.postMessage({"cmd":"configure","config":R}):I&&I.configure(R)},R.handleTransmuxComplete=function e(R){R.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(R)},e}()},"./src/demux/transmuxer-worker.ts":function srcDemuxTransmuxerWorkerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return o}));var _=I("./src/demux/transmuxer.ts"),O=I("./src/events.ts"),x=I("./src/utils/logger.ts"),w=I("./node_modules/eventemitter3/index.js");function o(R){var C=new w.EventEmitter,I=function t(C,I){R.postMessage({"event":C,"data":I})};C.on(O.Events.FRAG_DECRYPTED,I),C.on(O.Events.ERROR,I),R.addEventListener("message",(function(O){var w=O.data;switch(w.cmd){case"init":var P=JSON.parse(w.config);R.transmuxer=new _.default(C,w.typeSupported,P,w.vendor,w.id),Object(x.enableLogs)(P.debug),I("init",null);break;case"configure":R.transmuxer.configure(w.config);break;case"demux":var F=R.transmuxer.push(w.data,w.decryptdata,w.chunkMeta,w.state);Object(_.isPromise)(F)?F.then((function(C){l(R,C)})):l(R,F);break;case"flush":var M=w.chunkMeta,N=R.transmuxer.flush(M);Object(_.isPromise)(N)?N.then((function(C){f(R,C,M)})):f(R,N,M)}}))}function l(R,C){if(!function d(R){return!(R.audio||R.video||R.text||R.id3||R.initSegment)}(C.remuxResult)){var I=[],_=C.remuxResult,O=_.audio,x=_.video;O&&u(I,O),x&&u(I,x),R.postMessage({"event":"transmuxComplete","data":C},I)}}function u(R,C){C.data1&&R.push(C.data1.buffer),C.data2&&R.push(C.data2.buffer)}function f(R,C,I){C.forEach((function(C){l(R,C)})),R.postMessage({"event":"flush","data":I})}},"./src/demux/transmuxer.ts":function srcDemuxTransmuxerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return W})),I.d(C,"isPromise",(function(){return S})),I.d(C,"TransmuxConfig",(function(){return q})),I.d(C,"TransmuxState",(function(){return X}));var _,O=I("./src/events.ts"),x=I("./src/errors.ts"),w=I("./src/crypt/decrypter.ts"),P=I("./src/demux/aacdemuxer.ts"),F=I("./src/demux/mp4demuxer.ts"),M=I("./src/demux/tsdemuxer.ts"),N=I("./src/demux/mp3demuxer.ts"),U=I("./src/remux/mp4-remuxer.ts"),B=I("./src/remux/passthrough-remuxer.ts"),G=I("./src/demux/chunk-cache.ts"),j=I("./src/utils/mp4-tools.ts"),K=I("./src/utils/logger.ts");try{_=self.performance.now.bind(self.performance)}catch(R){K.logger.debug("Unable to use Performance API on this environment"),_=self.Date.now}var H=[{"demux":M.default,"remux":U.default},{"demux":F.default,"remux":B.default},{"demux":P.default,"remux":U.default},{"demux":N.default,"remux":U.default}],V=1024;H.forEach((function(R){var C=R.demux;V=Math.max(V,C.minProbeByteLength)}));var W=function(){function e(R,C,I,_,O){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new G.default,this.observer=R,this.typeSupported=C,this.config=I,this.vendor=_,this.id=O}var R=e.prototype;return R.configure=function e(R){this.transmuxConfig=R,this.decrypter&&this.decrypter.reset()},R.push=function e(R,C,I,O){var x=this,w=I.transmuxing;w.executeStart=_();var P=new Uint8Array(R),F=this.cache,M=this.config,N=this.currentTransmuxState,U=this.transmuxConfig;O&&(this.currentTransmuxState=O);var B=function E(R,C){var I=null;R.byteLength>0&&null!=C&&null!=C.key&&null!==C.iv&&null!=C.method&&(I=C);return I}(P,C);if(B&&"AES-128"===B.method){var G=this.getDecrypter();if(!M.enableSoftwareAES)return this.decryptionPromise=G.webCryptoDecrypt(P,B.key.buffer,B.iv.buffer).then((function(R){var C=x.push(R,null,I);return x.decryptionPromise=null,C})),this.decryptionPromise;var K=G.softwareDecrypt(P,B.key.buffer,B.iv.buffer);if(!K)return w.executeEnd=_(),Y(I);P=new Uint8Array(K)}var H=O||N,V=H.contiguous,W=H.discontinuity,q=H.trackSwitch,X=H.accurateTimeOffset,z=H.timeOffset,Q=H.initSegmentChange,J=U.audioCodec,$=U.videoCodec,Z=U.defaultInitPts,ee=U.duration,te=U.initSegmentData;if((W||q||Q)&&this.resetInitSegment(te,J,$,ee),(W||Q)&&this.resetInitialTimestamp(Z),V||this.resetContiguity(),this.needsProbing(P,W,q)){if(F.dataLength){var re=F.flush();P=Object(j.appendUint8Array)(re,P)}this.configureTransmuxer(P,U)}var ie=this.transmux(P,B,z,X,I),ne=this.currentTransmuxState;return ne.contiguous=!0,ne.discontinuity=!1,ne.trackSwitch=!1,w.executeEnd=_(),ie},R.flush=function e(R){var C=this,I=R.transmuxing;I.executeStart=_();var w=this.decrypter,P=this.cache,F=this.currentTransmuxState,M=this.decryptionPromise;if(M)return M.then((function(){return C.flush(R)}));var N=[],U=F.timeOffset;if(w){var B=w.flush();B&&N.push(this.push(B,null,R))}var G=P.dataLength;P.reset();var j=this.demuxer,K=this.remuxer;if(!j||!K)return G>=V&&this.observer.emit(O.Events.ERROR,O.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.FRAG_PARSING_ERROR,"fatal":!0,"reason":"no demux matching with content found"}),I.executeEnd=_(),[Y(R)];var H=j.flush(U);return S(H)?H.then((function(I){return C.flushRemux(N,I,R),N})):(this.flushRemux(N,H,R),N)},R.flushRemux=function e(R,C,I){var O=C.audioTrack,x=C.avcTrack,w=C.id3Track,P=C.textTrack,F=this.currentTransmuxState,M=F.accurateTimeOffset,N=F.timeOffset;K.logger.log("[transmuxer.ts]: Flushed fragment "+I.sn+(I.part>-1?" p: "+I.part:"")+" of level "+I.level);var U=this.remuxer.remux(O,x,w,P,N,M,!0,this.id);R.push({"remuxResult":U,"chunkMeta":I}),I.transmuxing.executeEnd=_()},R.resetInitialTimestamp=function e(R){var C=this.demuxer,I=this.remuxer;C&&I&&(C.resetTimeStamp(R),I.resetTimeStamp(R))},R.resetContiguity=function e(){var R=this.demuxer,C=this.remuxer;R&&C&&(R.resetContiguity(),C.resetNextTimestamp())},R.resetInitSegment=function e(R,C,I,_){var O=this.demuxer,x=this.remuxer;O&&x&&(O.resetInitSegment(C,I,_),x.resetInitSegment(R,C,I))},R.destroy=function e(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},R.transmux=function e(R,C,I,_,O){return C&&"SAMPLE-AES"===C.method?this.transmuxSampleAes(R,C,I,_,O):this.transmuxUnencrypted(R,I,_,O)},R.transmuxUnencrypted=function e(R,C,I,_){var O=this.demuxer.demux(R,C,!1,!this.config.progressive),x=O.audioTrack,w=O.avcTrack,P=O.id3Track,F=O.textTrack;return{"remuxResult":this.remuxer.remux(x,w,P,F,C,I,!1,this.id),"chunkMeta":_}},R.transmuxSampleAes=function e(R,C,I,_,O){var x=this;return this.demuxer.demuxSampleAes(R,C,I).then((function(R){return{"remuxResult":x.remuxer.remux(R.audioTrack,R.avcTrack,R.id3Track,R.textTrack,I,_,!1,x.id),"chunkMeta":O}}))},R.configureTransmuxer=function e(R,C){for(var I,_=this.config,O=this.observer,x=this.typeSupported,w=this.vendor,P=C.audioCodec,M=C.defaultInitPts,N=C.duration,U=C.initSegmentData,G=C.videoCodec,j=0,V=H.length;j<V;j++)if(H[j].demux.probe(R)){I=H[j];break}I||(K.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),I={"demux":F.default,"remux":B.default});var W=this.demuxer,Y=this.remuxer,q=I.remux,X=I.demux;Y&&Y instanceof q||(this.remuxer=new q(O,_,x,w)),W&&W instanceof X||(this.demuxer=new X(O,_,x),this.probe=X.probe),this.resetInitSegment(U,P,G,N),this.resetInitialTimestamp(M)},R.needsProbing=function e(R,C,I){return!this.demuxer||!this.remuxer||C||I},R.getDecrypter=function e(){var R=this.decrypter;return R||(R=this.decrypter=new w.default(this.observer,this.config)),R},e}();var Y=function e(R){return{"remuxResult":{},"chunkMeta":R}};function S(R){return"then"in R&&R.then instanceof Function}var q=function e(R,C,I,_,O){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=R,this.videoCodec=C,this.initSegmentData=I,this.duration=_,this.defaultInitPts=O},X=function e(R,C,I,_,O,x){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=R,this.contiguous=C,this.accurateTimeOffset=I,this.trackSwitch=_,this.timeOffset=O,this.initSegmentChange=x}},"./src/demux/tsdemuxer.ts":function srcDemuxTsdemuxerTs(R,C,I){I.r(C),I.d(C,"discardEPB",(function(){return T}));var _=I("./src/demux/adts.ts"),O=I("./src/demux/mpegaudio.ts"),x=I("./src/demux/exp-golomb.ts"),w=I("./src/demux/id3.ts"),P=I("./src/demux/sample-aes.ts"),F=I("./src/events.ts"),M=I("./src/utils/mp4-tools.ts"),N=I("./src/utils/logger.ts"),U=I("./src/errors.ts"),B={"video":1,"audio":2,"id3":3,"text":4},G=function(){function e(R,C,I){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=R,this.config=C,this.typeSupported=I}e.probe=function t(R){var C=e.syncOffset(R);return!(C<0)&&(C&&N.logger.warn("MPEG2-TS detected but first sync word found @ offset "+C+", junk ahead ?"),!0)},e.syncOffset=function e(R){for(var C=Math.min(1e3,R.length-564),I=0;I<C;){if(71===R[I]&&71===R[I+188]&&71===R[I+376])return I;I++}return-1},e.createTrack=function e(R,C){return{"container":"video"===R||"audio"===R?"video/mp2t":void 0,"type":R,"id":B[R],"pid":-1,"inputTimeScale":9e4,"sequenceNumber":0,"samples":[],"dropped":0,"duration":"audio"===R?C:void 0}};var R=e.prototype;return R.resetInitSegment=function t(R,C,I){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",I),this._audioTrack=e.createTrack("audio",I),this._id3Track=e.createTrack("id3",I),this._txtTrack=e.createTrack("text",I),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=R,this.videoCodec=C,this._duration=I},R.resetTimeStamp=function e(){},R.resetContiguity=function e(){var R=this._audioTrack,C=this._avcTrack,I=this._id3Track;R&&(R.pesData=null),C&&(C.pesData=null),I&&(I.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},R.demux=function t(R,C,I,_){var O;void 0===I&&(I=!1),void 0===_&&(_=!1),I||(this.sampleAes=null);var x=this._avcTrack,w=this._audioTrack,P=this._id3Track,B=x.pid,G=x.pesData,j=w.pid,K=P.pid,H=w.pesData,V=P.pesData,W=!1,Y=this.pmtParsed,q=this._pmtId,X=R.length;if(this.remainderData&&(X=(R=Object(M.appendUint8Array)(this.remainderData,R)).length,this.remainderData=null),X<188&&!_)return this.remainderData=R,{"audioTrack":w,"avcTrack":x,"id3Track":P,"textTrack":this._txtTrack};var z=Math.max(0,e.syncOffset(R));(X-=(X+z)%188)<R.byteLength&&!_&&(this.remainderData=new Uint8Array(R.buffer,X,R.buffer.byteLength-X));for(var Q=0,J=z;J<X;J+=188)if(71===R[J]){var $=!!(64&R[J+1]),Z=((31&R[J+1])<<8)+R[J+2],ee=void 0;if((48&R[J+3])>>4>1){if((ee=J+5+R[J+4])===J+188)continue}else ee=J+4;switch(Z){case B:$&&(G&&(O=m(G))&&this.parseAVCPES(O,!1),G={"data":[],"size":0}),G&&(G.data.push(R.subarray(ee,J+188)),G.size+=J+188-ee);break;case j:$&&(H&&(O=m(H))&&(w.isAAC?this.parseAACPES(O):this.parseMPEGPES(O)),H={"data":[],"size":0}),H&&(H.data.push(R.subarray(ee,J+188)),H.size+=J+188-ee);break;case K:$&&(V&&(O=m(V))&&this.parseID3PES(O),V={"data":[],"size":0}),V&&(V.data.push(R.subarray(ee,J+188)),V.size+=J+188-ee);break;case 0:$&&(ee+=R[ee]+1),q=this._pmtId=g(R,ee);break;case q:$&&(ee+=R[ee]+1);var te=p(R,ee,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,I);(B=te.avc)>0&&(x.pid=B),(j=te.audio)>0&&(w.pid=j,w.isAAC=te.isAAC),(K=te.id3)>0&&(P.pid=K),W&&!Y&&(N.logger.log("reparse from beginning"),W=!1,J=z-188),Y=this.pmtParsed=!0;break;case 17:case 8191:break;default:W=!0}}else Q++;Q>0&&this.observer.emit(F.Events.ERROR,F.Events.ERROR,{"type":U.ErrorTypes.MEDIA_ERROR,"details":U.ErrorDetails.FRAG_PARSING_ERROR,"fatal":!1,"reason":"Found "+Q+" TS packet/s that do not start with 0x47"}),x.pesData=G,w.pesData=H,P.pesData=V;var re={"audioTrack":w,"avcTrack":x,"id3Track":P,"textTrack":this._txtTrack};return _&&this.extractRemainingSamples(re),re},R.flush=function e(){var R,C=this.remainderData;return this.remainderData=null,R=C?this.demux(C,-1,!1,!0):{"audioTrack":this._audioTrack,"avcTrack":this._avcTrack,"textTrack":this._txtTrack,"id3Track":this._id3Track},this.extractRemainingSamples(R),this.sampleAes?this.decrypt(R,this.sampleAes):R},R.extractRemainingSamples=function e(R){var C,I=R.audioTrack,_=R.avcTrack,O=R.id3Track,x=_.pesData,w=I.pesData,P=O.pesData;x&&(C=m(x))?(this.parseAVCPES(C,!0),_.pesData=null):_.pesData=x,w&&(C=m(w))?(I.isAAC?this.parseAACPES(C):this.parseMPEGPES(C),I.pesData=null):(null!=w&&w.size&&N.logger.log("last AAC PES packet truncated,might overlap between fragments"),I.pesData=w),P&&(C=m(P))?(this.parseID3PES(C),O.pesData=null):O.pesData=P},R.demuxSampleAes=function e(R,C,I){var _=this.demux(R,I,!0,!this.config.progressive),O=this.sampleAes=new P.default(this.observer,this.config,C);return this.decrypt(_,O)},R.decrypt=function e(R,C){return new Promise((function(I){var _=R.audioTrack,O=R.avcTrack;_.samples&&_.isAAC?C.decryptAacSamples(_.samples,0,(function(){O.samples?C.decryptAvcSamples(O.samples,0,0,(function(){I(R)})):I(R)})):O.samples&&C.decryptAvcSamples(O.samples,0,0,(function(){I(R)}))}))},R.destroy=function e(){this._initPTS=this._initDTS=null,this._duration=0},R.parseAVCPES=function e(R,C){var I,_=this,O=this._avcTrack,P=this.parseAVCNALu(R.data),F=this.avcSample,M=!1;R.data=null,F&&P.length&&!O.audFound&&(y(F,O),F=this.avcSample=v(!1,R.pts,R.dts,"")),P.forEach((function(C){switch(C.type){case 1:I=!0,F||(F=_.avcSample=v(!0,R.pts,R.dts,"")),F.frame=!0;var P=C.data;if(M&&P.length>4){var N=new x.default(P).readSliceType();2!==N&&4!==N&&7!==N&&9!==N||(F.key=!0)}break;case 5:I=!0,F||(F=_.avcSample=v(!0,R.pts,R.dts,"")),F.key=!0,F.frame=!0;break;case 6:I=!0;var U=new x.default(T(C.data));U.readUByte();for(var B=0,G=0,j=!1,K=0;!j&&U.bytesAvailable>1;){B=0;do{B+=K=U.readUByte()}while(255===K);G=0;do{G+=K=U.readUByte()}while(255===K);if(4===B&&0!==U.bytesAvailable){if(j=!0,181===U.readUByte())if(49===U.readUShort())if(1195456820===U.readUInt())if(3===U.readUByte()){for(var H=U.readUByte(),V=31&H,W=[H,U.readUByte()],Y=0;Y<V;Y++)W.push(U.readUByte()),W.push(U.readUByte()),W.push(U.readUByte());E(_._txtTrack.samples,{"type":3,"pts":R.pts,"bytes":W})}}else if(5===B&&0!==U.bytesAvailable){if(j=!0,G>16){for(var q=[],X=0;X<16;X++)q.push(U.readUByte().toString(16)),3!==X&&5!==X&&7!==X&&9!==X||q.push("-");for(var z=G-16,Q=new Uint8Array(z),J=0;J<z;J++)Q[J]=U.readUByte();E(_._txtTrack.samples,{"pts":R.pts,"payloadType":B,"uuid":q.join(""),"userData":Object(w.utf8ArrayToStr)(Q),"userDataBytes":Q})}}else if(G<U.bytesAvailable)for(var $=0;$<G;$++)U.readUByte()}break;case 7:if(I=!0,M=!0,!O.sps){var Z=new x.default(C.data).readSPS();O.width=Z.width,O.height=Z.height,O.pixelRatio=Z.pixelRatio,O.sps=[C.data],O.duration=_._duration;for(var ee=C.data.subarray(1,4),te="avc1.",re=0;re<3;re++){var ie=ee[re].toString(16);ie.length<2&&(ie="0"+ie),te+=ie}O.codec=te}break;case 8:I=!0,O.pps||(O.pps=[C.data]);break;case 9:I=!1,O.audFound=!0,F&&y(F,O),F=_.avcSample=v(!1,R.pts,R.dts,"");break;case 12:I=!1;break;default:I=!1,F&&(F.debug+="unknown NAL "+C.type+" ")}F&&I&&F.units.push(C)})),C&&F&&(y(F,O),this.avcSample=null)},R.getLastNalUnit=function e(){var R,C,I=this.avcSample;if(!I||0===I.units.length){var _=this._avcTrack.samples;I=_[_.length-1]}if(null!==(R=I)&&void 0!==R&&R.units){var O=I.units;C=O[O.length-1]}return C},R.parseAVCNALu=function e(R){var C,I,_=R.byteLength,O=this._avcTrack,x=O.naluState||0,w=x,P=[],F=0,M=-1,N=0;for(-1===x&&(M=0,N=31&R[0],x=0,F=1);F<_;)if(C=R[F++],x)if(1!==x)if(C)if(1===C){if(M>=0){var U={"data":R.subarray(M,F-x-1),"type":N};P.push(U)}else{var B=this.getLastNalUnit();if(B&&(w&&F<=4-w&&B.state&&(B.data=B.data.subarray(0,B.data.byteLength-w)),(I=F-x-1)>0)){var G=new Uint8Array(B.data.byteLength+I);G.set(B.data,0),G.set(R.subarray(0,I),B.data.byteLength),B.data=G,B.state=0}}F<_?(M=F,N=31&R[F],x=0):x=-1}else x=0;else x=3;else x=C?0:2;else x=C?0:1;if(M>=0&&x>=0){var j={"data":R.subarray(M,_),"type":N,"state":x};P.push(j)}if(0===P.length){var K=this.getLastNalUnit();if(K){var H=new Uint8Array(K.data.byteLength+R.byteLength);H.set(K.data,0),H.set(R,K.data.byteLength),K.data=H}}return O.naluState=x,P},R.parseAACPES=function e(R){var C,I,O,x,w,P=0,M=this._audioTrack,B=this.aacOverFlow,G=R.data;if(B){this.aacOverFlow=null;var j=B.sample.unit.byteLength,K=Math.min(B.missing,j),H=j-K;B.sample.unit.set(G.subarray(0,K),H),M.samples.push(B.sample),P=B.missing}for(C=P,I=G.length;C<I-1&&!_.isHeader(G,C);C++);if(C!==P&&(C<I-1?(O="AAC PES did not start with ADTS header,offset:"+C,x=!1):(O="no ADTS header found in AAC PES",x=!0),N.logger.warn("parsing error:"+O),this.observer.emit(F.Events.ERROR,F.Events.ERROR,{"type":U.ErrorTypes.MEDIA_ERROR,"details":U.ErrorDetails.FRAG_PARSING_ERROR,"fatal":x,"reason":O}),x))return;if(_.initTrackConfig(M,this.observer,G,C,this.audioCodec),void 0!==R.pts)w=R.pts;else{if(!B)return void N.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var V=_.getFrameDuration(M.samplerate);w=B.sample.pts+V}for(var W=0;C<I;){if(_.isHeader(G,C)){if(C+5<I){var Y=_.appendFrame(M,G,C,w,W);if(Y){if(!Y.missing){C+=Y.length,W++;continue}this.aacOverFlow=Y}}break}C++}},R.parseMPEGPES=function e(R){var C=R.data,I=C.length,_=0,x=0,w=R.pts;if(void 0!==w)for(;x<I;)if(O.isHeader(C,x)){var P=O.appendFrame(this._audioTrack,C,x,w,_);if(!P)break;x+=P.length,_++}else x++;else N.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},R.parseID3PES=function e(R){void 0!==R.pts?this._id3Track.samples.push(R):N.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function v(R,C,I,_){return{"key":R,"frame":!1,"pts":C,"dts":I,"units":[],"debug":_,"length":0}}function g(R,C){return(31&R[C+10])<<8|R[C+11]}function p(R,C,I,_){var O={"audio":-1,"avc":-1,"id3":-1,"isAAC":!0},x=C+3+((15&R[C+1])<<8|R[C+2])-4;for(C+=12+((15&R[C+10])<<8|R[C+11]);C<x;){var w=(31&R[C+1])<<8|R[C+2];switch(R[C]){case 207:if(!_){N.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===O.audio&&(O.audio=w);break;case 21:-1===O.id3&&(O.id3=w);break;case 219:if(!_){N.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===O.avc&&(O.avc=w);break;case 3:case 4:I?-1===O.audio&&(O.audio=w,O.isAAC=!1):N.logger.log("MPEG audio found, not supported in this browser");break;case 36:N.logger.warn("Unsupported HEVC stream type found")}C+=5+((15&R[C+3])<<8|R[C+4])}return O}function m(R){var C,I,_,O,x,w=0,P=R.data;if(!R||0===R.size)return null;for(;P[0].length<19&&P.length>1;){var F=new Uint8Array(P[0].length+P[1].length);F.set(P[0]),F.set(P[1],P[0].length),P[0]=F,P.splice(1,1)}if(1===((C=P[0])[0]<<16)+(C[1]<<8)+C[2]){if((I=(C[4]<<8)+C[5])&&I>R.size-6)return null;var M=C[7];192&M&&(O=536870912*(14&C[9])+4194304*(255&C[10])+16384*(254&C[11])+128*(255&C[12])+(254&C[13])/2,64&M?O-(x=536870912*(14&C[14])+4194304*(255&C[15])+16384*(254&C[16])+128*(255&C[17])+(254&C[18])/2)>54e5&&(N.logger.warn(Math.round((O-x)/9e4)+"s delta between PTS and DTS, align them"),O=x):x=O);var U=(_=C[8])+9;if(R.size<=U)return null;R.size-=U;for(var B=new Uint8Array(R.size),G=0,j=P.length;G<j;G++){var K=(C=P[G]).byteLength;if(U){if(U>K){U-=K;continue}C=C.subarray(U),K-=U,U=0}B.set(C,w),w+=K}return I&&(I-=_+3),{"data":B,"pts":O,"dts":x,"len":I}}return null}function y(R,C){if(R.units.length&&R.frame){if(void 0===R.pts){var I=C.samples,_=I.length;if(!_)return void C.dropped++;var O=I[_-1];R.pts=O.pts,R.dts=O.dts}C.samples.push(R)}R.debug.length&&N.logger.log(R.pts+"/"+R.dts+":"+R.debug)}function E(R,C){var I=R.length;if(I>0){if(C.pts>=R[I-1].pts)R.push(C);else for(var _=I-1;_>=0;_--)if(C.pts<R[_].pts){R.splice(_,0,C);break}}else R.push(C)}function T(R){for(var C=R.byteLength,I=[],_=1;_<C-2;)0===R[_]&&0===R[_+1]&&3===R[_+2]?(I.push(_+2),_+=2):_++;if(0===I.length)return R;var O=C-I.length,x=new Uint8Array(O),w=0;for(_=0;_<O;w++,_++)w===I[0]&&(w++,I.shift()),x[_]=R[w];return x}G.minProbeByteLength=188,C.default=G},"./src/errors.ts":function srcErrorsTs(R,C,I){var _,O;I.r(C),I.d(C,"ErrorTypes",(function(){return _})),I.d(C,"ErrorDetails",(function(){return O})),function(R){R.NETWORK_ERROR="networkError",R.MEDIA_ERROR="mediaError",R.KEY_SYSTEM_ERROR="keySystemError",R.MUX_ERROR="muxError",R.OTHER_ERROR="otherError"}(_||(_={})),function(R){R.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",R.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",R.KEY_SYSTEM_NO_SESSION="keySystemNoSession",R.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",R.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",R.MANIFEST_LOAD_ERROR="manifestLoadError",R.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",R.MANIFEST_PARSING_ERROR="manifestParsingError",R.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",R.LEVEL_EMPTY_ERROR="levelEmptyError",R.LEVEL_LOAD_ERROR="levelLoadError",R.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",R.LEVEL_SWITCH_ERROR="levelSwitchError",R.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",R.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",R.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",R.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",R.FRAG_LOAD_ERROR="fragLoadError",R.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",R.FRAG_DECRYPT_ERROR="fragDecryptError",R.FRAG_PARSING_ERROR="fragParsingError",R.REMUX_ALLOC_ERROR="remuxAllocError",R.KEY_LOAD_ERROR="keyLoadError",R.KEY_LOAD_TIMEOUT="keyLoadTimeOut",R.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",R.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",R.BUFFER_APPEND_ERROR="bufferAppendError",R.BUFFER_APPENDING_ERROR="bufferAppendingError",R.BUFFER_STALLED_ERROR="bufferStalledError",R.BUFFER_FULL_ERROR="bufferFullError",R.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",R.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",R.INTERNAL_EXCEPTION="internalException",R.INTERNAL_ABORTED="aborted",R.UNKNOWN="unknown"}(O||(O={}))},"./src/events.ts":function srcEventsTs(R,C,I){var _;I.r(C),I.d(C,"Events",(function(){return _})),function(R){R.MEDIA_ATTACHING="hlsMediaAttaching",R.MEDIA_ATTACHED="hlsMediaAttached",R.MEDIA_DETACHING="hlsMediaDetaching",R.MEDIA_DETACHED="hlsMediaDetached",R.BUFFER_RESET="hlsBufferReset",R.BUFFER_CODECS="hlsBufferCodecs",R.BUFFER_CREATED="hlsBufferCreated",R.BUFFER_APPENDING="hlsBufferAppending",R.BUFFER_APPENDED="hlsBufferAppended",R.BUFFER_EOS="hlsBufferEos",R.BUFFER_FLUSHING="hlsBufferFlushing",R.BUFFER_FLUSHED="hlsBufferFlushed",R.MANIFEST_LOADING="hlsManifestLoading",R.MANIFEST_LOADED="hlsManifestLoaded",R.MANIFEST_PARSED="hlsManifestParsed",R.LEVEL_SWITCHING="hlsLevelSwitching",R.LEVEL_SWITCHED="hlsLevelSwitched",R.LEVEL_LOADING="hlsLevelLoading",R.LEVEL_LOADED="hlsLevelLoaded",R.LEVEL_UPDATED="hlsLevelUpdated",R.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",R.LEVELS_UPDATED="hlsLevelsUpdated",R.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",R.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",R.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",R.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",R.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",R.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",R.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",R.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",R.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",R.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",R.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",R.CUES_PARSED="hlsCuesParsed",R.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",R.INIT_PTS_FOUND="hlsInitPtsFound",R.FRAG_LOADING="hlsFragLoading",R.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",R.FRAG_LOADED="hlsFragLoaded",R.FRAG_DECRYPTED="hlsFragDecrypted",R.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",R.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",R.FRAG_PARSING_METADATA="hlsFragParsingMetadata",R.FRAG_PARSED="hlsFragParsed",R.FRAG_BUFFERED="hlsFragBuffered",R.FRAG_CHANGED="hlsFragChanged",R.FPS_DROP="hlsFpsDrop",R.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",R.ERROR="hlsError",R.DESTROYING="hlsDestroying",R.KEY_LOADING="hlsKeyLoading",R.KEY_LOADED="hlsKeyLoaded",R.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",R.BACK_BUFFER_REACHED="hlsBackBufferReached"}(_||(_={}))},"./src/hls.ts":function srcHlsTs(R,C,I){I.r(C),I.d(C,"default",(function(){return V}));var _=I("./node_modules/url-toolkit/src/url-toolkit.js"),O=I("./src/loader/playlist-loader.ts"),x=I("./src/loader/key-loader.ts"),w=I("./src/controller/id3-track-controller.ts"),P=I("./src/controller/latency-controller.ts"),F=I("./src/controller/level-controller.ts"),M=I("./src/controller/fragment-tracker.ts"),N=I("./src/controller/stream-controller.ts"),U=I("./src/is-supported.ts"),B=I("./src/utils/logger.ts"),G=I("./src/config.ts"),j=I("./node_modules/eventemitter3/index.js"),K=I("./src/events.ts"),H=I("./src/errors.ts");function m(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}var V=function(){function e(R){void 0===R&&(R={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new j.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var C=this.config=Object(G.mergeConfig)(e.DefaultConfig,R);this.userConfig=R,Object(B.enableLogs)(C.debug),this._autoLevelCapping=-1,C.progressive&&Object(G.enableStreamingMode)(C);var I=C.abrController,_=C.bufferController,U=C.capLevelController,K=C.fpsController,H=this.abrController=new I(this),V=this.bufferController=new _(this),W=this.capLevelController=new U(this),Y=new K(this),q=new O.default(this),X=new x.default(this),z=new w.default(this),Q=this.levelController=new F.default(this),J=new M.FragmentTracker(this),$=this.streamController=new N.default(this,J);W.setStreamController($),Y.setStreamController($);var Z=[Q,$];this.networkControllers=Z;var ee=[q,X,H,V,W,Y,z,J];this.audioTrackController=this.createController(C.audioTrackController,null,Z),this.createController(C.audioStreamController,J,Z),this.subtitleTrackController=this.createController(C.subtitleTrackController,null,Z),this.createController(C.subtitleStreamController,J,Z),this.createController(C.timelineController,null,ee),this.emeController=this.createController(C.emeController,null,ee),this.cmcdController=this.createController(C.cmcdController,null,ee),this.latencyController=this.createController(P.default,null,ee),this.coreComponents=ee}e.isSupported=function e(){return Object(U.isSupported)()};var R=e.prototype;return R.createController=function e(R,C,I){if(R){var _=C?new R(this,C):new R(this);return I&&I.push(_),_}return null},R.on=function e(R,C,I){void 0===I&&(I=this),this._emitter.on(R,C,I)},R.once=function e(R,C,I){void 0===I&&(I=this),this._emitter.once(R,C,I)},R.removeAllListeners=function e(R){this._emitter.removeAllListeners(R)},R.off=function e(R,C,I,_){void 0===I&&(I=this),this._emitter.off(R,C,I,_)},R.listeners=function e(R){return this._emitter.listeners(R)},R.emit=function e(R,C,I){return this._emitter.emit(R,C,I)},R.trigger=function e(R,C){if(this.config.debug)return this.emit(R,R,C);try{return this.emit(R,R,C)}catch(e){B.logger.error("An internal error happened while handling event "+R+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.trigger(K.Events.ERROR,{"type":H.ErrorTypes.OTHER_ERROR,"details":H.ErrorDetails.INTERNAL_EXCEPTION,"fatal":!1,"event":R,"error":e})}return!1},R.listenerCount=function e(R){return this._emitter.listenerCount(R)},R.destroy=function e(){B.logger.log("destroy"),this.trigger(K.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(R){return R.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(R){return R.destroy()})),this.coreComponents.length=0},R.attachMedia=function e(R){B.logger.log("attachMedia"),this._media=R,this.trigger(K.Events.MEDIA_ATTACHING,{"media":R})},R.detachMedia=function e(){B.logger.log("detachMedia"),this.trigger(K.Events.MEDIA_DETACHING,void 0),this._media=null},R.loadSource=function e(R){this.stopLoad();var C=this.media,I=this.url,O=this.url=_.buildAbsoluteURL(self.location.href,R,{"alwaysNormalize":!0});B.logger.log("loadSource:"+O),C&&I&&I!==O&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(C)),this.trigger(K.Events.MANIFEST_LOADING,{"url":R})},R.startLoad=function e(R){void 0===R&&(R=-1),B.logger.log("startLoad("+R+")"),this.networkControllers.forEach((function(C){C.startLoad(R)}))},R.stopLoad=function e(){B.logger.log("stopLoad"),this.networkControllers.forEach((function(R){R.stopLoad()}))},R.swapAudioCodec=function e(){B.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},R.recoverMediaError=function e(){B.logger.log("recoverMediaError");var R=this._media;this.detachMedia(),R&&this.attachMedia(R)},R.removeLevel=function e(R,C){void 0===C&&(C=0),this.levelController.removeLevel(R,C)},function y(R,C,I){return C&&m(R.prototype,C),I&&m(R,I),R}(e,[{"key":"levels","get":function e(){var R=this.levelController.levels;return R||[]}},{"key":"currentLevel","get":function e(){return this.streamController.currentLevel},"set":function e(R){B.logger.log("set currentLevel:"+R),this.loadLevel=R,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{"key":"nextLevel","get":function e(){return this.streamController.nextLevel},"set":function e(R){B.logger.log("set nextLevel:"+R),this.levelController.manualLevel=R,this.streamController.nextLevelSwitch()}},{"key":"loadLevel","get":function e(){return this.levelController.level},"set":function e(R){B.logger.log("set loadLevel:"+R),this.levelController.manualLevel=R}},{"key":"nextLoadLevel","get":function e(){return this.levelController.nextLoadLevel},"set":function e(R){this.levelController.nextLoadLevel=R}},{"key":"firstLevel","get":function e(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},"set":function e(R){B.logger.log("set firstLevel:"+R),this.levelController.firstLevel=R}},{"key":"startLevel","get":function e(){return this.levelController.startLevel},"set":function e(R){B.logger.log("set startLevel:"+R),-1!==R&&(R=Math.max(R,this.minAutoLevel)),this.levelController.startLevel=R}},{"key":"capLevelToPlayerSize","get":function e(){return this.config.capLevelToPlayerSize},"set":function e(R){var C=!!R;C!==this.config.capLevelToPlayerSize&&(C?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=C)}},{"key":"autoLevelCapping","get":function e(){return this._autoLevelCapping},"set":function e(R){this._autoLevelCapping!==R&&(B.logger.log("set autoLevelCapping:"+R),this._autoLevelCapping=R)}},{"key":"bandwidthEstimate","get":function e(){var R=this.abrController.bwEstimator;return R?R.getEstimate():NaN}},{"key":"autoLevelEnabled","get":function e(){return-1===this.levelController.manualLevel}},{"key":"manualLevel","get":function e(){return this.levelController.manualLevel}},{"key":"minAutoLevel","get":function e(){var R=this.levels,C=this.config.minAutoBitrate;if(!R)return 0;for(var I=R.length,_=0;_<I;_++)if(R[_].maxBitrate>C)return _;return 0}},{"key":"maxAutoLevel","get":function e(){var R=this.levels,C=this.autoLevelCapping;return-1===C&&R&&R.length?R.length-1:C}},{"key":"nextAutoLevel","get":function e(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},"set":function e(R){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,R)}},{"key":"audioTracks","get":function e(){var R=this.audioTrackController;return R?R.audioTracks:[]}},{"key":"audioTrack","get":function e(){var R=this.audioTrackController;return R?R.audioTrack:-1},"set":function e(R){var C=this.audioTrackController;C&&(C.audioTrack=R)}},{"key":"subtitleTracks","get":function e(){var R=this.subtitleTrackController;return R?R.subtitleTracks:[]}},{"key":"subtitleTrack","get":function e(){var R=this.subtitleTrackController;return R?R.subtitleTrack:-1},"set":function e(R){var C=this.subtitleTrackController;C&&(C.subtitleTrack=R)}},{"key":"media","get":function e(){return this._media}},{"key":"subtitleDisplay","get":function e(){var R=this.subtitleTrackController;return!!R&&R.subtitleDisplay},"set":function e(R){var C=this.subtitleTrackController;C&&(C.subtitleDisplay=R)}},{"key":"lowLatencyMode","get":function e(){return this.config.lowLatencyMode},"set":function e(R){this.config.lowLatencyMode=R}},{"key":"liveSyncPosition","get":function e(){return this.latencyController.liveSyncPosition}},{"key":"latency","get":function e(){return this.latencyController.latency}},{"key":"maxLatency","get":function e(){return this.latencyController.maxLatency}},{"key":"targetLatency","get":function e(){return this.latencyController.targetLatency}},{"key":"drift","get":function e(){return this.latencyController.drift}},{"key":"forceStartLoad","get":function e(){return this.streamController.forceStartLoad}}],[{"key":"version","get":function e(){return"1.1.5"}},{"key":"Events","get":function e(){return K.Events}},{"key":"ErrorTypes","get":function e(){return H.ErrorTypes}},{"key":"ErrorDetails","get":function e(){return H.ErrorDetails}},{"key":"DefaultConfig","get":function t(){return e.defaultConfig?e.defaultConfig:G.hlsDefaultConfig},"set":function t(R){e.defaultConfig=R}}]),e}();V.defaultConfig=void 0},"./src/is-supported.ts":function srcIsSupportedTs(R,C,I){I.r(C),I.d(C,"isSupported",(function(){return n})),I.d(C,"changeTypeSupported",(function(){return s}));var _=I("./src/utils/mediasource-helper.ts");function a(){return self.SourceBuffer||self.WebKitSourceBuffer}function n(){var R=Object(_.getMediaSource)();if(!R)return!1;var C=a(),I=R&&"function"==typeof R.isTypeSupported&&R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),O=!C||C.prototype&&"function"==typeof C.prototype.appendBuffer&&"function"==typeof C.prototype.remove;return!!I&&!!O}function s(){var R,C=a();return"function"==typeof(null==C||null===(R=C.prototype)||void 0===R?void 0:R.changeType)}},"./src/loader/fragment-loader.ts":function srcLoaderFragmentLoaderTs(R,C,I){I.r(C),I.d(C,"default",(function(){return w})),I.d(C,"LoadError",(function(){return P}));var _=I("./src/polyfills/number.ts"),O=I("./src/errors.ts");function s(R){var C="function"==typeof Map?new Map:void 0;return s=function e(R){if(null===R||!function u(R){return-1!==Function.toString.call(R).indexOf("[native code]")}(R))return R;if("function"!=typeof R)throw new TypeError("Super expression must either be null or a function");if(void 0!==C){if(C.has(R))return C.get(R);C.set(R,i)}function i(){return o(R,arguments,d(this).constructor)}return i.prototype=Object.create(R.prototype,{"constructor":{"value":i,"enumerable":!1,"writable":!0,"configurable":!0}}),f(i,R)},s(R)}function o(R,C,I){return o=function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(R){return!1}}()?Reflect.construct:function e(R,C,I){var _=[null];_.push.apply(_,C);var O=new(Function.bind.apply(R,_));return I&&f(O,I.prototype),O},o.apply(null,arguments)}function f(R,C){return f=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},f(R,C)}function d(R){return d=Object.setPrototypeOf?Object.getPrototypeOf:function e(R){return R.__proto__||Object.getPrototypeOf(R)},d(R)}var x=Math.pow(2,17),w=function(){function e(R){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=R}var R=e.prototype;return R.destroy=function e(){this.loader&&(this.loader.destroy(),this.loader=null)},R.abort=function e(){this.loader&&this.loader.abort()},R.load=function e(R,C){var I=this,_=R.url;if(!_)return Promise.reject(new P({"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.FRAG_LOAD_ERROR,"fatal":!1,"frag":R,"networkDetails":null},"Fragment does not have a "+(_?"part list":"url")));this.abort();var w=this.config,F=w.fLoader,M=w.loader;return new Promise((function(_,N){I.loader&&I.loader.destroy();var U=I.loader=R.loader=F?new F(w):new M(w),B=v(R),G={"timeout":w.fragLoadingTimeOut,"maxRetry":0,"retryDelay":0,"maxRetryDelay":w.fragLoadingMaxRetryTimeout,"highWaterMark":x};R.stats=U.stats,U.load(B,G,{"onSuccess":function r(C,O,x,w){I.resetLoader(R,U),_({"frag":R,"part":null,"payload":C.data,"networkDetails":w})},"onError":function e(C,_,x){I.resetLoader(R,U),N(new P({"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.FRAG_LOAD_ERROR,"fatal":!1,"frag":R,"response":C,"networkDetails":x}))},"onAbort":function e(C,_,x){I.resetLoader(R,U),N(new P({"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.INTERNAL_ABORTED,"fatal":!1,"frag":R,"networkDetails":x}))},"onTimeout":function e(C,_,x){I.resetLoader(R,U),N(new P({"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.FRAG_LOAD_TIMEOUT,"fatal":!1,"frag":R,"networkDetails":x}))},"onProgress":function e(I,_,O,x){C&&C({"frag":R,"part":null,"payload":O,"networkDetails":x})}})}))},R.loadPart=function e(R,C,I){var _=this;this.abort();var w=this.config,F=w.fLoader,M=w.loader;return new Promise((function(N,U){_.loader&&_.loader.destroy();var B=_.loader=R.loader=F?new F(w):new M(w),G=v(R,C),j={"timeout":w.fragLoadingTimeOut,"maxRetry":0,"retryDelay":0,"maxRetryDelay":w.fragLoadingMaxRetryTimeout,"highWaterMark":x};C.stats=B.stats,B.load(G,j,{"onSuccess":function a(O,x,w,P){_.resetLoader(R,B),_.updateStatsFromPart(R,C);var F={"frag":R,"part":C,"payload":O.data,"networkDetails":P};I(F),N(F)},"onError":function e(I,x,w){_.resetLoader(R,B),U(new P({"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.FRAG_LOAD_ERROR,"fatal":!1,"frag":R,"part":C,"response":I,"networkDetails":w}))},"onAbort":function e(I,x,w){R.stats.aborted=C.stats.aborted,_.resetLoader(R,B),U(new P({"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.INTERNAL_ABORTED,"fatal":!1,"frag":R,"part":C,"networkDetails":w}))},"onTimeout":function e(I,x,w){_.resetLoader(R,B),U(new P({"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.FRAG_LOAD_TIMEOUT,"fatal":!1,"frag":R,"part":C,"networkDetails":w}))}})}))},R.updateStatsFromPart=function e(R,C){var I=R.stats,_=C.stats,O=_.total;if(I.loaded+=_.loaded,O){var x=Math.round(R.duration/C.duration),w=Math.min(Math.round(I.loaded/O),x),P=(x-w)*Math.round(I.loaded/w);I.total=I.loaded+P}else I.total=Math.max(I.loaded,I.total);var F=I.loading,M=_.loading;F.start?F.first+=M.first-M.start:(F.start=M.start,F.first=M.first),F.end=M.end},R.resetLoader=function e(R,C){R.loader=null,this.loader===C&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),C.destroy()},e}();function v(R,C){void 0===C&&(C=null);var I=C||R,O={"frag":R,"part":C,"responseType":"arraybuffer","url":I.url,"headers":{},"rangeStart":0,"rangeEnd":0},x=I.byteRangeStartOffset,w=I.byteRangeEndOffset;return Object(_.isFiniteNumber)(x)&&Object(_.isFiniteNumber)(w)&&(O.rangeStart=x,O.rangeEnd=w),O}var P=function(R){function t(C){for(var I,_=arguments.length,O=new Array(_>1?_-1:0),x=1;x<_;x++)O[x-1]=arguments[x];return(I=R.call.apply(R,[this].concat(O))||this).data=void 0,I.data=C,I}return function n(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,f(R,C)}(t,R),t}(s(Error))},"./src/loader/fragment.ts":function srcLoaderFragmentTs(R,C,I){I.r(C),I.d(C,"ElementaryStreamTypes",(function(){return _})),I.d(C,"BaseSegment",(function(){return M})),I.d(C,"Fragment",(function(){return N})),I.d(C,"Part",(function(){return U}));var _,O=I("./src/polyfills/number.ts"),x=I("./node_modules/url-toolkit/src/url-toolkit.js"),w=I("./src/utils/logger.ts"),P=I("./src/loader/level-key.ts"),F=I("./src/loader/load-stats.ts");function l(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,u(R,C)}function u(R,C){return u=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},u(R,C)}function f(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}function d(R,C,I){return C&&f(R.prototype,C),I&&f(R,I),R}!function(R){R.AUDIO="audio",R.VIDEO="video",R.AUDIOVIDEO="audiovideo"}(_||(_={}));var M=function(){function e(R){var C;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((C={})[_.AUDIO]=null,C[_.VIDEO]=null,C[_.AUDIOVIDEO]=null,C),this.baseurl=R}return e.prototype.setByteRange=function e(R,C){var I=R.split("@",2),_=[];1===I.length?_[0]=C?C.byteRangeEndOffset:0:_[0]=parseInt(I[1]),_[1]=parseInt(I[0])+_[0],this._byteRange=_},d(e,[{"key":"byteRange","get":function e(){return this._byteRange?this._byteRange:[]}},{"key":"byteRangeStartOffset","get":function e(){return this.byteRange[0]}},{"key":"byteRangeEndOffset","get":function e(){return this.byteRange[1]}},{"key":"url","get":function e(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(x.buildAbsoluteURL)(this.baseurl,this.relurl,{"alwaysNormalize":!0})),this._url||""},"set":function e(R){this._url=R}}]),e}(),N=function(R){function t(C,I){var _;return(_=R.call(this,I)||this)._decryptdata=null,_.rawProgramDateTime=null,_.programDateTime=null,_.tagList=[],_.duration=0,_.sn=0,_.levelkey=void 0,_.type=void 0,_.loader=null,_.level=-1,_.cc=0,_.startPTS=void 0,_.endPTS=void 0,_.appendedPTS=void 0,_.startDTS=void 0,_.endDTS=void 0,_.start=0,_.deltaPTS=void 0,_.maxStartPTS=void 0,_.minEndPTS=void 0,_.stats=new F.LoadStats,_.urlId=0,_.data=void 0,_.bitrateTest=!1,_.title=null,_.initSegment=null,_.type=C,_}l(t,R);var C=t.prototype;return C.createInitializationVector=function e(R){for(var C=new Uint8Array(16),I=12;I<16;I++)C[I]=R>>8*(15-I)&255;return C},C.setDecryptDataFromLevelKey=function e(R,C){var I=R;return"AES-128"===(null==R?void 0:R.method)&&R.uri&&!R.iv&&((I=P.LevelKey.fromURI(R.uri)).method=R.method,I.iv=this.createInitializationVector(C),I.keyFormat="identity"),I},C.setElementaryStreamInfo=function e(R,C,I,_,O,x){void 0===x&&(x=!1);var w=this.elementaryStreams,P=w[R];P?(P.startPTS=Math.min(P.startPTS,C),P.endPTS=Math.max(P.endPTS,I),P.startDTS=Math.min(P.startDTS,_),P.endDTS=Math.max(P.endDTS,O)):w[R]={"startPTS":C,"endPTS":I,"startDTS":_,"endDTS":O,"partial":x}},C.clearElementaryStreamInfo=function e(){var R=this.elementaryStreams;R[_.AUDIO]=null,R[_.VIDEO]=null,R[_.AUDIOVIDEO]=null},d(t,[{"key":"decryptdata","get":function e(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var R=this.sn;"number"!=typeof R&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&w.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),R=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,R)}return this._decryptdata}},{"key":"end","get":function e(){return this.start+this.duration}},{"key":"endProgramDateTime","get":function e(){if(null===this.programDateTime)return null;if(!Object(O.isFiniteNumber)(this.programDateTime))return null;var R=Object(O.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*R}},{"key":"encrypted","get":function e(){var R;return!(null===(R=this.decryptdata)||void 0===R||!R.keyFormat||!this.decryptdata.uri)}}]),t}(M),U=function(R){function t(C,I,_,O,x){var w;(w=R.call(this,_)||this).fragOffset=0,w.duration=0,w.gap=!1,w.independent=!1,w.relurl=void 0,w.fragment=void 0,w.index=void 0,w.stats=new F.LoadStats,w.duration=C.decimalFloatingPoint("DURATION"),w.gap=C.bool("GAP"),w.independent=C.bool("INDEPENDENT"),w.relurl=C.enumeratedString("URI"),w.fragment=I,w.index=O;var P=C.enumeratedString("BYTERANGE");return P&&w.setByteRange(P,x),x&&(w.fragOffset=x.fragOffset+x.duration),w}return l(t,R),d(t,[{"key":"start","get":function e(){return this.fragment.start+this.fragOffset}},{"key":"end","get":function e(){return this.start+this.duration}},{"key":"loaded","get":function e(){var R=this.elementaryStreams;return!!(R.audio||R.video||R.audiovideo)}}]),t}(M)},"./src/loader/key-loader.ts":function srcLoaderKeyLoaderTs(R,C,I){I.r(C),I.d(C,"default",(function(){return w}));var _=I("./src/events.ts"),O=I("./src/errors.ts"),x=I("./src/utils/logger.ts"),w=function(){function e(R){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=R,this._registerListeners()}var R=e.prototype;return R._registerListeners=function e(){this.hls.on(_.Events.KEY_LOADING,this.onKeyLoading,this)},R._unregisterListeners=function e(){this.hls.off(_.Events.KEY_LOADING,this.onKeyLoading)},R.destroy=function e(){for(var R in this._unregisterListeners(),this.loaders){var C=this.loaders[R];C&&C.destroy()}this.loaders={}},R.onKeyLoading=function e(R,C){var I=C.frag,O=I.type,w=this.loaders[O];if(I.decryptdata){var P=I.decryptdata.uri;if(P!==this.decrypturl||null===this.decryptkey){var F=this.hls.config;if(w&&(x.logger.warn("abort previous key loader for type:"+O),w.abort()),!P)return void x.logger.warn("key uri is falsy");var M=F.loader,N=I.loader=this.loaders[O]=new M(F);this.decrypturl=P,this.decryptkey=null;var U={"url":P,"frag":I,"responseType":"arraybuffer"},B={"timeout":F.fragLoadingTimeOut,"maxRetry":0,"retryDelay":F.fragLoadingRetryDelay,"maxRetryDelay":F.fragLoadingMaxRetryTimeout,"highWaterMark":0},G={"onSuccess":this.loadsuccess.bind(this),"onError":this.loaderror.bind(this),"onTimeout":this.loadtimeout.bind(this)};N.load(U,B,G)}else this.decryptkey&&(I.decryptdata.key=this.decryptkey,this.hls.trigger(_.Events.KEY_LOADED,{"frag":I}))}else x.logger.warn("Missing decryption data on fragment in onKeyLoading")},R.loadsuccess=function e(R,C,I){var O=I.frag;O.decryptdata?(this.decryptkey=O.decryptdata.key=new Uint8Array(R.data),O.loader=null,delete this.loaders[O.type],this.hls.trigger(_.Events.KEY_LOADED,{"frag":O})):x.logger.error("after key load, decryptdata unset")},R.loaderror=function e(R,C){var I=C.frag,x=I.loader;x&&x.abort(),delete this.loaders[I.type],this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.KEY_LOAD_ERROR,"fatal":!1,"frag":I,"response":R})},R.loadtimeout=function e(R,C){var I=C.frag,x=I.loader;x&&x.abort(),delete this.loaders[I.type],this.hls.trigger(_.Events.ERROR,{"type":O.ErrorTypes.NETWORK_ERROR,"details":O.ErrorDetails.KEY_LOAD_TIMEOUT,"fatal":!1,"frag":I})},e}()},"./src/loader/level-details.ts":function srcLoaderLevelDetailsTs(R,C,I){I.r(C),I.d(C,"LevelDetails",(function(){return O}));var _=I("./src/polyfills/number.ts");function a(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}var O=function(){function e(R){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=R}return e.prototype.reloaded=function e(R){if(!R)return this.advanced=!0,void(this.updated=!0);var C=this.lastPartSn-R.lastPartSn,I=this.lastPartIndex-R.lastPartIndex;this.updated=this.endSN!==R.endSN||!!I||!!C,this.advanced=this.endSN>R.endSN||C>0||0===C&&I>0,this.updated||this.advanced?this.misses=Math.floor(.6*R.misses):this.misses=R.misses+1,this.availabilityDelay=R.availabilityDelay},function n(R,C,I){return C&&a(R.prototype,C),I&&a(R,I),R}(e,[{"key":"hasProgramDateTime","get":function e(){return!!this.fragments.length&&Object(_.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{"key":"levelTargetDuration","get":function e(){return this.averagetargetduration||this.targetduration||10}},{"key":"drift","get":function e(){var R=this.driftEndTime-this.driftStartTime;return R>0?1e3*(this.driftEnd-this.driftStart)/R:1}},{"key":"edge","get":function e(){return this.partEnd||this.fragmentEnd}},{"key":"partEnd","get":function e(){var R;return null!==(R=this.partList)&&void 0!==R&&R.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{"key":"fragmentEnd","get":function e(){var R;return null!==(R=this.fragments)&&void 0!==R&&R.length?this.fragments[this.fragments.length-1].end:0}},{"key":"age","get":function e(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{"key":"lastPartIndex","get":function e(){var R;return null!==(R=this.partList)&&void 0!==R&&R.length?this.partList[this.partList.length-1].index:-1}},{"key":"lastPartSn","get":function e(){var R;return null!==(R=this.partList)&&void 0!==R&&R.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}()},"./src/loader/level-key.ts":function srcLoaderLevelKeyTs(R,C,I){I.r(C),I.d(C,"LevelKey",(function(){return O}));var _=I("./node_modules/url-toolkit/src/url-toolkit.js");function a(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}var O=function(){function e(R,C){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=C?Object(_.buildAbsoluteURL)(R,C,{"alwaysNormalize":!0}):R}return e.fromURL=function t(R,C){return new e(R,C)},e.fromURI=function t(R){return new e(R)},function n(R,C,I){return C&&a(R.prototype,C),I&&a(R,I),R}(e,[{"key":"uri","get":function e(){return this._uri}}]),e}()},"./src/loader/load-stats.ts":function srcLoaderLoadStatsTs(R,C,I){I.r(C),I.d(C,"LoadStats",(function(){return _}));var _=function e(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={"start":0,"first":0,"end":0},this.parsing={"start":0,"end":0},this.buffering={"start":0,"first":0,"end":0}}},"./src/loader/m3u8-parser.ts":function srcLoaderM3u8ParserTs(R,C,I){I.r(C),I.d(C,"default",(function(){return H}));var _=I("./src/polyfills/number.ts"),O=I("./node_modules/url-toolkit/src/url-toolkit.js"),x=I("./src/loader/fragment.ts"),w=I("./src/loader/level-details.ts"),P=I("./src/loader/level-key.ts"),F=I("./src/utils/attr-list.ts"),M=I("./src/utils/logger.ts"),N=I("./src/utils/codecs.ts"),U=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,B=/#EXT-X-MEDIA:(.*)/g,G=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),j=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),K=/\.(mp4|m4s|m4v|m4a)$/i;function p(R){var C,I;return K.test(null!=(C=null===(I=O.parseURL(R))||void 0===I?void 0:I.path)?C:"")}var H=function(){function e(){}return e.findGroup=function e(R,C){for(var I=0;I<R.length;I++){var _=R[I];if(_.id===C)return _}},e.convertAVC1ToAVCOTI=function e(R){var C=R.split(".");if(C.length>2){var I=C.shift()+".";return I+=parseInt(C.shift()).toString(16),I+=("000"+parseInt(C.shift()).toString(16)).substr(-4)}return R},e.resolve=function e(R,C){return O.buildAbsoluteURL(C,R,{"alwaysNormalize":!0})},e.parseMasterPlaylist=function t(R,C){var I,_=[],O={},x=!1;for(U.lastIndex=0;null!=(I=U.exec(R));)if(I[1]){var w=new F.AttrList(I[1]),P={"attrs":w,"bitrate":w.decimalInteger("AVERAGE-BANDWIDTH")||w.decimalInteger("BANDWIDTH"),"name":w.NAME,"url":e.resolve(I[2],C)},M=w.decimalResolution("RESOLUTION");M&&(P.width=M.width,P.height=M.height),y((w.CODECS||"").split(/[ ,]+/).filter((function(R){return R})),P),P.videoCodec&&-1!==P.videoCodec.indexOf("avc1")&&(P.videoCodec=e.convertAVC1ToAVCOTI(P.videoCodec)),_.push(P)}else if(I[3]){var N=new F.AttrList(I[3]);N["DATA-ID"]&&(x=!0,O[N["DATA-ID"]]=N)}return{"levels":_,"sessionData":x?O:null}},e.parseMasterPlaylistMedia=function t(R,C,I,_){var O;void 0===_&&(_=[]);var x=[],w=0;for(B.lastIndex=0;null!==(O=B.exec(R));){var P=new F.AttrList(O[1]);if(P.TYPE===I){var M={"attrs":P,"bitrate":0,"id":w++,"groupId":P["GROUP-ID"],"instreamId":P["INSTREAM-ID"],"name":P.NAME||P.LANGUAGE||"","type":I,"default":P.bool("DEFAULT"),"autoselect":P.bool("AUTOSELECT"),"forced":P.bool("FORCED"),"lang":P.LANGUAGE,"url":P.URI?e.resolve(P.URI,C):""};if(_.length){var N=e.findGroup(_,M.groupId)||_[0];E(M,N,"audioCodec"),E(M,N,"textCodec")}x.push(M)}}return x},e.parseLevelPlaylist=function e(R,C,I,O,N){var U,B,K,H=new w.LevelDetails(C),V=H.fragments,W=null,Y=0,q=0,X=0,z=0,Q=null,J=new x.Fragment(O,C),$=-1,Z=!1;for(G.lastIndex=0,H.m3u8=R;null!==(U=G.exec(R));){Z&&(Z=!1,(J=new x.Fragment(O,C)).start=X,J.sn=Y,J.cc=z,J.level=I,W&&(J.initSegment=W,J.rawProgramDateTime=W.rawProgramDateTime));var ee=U[1];if(ee){J.duration=parseFloat(ee);var te=(" "+U[2]).slice(1);J.title=te||null,J.tagList.push(te?["INF",ee,te]:["INF",ee])}else if(U[3])Object(_.isFiniteNumber)(J.duration)&&(J.start=X,K&&(J.levelkey=K),J.sn=Y,J.level=I,J.cc=z,J.urlId=N,V.push(J),J.relurl=(" "+U[3]).slice(1),S(J,Q),Q=J,X+=J.duration,Y++,q=0,Z=!0);else if(U[4]){var re=(" "+U[4]).slice(1);Q?J.setByteRange(re,Q):J.setByteRange(re)}else if(U[5])J.rawProgramDateTime=(" "+U[5]).slice(1),J.tagList.push(["PROGRAM-DATE-TIME",J.rawProgramDateTime]),-1===$&&($=V.length);else{if(!(U=U[0].match(j))){M.logger.warn("No matches on slow regex match for level playlist!");continue}for(B=1;B<U.length&&void 0===U[B];B++);var ie=(" "+U[B]).slice(1),ne=(" "+U[B+1]).slice(1),se=U[B+2]?(" "+U[B+2]).slice(1):"";switch(ie){case"PLAYLIST-TYPE":H.type=ne.toUpperCase();break;case"MEDIA-SEQUENCE":Y=H.startSN=parseInt(ne);break;case"SKIP":var ae=new F.AttrList(ne),oe=ae.decimalInteger("SKIPPED-SEGMENTS");if(Object(_.isFiniteNumber)(oe)){H.skippedSegments=oe;for(var le=oe;le--;)V.unshift(null);Y+=oe}var ue=ae.enumeratedString("RECENTLY-REMOVED-DATERANGES");ue&&(H.recentlyRemovedDateranges=ue.split("\t"));break;case"TARGETDURATION":H.targetduration=parseFloat(ne);break;case"VERSION":H.version=parseInt(ne);break;case"EXTM3U":break;case"ENDLIST":H.live=!1;break;case"#":(ne||se)&&J.tagList.push(se?[ne,se]:[ne]);break;case"DIS":z++;case"GAP":J.tagList.push([ie]);break;case"BITRATE":J.tagList.push([ie,ne]);break;case"DISCONTINUITY-SEQ":z=parseInt(ne);break;case"KEY":var ce,de=new F.AttrList(ne),he=de.enumeratedString("METHOD"),fe=de.URI,ge=de.hexadecimalInteger("IV"),ve=de.enumeratedString("KEYFORMATVERSIONS"),pe=de.enumeratedString("KEYID"),me=null!=(ce=de.enumeratedString("KEYFORMAT"))?ce:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(me)>-1){M.logger.warn("Keyformat "+me+" is not supported from the manifest");continue}if("identity"!==me)continue;he&&(K=P.LevelKey.fromURL(C,fe),fe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(he)>=0&&(K.method=he,K.keyFormat=me,pe&&(K.keyID=pe),ve&&(K.keyFormatVersions=ve),K.iv=ge));break;case"START":var ye=new F.AttrList(ne).decimalFloatingPoint("TIME-OFFSET");Object(_.isFiniteNumber)(ye)&&(H.startTimeOffset=ye);break;case"MAP":var Ee=new F.AttrList(ne);J.relurl=Ee.URI,Ee.BYTERANGE&&J.setByteRange(Ee.BYTERANGE),J.level=I,J.sn="initSegment",K&&(J.levelkey=K),J.initSegment=null,W=J,Z=!0;break;case"SERVER-CONTROL":var Te=new F.AttrList(ne);H.canBlockReload=Te.bool("CAN-BLOCK-RELOAD"),H.canSkipUntil=Te.optionalFloat("CAN-SKIP-UNTIL",0),H.canSkipDateRanges=H.canSkipUntil>0&&Te.bool("CAN-SKIP-DATERANGES"),H.partHoldBack=Te.optionalFloat("PART-HOLD-BACK",0),H.holdBack=Te.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Se=new F.AttrList(ne);H.partTarget=Se.decimalFloatingPoint("PART-TARGET");break;case"PART":var be=H.partList;be||(be=H.partList=[]);var Le=q>0?be[be.length-1]:void 0,Ae=q++,De=new x.Part(new F.AttrList(ne),J,C,Ae,Le);be.push(De),J.duration+=De.duration;break;case"PRELOAD-HINT":var Re=new F.AttrList(ne);H.preloadHint=Re;break;case"RENDITION-REPORT":var ke=new F.AttrList(ne);H.renditionReports=H.renditionReports||[],H.renditionReports.push(ke);break;default:M.logger.warn("line parsed but not handled: "+U)}}}Q&&!Q.relurl?(V.pop(),X-=Q.duration,H.partList&&(H.fragmentHint=Q)):H.partList&&(S(J,Q),J.cc=z,H.fragmentHint=J);var Ce=V.length,Ie=V[0],_e=V[Ce-1];if((X+=H.skippedSegments*H.targetduration)>0&&Ce&&_e){H.averagetargetduration=X/Ce;var Oe=_e.sn;H.endSN="initSegment"!==Oe?Oe:0,Ie&&(H.startCC=Ie.cc,Ie.initSegment||H.fragments.every((function(R){return R.relurl&&p(R.relurl)}))&&(M.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(J=new x.Fragment(O,C)).relurl=_e.relurl,J.level=I,J.sn="initSegment",Ie.initSegment=J,H.needSidxRanges=!0))}else H.endSN=0,H.startCC=0;return H.fragmentHint&&(X+=H.fragmentHint.duration),H.totalduration=X,H.endCC=z,$>0&&function T(R,C){for(var I=R[C],_=C;_--;){var O=R[_];if(!O)return;O.programDateTime=I.programDateTime-1e3*O.duration,I=O}}(V,$),H},e}();function y(R,C){["video","audio","text"].forEach((function(I){var _=R.filter((function(R){return Object(N.isCodecType)(R,I)}));if(_.length){var O=_.filter((function(R){return 0===R.lastIndexOf("avc1",0)||0===R.lastIndexOf("mp4a",0)}));C[I+"Codec"]=O.length>0?O[0]:_[0],R=R.filter((function(R){return-1===_.indexOf(R)}))}})),C.unknownCodecs=R}function E(R,C,I){var _=C[I];_&&(R[I]=_)}function S(R,C){R.rawProgramDateTime?R.programDateTime=Date.parse(R.rawProgramDateTime):null!=C&&C.programDateTime&&(R.programDateTime=C.endProgramDateTime),Object(_.isFiniteNumber)(R.programDateTime)||(R.programDateTime=null,R.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function srcLoaderPlaylistLoaderTs(R,C,I){I.r(C);var _=I("./src/polyfills/number.ts"),O=I("./src/events.ts"),x=I("./src/errors.ts"),w=I("./src/utils/logger.ts"),P=I("./src/utils/mp4-tools.ts"),F=I("./src/loader/m3u8-parser.ts"),M=I("./src/types/loader.ts"),N=I("./src/utils/attr-list.ts");function c(R,C){var I=R.url;return void 0!==I&&0!==I.indexOf("data:")||(I=C.url),I}var U=function(){function e(R){this.hls=void 0,this.loaders=Object.create(null),this.hls=R,this.registerListeners()}var R=e.prototype;return R.registerListeners=function e(){var R=this.hls;R.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),R.on(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),R.off(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),R.off(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},R.createInternalLoader=function e(R){var C=this.hls.config,I=C.pLoader,_=C.loader,O=new(I||_)(C);return R.loader=O,this.loaders[R.type]=O,O},R.getInternalLoader=function e(R){return this.loaders[R.type]},R.resetInternalLoader=function e(R){this.loaders[R]&&delete this.loaders[R]},R.destroyInternalLoaders=function e(){for(var R in this.loaders){var C=this.loaders[R];C&&C.destroy(),this.resetInternalLoader(R)}},R.destroy=function e(){this.unregisterListeners(),this.destroyInternalLoaders()},R.onManifestLoading=function e(R,C){var I=C.url;this.load({"id":null,"groupId":null,"level":0,"responseType":"text","type":M.PlaylistContextType.MANIFEST,"url":I,"deliveryDirectives":null})},R.onLevelLoading=function e(R,C){var I=C.id,_=C.level,O=C.url,x=C.deliveryDirectives;this.load({"id":I,"groupId":null,"level":_,"responseType":"text","type":M.PlaylistContextType.LEVEL,"url":O,"deliveryDirectives":x})},R.onAudioTrackLoading=function e(R,C){var I=C.id,_=C.groupId,O=C.url,x=C.deliveryDirectives;this.load({"id":I,"groupId":_,"level":null,"responseType":"text","type":M.PlaylistContextType.AUDIO_TRACK,"url":O,"deliveryDirectives":x})},R.onSubtitleTrackLoading=function e(R,C){var I=C.id,_=C.groupId,O=C.url,x=C.deliveryDirectives;this.load({"id":I,"groupId":_,"level":null,"responseType":"text","type":M.PlaylistContextType.SUBTITLE_TRACK,"url":O,"deliveryDirectives":x})},R.load=function e(R){var C,I,_,O,x,P,F=this.hls.config,N=this.getInternalLoader(R);if(N){var U=N.context;if(U&&U.url===R.url)return void w.logger.trace("[playlist-loader]: playlist request ongoing");w.logger.log("[playlist-loader]: aborting previous loader for type: "+R.type),N.abort()}switch(R.type){case M.PlaylistContextType.MANIFEST:I=F.manifestLoadingMaxRetry,_=F.manifestLoadingTimeOut,O=F.manifestLoadingRetryDelay,x=F.manifestLoadingMaxRetryTimeout;break;case M.PlaylistContextType.LEVEL:case M.PlaylistContextType.AUDIO_TRACK:case M.PlaylistContextType.SUBTITLE_TRACK:I=0,_=F.levelLoadingTimeOut;break;default:I=F.levelLoadingMaxRetry,_=F.levelLoadingTimeOut,O=F.levelLoadingRetryDelay,x=F.levelLoadingMaxRetryTimeout}if((N=this.createInternalLoader(R),null!==(C=R.deliveryDirectives)&&void 0!==C&&C.part)&&(R.type===M.PlaylistContextType.LEVEL&&null!==R.level?P=this.hls.levels[R.level].details:R.type===M.PlaylistContextType.AUDIO_TRACK&&null!==R.id?P=this.hls.audioTracks[R.id].details:R.type===M.PlaylistContextType.SUBTITLE_TRACK&&null!==R.id&&(P=this.hls.subtitleTracks[R.id].details),P)){var B=P.partTarget,G=P.targetduration;B&&G&&(_=Math.min(1e3*Math.max(3*B,.8*G),_))}var j={"timeout":_,"maxRetry":I,"retryDelay":O,"maxRetryDelay":x,"highWaterMark":0},K={"onSuccess":this.loadsuccess.bind(this),"onError":this.loaderror.bind(this),"onTimeout":this.loadtimeout.bind(this)};N.load(R,j,K)},R.loadsuccess=function e(R,C,I,_){if(void 0===_&&(_=null),I.isSidxRequest)return this.handleSidxRequest(R,I),void this.handlePlaylistLoaded(R,C,I,_);this.resetInternalLoader(I.type);var O=R.data;0===O.indexOf("#EXTM3U")?(C.parsing.start=performance.now(),O.indexOf("#EXTINF:")>0||O.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(R,C,I,_):this.handleMasterPlaylist(R,C,I,_)):this.handleManifestParsingError(R,I,"no EXTM3U delimiter",_)},R.loaderror=function e(R,C,I){void 0===I&&(I=null),this.handleNetworkError(C,I,!1,R)},R.loadtimeout=function e(R,C,I){void 0===I&&(I=null),this.handleNetworkError(C,I,!0)},R.handleMasterPlaylist=function e(R,C,I,_){var x=this.hls,P=R.data,M=c(R,I),U=F.default.parseMasterPlaylist(P,M),B=U.levels,G=U.sessionData;if(B.length){var j=B.map((function(R){return{"id":R.attrs.AUDIO,"audioCodec":R.audioCodec}})),K=B.map((function(R){return{"id":R.attrs.SUBTITLES,"textCodec":R.textCodec}})),H=F.default.parseMasterPlaylistMedia(P,M,"AUDIO",j),V=F.default.parseMasterPlaylistMedia(P,M,"SUBTITLES",K),W=F.default.parseMasterPlaylistMedia(P,M,"CLOSED-CAPTIONS");if(H.length){var Y=H.some((function(R){return!R.url}));Y||!B[0].audioCodec||B[0].attrs.AUDIO||(w.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),H.unshift({"type":"main","name":"main","default":!1,"autoselect":!1,"forced":!1,"id":-1,"attrs":new N.AttrList({}),"bitrate":0,"url":""}))}x.trigger(O.Events.MANIFEST_LOADED,{"levels":B,"audioTracks":H,"subtitles":V,"captions":W,"url":M,"stats":C,"networkDetails":_,"sessionData":G})}else this.handleManifestParsingError(R,I,"no level found in manifest",_)},R.handleTrackOrLevelPlaylist=function e(R,C,I,w){var P=this.hls,U=I.id,B=I.level,G=I.type,j=c(R,I),K=Object(_.isFiniteNumber)(U)?U:0,H=Object(_.isFiniteNumber)(B)?B:K,V=function d(R){switch(R.type){case M.PlaylistContextType.AUDIO_TRACK:return M.PlaylistLevelType.AUDIO;case M.PlaylistContextType.SUBTITLE_TRACK:return M.PlaylistLevelType.SUBTITLE;default:return M.PlaylistLevelType.MAIN}}(I),W=F.default.parseLevelPlaylist(R.data,j,H,V,K);if(W.fragments.length){if(G===M.PlaylistContextType.MANIFEST){var Y={"attrs":new N.AttrList({}),"bitrate":0,"details":W,"name":"","url":j};P.trigger(O.Events.MANIFEST_LOADED,{"levels":[Y],"audioTracks":[],"url":j,"stats":C,"networkDetails":w,"sessionData":null})}if(C.parsing.end=performance.now(),W.needSidxRanges){var q,X=null===(q=W.fragments[0].initSegment)||void 0===q?void 0:q.url;this.load({"url":X,"isSidxRequest":!0,"type":G,"level":B,"levelDetails":W,"id":U,"groupId":null,"rangeStart":0,"rangeEnd":2048,"responseType":"arraybuffer","deliveryDirectives":null})}else I.levelDetails=W,this.handlePlaylistLoaded(R,C,I,w)}else P.trigger(O.Events.ERROR,{"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.LEVEL_EMPTY_ERROR,"fatal":!1,"url":j,"reason":"no fragments found in level","level":"number"==typeof I.level?I.level:void 0})},R.handleSidxRequest=function e(R,C){var I=Object(P.parseSegmentIndex)(new Uint8Array(R.data));if(I){var _=I.references,O=C.levelDetails;_.forEach((function(R,C){var _=R.info,x=O.fragments[C];0===x.byteRange.length&&x.setByteRange(String(1+_.end-_.start)+"@"+String(_.start)),x.initSegment&&x.initSegment.setByteRange(String(I.moovEndOffset)+"@0")}))}},R.handleManifestParsingError=function e(R,C,I,_){this.hls.trigger(O.Events.ERROR,{"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.MANIFEST_PARSING_ERROR,"fatal":C.type===M.PlaylistContextType.MANIFEST,"url":R.url,"reason":I,"response":R,"context":C,"networkDetails":_})},R.handleNetworkError=function e(R,C,I,_){void 0===I&&(I=!1),w.logger.warn("[playlist-loader]: A network "+(I?"timeout":"error")+" occurred while loading "+R.type+" level: "+R.level+" id: "+R.id+' group-id: "'+R.groupId+'"');var P=x.ErrorDetails.UNKNOWN,F=!1,N=this.getInternalLoader(R);switch(R.type){case M.PlaylistContextType.MANIFEST:P=I?x.ErrorDetails.MANIFEST_LOAD_TIMEOUT:x.ErrorDetails.MANIFEST_LOAD_ERROR,F=!0;break;case M.PlaylistContextType.LEVEL:P=I?x.ErrorDetails.LEVEL_LOAD_TIMEOUT:x.ErrorDetails.LEVEL_LOAD_ERROR,F=!1;break;case M.PlaylistContextType.AUDIO_TRACK:P=I?x.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,F=!1;break;case M.PlaylistContextType.SUBTITLE_TRACK:P=I?x.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:x.ErrorDetails.SUBTITLE_LOAD_ERROR,F=!1}N&&this.resetInternalLoader(R.type);var U={"type":x.ErrorTypes.NETWORK_ERROR,"details":P,"fatal":F,"url":R.url,"loader":N,"context":R,"networkDetails":C};_&&(U.response=_),this.hls.trigger(O.Events.ERROR,U)},R.handlePlaylistLoaded=function e(R,C,I,_){var x=I.type,w=I.level,P=I.id,F=I.groupId,N=I.loader,U=I.levelDetails,B=I.deliveryDirectives;if(null!=U&&U.targetduration){if(N)switch(U.live&&(N.getCacheAge&&(U.ageHeader=N.getCacheAge()||0),N.getCacheAge&&!isNaN(U.ageHeader)||(U.ageHeader=0)),x){case M.PlaylistContextType.MANIFEST:case M.PlaylistContextType.LEVEL:this.hls.trigger(O.Events.LEVEL_LOADED,{"details":U,"level":w||0,"id":P||0,"stats":C,"networkDetails":_,"deliveryDirectives":B});break;case M.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,{"details":U,"id":P||0,"groupId":F||"","stats":C,"networkDetails":_,"deliveryDirectives":B});break;case M.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(O.Events.SUBTITLE_TRACK_LOADED,{"details":U,"id":P||0,"groupId":F||"","stats":C,"networkDetails":_,"deliveryDirectives":B})}}else this.handleManifestParsingError(R,I,"invalid target duration",_)},e}();C.default=U},"./src/polyfills/number.ts":function srcPolyfillsNumberTs(R,C,I){I.r(C),I.d(C,"isFiniteNumber",(function(){return _})),I.d(C,"MAX_SAFE_INTEGER",(function(){return O}));var _=Number.isFinite||function(R){return"number"==typeof R&&isFinite(R)},O=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function srcRemuxAacHelperTs(R,C,I){I.r(C);var _=function(){function e(){}return e.getSilentFrame=function e(R,C){if("mp4a.40.2"===R){if(1===C)return new Uint8Array([0,200,0,128,35,128]);if(2===C)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===C)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===C)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===C)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===C)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===C)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===C)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===C)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}();C.default=_},"./src/remux/mp4-generator.ts":function srcRemuxMp4GeneratorTs(R,C,I){I.r(C);var _=Math.pow(2,32)-1,O=function(){function e(){}return e.init=function t(){var R;for(R in e.types={"avc1":[],"avcC":[],"btrt":[],"dinf":[],"dref":[],"esds":[],"ftyp":[],"hdlr":[],"mdat":[],"mdhd":[],"mdia":[],"mfhd":[],"minf":[],"moof":[],"moov":[],"mp4a":[],".mp3":[],"mvex":[],"mvhd":[],"pasp":[],"sdtp":[],"stbl":[],"stco":[],"stsc":[],"stsd":[],"stsz":[],"stts":[],"tfdt":[],"tfhd":[],"traf":[],"trak":[],"trun":[],"trex":[],"tkhd":[],"vmhd":[],"smhd":[]},e.types)e.types.hasOwnProperty(R)&&(e.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),I=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={"video":C,"audio":I};var _=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),O=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=O,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var x=new Uint8Array([105,115,111,109]),w=new Uint8Array([97,118,99,49]),P=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,x,P,x,w),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,_))},e.box=function e(R){for(var C=8,I=arguments.length,_=new Array(I>1?I-1:0),O=1;O<I;O++)_[O-1]=arguments[O];for(var x=_.length,w=x;x--;)C+=_[x].byteLength;var P=new Uint8Array(C);for(P[0]=C>>24&255,P[1]=C>>16&255,P[2]=C>>8&255,P[3]=255&C,P.set(R,4),x=0,C=8;x<w;x++)P.set(_[x],C),C+=_[x].byteLength;return P},e.hdlr=function t(R){return e.box(e.types.hdlr,e.HDLR_TYPES[R])},e.mdat=function t(R){return e.box(e.types.mdat,R)},e.mdhd=function t(R,C){C*=R;var I=Math.floor(C/(_+1)),O=Math.floor(C%(_+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,I>>24,I>>16&255,I>>8&255,255&I,O>>24,O>>16&255,O>>8&255,255&O,85,196,0,0]))},e.mdia=function t(R){return e.box(e.types.mdia,e.mdhd(R.timescale,R.duration),e.hdlr(R.type),e.minf(R))},e.mfhd=function t(R){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,255&R]))},e.minf=function t(R){return"audio"===R.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(R)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(R))},e.moof=function t(R,C,I){return e.box(e.types.moof,e.mfhd(R),e.traf(I,C))},e.moov=function t(R){for(var C=R.length,I=[];C--;)I[C]=e.trak(R[C]);return e.box.apply(null,[e.types.moov,e.mvhd(R[0].timescale,R[0].duration)].concat(I).concat(e.mvex(R)))},e.mvex=function t(R){for(var C=R.length,I=[];C--;)I[C]=e.trex(R[C]);return e.box.apply(null,[e.types.mvex].concat(I))},e.mvhd=function t(R,C){C*=R;var I=Math.floor(C/(_+1)),O=Math.floor(C%(_+1)),x=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,I>>24,I>>16&255,I>>8&255,255&I,O>>24,O>>16&255,O>>8&255,255&O,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,x)},e.sdtp=function t(R){var C,I,_=R.samples||[],O=new Uint8Array(4+_.length);for(C=0;C<_.length;C++)I=_[C].flags,O[C+4]=I.dependsOn<<4|I.isDependedOn<<2|I.hasRedundancy;return e.box(e.types.sdtp,O)},e.stbl=function t(R){return e.box(e.types.stbl,e.stsd(R),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function t(R){var C,I,_,O=[],x=[];for(C=0;C<R.sps.length;C++)_=(I=R.sps[C]).byteLength,O.push(_>>>8&255),O.push(255&_),O=O.concat(Array.prototype.slice.call(I));for(C=0;C<R.pps.length;C++)_=(I=R.pps[C]).byteLength,x.push(_>>>8&255),x.push(255&_),x=x.concat(Array.prototype.slice.call(I));var w=e.box(e.types.avcC,new Uint8Array([1,O[3],O[4],O[5],255,224|R.sps.length].concat(O).concat([R.pps.length]).concat(x))),P=R.width,F=R.height,M=R.pixelRatio[0],N=R.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,P>>8&255,255&P,F>>8&255,255&F,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),w,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([M>>24,M>>16&255,M>>8&255,255&M,N>>24,N>>16&255,N>>8&255,255&N])))},e.esds=function e(R){var C=R.config.length;return new Uint8Array([0,0,0,0,3,23+C,0,1,0,4,15+C,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([C]).concat(R.config).concat([6,1,2]))},e.mp4a=function t(R){var C=R.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,C>>8&255,255&C,0,0]),e.box(e.types.esds,e.esds(R)))},e.mp3=function t(R){var C=R.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,C>>8&255,255&C,0,0]))},e.stsd=function t(R){return"audio"===R.type?R.isAAC||"mp3"!==R.codec?e.box(e.types.stsd,e.STSD,e.mp4a(R)):e.box(e.types.stsd,e.STSD,e.mp3(R)):e.box(e.types.stsd,e.STSD,e.avc1(R))},e.tkhd=function t(R){var C=R.id,I=R.duration*R.timescale,O=R.width,x=R.height,w=Math.floor(I/(_+1)),P=Math.floor(I%(_+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,255&C,0,0,0,0,w>>24,w>>16&255,w>>8&255,255&w,P>>24,P>>16&255,P>>8&255,255&P,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,O>>8&255,255&O,0,0,x>>8&255,255&x,0,0]))},e.traf=function t(R,C){var I=e.sdtp(R),O=R.id,x=Math.floor(C/(_+1)),w=Math.floor(C%(_+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,255&O])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,x>>24,x>>16&255,x>>8&255,255&x,w>>24,w>>16&255,w>>8&255,255&w])),e.trun(R,I.length+16+20+8+16+8+8),I)},e.trak=function t(R){return R.duration=R.duration||4294967295,e.box(e.types.trak,e.tkhd(R),e.mdia(R))},e.trex=function t(R){var C=R.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,255&C,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function t(R,C){var I,_,O,x,w,P,F=R.samples||[],M=F.length,N=12+16*M,U=new Uint8Array(N);for(C+=8+N,U.set([0,0,15,1,M>>>24&255,M>>>16&255,M>>>8&255,255&M,C>>>24&255,C>>>16&255,C>>>8&255,255&C],0),I=0;I<M;I++)O=(_=F[I]).duration,x=_.size,w=_.flags,P=_.cts,U.set([O>>>24&255,O>>>16&255,O>>>8&255,255&O,x>>>24&255,x>>>16&255,x>>>8&255,255&x,w.isLeading<<2|w.dependsOn,w.isDependedOn<<6|w.hasRedundancy<<4|w.paddingValue<<1|w.isNonSync,61440&w.degradPrio,15&w.degradPrio,P>>>24&255,P>>>16&255,P>>>8&255,255&P],12+16*I);return e.box(e.types.trun,U)},e.initSegment=function t(R){e.types||e.init();var C=e.moov(R),I=new Uint8Array(e.FTYP.byteLength+C.byteLength);return I.set(e.FTYP),I.set(C,e.FTYP.byteLength),I},e}();O.types=void 0,O.HDLR_TYPES=void 0,O.STTS=void 0,O.STSC=void 0,O.STCO=void 0,O.STSZ=void 0,O.VMHD=void 0,O.SMHD=void 0,O.STSD=void 0,O.FTYP=void 0,O.DINF=void 0,C.default=O},"./src/remux/mp4-remuxer.ts":function srcRemuxMp4RemuxerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return j})),I.d(C,"normalizePts",(function(){return E}));var _=I("./src/polyfills/number.ts"),O=I("./src/remux/aac-helper.ts"),x=I("./src/remux/mp4-generator.ts"),w=I("./src/events.ts"),P=I("./src/errors.ts"),F=I("./src/utils/logger.ts"),M=I("./src/types/loader.ts"),N=I("./src/utils/timescale-conversion.ts");function d(){return d=Object.assign||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var _ in I)Object.prototype.hasOwnProperty.call(I,_)&&(R[_]=I[_])}return R},d.apply(this,arguments)}var U=null,B=null,G=!1,j=function(){function e(R,C,I,_){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=R,this.config=C,this.typeSupported=I,this.ISGenerated=!1,null===U){var O=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);U=O?parseInt(O[1]):0}if(null===B){var x=navigator.userAgent.match(/Safari\/(\d+)/i);B=x?parseInt(x[1]):0}G=!!U&&U<75||!!B&&B<600}var R=e.prototype;return R.destroy=function e(){},R.resetTimeStamp=function e(R){F.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=R},R.resetNextTimestamp=function e(){F.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},R.resetInitSegment=function e(){F.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},R.getVideoStartPts=function e(R){var C=!1,I=R.reduce((function(R,I){var _=I.pts-R;return _<-4294967296?(C=!0,E(R,I.pts)):_>0?R:I.pts}),R[0].pts);return C&&F.logger.debug("PTS rollover detected"),I},R.remux=function e(R,C,I,_,O,x,w,P){var N,U,B,G,j,K,H=O,V=O,W=R.pid>-1,Y=C.pid>-1,q=C.samples.length,X=R.samples.length>0,z=q>1;if((!W||X)&&(!Y||z)||this.ISGenerated||w){this.ISGenerated||(B=this.generateIS(R,C,O));var Q=this.isVideoContiguous,J=-1;if(z&&(J=function T(R){for(var C=0;C<R.length;C++)if(R[C].key)return C;return-1}(C.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,J>0){F.logger.warn("[mp4-remuxer]: Dropped "+J+" out of "+q+" video samples due to a missing keyframe");var $=this.getVideoStartPts(C.samples);C.samples=C.samples.slice(J),C.dropped+=J,V+=(C.samples[0].pts-$)/(C.timescale||9e4)}else-1===J&&(F.logger.warn("[mp4-remuxer]: No keyframe found out of "+q+" video samples"),K=!1);if(this.ISGenerated){if(X&&z){var Z=this.getVideoStartPts(C.samples),ee=(E(R.samples[0].pts,Z)-Z)/C.inputTimeScale;H+=Math.max(0,ee),V+=Math.max(0,-ee)}if(X){if(R.samplerate||(F.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),B=this.generateIS(R,C,O)),U=this.remuxAudio(R,H,this.isAudioContiguous,x,Y||z||P===M.PlaylistLevelType.AUDIO?V:void 0),z){var te=U?U.endPTS-U.startPTS:0;C.inputTimeScale||(F.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),B=this.generateIS(R,C,O)),N=this.remuxVideo(C,V,Q,te)}}else z&&(N=this.remuxVideo(C,V,Q,0));N&&(N.firstKeyFrame=J,N.independent=-1!==J)}}return this.ISGenerated&&(I.samples.length&&(j=this.remuxID3(I,O)),_.samples.length&&(G=this.remuxText(_,O))),{"audio":U,"video":N,"initSegment":B,"independent":K,"text":G,"id3":j}},R.generateIS=function e(R,C,I){var O,w,P,F=R.samples,M=C.samples,N=this.typeSupported,U={},B=!Object(_.isFiniteNumber)(this._initPTS),G="audio/mp4";if(B&&(O=w=1/0),R.config&&F.length&&(R.timescale=R.samplerate,R.isAAC||(N.mpeg?(G="audio/mpeg",R.codec=""):N.mp3&&(R.codec="mp3")),U.audio={"id":"audio","container":G,"codec":R.codec,"initSegment":!R.isAAC&&N.mpeg?new Uint8Array(0):x.default.initSegment([R]),"metadata":{"channelCount":R.channelCount}},B&&(P=R.inputTimeScale,O=w=F[0].pts-Math.round(P*I))),C.sps&&C.pps&&M.length&&(C.timescale=C.inputTimeScale,U.video={"id":"main","container":"video/mp4","codec":C.codec,"initSegment":x.default.initSegment([C]),"metadata":{"width":C.width,"height":C.height}},B)){P=C.inputTimeScale;var j=this.getVideoStartPts(M),K=Math.round(P*I);w=Math.min(w,E(M[0].dts,j)-K),O=Math.min(O,j-K)}if(Object.keys(U).length)return this.ISGenerated=!0,B&&(this._initPTS=O,this._initDTS=w),{"tracks":U,"initPTS":O,"timescale":P}},R.remuxVideo=function e(R,C,I,_){var O,M,B,j=R.inputTimeScale,H=R.samples,V=[],W=H.length,Y=this._initPTS,q=this.nextAvcDts,X=8,z=Number.POSITIVE_INFINITY,Q=Number.NEGATIVE_INFINITY,J=0,$=!1;I&&null!==q||(q=C*j-(H[0].pts-E(H[0].dts,H[0].pts)));for(var Z=0;Z<W;Z++){var ee=H[Z];if(ee.pts=E(ee.pts-Y,q),ee.dts=E(ee.dts-Y,q),ee.dts>ee.pts){J=Math.max(Math.min(J,ee.pts-ee.dts),-18e3)}ee.dts<H[Z>0?Z-1:Z].dts&&($=!0)}$&&H.sort((function(R,C){var I=R.dts-C.dts,_=R.pts-C.pts;return I||_})),M=H[0].dts,B=H[H.length-1].dts;var te=Math.round((B-M)/(W-1));if(J<0){if(J<-2*te){F.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(N.toMsFromMpegTsClock)(-te,!0)+" ms");for(var re=J,ie=0;ie<W;ie++)H[ie].dts=re=Math.max(re,H[ie].pts-te),H[ie].pts=Math.max(re,H[ie].pts)}else{F.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(N.toMsFromMpegTsClock)(J,!0)+" ms to overcome this issue");for(var ne=0;ne<W;ne++)H[ne].dts=H[ne].dts+J}M=H[0].dts}if(I){var se=M-q,ae=se>te;if(ae||se<-1){ae?F.logger.warn("AVC: "+Object(N.toMsFromMpegTsClock)(se,!0)+" ms ("+se+"dts) hole between fragments detected, filling it"):F.logger.warn("AVC: "+Object(N.toMsFromMpegTsClock)(-se,!0)+" ms ("+se+"dts) overlapping between fragments detected"),M=q;var oe=H[0].pts-se;H[0].dts=M,H[0].pts=oe,F.logger.log("Video: First PTS/DTS adjusted: "+Object(N.toMsFromMpegTsClock)(oe,!0)+"/"+Object(N.toMsFromMpegTsClock)(M,!0)+", delta: "+Object(N.toMsFromMpegTsClock)(se,!0)+" ms")}}G&&(M=Math.max(0,M));for(var le=0,ue=0,ce=0;ce<W;ce++){for(var de=H[ce],he=de.units,fe=he.length,ge=0,ve=0;ve<fe;ve++)ge+=he[ve].data.length;ue+=ge,le+=fe,de.length=ge,de.dts=Math.max(de.dts,M),de.pts=Math.max(de.pts,de.dts,0),z=Math.min(de.pts,z),Q=Math.max(de.pts,Q)}B=H[W-1].dts;var pe,me=ue+4*le+8;try{pe=new Uint8Array(me)}catch(e){return void this.observer.emit(w.Events.ERROR,w.Events.ERROR,{"type":P.ErrorTypes.MUX_ERROR,"details":P.ErrorDetails.REMUX_ALLOC_ERROR,"fatal":!1,"bytes":me,"reason":"fail allocating video mdat "+me})}var ye=new DataView(pe.buffer);ye.setUint32(0,me),pe.set(x.default.types.mdat,4);for(var Ee=0;Ee<W;Ee++){for(var Te=H[Ee],Se=Te.units,be=0,Le=0,Ae=Se.length;Le<Ae;Le++){var De=Se[Le],Re=De.data,ke=De.data.byteLength;ye.setUint32(X,ke),X+=4,pe.set(Re,X),X+=ke,be+=4+ke}if(Ee<W-1)O=H[Ee+1].dts-Te.dts;else{var Ce=this.config,Ie=Te.dts-H[Ee>0?Ee-1:Ee].dts;if(Ce.stretchShortVideoTrack&&null!==this.nextAudioPts){var _e=Math.floor(Ce.maxBufferHole*j),Oe=(_?z+_*j:this.nextAudioPts)-Te.pts;Oe>_e?((O=Oe-Ie)<0&&(O=Ie),F.logger.log("[mp4-remuxer]: It is approximately "+Oe/90+" ms to the next segment; using duration "+O/90+" ms for the last video frame.")):O=Ie}else O=Ie}var xe=Math.round(Te.pts-Te.dts);V.push(new K(Te.key,O,be,xe))}if(V.length&&U&&U<70){var we=V[0].flags;we.dependsOn=2,we.isNonSync=0}console.assert(void 0!==O,"mp4SampleDuration must be computed"),this.nextAvcDts=q=B+O,this.isVideoContiguous=!0;var Pe={"data1":x.default.moof(R.sequenceNumber++,M,d({},R,{"samples":V})),"data2":pe,"startPTS":z/j,"endPTS":(Q+O)/j,"startDTS":M/j,"endDTS":q/j,"type":"video","hasAudio":!1,"hasVideo":!0,"nb":V.length,"dropped":R.dropped};return R.samples=[],R.dropped=0,console.assert(pe.length,"MDAT length must not be zero"),Pe},R.remuxAudio=function e(R,C,I,_,M){var N=R.inputTimeScale,U=N/(R.samplerate?R.samplerate:N),B=R.isAAC?1024:1152,G=B*U,j=this._initPTS,H=!R.isAAC&&this.typeSupported.mpeg,V=[],W=R.samples,Y=H?0:8,q=this.nextAudioPts||-1,X=C*N;if(this.isAudioContiguous=I=I||W.length&&q>0&&(_&&Math.abs(X-q)<9e3||Math.abs(E(W[0].pts-j,X)-q)<20*G),W.forEach((function(R){R.pts=E(R.pts-j,X)})),!I||q<0){if(W=W.filter((function(R){return R.pts>=0})),!W.length)return;q=0===M?0:_?Math.max(0,X):W[0].pts}if(R.isAAC)for(var z=void 0!==M,Q=this.config.maxAudioFramesDrift,J=0,$=q;J<W.length;J++){var Z=W[J],ee=Z.pts,te=ee-$,re=Math.abs(1e3*te/N);if(te<=-Q*G&&z)0===J&&(F.logger.warn("Audio frame @ "+(ee/N).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*te/N)+" ms."),this.nextAudioPts=q=$=ee);else if(te>=Q*G&&re<1e4&&z){var ie=Math.round(te/G);($=ee-ie*G)<0&&(ie--,$+=G),0===J&&(this.nextAudioPts=q=$),F.logger.warn("[mp4-remuxer]: Injecting "+ie+" audio frame @ "+($/N).toFixed(3)+"s due to "+Math.round(1e3*te/N)+" ms gap.");for(var ne=0;ne<ie;ne++){var se=Math.max($,0),ae=O.default.getSilentFrame(R.manifestCodec||R.codec,R.channelCount);ae||(F.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ae=Z.unit.subarray()),W.splice(J,0,{"unit":ae,"pts":se}),$+=G,J++}}Z.pts=$,$+=G}for(var oe,le=null,ue=null,ce=0,de=W.length;de--;)ce+=W[de].unit.byteLength;for(var he=0,fe=W.length;he<fe;he++){var ge=W[he],ve=ge.unit,pe=ge.pts;if(null!==ue){V[he-1].duration=Math.round((pe-ue)/U)}else{if(I&&R.isAAC&&(pe=q),le=pe,!(ce>0))return;ce+=Y;try{oe=new Uint8Array(ce)}catch(e){return void this.observer.emit(w.Events.ERROR,w.Events.ERROR,{"type":P.ErrorTypes.MUX_ERROR,"details":P.ErrorDetails.REMUX_ALLOC_ERROR,"fatal":!1,"bytes":ce,"reason":"fail allocating audio mdat "+ce})}H||(new DataView(oe.buffer).setUint32(0,ce),oe.set(x.default.types.mdat,4))}oe.set(ve,Y);var me=ve.byteLength;Y+=me,V.push(new K(!0,B,me,0)),ue=pe}var ye=V.length;if(ye){var Ee=V[V.length-1];this.nextAudioPts=q=ue+U*Ee.duration;var Te=H?new Uint8Array(0):x.default.moof(R.sequenceNumber++,le/U,d({},R,{"samples":V}));R.samples=[];var Se=le/N,be=q/N,Le={"data1":Te,"data2":oe,"startPTS":Se,"endPTS":be,"startDTS":Se,"endDTS":be,"type":"audio","hasAudio":!0,"hasVideo":!1,"nb":ye};return this.isAudioContiguous=!0,console.assert(oe.length,"MDAT length must not be zero"),Le}},R.remuxEmptyAudio=function e(R,C,I,_){var x=R.inputTimeScale,w=x/(R.samplerate?R.samplerate:x),P=this.nextAudioPts,M=(null!==P?P:_.startDTS*x)+this._initDTS,N=_.endDTS*x+this._initDTS,U=1024*w,B=Math.ceil((N-M)/U),G=O.default.getSilentFrame(R.manifestCodec||R.codec,R.channelCount);if(F.logger.warn("[mp4-remuxer]: remux empty Audio"),G){for(var j=[],K=0;K<B;K++){var H=M+K*U;j.push({"unit":G,"pts":H,"dts":H})}return R.samples=j,this.remuxAudio(R,C,I,!1)}F.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},R.remuxID3=function e(R,C){var I=R.samples.length;if(I){for(var _=R.inputTimeScale,O=this._initPTS,x=this._initDTS,w=0;w<I;w++){var P=R.samples[w];P.pts=E(P.pts-O,C*_)/_,P.dts=E(P.dts-x,C*_)/_}var F=R.samples;return R.samples=[],{"samples":F}}},R.remuxText=function e(R,C){var I=R.samples.length;if(I){for(var _=R.inputTimeScale,O=this._initPTS,x=0;x<I;x++){var w=R.samples[x];w.pts=E(w.pts-O,C*_)/_}R.samples.sort((function(R,C){return R.pts-C.pts}));var P=R.samples;return R.samples=[],{"samples":P}}},e}();function E(R,C){var I;if(null===C)return R;for(I=C<R?-8589934592:8589934592;Math.abs(R-C)>4294967296;)R+=I;return R}var K=function e(R,C,I,_){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=C,this.size=I,this.cts=_,this.flags=new H(R)},H=function e(R){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=R?2:1,this.isNonSync=R?0:1}},"./src/remux/passthrough-remuxer.ts":function srcRemuxPassthroughRemuxerTs(R,C,I){I.r(C);var _=I("./src/polyfills/number.ts"),O=I("./src/utils/mp4-tools.ts"),x=I("./src/loader/fragment.ts"),w=I("./src/utils/logger.ts"),P=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var R=e.prototype;return R.destroy=function e(){},R.resetTimeStamp=function e(R){this.initPTS=R,this.lastEndDTS=null},R.resetNextTimestamp=function e(){this.lastEndDTS=null},R.resetInitSegment=function e(R,C,I){this.audioCodec=C,this.videoCodec=I,this.generateInitSegment(R),this.emitInitSegment=!0},R.generateInitSegment=function e(R){var C=this.audioCodec,I=this.videoCodec;if(!R||!R.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var _=this.initData=Object(O.parseInitSegment)(R);C||(C=u(_.audio,x.ElementaryStreamTypes.AUDIO)),I||(I=u(_.video,x.ElementaryStreamTypes.VIDEO));var P={};_.audio&&_.video?P.audiovideo={"container":"video/mp4","codec":C+","+I,"initSegment":R,"id":"main"}:_.audio?P.audio={"container":"audio/mp4","codec":C,"initSegment":R,"id":"audio"}:_.video?P.video={"container":"video/mp4","codec":I,"initSegment":R,"id":"main"}:w.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=P},R.remux=function e(R,C,I,x,P){var M=this.initPTS,N=this.lastEndDTS,U={"audio":void 0,"video":void 0,"text":x,"id3":I,"initSegment":void 0};Object(_.isFiniteNumber)(N)||(N=this.lastEndDTS=P||0);var B=C.samples;if(!B||!B.length)return U;var G={"initPTS":void 0,"timescale":1},j=this.initData;if(j&&j.length||(this.generateInitSegment(B),j=this.initData),!j||!j.length)return w.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),U;this.emitInitSegment&&(G.tracks=this.initTracks,this.emitInitSegment=!1),Object(_.isFiniteNumber)(M)||(this.initPTS=G.initPTS=M=F(j,B,N));var K=Object(O.getDuration)(B,j),H=N,V=K+H;Object(O.offsetStartDTS)(j,B,M),K>0?this.lastEndDTS=V:(w.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var W=!!j.audio,Y=!!j.video,q="";W&&(q+="audio"),Y&&(q+="video");var X={"data1":B,"startPTS":H,"startDTS":H,"endPTS":V,"endDTS":V,"type":q,"hasAudio":W,"hasVideo":Y,"nb":1,"dropped":0};return U.audio="audio"===X.type?X:void 0,U.video="audio"!==X.type?X:void 0,U.text=x,U.id3=I,U.initSegment=G,U},e}(),F=function e(R,C,I){return Object(O.getStartDTS)(R,C)-I};function u(R,C){var I=null==R?void 0:R.codec;return I&&I.length>4?I:"hvc1"===I?"hvc1.1.c.L120.90":"av01"===I?"av01.0.04M.08":"avc1"===I||C===x.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=P},"./src/task-loop.ts":function srcTaskLoopTs(R,C,I){I.r(C),I.d(C,"default",(function(){return _}));var _=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var R=e.prototype;return R.destroy=function e(){this.onHandlerDestroying(),this.onHandlerDestroyed()},R.onHandlerDestroying=function e(){this.clearNextTick(),this.clearInterval()},R.onHandlerDestroyed=function e(){},R.hasInterval=function e(){return!!this._tickInterval},R.hasNextTick=function e(){return!!this._tickTimer},R.setInterval=function e(R){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,R),!0)},R.clearInterval=function e(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},R.clearNextTick=function e(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},R.tick=function e(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},R.tickImmediate=function e(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},R.doTick=function e(){},e}()},"./src/types/cmcd.ts":function srcTypesCmcdTs(R,C,I){I.r(C),I.d(C,"CMCDVersion",(function(){return w})),I.d(C,"CMCDObjectType",(function(){return _})),I.d(C,"CMCDStreamingFormat",(function(){return O})),I.d(C,"CMCDStreamType",(function(){return x}));var _,O,x,w=1;!function(R){R.MANIFEST="m",R.AUDIO="a",R.VIDEO="v",R.MUXED="av",R.INIT="i",R.CAPTION="c",R.TIMED_TEXT="tt",R.KEY="k",R.OTHER="o"}(_||(_={})),function(R){R.DASH="d",R.HLS="h",R.SMOOTH="s",R.OTHER="o"}(O||(O={})),function(R){R.VOD="v",R.LIVE="l"}(x||(x={}))},"./src/types/level.ts":function srcTypesLevelTs(R,C,I){function i(R,C){for(var I=0;I<C.length;I++){var _=C[I];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(R,_.key,_)}}var _;function s(R,C){var I=R.canSkipUntil,O=R.canSkipDateRanges,x=R.endSN;return I&&(void 0!==C?C-x:0)<I?O?_.v2:_.Yes:_.No}I.r(C),I.d(C,"HlsSkip",(function(){return _})),I.d(C,"getSkipValue",(function(){return s})),I.d(C,"HlsUrlParameters",(function(){return O})),I.d(C,"Level",(function(){return x})),function(R){R.No="",R.Yes="YES",R.v2="v2"}(_||(_={}));var O=function(){function e(R,C,I){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=R,this.part=C,this.skip=I}return e.prototype.addDirectives=function e(R){var C=new self.URL(R);return void 0!==this.msn&&C.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&C.searchParams.set("_HLS_part",this.part.toString()),this.skip&&C.searchParams.set("_HLS_skip",this.skip),C.toString()},e}(),x=function(){function e(R){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[R.url],this.attrs=R.attrs,this.bitrate=R.bitrate,R.details&&(this.details=R.details),this.id=R.id||0,this.name=R.name,this.width=R.width||0,this.height=R.height||0,this.audioCodec=R.audioCodec,this.videoCodec=R.videoCodec,this.unknownCodecs=R.unknownCodecs,this.codecSet=[R.videoCodec,R.audioCodec].filter((function(R){return R})).join(",").replace(/\.[^.,]+/g,"")}return function a(R,C,I){return C&&i(R.prototype,C),I&&i(R,I),R}(e,[{"key":"maxBitrate","get":function e(){return Math.max(this.realBitrate,this.bitrate)}},{"key":"uri","get":function e(){return this.url[this._urlId]||""}},{"key":"urlId","get":function e(){return this._urlId},"set":function e(R){var C=R%this.url.length;this._urlId!==C&&(this.details=void 0,this._urlId=C)}}]),e}()},"./src/types/loader.ts":function srcTypesLoaderTs(R,C,I){var _,O;I.r(C),I.d(C,"PlaylistContextType",(function(){return _})),I.d(C,"PlaylistLevelType",(function(){return O})),function(R){R.MANIFEST="manifest",R.LEVEL="level",R.AUDIO_TRACK="audioTrack",R.SUBTITLE_TRACK="subtitleTrack"}(_||(_={})),function(R){R.MAIN="main",R.AUDIO="audio",R.SUBTITLE="subtitle"}(O||(O={}))},"./src/types/transmuxer.ts":function srcTypesTransmuxerTs(R,C,I){I.r(C),I.d(C,"ChunkMetadata",(function(){return _}));var _=function e(R,C,I,_,O,x){void 0===_&&(_=0),void 0===O&&(O=-1),void 0===x&&(x=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={"start":0,"executeStart":0,"executeEnd":0,"end":0},this.buffering={"audio":{"start":0,"executeStart":0,"executeEnd":0,"end":0},"video":{"start":0,"executeStart":0,"executeEnd":0,"end":0},"audiovideo":{"start":0,"executeStart":0,"executeEnd":0,"end":0}},this.level=R,this.sn=C,this.id=I,this.size=_,this.part=O,this.partial=x}},"./src/utils/attr-list.ts":function srcUtilsAttrListTs(R,C,I){I.r(C),I.d(C,"AttrList",(function(){return x}));var _=/^(\d+)x(\d+)$/,O=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,x=function(){function e(R){for(var C in"string"==typeof R&&(R=e.parseAttrList(R)),R)R.hasOwnProperty(C)&&(this[C]=R[C])}var R=e.prototype;return R.decimalInteger=function e(R){var C=parseInt(this[R],10);return C>Number.MAX_SAFE_INTEGER?1/0:C},R.hexadecimalInteger=function e(R){if(this[R]){var C=(this[R]||"0x").slice(2);C=(1&C.length?"0":"")+C;for(var I=new Uint8Array(C.length/2),_=0;_<C.length/2;_++)I[_]=parseInt(C.slice(2*_,2*_+2),16);return I}return null},R.hexadecimalIntegerAsNumber=function e(R){var C=parseInt(this[R],16);return C>Number.MAX_SAFE_INTEGER?1/0:C},R.decimalFloatingPoint=function e(R){return parseFloat(this[R])},R.optionalFloat=function e(R,C){var I=this[R];return I?parseFloat(I):C},R.enumeratedString=function e(R){return this[R]},R.bool=function e(R){return"YES"===this[R]},R.decimalResolution=function e(R){var C=_.exec(this[R]);if(null!==C)return{"width":parseInt(C[1],10),"height":parseInt(C[2],10)}},e.parseAttrList=function e(R){var C,I={};for(O.lastIndex=0;null!==(C=O.exec(R));){var _=C[2];0===_.indexOf('"')&&_.lastIndexOf('"')===_.length-1&&(_=_.slice(1,-1)),I[C[1]]=_}return I},e}()},"./src/utils/binary-search.ts":function srcUtilsBinarySearchTs(R,C,I){I.r(C);C.default={"search":function e(R,C){for(var I=0,_=R.length-1,O=null,x=null;I<=_;){var w=C(x=R[O=(I+_)/2|0]);if(w>0)I=O+1;else{if(!(w<0))return x;_=O-1}}return null}}},"./src/utils/buffer-helper.ts":function srcUtilsBufferHelperTs(R,C,I){I.r(C),I.d(C,"BufferHelper",(function(){return x}));var _=I("./src/utils/logger.ts"),O={"length":0,"start":function e(){return 0},"end":function e(){return 0}},x=function(){function e(){}return e.isBuffered=function t(R,C){try{if(R)for(var I=e.getBuffered(R),_=0;_<I.length;_++)if(C>=I.start(_)&&C<=I.end(_))return!0}catch(R){}return!1},e.bufferInfo=function t(R,C,I){try{if(R){var _,O=e.getBuffered(R),x=[];for(_=0;_<O.length;_++)x.push({"start":O.start(_),"end":O.end(_)});return this.bufferedInfo(x,C,I)}}catch(R){}return{"len":0,"start":C,"end":C,"nextStart":void 0}},e.bufferedInfo=function e(R,C,I){C=Math.max(0,C),R.sort((function(R,C){var I=R.start-C.start;return I||C.end-R.end}));var _=[];if(I)for(var O=0;O<R.length;O++){var x=_.length;if(x){var w=_[x-1].end;R[O].start-w<I?R[O].end>w&&(_[x-1].end=R[O].end):_.push(R[O])}else _.push(R[O])}else _=R;for(var P,F=0,M=C,N=C,U=0;U<_.length;U++){var B=_[U].start,G=_[U].end;if(C+I>=B&&C<G)M=B,F=(N=G)-C;else if(C+I<B){P=B;break}}return{"len":F,"start":M||0,"end":N||0,"nextStart":P}},e.getBuffered=function e(R){try{return R.buffered}catch(e){return _.logger.log("failed to get media.buffered",e),O}},e}()},"./src/utils/cea-608-parser.ts":function srcUtilsCea608ParserTs(R,C,I){I.r(C),I.d(C,"Row",(function(){return W})),I.d(C,"CaptionScreen",(function(){return Y}));var _,O=I("./src/utils/logger.ts"),x={"42":225,"92":233,"94":237,"95":243,"96":250,"123":231,"124":247,"125":209,"126":241,"127":9608,"128":174,"129":176,"130":189,"131":191,"132":8482,"133":162,"134":163,"135":9834,"136":224,"137":32,"138":232,"139":226,"140":234,"141":238,"142":244,"143":251,"144":193,"145":201,"146":211,"147":218,"148":220,"149":252,"150":8216,"151":161,"152":42,"153":8217,"154":9473,"155":169,"156":8480,"157":8226,"158":8220,"159":8221,"160":192,"161":194,"162":199,"163":200,"164":202,"165":203,"166":235,"167":206,"168":207,"169":239,"170":212,"171":217,"172":249,"173":219,"174":171,"175":187,"176":195,"177":227,"178":205,"179":204,"180":236,"181":210,"182":242,"183":213,"184":245,"185":123,"186":125,"187":92,"188":94,"189":95,"190":124,"191":8764,"192":196,"193":228,"194":214,"195":246,"196":223,"197":165,"198":164,"199":9475,"200":197,"201":229,"202":216,"203":248,"204":9487,"205":9491,"206":9495,"207":9499},w=function e(R){var C=R;return x.hasOwnProperty(R)&&(C=x[R]),String.fromCharCode(C)},P=15,F=100,M={"17":1,"18":3,"21":5,"22":7,"23":9,"16":11,"19":12,"20":14},N={"17":2,"18":4,"21":6,"22":8,"23":10,"19":13,"20":15},U={"25":1,"26":3,"29":5,"30":7,"31":9,"24":11,"27":12,"28":14},B={"25":2,"26":4,"29":6,"30":8,"31":10,"27":13,"28":15},G=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(R){R[R.ERROR=0]="ERROR",R[R.TEXT=1]="TEXT",R[R.WARNING=2]="WARNING",R[R.INFO=2]="INFO",R[R.DEBUG=3]="DEBUG",R[R.DATA=3]="DATA"}(_||(_={}));var j=function(){function e(){this.time=null,this.verboseLevel=_.ERROR}return e.prototype.log=function e(R,C){this.verboseLevel>=R&&O.logger.log(this.time+" ["+R+"] "+C)},e}(),K=function e(R){for(var C=[],I=0;I<R.length;I++)C.push(R[I].toString(16));return C},H=function(){function e(R,C,I,_,O){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=R||"white",this.underline=C||!1,this.italics=I||!1,this.background=_||"black",this.flash=O||!1}var R=e.prototype;return R.reset=function e(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},R.setStyles=function e(R){for(var C=["foreground","underline","italics","background","flash"],I=0;I<C.length;I++){var _=C[I];R.hasOwnProperty(_)&&(this[_]=R[_])}},R.isDefault=function e(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},R.equals=function e(R){return this.foreground===R.foreground&&this.underline===R.underline&&this.italics===R.italics&&this.background===R.background&&this.flash===R.flash},R.copy=function e(R){this.foreground=R.foreground,this.underline=R.underline,this.italics=R.italics,this.background=R.background,this.flash=R.flash},R.toString=function e(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),V=function(){function e(R,C,I,_,O,x){this.uchar=void 0,this.penState=void 0,this.uchar=R||" ",this.penState=new H(C,I,_,O,x)}var R=e.prototype;return R.reset=function e(){this.uchar=" ",this.penState.reset()},R.setChar=function e(R,C){this.uchar=R,this.penState.copy(C)},R.setPenState=function e(R){this.penState.copy(R)},R.equals=function e(R){return this.uchar===R.uchar&&this.penState.equals(R.penState)},R.copy=function e(R){this.uchar=R.uchar,this.penState.copy(R.penState)},R.isEmpty=function e(){return" "===this.uchar&&this.penState.isDefault()},e}(),W=function(){function e(R){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var C=0;C<F;C++)this.chars.push(new V);this.logger=R,this.pos=0,this.currPenState=new H}var R=e.prototype;return R.equals=function e(R){for(var C=!0,I=0;I<F;I++)if(!this.chars[I].equals(R.chars[I])){C=!1;break}return C},R.copy=function e(R){for(var C=0;C<F;C++)this.chars[C].copy(R.chars[C])},R.isEmpty=function e(){for(var R=!0,C=0;C<F;C++)if(!this.chars[C].isEmpty()){R=!1;break}return R},R.setCursor=function e(R){this.pos!==R&&(this.pos=R),this.pos<0?(this.logger.log(_.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>F&&(this.logger.log(_.DEBUG,"Too large cursor position "+this.pos),this.pos=F)},R.moveCursor=function e(R){var C=this.pos+R;if(R>1)for(var I=this.pos+1;I<C+1;I++)this.chars[I].setPenState(this.currPenState);this.setCursor(C)},R.backSpace=function e(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},R.insertChar=function e(R){R>=144&&this.backSpace();var C=w(R);this.pos>=F?this.logger.log(_.ERROR,"Cannot insert "+R.toString(16)+" ("+C+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(C,this.currPenState),this.moveCursor(1))},R.clearFromPos=function e(R){var C;for(C=R;C<F;C++)this.chars[C].reset()},R.clear=function e(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},R.clearToEndOfRow=function e(){this.clearFromPos(this.pos)},R.getTextString=function e(){for(var R=[],C=!0,I=0;I<F;I++){var _=this.chars[I].uchar;" "!==_&&(C=!1),R.push(_)}return C?"":R.join("")},R.setPenStyles=function e(R){this.currPenState.setStyles(R),this.chars[this.pos].setPenState(this.currPenState)},e}(),Y=function(){function e(R){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var C=0;C<P;C++)this.rows.push(new W(R));this.logger=R,this.currRow=P-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var R=e.prototype;return R.reset=function e(){for(var R=0;R<P;R++)this.rows[R].clear();this.currRow=P-1},R.equals=function e(R){for(var C=!0,I=0;I<P;I++)if(!this.rows[I].equals(R.rows[I])){C=!1;break}return C},R.copy=function e(R){for(var C=0;C<P;C++)this.rows[C].copy(R.rows[C])},R.isEmpty=function e(){for(var R=!0,C=0;C<P;C++)if(!this.rows[C].isEmpty()){R=!1;break}return R},R.backSpace=function e(){this.rows[this.currRow].backSpace()},R.clearToEndOfRow=function e(){this.rows[this.currRow].clearToEndOfRow()},R.insertChar=function e(R){this.rows[this.currRow].insertChar(R)},R.setPen=function e(R){this.rows[this.currRow].setPenStyles(R)},R.moveCursor=function e(R){this.rows[this.currRow].moveCursor(R)},R.setCursor=function e(R){this.logger.log(_.INFO,"setCursor: "+R),this.rows[this.currRow].setCursor(R)},R.setPAC=function e(R){this.logger.log(_.INFO,"pacData = "+JSON.stringify(R));var C=R.row-1;if(this.nrRollUpRows&&C<this.nrRollUpRows-1&&(C=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==C){for(var I=0;I<P;I++)this.rows[I].clear();var O=this.currRow+1-this.nrRollUpRows,x=this.lastOutputScreen;if(x){var w=x.rows[O].cueStartTime,F=this.logger.time;if(w&&null!==F&&w<F)for(var M=0;M<this.nrRollUpRows;M++)this.rows[C-this.nrRollUpRows+M+1].copy(x.rows[O+M])}}this.currRow=C;var N=this.rows[this.currRow];if(null!==R.indent){var U=R.indent,B=Math.max(U-1,0);N.setCursor(R.indent),R.color=N.chars[B].penState.foreground}var G={"foreground":R.color,"underline":R.underline,"italics":R.italics,"background":"black","flash":!1};this.setPen(G)},R.setBkgData=function e(R){this.logger.log(_.INFO,"bkgData = "+JSON.stringify(R)),this.backSpace(),this.setPen(R),this.insertChar(32)},R.setRollUpRows=function e(R){this.nrRollUpRows=R},R.rollUp=function e(){if(null!==this.nrRollUpRows){this.logger.log(_.TEXT,this.getDisplayText());var R=this.currRow+1-this.nrRollUpRows,C=this.rows.splice(R,1)[0];C.clear(),this.rows.splice(this.currRow,0,C),this.logger.log(_.INFO,"Rolling up")}else this.logger.log(_.DEBUG,"roll_up but nrRollUpRows not set yet")},R.getDisplayText=function e(R){R=R||!1;for(var C=[],I="",_=-1,O=0;O<P;O++){var x=this.rows[O].getTextString();x&&(_=O+1,R?C.push("Row "+_+": '"+x+"'"):C.push(x.trim()))}return C.length>0&&(I=R?"["+C.join(" | ")+"]":C.join("\n")),I},R.getTextAndFormat=function e(){return this.rows},e}(),q=function(){function e(R,C,I){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=R,this.outputFilter=C,this.mode=null,this.verbose=0,this.displayedMemory=new Y(I),this.nonDisplayedMemory=new Y(I),this.lastOutputScreen=new Y(I),this.currRollUpRow=this.displayedMemory.rows[P-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=I}var R=e.prototype;return R.reset=function e(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[P-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},R.getHandler=function e(){return this.outputFilter},R.setHandler=function e(R){this.outputFilter=R},R.setPAC=function e(R){this.writeScreen.setPAC(R)},R.setBkgData=function e(R){this.writeScreen.setBkgData(R)},R.setMode=function e(R){R!==this.mode&&(this.mode=R,this.logger.log(_.INFO,"MODE="+R),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=R)},R.insertChars=function e(R){for(var C=0;C<R.length;C++)this.writeScreen.insertChar(R[C]);var I=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(_.INFO,I+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(_.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},R.ccRCL=function e(){this.logger.log(_.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},R.ccBS=function e(){this.logger.log(_.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},R.ccAOF=function e(){},R.ccAON=function e(){},R.ccDER=function e(){this.logger.log(_.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},R.ccRU=function e(R){this.logger.log(_.INFO,"RU("+R+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(R)},R.ccFON=function e(){this.logger.log(_.INFO,"FON - Flash On"),this.writeScreen.setPen({"flash":!0})},R.ccRDC=function e(){this.logger.log(_.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},R.ccTR=function e(){this.logger.log(_.INFO,"TR"),this.setMode("MODE_TEXT")},R.ccRTD=function e(){this.logger.log(_.INFO,"RTD"),this.setMode("MODE_TEXT")},R.ccEDM=function e(){this.logger.log(_.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},R.ccCR=function e(){this.logger.log(_.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},R.ccENM=function e(){this.logger.log(_.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},R.ccEOC=function e(){if(this.logger.log(_.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var R=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=R,this.writeScreen=this.nonDisplayedMemory,this.logger.log(_.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},R.ccTO=function e(R){this.logger.log(_.INFO,"TO("+R+") - Tab Offset"),this.writeScreen.moveCursor(R)},R.ccMIDROW=function e(R){var C={"flash":!1};if(C.underline=R%2==1,C.italics=R>=46,C.italics)C.foreground="white";else{var I=Math.floor(R/2)-16;C.foreground=["white","green","blue","cyan","red","yellow","magenta"][I]}this.logger.log(_.INFO,"MIDROW: "+JSON.stringify(C)),this.writeScreen.setPen(C)},R.outputDataUpdate=function e(R){void 0===R&&(R=!1);var C=this.logger.time;null!==C&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,C,this.lastOutputScreen),R&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:C):this.cueStartTime=C,this.lastOutputScreen.copy(this.displayedMemory))},R.cueSplitAtTime=function e(R){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,R,this.displayedMemory),this.cueStartTime=R))},e}(),X=function(){function e(R,C,I){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var _=new j;this.channels=[null,new q(R,C,_),new q(R+1,I,_)],this.cmdHistory={"a":null,"b":null},this.logger=_}var R=e.prototype;return R.getHandler=function e(R){return this.channels[R].getHandler()},R.setHandler=function e(R,C){this.channels[R].setHandler(C)},R.addData=function e(R,C){var I,O,x,w=!1;this.logger.time=R;for(var P=0;P<C.length;P+=2)if(O=127&C[P],x=127&C[P+1],0!==O||0!==x){if(this.logger.log(_.DATA,"["+K([C[P],C[P+1]])+"] -> ("+K([O,x])+")"),(I=this.parseCmd(O,x))||(I=this.parseMidrow(O,x)),I||(I=this.parsePAC(O,x)),I||(I=this.parseBackgroundAttributes(O,x)),!I&&(w=this.parseChars(O,x))){var F=this.currentChannel;if(F&&F>0)this.channels[F].insertChars(w);else this.logger.log(_.WARNING,"No channel found yet. TEXT-MODE?")}I||w||this.logger.log(_.WARNING,"Couldn't parse cleaned data "+K([O,x])+" orig: "+K([C[P],C[P+1]]))}},R.parseCmd=function e(R,C){var I=this.cmdHistory;if(!((20===R||28===R||21===R||29===R)&&C>=32&&C<=47)&&!((23===R||31===R)&&C>=33&&C<=35))return!1;if(L(R,C,I))return b(null,null,I),this.logger.log(_.DEBUG,"Repeated command ("+K([R,C])+") is dropped"),!0;var O=20===R||21===R||23===R?1:2,x=this.channels[O];return 20===R||21===R||28===R||29===R?32===C?x.ccRCL():33===C?x.ccBS():34===C?x.ccAOF():35===C?x.ccAON():36===C?x.ccDER():37===C?x.ccRU(2):38===C?x.ccRU(3):39===C?x.ccRU(4):40===C?x.ccFON():41===C?x.ccRDC():42===C?x.ccTR():43===C?x.ccRTD():44===C?x.ccEDM():45===C?x.ccCR():46===C?x.ccENM():47===C&&x.ccEOC():x.ccTO(C-32),b(R,C,I),this.currentChannel=O,!0},R.parseMidrow=function e(R,C){var I=0;if((17===R||25===R)&&C>=32&&C<=47){if((I=17===R?1:2)!==this.currentChannel)return this.logger.log(_.ERROR,"Mismatch channel in midrow parsing"),!1;var O=this.channels[I];return!!O&&(O.ccMIDROW(C),this.logger.log(_.DEBUG,"MIDROW ("+K([R,C])+")"),!0)}return!1},R.parsePAC=function e(R,C){var I,_=this.cmdHistory;if(!((R>=17&&R<=23||R>=25&&R<=31)&&C>=64&&C<=127)&&!((16===R||24===R)&&C>=64&&C<=95))return!1;if(L(R,C,_))return b(null,null,_),!0;var O=R<=23?1:2;I=C>=64&&C<=95?1===O?M[R]:U[R]:1===O?N[R]:B[R];var x=this.channels[O];return!!x&&(x.setPAC(this.interpretPAC(I,C)),b(R,C,_),this.currentChannel=O,!0)},R.interpretPAC=function e(R,C){var I,_={"color":null,"italics":!1,"indent":null,"underline":!1,"row":R};return I=C>95?C-96:C-64,_.underline=1==(1&I),I<=13?_.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(I/2)]:I<=15?(_.italics=!0,_.color="white"):_.indent=4*Math.floor((I-16)/2),_},R.parseChars=function e(R,C){var I,O,x=null,P=null;(R>=25?(I=2,P=R-8):(I=1,P=R),P>=17&&P<=19)?(O=17===P?C+80:18===P?C+112:C+144,this.logger.log(_.INFO,"Special char '"+w(O)+"' in channel "+I),x=[O]):R>=32&&R<=127&&(x=0===C?[R]:[R,C]);if(x){var F=K(x);this.logger.log(_.DEBUG,"Char codes =  "+F.join(",")),b(R,C,this.cmdHistory)}return x},R.parseBackgroundAttributes=function e(R,C){var I;if(!((16===R||24===R)&&C>=32&&C<=47)&&!((23===R||31===R)&&C>=45&&C<=47))return!1;var _={};16===R||24===R?(I=Math.floor((C-32)/2),_.background=G[I],C%2==1&&(_.background=_.background+"_semi")):45===C?_.background="transparent":(_.foreground="black",47===C&&(_.underline=!0));var O=R<=23?1:2;return this.channels[O].setBkgData(_),b(R,C,this.cmdHistory),!0},R.reset=function e(){for(var R=0;R<Object.keys(this.channels).length;R++){var C=this.channels[R];C&&C.reset()}this.cmdHistory={"a":null,"b":null}},R.cueSplitAtTime=function e(R){for(var C=0;C<this.channels.length;C++){var I=this.channels[C];I&&I.cueSplitAtTime(R)}},e}();function b(R,C,I){I.a=R,I.b=C}function L(R,C,I){return I.a===R&&I.b===C}C.default=X},"./src/utils/codecs.ts":function srcUtilsCodecsTs(R,C,I){I.r(C),I.d(C,"isCodecType",(function(){return a})),I.d(C,"isCodecSupportedInMp4",(function(){return n}));var _={"audio":{"a3ds":!0,"ac-3":!0,"ac-4":!0,"alac":!0,"alaw":!0,"dra1":!0,"dts+":!0,"dts-":!0,"dtsc":!0,"dtse":!0,"dtsh":!0,"ec-3":!0,"enca":!0,"g719":!0,"g726":!0,"m4ae":!0,"mha1":!0,"mha2":!0,"mhm1":!0,"mhm2":!0,"mlpa":!0,"mp4a":!0,"raw ":!0,"Opus":!0,"samr":!0,"sawb":!0,"sawp":!0,"sevc":!0,"sqcp":!0,"ssmv":!0,"twos":!0,"ulaw":!0},"video":{"avc1":!0,"avc2":!0,"avc3":!0,"avc4":!0,"avcp":!0,"av01":!0,"drac":!0,"dvav":!0,"dvhe":!0,"encv":!0,"hev1":!0,"hvc1":!0,"mjp2":!0,"mp4v":!0,"mvc1":!0,"mvc2":!0,"mvc3":!0,"mvc4":!0,"resv":!0,"rv60":!0,"s263":!0,"svc1":!0,"svc2":!0,"vc-1":!0,"vp08":!0,"vp09":!0},"text":{"stpp":!0,"wvtt":!0}};function a(R,C){var I=_[C];return!!I&&!0===I[R.slice(0,4)]}function n(R,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":function srcUtilsCuesTs(R,C,I){I.r(C);var _=I("./src/utils/vttparser.ts"),O=I("./src/utils/webvtt-parser.ts"),x=I("./src/utils/texttrack-utils.ts"),w=/\s/,P={"newCue":function e(R,C,I,P){for(var F,M,N,U,B,G=[],j=self.VTTCue||self.TextTrackCue,K=0;K<P.rows.length;K++)if(N=!0,U=0,B="",!(F=P.rows[K]).isEmpty()){for(var H=0;H<F.chars.length;H++)w.test(F.chars[H].uchar)&&N?U++:(B+=F.chars[H].uchar,N=!1);F.cueStartTime=C,C===I&&(I+=1e-4),U>=16?U--:U++;var V=Object(_.fixLineBreaks)(B.trim()),W=Object(O.generateCueId)(C,I,V);R&&R.cues&&R.cues.getCueById(W)||((M=new j(C,I,V)).id=W,M.line=K+1,M.align="left",M.position=10+Math.min(80,10*Math.floor(8*U/32)),G.push(M))}return R&&G.length&&(G.sort((function(R,C){return"auto"===R.line||"auto"===C.line?0:R.line>8&&C.line>8?C.line-R.line:R.line-C.line})),G.forEach((function(C){return Object(x.addCueToTrack)(R,C)}))),G}};C.default=P},"./src/utils/discontinuities.ts":function srcUtilsDiscontinuitiesTs(R,C,I){I.r(C),I.d(C,"findFirstFragWithCC",(function(){return s})),I.d(C,"shouldAlignOnDiscontinuities",(function(){return o})),I.d(C,"findDiscontinuousReferenceFrag",(function(){return l})),I.d(C,"adjustSlidingStart",(function(){return f})),I.d(C,"alignStream",(function(){return d})),I.d(C,"alignPDT",(function(){return h})),I.d(C,"alignFragmentByPDTDelta",(function(){return v})),I.d(C,"alignMediaPlaylistByPDT",(function(){return g}));var _=I("./src/polyfills/number.ts"),O=I("./src/utils/logger.ts"),x=I("./src/controller/level-helper.ts");function s(R,C){for(var I=null,_=0,O=R.length;_<O;_++){var x=R[_];if(x&&x.cc===C){I=x;break}}return I}function o(R,C,I){return!(!C.details||!(I.endCC>I.startCC||R&&R.cc<I.startCC))}function l(R,C){var I=R.fragments,_=C.fragments;if(_.length&&I.length){var x=s(I,_[0].cc);if(x&&(!x||x.startPTS))return x;O.logger.log("No frag in previous level to align on")}else O.logger.log("No fragments to align")}function u(R,C){if(R){var I=R.start+C;R.start=R.startPTS=I,R.endPTS=I+R.duration}}function f(R,C){for(var I=C.fragments,_=0,O=I.length;_<O;_++)u(I[_],R);C.fragmentHint&&u(C.fragmentHint,R),C.alignedSliding=!0}function d(R,C,I){C&&(!function c(R,C,I){if(o(R,I,C)){var x=l(I.details,C);x&&Object(_.isFiniteNumber)(x.start)&&(O.logger.log("Adjusting PTS using last level due to CC increase within current level "+C.url),f(x.start,C))}}(R,I,C),!I.alignedSliding&&C.details&&h(I,C.details),I.alignedSliding||!C.details||I.skippedSegments||Object(x.adjustSliding)(C.details,I))}function h(R,C){if(C.fragments.length&&R.hasProgramDateTime&&C.hasProgramDateTime){var I=C.fragments[0].programDateTime,x=R.fragments[0].programDateTime,w=(x-I)/1e3+C.fragments[0].start;w&&Object(_.isFiniteNumber)(w)&&(O.logger.log("Adjusting PTS using programDateTime delta "+(x-I)+"ms, sliding:"+w.toFixed(3)+" "+R.url+" "),f(w,R))}}function v(R,C){var I=R.programDateTime;if(I){var _=(I-C)/1e3;R.start=R.startPTS=_,R.endPTS=_+R.duration}}function g(R,C){if(C.fragments.length&&R.hasProgramDateTime&&C.hasProgramDateTime){var I=C.fragments[0].programDateTime-1e3*C.fragments[0].start;R.fragments.forEach((function(R){v(R,I)})),R.fragmentHint&&v(R.fragmentHint,I),R.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function srcUtilsEwmaBandwidthEstimatorTs(R,C,I){I.r(C);var _=I("./src/utils/ewma.ts"),O=function(){function e(R,C,I){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=I,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _.default(R),this.fast_=new _.default(C)}var R=e.prototype;return R.update=function e(R,C){var I=this.slow_,O=this.fast_;this.slow_.halfLife!==R&&(this.slow_=new _.default(R,I.getEstimate(),I.getTotalWeight())),this.fast_.halfLife!==C&&(this.fast_=new _.default(C,O.getEstimate(),O.getTotalWeight()))},R.sample=function e(R,C){var I=(R=Math.max(R,this.minDelayMs_))/1e3,_=8*C/I;this.fast_.sample(I,_),this.slow_.sample(I,_)},R.canEstimate=function e(){var R=this.fast_;return R&&R.getTotalWeight()>=this.minWeight_},R.getEstimate=function e(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},R.destroy=function e(){},e}();C.default=O},"./src/utils/ewma.ts":function srcUtilsEwmaTs(R,C,I){I.r(C);var _=function(){function e(R,C,I){void 0===C&&(C=0),void 0===I&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=R,this.alpha_=R?Math.exp(Math.log(.5)/R):0,this.estimate_=C,this.totalWeight_=I}var R=e.prototype;return R.sample=function e(R,C){var I=Math.pow(this.alpha_,R);this.estimate_=C*(1-I)+I*this.estimate_,this.totalWeight_+=R},R.getTotalWeight=function e(){return this.totalWeight_},R.getEstimate=function e(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},e}();C.default=_},"./src/utils/fetch-loader.ts":function srcUtilsFetchLoaderTs(R,C,I){I.r(C),I.d(C,"fetchSupported",(function(){return v}));var _=I("./src/polyfills/number.ts"),O=I("./src/loader/load-stats.ts"),x=I("./src/demux/chunk-cache.ts");function o(R){var C="function"==typeof Map?new Map:void 0;return o=function e(R){if(null===R||!function f(R){return-1!==Function.toString.call(R).indexOf("[native code]")}(R))return R;if("function"!=typeof R)throw new TypeError("Super expression must either be null or a function");if(void 0!==C){if(C.has(R))return C.get(R);C.set(R,i)}function i(){return l(R,arguments,c(this).constructor)}return i.prototype=Object.create(R.prototype,{"constructor":{"value":i,"enumerable":!1,"writable":!0,"configurable":!0}}),d(i,R)},o(R)}function l(R,C,I){return l=function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(R){return!1}}()?Reflect.construct:function e(R,C,I){var _=[null];_.push.apply(_,C);var O=new(Function.bind.apply(R,_));return I&&d(O,I.prototype),O},l.apply(null,arguments)}function d(R,C){return d=Object.setPrototypeOf||function e(R,C){return R.__proto__=C,R},d(R,C)}function c(R){return c=Object.setPrototypeOf?Object.getPrototypeOf:function e(R){return R.__proto__||Object.getPrototypeOf(R)},c(R)}function h(){return h=Object.assign||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var _ in I)Object.prototype.hasOwnProperty.call(I,_)&&(R[_]=I[_])}return R},h.apply(this,arguments)}function v(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(R){}return!1}var w=function(){function e(R){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=R.fetchSetup||m,this.controller=new self.AbortController,this.stats=new O.LoadStats}var R=e.prototype;return R.destroy=function e(){this.loader=this.callbacks=null,this.abortInternal()},R.abortInternal=function e(){var R=this.response;R&&R.ok||(this.stats.aborted=!0,this.controller.abort())},R.abort=function e(){var R;this.abortInternal(),null!==(R=this.callbacks)&&void 0!==R&&R.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},R.load=function e(R,C,I){var O=this,x=this.stats;if(x.loading.start)throw new Error("Loader can only be used once.");x.loading.start=self.performance.now();var w=function p(R,C){var I={"method":"GET","mode":"cors","credentials":"same-origin","signal":C,"headers":new self.Headers(h({},R.headers))};R.rangeEnd&&I.headers.set("Range","bytes="+R.rangeStart+"-"+String(R.rangeEnd-1));return I}(R,this.controller.signal),F=I.onProgress,M="arraybuffer"===R.responseType,N=M?"byteLength":"length";this.context=R,this.config=C,this.callbacks=I,this.request=this.fetchSetup(R,w),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){O.abortInternal(),I.onTimeout(x,R,O.response)}),C.timeout),self.fetch(this.request).then((function(I){if(O.response=O.loader=I,!I.ok){var w=I.status,N=I.statusText;throw new P(N||"fetch, bad network response",w,I)}return x.loading.first=Math.max(self.performance.now(),x.loading.start),x.total=parseInt(I.headers.get("Content-Length")||"0"),F&&Object(_.isFiniteNumber)(C.highWaterMark)?O.loadProgressively(I,x,R,C.highWaterMark,F):M?I.arrayBuffer():I.text()})).then((function(w){var P=O.response;self.clearTimeout(O.requestTimeout),x.loading.end=Math.max(self.performance.now(),x.loading.first),x.loaded=x.total=w[N];var M={"url":P.url,"data":w};F&&!Object(_.isFiniteNumber)(C.highWaterMark)&&F(x,R,w,P),I.onSuccess(M,x,R,P)})).catch((function(C){if(self.clearTimeout(O.requestTimeout),!x.aborted){var _=C.code||0;I.onError({"code":_,"text":C.message},R,C.details)}}))},R.getCacheAge=function e(){var R=null;if(this.response){var C=this.response.headers.get("age");R=C?parseFloat(C):null}return R},R.loadProgressively=function e(R,C,I,_,O){void 0===_&&(_=0);var w=new x.default,P=R.body.getReader();return function e(){return P.read().then((function(x){if(x.done)return w.dataLength&&O(C,I,w.flush(),R),Promise.resolve(new ArrayBuffer(0));var P=x.value,F=P.length;return C.loaded+=F,F<_||w.dataLength?(w.push(P),w.dataLength>=_&&O(C,I,w.flush(),R)):O(C,I,P,R),e()})).catch((function(){return Promise.reject()}))}()},e}();function m(R,C){return new self.Request(R.url,C)}var P=function(R){function t(C,I,_){var O;return(O=R.call(this,C)||this).code=void 0,O.details=void 0,O.code=I,O.details=_,O}return function s(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,d(R,C)}(t,R),t}(o(Error));C.default=w},"./src/utils/imsc1-ttml-parser.ts":function srcUtilsImsc1TtmlParserTs(R,C,I){I.r(C),I.d(C,"IMSC1_CODEC",(function(){return M})),I.d(C,"parseIMSC1",(function(){return v}));var _=I("./src/utils/mp4-tools.ts"),O=I("./src/utils/vttparser.ts"),x=I("./src/utils/vttcue.ts"),w=I("./src/demux/id3.ts"),P=I("./src/utils/timescale-conversion.ts"),F=I("./src/utils/webvtt-parser.ts");function u(){return u=Object.assign||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var _ in I)Object.prototype.hasOwnProperty.call(I,_)&&(R[_]=I[_])}return R},u.apply(this,arguments)}var M="stpp.ttml.im1t",N=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,U=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,B={"left":"start","center":"center","right":"end","start":"start","end":"end"};function v(R,C,I,O,x){var F=Object(_.findBox)(new Uint8Array(R),["mdat"]);if(0!==F.length){var M=F[0],N=Object(w.utf8ArrayToStr)(new Uint8Array(R,M.start,M.end-M.start)),U=Object(P.toTimescaleFromScale)(C,1,I);try{O(g(N,U))}catch(R){x(R)}}else x(new Error("Could not parse IMSC1 mdat"))}function g(R,C){var I=(new DOMParser).parseFromString(R,"text/xml").getElementsByTagName("tt")[0];if(!I)throw new Error("Invalid ttml");var _={"frameRate":30,"subFrameRate":1,"frameRateMultiplier":0,"tickRate":0},O=Object.keys(_).reduce((function(R,C){return R[C]=I.getAttribute("ttp:"+C)||_[C],R}),{}),w="preserve"!==I.getAttribute("xml:space"),P=m(p(I,"styling","style")),M=m(p(I,"layout","region")),N=p(I,"body","[begin]");return[].map.call(N,(function(R){var I=y(R,w);if(!I||!R.hasAttribute("begin"))return null;var _=b(R.getAttribute("begin"),O),N=b(R.getAttribute("dur"),O),U=b(R.getAttribute("end"),O);if(null===_)throw S(R);if(null===U){if(null===N)throw S(R);U=_+N}var G=new x.default(_-C,U-C,I);G.id=Object(F.generateCueId)(G.startTime,G.endTime,G.text);var j=M[R.getAttribute("region")],K=P[R.getAttribute("style")];G.position=10,G.size=80;var H=E(j,K),V=H.textAlign;if(V){var W=B[V];W&&(G.lineAlign=W),G.align=V}return u(G,H),G})).filter((function(R){return null!==R}))}function p(R,C,I){var _=R.getElementsByTagName(C)[0];return _?[].slice.call(_.querySelectorAll(I)):[]}function m(R){return R.reduce((function(R,C){var I=C.getAttribute("xml:id");return I&&(R[I]=C),R}),{})}function y(R,C){return[].slice.call(R.childNodes).reduce((function(R,I,_){var O;return"br"===I.nodeName&&_?R+"\n":null!==(O=I.childNodes)&&void 0!==O&&O.length?y(I,C):C?R+I.textContent.trim().replace(/\s+/g," "):R+I.textContent}),"")}function E(R,C){var I="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(_,O){var x=T(C,I,O)||T(R,I,O);return x&&(_[O]=x),_}),{})}function T(R,C,I){return R.hasAttributeNS(C,I)?R.getAttributeNS(C,I):null}function S(R){return new Error("Could not parse ttml timestamp "+R)}function b(R,C){if(!R)return null;var I=Object(O.parseTimeStamp)(R);return null===I&&(N.test(R)?I=function L(R,C){var I=N.exec(R),_=(0|I[4])+(0|I[5])/C.subFrameRate;return 3600*(0|I[1])+60*(0|I[2])+(0|I[3])+_/C.frameRate}(R,C):U.test(R)&&(I=function A(R,C){var I=U.exec(R),_=Number(I[1]);switch(I[2]){case"h":return 3600*_;case"m":return 60*_;case"ms":return 1e3*_;case"f":return _/C.frameRate;case"t":return _/C.tickRate}return _}(R,C))),I}},"./src/utils/logger.ts":function srcUtilsLoggerTs(R,C,I){I.r(C),I.d(C,"enableLogs",(function(){return l})),I.d(C,"logger",(function(){return w}));var _=function e(){},O={"trace":_,"debug":_,"log":_,"warn":_,"info":_,"error":_},x=O;function s(R){var C=self.console[R];return C?C.bind(self.console,"["+R+"] >"):_}function l(R){if(self.console&&!0===R||"object"==typeof R){!function o(R){for(var C=arguments.length,I=new Array(C>1?C-1:0),_=1;_<C;_++)I[_-1]=arguments[_];I.forEach((function(C){x[C]=R[C]?R[C].bind(R):s(C)}))}(R,"debug","log","info","warn","error");try{x.log()}catch(R){x=O}}else x=O}var w=O},"./src/utils/mediakeys-helper.ts":function srcUtilsMediakeysHelperTs(R,C,I){var _;I.r(C),I.d(C,"KeySystems",(function(){return _})),I.d(C,"requestMediaKeySystemAccess",(function(){return O})),function(R){R.WIDEVINE="com.widevine.alpha",R.PLAYREADY="com.microsoft.playready"}(_||(_={}));var O="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function srcUtilsMediasourceHelperTs(R,C,I){function i(){return self.MediaSource||self.WebKitMediaSource}I.r(C),I.d(C,"getMediaSource",(function(){return i}))},"./src/utils/mp4-tools.ts":function srcUtilsMp4ToolsTs(R,C,I){I.r(C),I.d(C,"bin2str",(function(){return o})),I.d(C,"readUint16",(function(){return l})),I.d(C,"readUint32",(function(){return u})),I.d(C,"writeUint32",(function(){return f})),I.d(C,"findBox",(function(){return d})),I.d(C,"parseSegmentIndex",(function(){return c})),I.d(C,"parseInitSegment",(function(){return h})),I.d(C,"getStartDTS",(function(){return v})),I.d(C,"getDuration",(function(){return g})),I.d(C,"computeRawDurationFromSamples",(function(){return p})),I.d(C,"offsetStartDTS",(function(){return m})),I.d(C,"segmentValidRange",(function(){return y})),I.d(C,"appendUint8Array",(function(){return E}));var _=I("./src/utils/typed-array.ts"),O=I("./src/loader/fragment.ts"),x=Math.pow(2,32)-1,w=[].push;function o(R){return String.fromCharCode.apply(null,R)}function l(R,C){"data"in R&&(C+=R.start,R=R.data);var I=R[C]<<8|R[C+1];return I<0?65536+I:I}function u(R,C){"data"in R&&(C+=R.start,R=R.data);var I=R[C]<<24|R[C+1]<<16|R[C+2]<<8|R[C+3];return I<0?4294967296+I:I}function f(R,C,I){"data"in R&&(C+=R.start,R=R.data),R[C]=I>>24,R[C+1]=I>>16&255,R[C+2]=I>>8&255,R[C+3]=255&I}function d(R,C){var I,_,O,x=[];if(!C.length)return x;"data"in R?(I=R.data,_=R.start,O=R.end):(_=0,O=(I=R).byteLength);for(var P=_;P<O;){var F=u(I,P),M=F>1?P+F:O;if(o(I.subarray(P+4,P+8))===C[0])if(1===C.length)x.push({"data":I,"start":P+8,"end":M});else{var N=d({"data":I,"start":P+8,"end":M},C.slice(1));N.length&&w.apply(x,N)}P=M}return x}function c(R){var C=d(R,["moov"])[0],I=C?C.end:null,_=d(R,["sidx"]);if(!_||!_[0])return null;var O=[],x=_[0],w=x.data[0],P=0===w?8:16,F=u(x,P);P+=4;P+=0===w?8:16,P+=2;var M=x.end+0,N=l(x,P);P+=2;for(var U=0;U<N;U++){var B=P,G=u(x,B);B+=4;var j=2147483647&G;if(1===(2147483648&G)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var K=u(x,B);B+=4,O.push({"referenceSize":j,"subsegmentDuration":K,"info":{"duration":K/F,"start":M,"end":M+j-1}}),M+=j,P=B+=4}return{"earliestPresentationTime":0,"timescale":F,"version":w,"referencesCount":N,"references":O,"moovEndOffset":I}}function h(R){for(var C=[],I=d(R,["moov","trak"]),_=0;_<I.length;_++){var x=I[_],w=d(x,["tkhd"])[0];if(w){var P=w.data[w.start],F=0===P?12:20,M=u(w,F),N=d(x,["mdia","mdhd"])[0];if(N){var U=u(N,F=0===(P=N.data[N.start])?12:20),B=d(x,["mdia","hdlr"])[0];if(B){var G=o(B.data.subarray(B.start+8,B.start+12)),j={"soun":O.ElementaryStreamTypes.AUDIO,"vide":O.ElementaryStreamTypes.VIDEO}[G];if(j){var K=d(x,["mdia","minf","stbl","stsd"])[0],H=void 0;K&&(H=o(K.data.subarray(K.start+12,K.start+16))),C[M]={"timescale":U,"type":j},C[j]={"timescale":U,"id":M,"codec":H}}}}}}return d(R,["moov","mvex","trex"]).forEach((function(R){var I=u(R,4),_=C[I];_&&(_.default={"duration":u(R,12),"flags":u(R,20)})})),C}function v(R,C){return d(C,["moof","traf"]).reduce((function(C,I){var _=d(I,["tfdt"])[0],O=_.data[_.start],x=d(I,["tfhd"]).reduce((function(C,I){var x=u(I,4),w=R[x];if(w){var P=u(_,4);1===O&&(P*=Math.pow(2,32),P+=u(_,8));var F=P/(w.timescale||9e4);if(isFinite(F)&&(null===C||F<C))return F}return C}),null);return null!==x&&isFinite(x)&&(null===C||x<C)?x:C}),null)||0}function g(R,C){for(var I=0,_=0,x=0,w=d(R,["moof","traf"]),P=0;P<w.length;P++){var F=w[P],M=d(F,["tfhd"])[0],N=C[u(M,4)];if(N){var U=N.default,B=u(M,0)|(null==U?void 0:U.flags),G=null==U?void 0:U.duration;8&B&&(G=u(M,2&B?12:8));for(var j=N.timescale||9e4,K=d(F,["trun"]),H=0;H<K.length;H++){if(!(I=p(K[H]))&&G)I=G*u(K[H],4);N.type===O.ElementaryStreamTypes.VIDEO?_+=I/j:N.type===O.ElementaryStreamTypes.AUDIO&&(x+=I/j)}}}if(0===_&&0===x){var V=c(R);if(null!=V&&V.references)return V.references.reduce((function(R,C){return R+C.info.duration||0}),0)}return _||x}function p(R){var C=u(R,0),I=8;1&C&&(I+=4),4&C&&(I+=4);for(var _=0,O=u(R,4),x=0;x<O;x++){if(256&C)_+=u(R,I),I+=4;512&C&&(I+=4),1024&C&&(I+=4),2048&C&&(I+=4)}return _}function m(R,C,I){d(C,["moof","traf"]).forEach((function(C){d(C,["tfhd"]).forEach((function(_){var O=u(_,4),w=R[O];if(w){var P=w.timescale||9e4;d(C,["tfdt"]).forEach((function(R){var C=R.data[R.start],_=u(R,4);if(0===C)f(R,4,_-I*P);else{_*=Math.pow(2,32),_+=u(R,8),_-=I*P,_=Math.max(_,0);var O=Math.floor(_/(x+1)),w=Math.floor(_%(x+1));f(R,4,O),f(R,8,w)}}))}}))}))}function y(R){var C={"valid":null,"remainder":null},I=d(R,["moof"]);if(!I)return C;if(I.length<2)return C.remainder=R,C;var O=I[I.length-1];return C.valid=Object(_.sliceUint8)(R,0,O.start-8),C.remainder=Object(_.sliceUint8)(R,O.start-8),C}function E(R,C){var I=new Uint8Array(R.length+C.length);return I.set(R),I.set(C,R.length),I}},"./src/utils/output-filter.ts":function srcUtilsOutputFilterTs(R,C,I){I.r(C),I.d(C,"default",(function(){return _}));var _=function(){function e(R,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=C}var R=e.prototype;return R.dispatchCue=function e(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},R.newCue=function e(R,C,I){(null===this.startTime||this.startTime>R)&&(this.startTime=R),this.endTime=C,this.screen=I,this.timelineController.createCaptionsTrack(this.trackName)},R.reset=function e(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":function srcUtilsTexttrackUtilsTs(R,C,I){I.r(C),I.d(C,"sendAddTrackEvent",(function(){return a})),I.d(C,"addCueToTrack",(function(){return n})),I.d(C,"clearCurrentCues",(function(){return s})),I.d(C,"removeCuesInRange",(function(){return o})),I.d(C,"getCuesInRange",(function(){return u}));var _=I("./src/utils/logger.ts");function a(R,C){var I;try{I=new Event("addtrack")}catch(R){(I=document.createEvent("Event")).initEvent("addtrack",!1,!1)}I.track=R,C.dispatchEvent(I)}function n(R,C){var I=R.mode;if("disabled"===I&&(R.mode="hidden"),R.cues&&!R.cues.getCueById(C.id))try{if(R.addCue(C),!R.cues.getCueById(C.id))throw new Error("addCue is failed for: "+C)}catch(I){_.logger.debug("[texttrack-utils]: "+I);var O=new self.TextTrackCue(C.startTime,C.endTime,C.text);O.id=C.id,R.addCue(O)}"disabled"===I&&(R.mode=I)}function s(R){var C=R.mode;if("disabled"===C&&(R.mode="hidden"),R.cues)for(var I=R.cues.length;I--;)R.removeCue(R.cues[I]);"disabled"===C&&(R.mode=C)}function o(R,C,I){var _=R.mode;if("disabled"===_&&(R.mode="hidden"),R.cues&&R.cues.length>0)for(var O=u(R.cues,C,I),x=0;x<O.length;x++)R.removeCue(O[x]);"disabled"===_&&(R.mode=_)}function u(R,C,I){var _=[],O=function l(R,C){if(C<R[0].startTime)return 0;var I=R.length-1;if(C>R[I].endTime)return-1;for(var _=0,O=I;_<=O;){var x=Math.floor((O+_)/2);if(C<R[x].startTime)O=x-1;else{if(!(C>R[x].startTime&&_<I))return x;_=x+1}}return R[_].startTime-C<C-R[O].startTime?_:O}(R,C);if(O>-1)for(var x=O,w=R.length;x<w;x++){var P=R[x];if(P.startTime>=C&&P.endTime<=I)_.push(P);else if(P.startTime>I)return _}return _}},"./src/utils/time-ranges.ts":function srcUtilsTimeRangesTs(R,C,I){I.r(C);C.default={"toString":function e(R){for(var C="",I=R.length,_=0;_<I;_++)C+="["+R.start(_).toFixed(3)+","+R.end(_).toFixed(3)+"]";return C}}},"./src/utils/timescale-conversion.ts":function srcUtilsTimescaleConversionTs(R,C,I){I.r(C),I.d(C,"toTimescaleFromBase",(function(){return a})),I.d(C,"toTimescaleFromScale",(function(){return n})),I.d(C,"toMsFromMpegTsClock",(function(){return s})),I.d(C,"toMpegTsClockFromTimescale",(function(){return o}));var _=9e4;function a(R,C,I,_){void 0===I&&(I=1),void 0===_&&(_=!1);var O=R*C*I;return _?Math.round(O):O}function n(R,C,I,_){return void 0===I&&(I=1),void 0===_&&(_=!1),a(R,C,1/I,_)}function s(R,C){return void 0===C&&(C=!1),a(R,1e3,1/_,C)}function o(R,C){return void 0===C&&(C=1),a(R,_,1/C)}},"./src/utils/typed-array.ts":function srcUtilsTypedArrayTs(R,C,I){function i(R,C,I){return Uint8Array.prototype.slice?R.slice(C,I):new Uint8Array(Array.prototype.slice.call(R,C,I))}I.r(C),I.d(C,"sliceUint8",(function(){return i}))},"./src/utils/vttcue.ts":function srcUtilsVttcueTs(R,C,I){I.r(C),C.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var R=["","lr","rl"],C=["start","middle","end","left","right"];function r(R,C){if("string"!=typeof C)return!1;if(!Array.isArray(R))return!1;var I=C.toLowerCase();return!!~R.indexOf(I)&&I}function i(C){return r(R,C)}function a(R){return r(C,R)}function n(R){for(var C=arguments.length,I=new Array(C>1?C-1:0),_=1;_<C;_++)I[_-1]=arguments[_];for(var O=1;O<arguments.length;O++){var x=arguments[O];for(var w in x)R[w]=x[w]}return R}function s(R,C,I){var _=this,O={"enumerable":!0};_.hasBeenReset=!1;var x="",w=!1,P=R,F=C,M=I,N=null,U="",B=!0,G="auto",j="start",K=50,H="middle",V=50,W="middle";Object.defineProperty(_,"id",n({},O,{"get":function e(){return x},"set":function e(R){x=""+R}})),Object.defineProperty(_,"pauseOnExit",n({},O,{"get":function e(){return w},"set":function e(R){w=!!R}})),Object.defineProperty(_,"startTime",n({},O,{"get":function e(){return P},"set":function e(R){if("number"!=typeof R)throw new TypeError("Start time must be set to a number.");P=R,this.hasBeenReset=!0}})),Object.defineProperty(_,"endTime",n({},O,{"get":function e(){return F},"set":function e(R){if("number"!=typeof R)throw new TypeError("End time must be set to a number.");F=R,this.hasBeenReset=!0}})),Object.defineProperty(_,"text",n({},O,{"get":function e(){return M},"set":function e(R){M=""+R,this.hasBeenReset=!0}})),Object.defineProperty(_,"region",n({},O,{"get":function e(){return N},"set":function e(R){N=R,this.hasBeenReset=!0}})),Object.defineProperty(_,"vertical",n({},O,{"get":function e(){return U},"set":function e(R){var C=i(R);if(!1===C)throw new SyntaxError("An invalid or illegal string was specified.");U=C,this.hasBeenReset=!0}})),Object.defineProperty(_,"snapToLines",n({},O,{"get":function e(){return B},"set":function e(R){B=!!R,this.hasBeenReset=!0}})),Object.defineProperty(_,"line",n({},O,{"get":function e(){return G},"set":function e(R){if("number"!=typeof R&&"auto"!==R)throw new SyntaxError("An invalid number or illegal string was specified.");G=R,this.hasBeenReset=!0}})),Object.defineProperty(_,"lineAlign",n({},O,{"get":function e(){return j},"set":function e(R){var C=a(R);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");j=C,this.hasBeenReset=!0}})),Object.defineProperty(_,"position",n({},O,{"get":function e(){return K},"set":function e(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");K=R,this.hasBeenReset=!0}})),Object.defineProperty(_,"positionAlign",n({},O,{"get":function e(){return H},"set":function e(R){var C=a(R);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");H=C,this.hasBeenReset=!0}})),Object.defineProperty(_,"size",n({},O,{"get":function e(){return V},"set":function e(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");V=R,this.hasBeenReset=!0}})),Object.defineProperty(_,"align",n({},O,{"get":function e(){return W},"set":function e(R){var C=a(R);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");W=C,this.hasBeenReset=!0}})),_.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}()},"./src/utils/vttparser.ts":function srcUtilsVttparserTs(R,C,I){I.r(C),I.d(C,"parseTimeStamp",(function(){return n})),I.d(C,"fixLineBreaks",(function(){return d})),I.d(C,"VTTParser",(function(){return F}));var _=I("./src/utils/vttcue.ts"),O=function(){function e(){}return e.prototype.decode=function e(R,C){if(!R)return"";if("string"!=typeof R)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(R))},e}();function n(R){function t(R,C,I,_){return 3600*(0|R)+60*(0|C)+(0|I)+parseFloat(_||0)}var C=R.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return C?parseFloat(C[2])>59?t(C[2],C[3],0,C[4]):t(C[1],C[2],C[3],C[4]):null}var x=function(){function e(){this.values=Object.create(null)}var R=e.prototype;return R.set=function e(R,C){this.get(R)||""===C||(this.values[R]=C)},R.get=function e(R,C,I){return I?this.has(R)?this.values[R]:C[I]:this.has(R)?this.values[R]:C},R.has=function e(R){return R in this.values},R.alt=function e(R,C,I){for(var _=0;_<I.length;++_)if(C===I[_]){this.set(R,C);break}},R.integer=function e(R,C){/^-?\d+$/.test(C)&&this.set(R,parseInt(C,10))},R.percent=function e(R,C){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(C)){var e=parseFloat(C);if(e>=0&&e<=100)return this.set(R,e),!0}return!1},e}();function o(R,C,I,_){var O=_?R.split(_):[R];for(var x in O)if("string"==typeof O[x]){var w=O[x].split(I);if(2===w.length)C(w[0],w[1])}}var w=new _.default(0,0,""),P="middle"===w.align?"middle":"center";function f(R,C,I){var _=R;function a(){var C=n(R);if(null===C)throw new Error("Malformed timestamp: "+_);return R=R.replace(/^[^\sa-zA-Z-]+/,""),C}function d(){R=R.replace(/^\s+/,"")}if(d(),C.startTime=a(),d(),"--\x3e"!==R.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+_);R=R.substr(3),d(),C.endTime=a(),d(),function f(R,C){var _=new x;o(R,(function(R,C){var O;switch(R){case"region":for(var x=I.length-1;x>=0;x--)if(I[x].id===C){_.set(R,I[x].region);break}break;case"vertical":_.alt(R,C,["rl","lr"]);break;case"line":O=C.split(","),_.integer(R,O[0]),_.percent(R,O[0])&&_.set("snapToLines",!1),_.alt(R,O[0],["auto"]),2===O.length&&_.alt("lineAlign",O[1],["start",P,"end"]);break;case"position":O=C.split(","),_.percent(R,O[0]),2===O.length&&_.alt("positionAlign",O[1],["start",P,"end","line-left","line-right","auto"]);break;case"size":_.percent(R,C);break;case"align":_.alt(R,C,["start",P,"end","left","right"])}}),/:/,/\s/),C.region=_.get("region",null),C.vertical=_.get("vertical","");var O=_.get("line","auto");"auto"===O&&-1===w.line&&(O=-1),C.line=O,C.lineAlign=_.get("lineAlign","start"),C.snapToLines=_.get("snapToLines",!0),C.size=_.get("size",100),C.align=_.get("align",P);var F=_.get("position","auto");"auto"===F&&50===w.position&&(F="start"===C.align||"left"===C.align?0:"end"===C.align||"right"===C.align?100:50),C.position=F}(R,C)}function d(R){return R.replace(/<br(?: \/)?>/gi,"\n")}var F=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new O,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var R=e.prototype;return R.parse=function e(R){var C=this;function a(){var R=C.buffer,I=0;for(R=d(R);I<R.length&&"\r"!==R[I]&&"\n"!==R[I];)++I;var _=R.substr(0,I);return"\r"===R[I]&&++I,"\n"===R[I]&&++I,C.buffer=R.substr(I),_}function n(R){o(R,(function(R,C){}),/:/)}R&&(C.buffer+=C.decoder.decode(R,{"stream":!0}));try{var I="";if("INITIAL"===C.state){if(!/\r\n|\n/.test(C.buffer))return this;var O=(I=a()).match(/^()?WEBVTT([ \t].*)?$/);if(!O||!O[0])throw new Error("Malformed WebVTT signature.");C.state="HEADER"}for(var x=!1;C.buffer;){if(!/\r\n|\n/.test(C.buffer))return this;switch(x?x=!1:I=a(),C.state){case"HEADER":/:/.test(I)?n(I):I||(C.state="ID");continue;case"NOTE":I||(C.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(I)){C.state="NOTE";break}if(!I)continue;if(C.cue=new _.default(0,0,""),C.state="CUE",-1===I.indexOf("--\x3e")){C.cue.id=I;continue}case"CUE":if(!C.cue){C.state="BADCUE";continue}try{f(I,C.cue,C.regionList)}catch(e){C.cue=null,C.state="BADCUE";continue}C.state="CUETEXT";continue;case"CUETEXT":var w=-1!==I.indexOf("--\x3e");if(!I||w&&(x=!0)){C.oncue&&C.cue&&C.oncue(C.cue),C.cue=null,C.state="ID";continue}if(null===C.cue)continue;C.cue.text&&(C.cue.text+="\n"),C.cue.text+=I;continue;case"BADCUE":I||(C.state="ID")}}}catch(e){"CUETEXT"===C.state&&C.cue&&C.oncue&&C.oncue(C.cue),C.cue=null,C.state="INITIAL"===C.state?"BADWEBVTT":"BADCUE"}return this},R.flush=function e(){var R=this;try{if((R.cue||"HEADER"===R.state)&&(R.buffer+="\n\n",R.parse()),"INITIAL"===R.state||"BADWEBVTT"===R.state)throw new Error("Malformed WebVTT signature.")}catch(e){R.onparsingerror&&R.onparsingerror(e)}return R.onflush&&R.onflush(),this},e}()},"./src/utils/webvtt-parser.ts":function srcUtilsWebvttParserTs(R,C,I){I.r(C),I.d(C,"generateCueId",(function(){return c})),I.d(C,"parseWebVTT",(function(){return v}));var _=I("./src/polyfills/number.ts"),O=I("./src/utils/vttparser.ts"),x=I("./src/demux/id3.ts"),w=I("./src/utils/timescale-conversion.ts"),P=I("./src/remux/mp4-remuxer.ts"),F=/\r\n|\n\r|\n|\r/g,M=function e(R,C,I){return void 0===I&&(I=0),R.substr(I,C.length)===C},N=function e(R){var C=parseInt(R.substr(-3)),I=parseInt(R.substr(-6,2)),O=parseInt(R.substr(-9,2)),x=R.length>9?parseInt(R.substr(0,R.indexOf(":"))):0;if(!(Object(_.isFiniteNumber)(C)&&Object(_.isFiniteNumber)(I)&&Object(_.isFiniteNumber)(O)&&Object(_.isFiniteNumber)(x)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+R);return C+=1e3*I,C+=6e4*O,C+=36e5*x},U=function e(R){for(var e=5381,C=R.length;C;)e=33*e^R.charCodeAt(--C);return(e>>>0).toString()};function c(R,C,I){return U(R.toString())+U(C.toString())+U(I)}var B=function e(R,C,I){var _=R[C],O=R[_.prevCC];if(!O||!O.new&&_.new)return R.ccOffset=R.presentationOffset=_.start,void(_.new=!1);for(;null!==(x=O)&&void 0!==x&&x.new;){var x;R.ccOffset+=_.start-O.start,_.new=!1,O=R[(_=O).prevCC]}R.presentationOffset=I};function v(R,C,I,_,U,G,j,K){var H,V=new O.VTTParser,W=Object(x.utf8ArrayToStr)(new Uint8Array(R)).trim().replace(F,"\n").split("\n"),Y=[],q=Object(w.toMpegTsClockFromTimescale)(C,I),X="00:00.000",z=0,Q=0,J=!0,$=!1;V.oncue=function(R){var C=_[U],I=_.ccOffset,O=(z-q)/9e4;if(null!=C&&C.new&&(void 0!==Q?I=_.ccOffset=C.start:B(_,U,O)),O&&(I=O-_.presentationOffset),$){var x=R.endTime-R.startTime,w=Object(P.normalizePts)(9e4*(R.startTime+I-Q),9e4*G)/9e4;R.startTime=w,R.endTime=w+x}var F=R.text.trim();R.text=decodeURIComponent(encodeURIComponent(F)),R.id||(R.id=c(R.startTime,R.endTime,F)),R.endTime>0&&Y.push(R)},V.onparsingerror=function(R){H=R},V.onflush=function(){H?K(H):j(Y)},W.forEach((function(R){if(J){if(M(R,"X-TIMESTAMP-MAP=")){J=!1,$=!0,R.substr(16).split(",").forEach((function(R){M(R,"LOCAL:")?X=R.substr(6):M(R,"MPEGTS:")&&(z=parseInt(R.substr(7)))}));try{Q=N(X)/1e3}catch(R){$=!1,H=R}return}""===R&&(J=!1)}V.parse(R+"\n")})),V.flush()}},"./src/utils/xhr-loader.ts":function srcUtilsXhrLoaderTs(R,C,I){I.r(C);var _=I("./src/utils/logger.ts"),O=I("./src/loader/load-stats.ts"),x=/^age:\s*[\d.]+\s*$/m,w=function(){function e(R){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=R?R.xhrSetup:null,this.stats=new O.LoadStats,this.retryDelay=0}var R=e.prototype;return R.destroy=function e(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function e(){var R=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),R&&(R.onreadystatechange=null,R.onprogress=null,4!==R.readyState&&(this.stats.aborted=!0,R.abort()))},R.abort=function e(){var R;this.abortInternal(),null!==(R=this.callbacks)&&void 0!==R&&R.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function e(R,C,I){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=R,this.config=C,this.callbacks=I,this.retryDelay=C.retryDelay,this.loadInternal()},R.loadInternal=function e(){var R=this.config,C=this.context;if(R){var I=this.loader=new self.XMLHttpRequest,_=this.stats;_.loading.first=0,_.loaded=0;var O=this.xhrSetup;try{if(O)try{O(I,C.url)}catch(e){I.open("GET",C.url,!0),O(I,C.url)}I.readyState||I.open("GET",C.url,!0);var x=this.context.headers;if(x)for(var w in x)I.setRequestHeader(w,x[w])}catch(e){return void this.callbacks.onError({"code":I.status,"text":e.message},C,I)}C.rangeEnd&&I.setRequestHeader("Range","bytes="+C.rangeStart+"-"+(C.rangeEnd-1)),I.onreadystatechange=this.readystatechange.bind(this),I.onprogress=this.loadprogress.bind(this),I.responseType=C.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),R.timeout),I.send()}},R.readystatechange=function e(){var R=this.context,C=this.loader,I=this.stats;if(R&&C){var O=C.readyState,x=this.config;if(!I.aborted&&O>=2)if(self.clearTimeout(this.requestTimeout),0===I.loading.first&&(I.loading.first=Math.max(self.performance.now(),I.loading.start)),4===O){C.onreadystatechange=null,C.onprogress=null;var w=C.status;if(w>=200&&w<300){var P,F;if(I.loading.end=Math.max(self.performance.now(),I.loading.first),F="arraybuffer"===R.responseType?(P=C.response).byteLength:(P=C.responseText).length,I.loaded=I.total=F,!this.callbacks)return;var M=this.callbacks.onProgress;if(M&&M(I,R,P,C),!this.callbacks)return;var N={"url":C.responseURL,"data":P};this.callbacks.onSuccess(N,I,R,C)}else I.retry>=x.maxRetry||w>=400&&w<499?(_.logger.error(w+" while loading "+R.url),this.callbacks.onError({"code":w,"text":C.statusText},R,C)):(_.logger.warn(w+" while loading "+R.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,x.maxRetryDelay),I.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),x.timeout)}},R.loadtimeout=function e(){_.logger.warn("timeout while loading "+this.context.url);var R=this.callbacks;R&&(this.abortInternal(),R.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function e(R){var C=this.stats;C.loaded=R.loaded,R.lengthComputable&&(C.total=R.total)},R.getCacheAge=function e(){var R=null;if(this.loader&&x.test(this.loader.getAllResponseHeaders())){var C=this.loader.getResponseHeader("age");R=C?parseFloat(C):null}return R},e}();C.default=w}}).default}))})),x=(0,_.g)(O),w=Object.freeze(Object.assign(Object.create(null),O,{"default":x}))}}]);